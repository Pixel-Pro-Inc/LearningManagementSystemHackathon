"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[604],{5604:(Hc,dl,Ue)=>{Ue.r(dl),Ue.d(dl,{ExcelModule:()=>Bc});var fl=Ue(8583),H=Ue(639),me=Ue(1177),Ua=Ue(4762),f=Ue(1727),re=Ue(310),Oe=Ue(4811),Pt=Ue(8760),ze=Ue(8386),bt=Ue(3773),at=Ue(1355),Rt=Ue(1155),an=Ue(707),Ge=Ue(1983),Be=Ue(5509);function A(s){var e,r=[];return(s=-1===(s=s.indexOf("!")>-1?s.split("!")[1]:s).indexOf(":")?s+":"+s:s).split(":").forEach(function(t){e=B(t),r.push(e[0]),r.push(e[1])}),r}function B(s){return[parseInt(s.match(/\d+/)[0],10)-1,Vt(s.match(/[A-Z]+/i)[0].toUpperCase())]}function Vt(s){for(var e=0,r=(s=s.split("").reverse().join("")).length-1;r>=0;r--)e+=(s[r].charCodeAt(0)-64)*Math.pow(26,r);return e-1}function j(s,e){return _e(e+1)+(s+1)}function z(s){return j(s[0],s[1])+":"+((0,f.le)(s[2])?j(s[0],s[1]):j(s[2],s[3]))}function _e(s){return s/26>1?_e(s%26==0?s/26-1:Math.floor(s/26))+String.fromCharCode(s%26==0?"Z".charCodeAt(0):64+s%26):String.fromCharCode(64+s)}function De(s){return A(Cr(s))}function Cr(s){return s.split("!")[1]||s}function ul(s,e){return{sheetIndex:qt(s,e),indices:De(e)}}function qt(s,e){return e.indexOf("!")>-1?ee(s,Et(e)):s.activeSheetIndex}function Q(s){var e=s.slice();return s[0]>s[2]&&vl(e,0,2),s[1]>s[3]&&vl(e,1,3),e}function vl(s,e,r){var t=s[e];s[e]=s[r],s[r]=t}function yi(s){return s[0]===s[2]&&s[1]===s[3]}function ml(s,e,r,t,i){return new yh(s,e,r,t,i)}var yh=function(){function s(e,r,t,i,n){this.preventCallback=!1,this.context=e,this.workerTask=r,this.defaultListener=t,this.workerData=i,n&&(this.preventCallback=!0),this.initWorker()}return s.prototype.terminate=function(){this.worker.terminate(),URL.revokeObjectURL(this.workerUrl)},s.prototype.initWorker=function(){var e=new Blob([this.getFnCode()],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(e),this.worker=new Worker(this.workerUrl),this.worker.onmessage=this.messageFromWorker.bind(this),this.worker.onerror=this.onError.bind(this),this.worker.postMessage(this.workerData)},s.prototype.messageFromWorker=function(e){this.terminate(),this.defaultListener.apply(this.context,[e.data])},s.prototype.onError=function(e){throw this.terminate(),e.message||e},s.prototype.getFnCode=function(){var r,t,e="",i="",n=!1;if("function"==typeof this.workerTask)this.workerTask.toString().indexOf("function")<0?i="function "+this.workerTask.toString():(i=this.workerTask.toString(),n=!0),e+="self.workerTask = "+i+"; \n";else if("object"==typeof this.workerTask)for(t=Object.keys(this.workerTask),r=0;r<t.length;r++)this.workerTask[t[r]].toString().indexOf("function")<0?i="function "+this.workerTask[t[r]].toString():(i=this.workerTask[t[r]].toString(),n=!0),e+=(0===r?"self.workerTask":t[r])+"= "+i+"; \n";return e+"self.onmessage = "+(n?"":" function ")+(this.preventCallback?this.getMessageFn.toString():this.getCallbackMessageFn.toString())+"; \n"},s.prototype.getCallbackMessageFn=function(e){postMessage(this.workerTask.apply(this,e.data))},s.prototype.getMessageFn=function(e){this.workerTask.apply(this,e.data)},s}();function Ch(s){var e=s.toString();if(s===parseInt(e,10))return parseInt(e,10)+"  ";var r=e.indexOf(".")>-1?e.split(".")[1]:0,t=Math.pow(10,r.toString().replace("-","").length),i=Math.abs(gl(r,t));return r/i+"/"+t/i}function gl(s,e){return s=Number(s),(e=Number(e))?gl(e,s%e):s}function nr(s){(s=(s=Number(s))>0&&s<1?1+s:0===s?1:s)>60&&(s-=1);var e=new Date("01/01/1900"),r=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds());return new Date(new Date(864e5*(s-1)+r).toUTCString().replace(" GMT",""))}function Ut(s,e,r){var t=new Date("01/01/1900"),i=Hr(s)?s:new Date(s),n=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()),o=(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds())-n)/864e5;return(e?o:parseInt(o.toString(),10))+(r?0:o>60?2:1)}function Hr(s){return"[object Date]"===Object.prototype.toString.call(s)&&!isNaN(s.valueOf())}function te(s){return s-parseFloat(s)>=0}function za(s,e,r,t,i){var n=f.sd.getDependables(f.qV,r,null).dateObject,a=n.dateTimeFormats.availableFormats,o={dateObj:null,isCustom:!1,type:""},l=s;if("string"==typeof s&&(s=s.toUpperCase()),t&&(o.dateObj=e.parseDate(l,{format:t}),o.dateObj&&(o.type=s.toString().indexOf(":")>-1?"time":"datetime",o.isCustom=!0)),(0,f.le)(o.dateObj)){if((s=s.toString())&&s.indexOf("/")>-1||s.indexOf("-")>0){var h=i&&i.format||t,p=h.includes("dd-MM-yy");if((p||h.includes("dd/MM/yy"))&&(o.dateObj=e.parseDate(s,{format:h=p?"d-M-y":"d/M/y",skeleton:"yMd"}),o.dateObj))return o.type="date",o}if(s.indexOf(":")<0)for(var c=0,d=Object.keys(n.dateFormats);c<d.length;c++)if(o.dateObj=e.parseDate(s,{format:n.dateFormats[u=d[c]],skeleton:u}),o.dateObj){o.type="date",o.isCustom=!1;break}if((0,f.le)(o.dateObj))for(var v=0,g=Object.keys(a);v<g.length;v++)if(o.dateObj=e.parseDate(s,{format:a[u=g[v]],skeleton:u}),!o.dateObj&&s.indexOf(":")>-1&&a[u].indexOf(":")>-1&&(o.dateObj=e.parseDate(s,{format:a[u].split(" ")[0]})),o.dateObj){if(o.type=s.toString().indexOf(":")>-1?"time":"datetime","time"===o.type){var m=o.dateObj.toLocaleTimeString();o.dateObj=new Date("01/01/1900 "+m)}o.isCustom=!0;break}if((0,f.le)(o.dateObj))for(var y=0,C=Object.keys(n.timeFormats);y<C.length;y++){var u;if(o.dateObj=e.parseDate(s,{format:n.timeFormats[u=C[y]],skeleton:u}),o.dateObj){m=o.dateObj.toLocaleTimeString(),o.dateObj=new Date("01/01/1900 "+m),o.type="time",o.isCustom=!1;break}}}return"#DIV/0!"!==s&&!o.dateObj&&"Invalid Date"!==new Date(s).toString()&&(o.dateObj=new Date(s),o.type="date"),o}function Pr(s){return s&&"."!==s&&/^\d*\.?\d*$/.test(s)?parseFloat(s):s}function on(s,e,r,t,i){var n=s.value;return te(n)?{isNumber:!0,value:n}:(i&&s.format.indexOf(i)>-1&&n&&n.indexOf(i)>-1&&(n=n.replace(i,"")),s.format.indexOf(r)>-1&&n&&n.indexOf(r)>-1&&(n=function(s,e,r,t){for(var i=!1,o=123456..toLocaleString(e).split(r).reverse(),l=s.split(t)[0].split(r),h=0;h<l.length&&(i=h===l.length-1?l[h].length===o[0].length:0==h?l[h].length<=o[1].length:l[h].length===o[1].length);h++);return i}(n,e,r,t)?n.split(r).join(""):n),{isNumber:te(n),value:n})}var sn=function(){function s(e){this.parent=e,this.localeObj=(0,f.NE)(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.groupSep=this.localeObj.group,this.addEventListener()}return s.prototype.numberFormatting=function(e){var r=this.parent.activeSheetIndex;e.range&&e.range.indexOf("!")>-1&&(r=ee(this.parent,e.range.split("!")[0]));for(var a,t=this.parent.sheets[r],n=A(e.range?e.range.indexOf("!")>-1?e.range.split("!")[1]:e.range:t.selectedRange),o=n[0];o<=n[2];o++)for(var l=n[1];l<=n[3];l++)Je(this.parent,t,{cell:{format:e.format},rowIdx:o,colIdx:l})||(a=E(o,l,t),this.getFormattedCell({value:a.value,format:a.format,rowIndex:o,colIndex:l,sheetIndex:r,cell:a}))},s.prototype.getFormattedCell=function(e){var n,r=null==e.value?"":e.value,i=this.parent.sheets[void 0===e.sheetIndex?this.parent.activeSheetIndex:e.sheetIndex];n=void 0===e.rowIndex?A(i.activeCell):[e.rowIndex,e.colIndex];var a=e.cell||E(n[0],n[1],i,!1,!0),o=!1,l={},h=new f.eC;h.getNumberFormat(l);var d,p=(0,f.o5)(this.parent.locale,l.currency);if(e.format&&"General"!==e.format)e.type=Ft(e.format);else{e.type=e.format="General";var c={value:r,updatedVal:r,cell:a};this.checkDateFormat(c),(c.isDate||c.isTime)&&(o=!0,a.value=e.value=c.updatedVal,a.format?e.format=a.format:a.format=e.format=Ee(c.isDate?"ShortDate":"Time"))}if(a.format&&this.isCustomType(a)){e.type="Custom";var u=void 0,v=a.format;a.format=a.format.split("\\").join(""),this.currentRange=j(n[0],n[1]),a.format.indexOf(";")>-1?(a.format.indexOf("<")>-1||a.format.indexOf(">")>-1?e.result=this.processCustomConditions(a):(e.result=this.processCustomAccounting(a,n[0],n[1],e.td,p,e.skipRowFill),u=!(te(a.value)&&!(a.format&&a.format.indexOf("@")>-1))),a.format=v):Kl(a,!0)?(e.result=this.processCustomDate(e,a),u=""===e.result,e.result=e.result||a.value):a.format.indexOf("/")>-1?e.result=this.processCustomFraction(a):a.format.indexOf("@")>-1?(u=!0,e.result=this.processCustomText(a)):a.format.includes("E+0")&&te(r)?(e.format!==a.format&&(e.format=a.format),e.result=this.scientificFormat(e)):on(a,this.parent.locale,this.groupSep,this.decimalSep).isNumber?(e.result=this.processCustomNumberFormat(a,n[0],n[1],e.td),u=!te(a.value)):u=e.dataUpdate=!0,e.dataUpdate||(e.value=e.result),e.isRightAlign=!u&&!(0,f.le)(a.value)}else d=this.processFormats(e,r,o,a,h,p,l.currency);return e.isRowFill=this.isRowFill,e.onLoad||(i.id===this.parent.getActiveSheet().id&&(this.parent.notify(Ga,{isRightAlign:"Custom"===e.type?e.isRightAlign:d.rightAlign,result:"Custom"===e.type?e.value:d.fResult||e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,sheetIndex:e.sheetIndex,type:e.type,curSymbol:p,value:"Custom"===e.type?e.value:e.value||"",isRowFill:this.isRowFill}),this.isRowFill=!1),this.parent.setUsedRange(e.rowIndex,e.colIndex)),this.isRowFill=!1,"Custom"===e.type?e.formattedText=null==e.value?"":e.value.toString():(e.formattedText=d.fResult||(null==e.value?"":e.value.toString()),e.isRightAlign=d.rightAlign),e.curSymbol=p,e.formattedText},s.prototype.isCustomType=function(e){var r=Ft(e.format),t=this.parent.serviceLocator.getService("spreadsheetLocale");return!!(r===t.getConstant("General")&&e.format!==t.getConstant("General")||r===t.getConstant("Time")&&this.parent.isEdit)},s.prototype.processCustomFill=function(e,r,t,i,n,a){var p,c,o=r.format.indexOf("*"),l=e[o+1],h=e.split(e[o]+l);return""===h[1]?(e=e.split(e[o]+l).join(""),p=this.processCustomNumberFormat({format:e,value:r.value})):(p=e.split(e[o]+l)[0],c=this.processCustomNumberFormat({format:e=h[1],value:r.value}),0===parseFloat(r.value)&&(c=c.split("0").join(""))),a||(this.isRowFill=!0,this.parent.notify(Rn,{cell:r,rowIdx:t,colIdx:i,value:l,formatText:p,secText:c,td:n})),p},s.prototype.processCustomDate=function(e,r){var n,g,m,t=this,i=nr(parseFloat(r.value));if(isNaN(Number(i))&&!(n=r.value&&(g=f.sd.getDependables(f.qV,t.parent.locale,null).dateObject,m=g.months["stand-alone"]&&g.months["stand-alone"].abbreviated,m&&!!Object.keys(m).find(function(y){return r.value.toString().includes(m[y])}))))return r.value||"";var o,l=r.format,h=new f.eC,p=function(g){var m;if(r.value.toString().includes("/")||r.value.toString().includes("-")||n){if(m=(i=za(r.value,new f.eC,t.parent.locale,l,r).dateObj)&&"Invalid Date"!==i.toString()){if(i.getFullYear()<1900)return"";r.value=Ut(i).toString()}}else m=i&&"Invalid Date"!==i.toString();return g&&m&&(e.dateObj=i),m&&h.formatDate(i,{type:o,format:l})||""};if(r.format.indexOf("h")>-1&&(l=l.split("h").join("H"),o="time"),r.format.indexOf("s")>-1&&(o="time"),(r.format.indexOf("AM/PM")>-1||r.format.indexOf("A/P")>-1)&&(l=(l=l.split("H").join("h")).split("A/P").join("AM/PM").split("AM/PM").join("a"),o="time"),r.format.indexOf("d")>-1){o="date";for(var c=l.split(" "),d=void 0,u=0;u<c.length;u++)(d=c[u].match(/d/g))&&d.length>2&&(c[u]=c[u].split("d").join("E"));l=c.join(" ")}if(r.format.indexOf("m")>-1)if(r.format.indexOf("s")>-1||r.format.indexOf("h")>-1)o="time";else if(o="date",l=l.split("m").join("M"),r.format.indexOf("mmmmm")>-1){l="MMMM";var v=p()[0];return l=r.format.split("mmmmm").join("p"),p(e.checkDate).split("p").join(v)}return p(e.checkDate)},s.prototype.processCustomFraction=function(e){return""},s.prototype.processCustomConditions=function(e){if(te(e.value)){for(var r=e.format.split(";"),t=Number(e.value),i=[],n=void 0,a=void 0,o=void 0,l=void 0,h=0;h<r.length;h++){if(i.push(Ji(n=r[h])),i[h]&&(n=n.split("["+i[h]+"]").join("")),2===(o=(a=n.split("[")[1].split("]")[0]).split("<=")).length&&t<=Number(o[1])||1===o.length&&2===(o=a.split(">=")).length&&t>=Number(o[1])||1===o.length&&2===(o=a.split("<")).length&&t<Number(o[1])||1===o.length&&2===(o=a.split(">")).length&&t>Number(o[1])){e.format=r[h].split("["+a+"]")[0]+r[h].split("["+a+"]")[1],l=!1;break}l=2===o.length}return l?(e.style&&e.style.color&&i.indexOf(e.style.color)>-1&&this.parent.notify(ye,{style:{color:""},range:this.currentRange}),"#####"):this.processCustomNumberFormat(e)}return e.value},s.prototype.processCustomAccounting=function(e,r,t,i,n,a){var o,l=e.format.split(";"),h=on(e,this.parent.locale,this.groupSep,this.decimalSep,n),p=e.value;if(h.isNumber&&(e.value=h.value,o=parseFloat(h.value)),o>0)e.format=l[0];else if(0===o){if(!(0,f.le)(l[2]))return e.format=l[2]+"0",this.processCustomNumberFormat(e,r,t,i).split("0").join("");e.format=l[0]}else{if(!te(o))return e.format=l[3],(0,f.le)(l[3])?e.value?e.value.toString():"":this.processCustomText(e);e.format=l[1]}if(o<0){e.value=Math.abs(o).toString();var c=this.processCustomNumberFormat(e,r,t,i);return e.value=p,c}return this.processCustomNumberFormat(e,r,t,i,a)},s.prototype.processCustomText=function(e){var r=this.processCustomNumberFormat({format:e.format.split("@").join("#"),value:e.value?e.value.split(e.value).join("0"):""});return r&&r.split("0").join(e.value)},s.prototype.thousandSeparator=function(e,r){for(;e;)r/=1e3,e--;return r},s.prototype.getSeparatorCount=function(e){for(var r=0,t=["#","0"],i=0;i<e.format.length;i++)","===e.format[i]&&!(t.indexOf(e.format[i+1])>-1)&&r++;return r},s.prototype.processSeparator=function(e){var r=this.getSeparatorCount(e),t=this.thousandSeparator(r,parseInt(e.value,10));return e.format.indexOf(".")>-1||(t=Math.round(t)),e.value=this.getFormattedNumber(e.format.split(",").join(""),t),e.value=e.value.replace(",",""),0===t&&(e.value=e.value.replace("0","")),e.value},s.prototype.processDigits=function(e){var r=e.format.split("?").join("0"),t=e.value;return e.value=this.getFormattedNumber(r,parseFloat(e.value)),!(0,f.le)(e.value)&&e.value.includes(".")&&(e.value=e.value.split(".")[0]+"."+e.value.split(".")[1].split("0").join("  ")),""===e.value&&"0"===t&&(e.value=t),e.value},s.prototype.processSpace=function(e,r){var i={cell:r,char:" ",width:0};this.parent.notify(Fn,i);for(var a,n=i.width,o=0;o<e.length;o++)"_"===e[o]&&(i.char=e[o+1],this.parent.notify(Fn,i),a=Math.round(i.width/n),e=e.replace(e[o]+e[o+1]," ".repeat(a)));return e},s.prototype.processCustomNumberFormat=function(e,r,t,i,n){if(""===e.format)return"";var a=0,o=e.value,l=!1;if(a=on(e,this.parent.locale,this.groupSep,this.decimalSep).value,e&&te(a)){e.value=a,a=parseFloat(a.toString());var h=this.processCustomColor(e);this.getSeparatorCount(e)&&(l=!0,o=this.processSeparator(e)),h.indexOf("?")>-1&&(l=!0,h=e.format.split("?").join(""),o=this.processDigits(e)),h.indexOf("_")>-1&&(l=!0,h=e.format=this.processSpace(h,e),o=this.getFormattedNumber(h,a)),(e.format.indexOf('"')>-1||e.format.indexOf("\\")>-1)&&(h=this.processText(h)),h&&o&&h.indexOf("?")>-1&&(o=o.replace("?"," ")),h.indexOf("*")>-1&&(l=!0,o=this.processCustomFill(h,e,r,t,i,n)),"General"===h&&(l=!0,o=a.toString()),l||(o=this.getFormattedNumber(h,a)),null!=h&&h.split(".")[0].indexOf("#")>-1&&a<1&&(o=o.toString().replace(/^0+/,""))}return o},s.prototype.processText=function(e){var r=e;return r.indexOf('"')>-1?r=r.split('"').join(""):r.indexOf("\\")>-1&&(r=r.split("\\").join("")),r},s.prototype.processCustomColor=function(e){var r=e.format,t=Ji(r);return t?(r=e.format.split("["+t+"]")[0]+e.format.split("["+t+"]")[1],this.currentRange.indexOf("NaN")>-1&&(this.currentRange=void 0),this.parent.notify(ye,{style:{color:t},range:this.currentRange})):e.style&&["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(e.style.color)>-1&&this.parent.notify(ye,{style:{color:"black"}}),r},s.prototype.processFormats=function(e,r,t,i,n,a,o){var l;if(""!==r)switch(e.type){case"General":r=(l=this.autoDetectGeneralFormat({args:e,currencySymbol:a,fResult:r,intl:n,isRightAlign:t,curCode:o,cell:i,rowIdx:Number(e.rowIndex),colIdx:Number(e.colIndex)})).fResult,t=l.isRightAlign;break;case"Number":te(r)&&(r=this.applyNumberFormat(e,n),t=!0);break;case"Currency":var h=on({value:r,format:e.format},this.parent.locale,this.groupSep,this.decimalSep,a);h.isNumber&&(e.value=h.value,r=this.currencyFormat(e,n,o),t=!0);break;case"Percentage":te(r)&&(r=this.percentageFormat(e,n),t=!0);break;case"Accounting":te(r)&&(r=this.accountingFormat(e,n,a,o),t=!0);break;case"ShortDate":t=!!(r=this.shortDateFormat(e,n));break;case"LongDate":t=!!(r=this.longDateFormat(e,n));break;case"Time":t=!!(r=this.timeFormat(e,n));break;case"Fraction":te(r)&&(r=this.fractionFormat(e),t=!0);break;case"Scientific":te(r)&&(r=this.scientificFormat(e),t=!0);break;case"Text":t=!1}return{fResult:r,rightAlign:t}},s.prototype.autoDetectGeneralFormat=function(e){var r=!1,t=e.fResult;if(e.args.cell&&e.args.cell.formula&&e.args.cell.formula.indexOf("ADDRESS(")>0&&(r=!0),te(e.fResult)){e.args.format&&""!==e.args.format&&(e.fResult=e.args.format.toString().indexOf("%")>-1?this.percentageFormat(e.args,e.intl):e.args.format.toString().indexOf(e.currencySymbol)>-1?this.currencyFormat(e.args,e.intl,e.curCode):this.applyNumberFormat(e.args,e.intl));var i=void 0;"General"===e.args.format&&(i=e.fResult||e.args.value)&&i.toString().split(this.decimalSep)[0].length>11&&(e.fResult=this.scientificFormat(e.args,5)),e.isRightAlign=!0}if(!(0,f.le)(e.fResult)){var n=e.fResult.toString();if(n.indexOf("%")>-1&&""!==n.split("%")[0]&&""===n.split("%")[1].trim()&&"NaN"!==Number(n.split("%")[0].split(this.groupSep).join("")).toString())e.args.value=Number(n.split("%")[0].split(this.groupSep).join(""))/100,e.cell.format=e.args.format=this.getPercentageFormat(n),e.fResult=this.percentageFormat(e.args,e.intl),e.cell.value=e.args.value.toString(),e.isRightAlign=!0;else if(n.indexOf(e.currencySymbol)>-1){var a=n.split(e.currencySymbol);""===a[0].trim()&&""!==a[1]&&te(a[1].split(this.groupSep).join(""))&&(e.args.value=Number(a[1].split(this.groupSep).join("")),e.cell.format=e.args.format=Ee("Currency"),e.fResult=this.currencyFormat(e.args,e.intl,e.curCode),e.cell.value=e.args.value.toString(),ce(e.rowIdx,e.colIdx,this.parent.getActiveSheet(),e.cell,!0),e.isRightAlign=!0)}}return r&&(e.isRightAlign=!1,e.fResult=t),{isRightAlign:e.isRightAlign,fResult:e.fResult}},s.prototype.getPercentageFormat=function(e){return e.indexOf(this.decimalSep)>-1?Ee("Percentage"):"0%"},s.prototype.findSuffix=function(e,r){var i=e.length-r.length;return e.substr(0,i<0?0:i)+r},s.prototype.applyNumberFormat=function(e,r){e.format=this.isCustomFormat(e.format.toString());var t=e.format.toString().split(";");if(Number(e.value)>0)e.format=t[0];else if(0===Number(e.value)){if(e.format=t[2]?t[2]:t[0],e.format.indexOf('"')>-1&&-1===e.format.indexOf("#"))return e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" ").split('"').join(""),e.format}else if(Number(e.value)<0)e.format=(0,f.le)(t[1])?t[0]:t[1].split("*").join(" "),e.format.indexOf("-")>-1&&(e.value=e.value.toString().split("-").join(""));else if(e.format=t[3]?t[3]:t[0],e.format=e.format.split("_").join(" ").split("*").join(" ").split("?").join(" "),e.format.indexOf("@")>-1)return e.format.split("@").join(e.value.toString());if(e.format=e.format.split("_").join(" ").split("*").join(" ").split('"').join(""),e.format.indexOf("?")>-1&&e.format.indexOf(this.decimalSep)>-1){var i=e.format.split(this.decimalSep)[1].length,n="";Number(e.value)%1&&(n=i>e.value.toString().split(".")[1].length?" ":"0"),e.format=e.format.split("?").join(n)}else e.format=e.format.split("?").join(" ");return Number(e.value)<0&&e.cell&&(e.format=e.cell.format),r.formatNumber(Number(e.value),{format:e.format})},s.prototype.isCustomFormat=function(e){return('_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-'===e||'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-'===e)&&(e=""),(e=""===e?Ee("Number"):e).toString().split("_)").join(" ").split("_(").join(" ").split("[Red]").join("")},s.prototype.currencyFormat=function(e,r,t){e.format=""===e.format?Ee("Currency"):e.format,e.format=e.format.toString().split("_(").join(" ").split("_)").join(" ").split("[Red]").join("");var i=e.format.toString().split(";");return e.format=Number(e.value)>=0||(0,f.le)(i[1])?i[0]:i[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),r.formatNumber(Number(e.value),{format:e.format,currency:t})},s.prototype.percentageFormat=function(e,r){return e.format=""===e.format?Ee("Percentage"):e.format,r.formatNumber(Number(e.value),{format:e.format})},s.prototype.accountingFormat=function(e,r,t,i){e.format=""===e.format?Ee("Accounting"):e.format,e.format=e.format.split("_(").join(" ").split("_)").join(" ").split("[Red]").join("").split("_").join("");var n=e.format.split(";");return e.format=Number(e.value)>=0?n[0]:n[1].split("*").join(" "),e.format=this.getFormatForOtherCurrency(e.format),0===Number(e.value)?t+"- ":r.formatNumber(Number(e.value),{format:e.format,currency:i}).split("-").join("")},s.prototype.getFormatForOtherCurrency=function(e){if(e.indexOf("[$")>-1){var r=e.split("]")[0].split("[$")[1].split("-")[0];e=e.indexOf("0")>e.indexOf("[$")?r+e.slice(e.indexOf("]")+1,e.length):e.slice(0,e.indexOf("[$"))+r}return e},s.prototype.shortDateFormat=function(e,r){var i,t=""===e.format||"General"===e.format?Ee("ShortDate"):e.format;if(t===Ee("ShortDate")?(t="MM-dd-yyyy",i={type:"date",skeleton:"yMd"}):i={type:"date",format:t},e.value&&(e.value=e.value.toString(),e.value.includes("/")||e.value.includes("-"))){("dd-MM-yyyy"===t||"dd/MM/yyyy"===t)&&(t="");var n=za(e.value,new f.eC,this.parent.locale,t,e.cell).dateObj;if(n&&"Invalid Date"!==n.toString())return n.getFullYear()<1900?"":(e.value=Ut(n).toString(),e.cell&&(e.cell.value=e.value),e.checkDate&&(e.dateObj=n),r.formatDate(n,i))}var a=nr(e.value);return e.checkDate&&(e.dateObj=a),r.formatDate(a,i)},s.prototype.longDateFormat=function(e,r){var t=nr(e.value),i=""===e.format||"General"===e.format?Ee("LongDate"):e.format.toString();return i===Ee("LongDate")&&(i="EEEE, MMMM d, y"),e.checkDate&&(e.dateObj=t),r.formatDate(t,{type:"date",format:i})},s.prototype.timeFormat=function(e,r){if((0,f.le)(e.value))return"";var t=e.value.toString().split(this.decimalSep);(0,f.le)(t[1])||(e.value=parseFloat(t[0]+1+this.decimalSep+t[1])||e.value);var i=nr(e.value),n=""===e.format||"General"===e.format?Ee("Time"):e.format.toString();return n===Ee("Time")&&(n="h:mm:ss a"),r.formatDate(i,{type:"time",skeleton:"medium",format:n})},s.prototype.scientificFormat=function(e,r){e.format=""===e.format?Ee("Scientific"):e.format;var t=e.format.split("+")[1]||"00";r=r||this.findDecimalPlaces(e.format,"Scientific");var i=Number(e.value).toExponential(r);return i.indexOf("e+")>-1?i=i.split("e+")[0]+"E+"+this.findSuffix(t,i.split("e+")[1]):i.indexOf("e-")>-1&&(i=i.split("e-")[0]+"E-"+ +this.findSuffix(t,i.split("e-")[1])),i},s.prototype.fractionFormat=function(e){e.format=""===e.format?Ee("Fraction"):e.format;var t,r="";return e.value.toString().indexOf(this.decimalSep)>-1&&te(e.value)?(r=e.value.toString().split(this.decimalSep)[0],t=Ch(Number(e.value)),0===Number(r)?" "+t:r+" "+t):r},s.prototype.findDecimalPlaces=function(e,r){var t,i;return"Scientific"===r&&(t=e.toUpperCase().indexOf("E"),i=e.indexOf(this.decimalSep),t>-1)?e.substring(i+1,t).length:2},s.prototype.checkDateFormat=function(e){if(!(0,f.le)(e.value)){var r=e.cell||E(e.rowIndex,e.colIndex,_(this.parent,(0,f.le)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex),!1,!0),t=this.checkCustomDateFormat(e.value.toString(),r);if("Invalid"!==t.val){var i=za(t.val,new f.eC,this.parent.locale,t.format,r);!(0,f.le)(i.dateObj)&&"Invalid Date"!==i.dateObj.toString()&&i.dateObj.getFullYear()>=1900&&(t.val=Ut(i.dateObj,t.val.indexOf(":")>-1,i.type&&"time"===i.type).toString(),r.format||(r.format=Ee("time"===i.type?"Time":"ShortDate")),e.isDate="date"===i.type||"datetime"===i.type,e.isTime="time"===i.type,e.dateObj=i.dateObj),e.updatedVal=t.val}}},s.prototype.checkCustomDateFormat=function(e,r){var t;if(e.includes("/"))t="/";else{if(!e.includes("-"))return{val:e.includes(":")?e:"Invalid",format:""};t="-"}var i=e.split(t),n="",a=[],o=function(){n=a.join(t),r.format||(r.format=n)};if(2===i.length){var l,h=function(v){e=l,a[0]="MMM",Number(v)<=31?(e=v+t+e,a.splice(0,0,"dd"),o()):Number(v)>=1900&&Number(v)<=9999&&(e+=t+v.slice(2,4),a[1]="yy",o())},p=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];i[0]=i[0].toLowerCase().trim(),i[1]=i[1].toLowerCase().trim();var c=i[1].substring(0,3);(l=!Number(i[0])&&p.find(function(v){return i[0].includes(v)}))?i[0].includes(",")||h(i[1]):(l=!Number(i[1])&&p.find(function(v){return c.includes(v)}))?h(i[0]):i[0]&&Number(i[0])<=12&&Number(i[1])&&(l=p[Number(i[0])-1],h(i[1])),a.length||(e="Invalid")}else if(i.length>2){p=["jan","feb","mar","apr","may","jun","jul","aug","sep","sept","oct","nov","dec"];for(var d=function(g){Number(i[g])>-1||(p.filter(function(m){return i[g].toLowerCase().includes(m)}).length?1===g&&(a[1]="MMM",Number(i[0])<31&&Number(i[2])>=1900&&Number(i[2])<=9999&&(a[0]="d",a[2]="yy",o())):e="Invalid")},u=0;u<i.length;u++)d(u)}return{val:e,format:n}},s.prototype.formattedBarText=function(e){if(""!==e.value){var r=Ft(e.cell?e.cell.format:""),t=new f.eC,i=e.value,n="ShortDate"===r&&e.cell&&e.cell.format?e.cell.format:Ee("ShortDate"),a=Ee("Time");switch(r){case"ShortDate":case"LongDate":e.value=this.shortDateFormat({type:r,value:e.value,format:n,cell:e.cell},t);break;case"Time":e.value=i&&Number(i)>=1?this.shortDateFormat({type:r,value:e.value,format:n},t)+" "+this.timeFormat({type:r,value:e.value,format:a},t):this.timeFormat({type:r,value:e.value,format:a},t)}(!e.value||e.value&&e.value.toString().indexOf("null")>-1)&&(e.value=i)}},s.prototype.getFormattedNumber=function(e,r){return(new f.eC).formatNumber(Number(r),{format:e})||""},s.prototype.addEventListener=function(){this.parent.on(xi,this.numberFormatting,this),this.parent.on(ot,this.getFormattedCell,this),this.parent.on(Tt,this.checkDateFormat,this),this.parent.on(Ya,this.formattedBarText,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(xi,this.numberFormatting),this.parent.off(ot,this.getFormattedCell),this.parent.off(Tt,this.checkDateFormat),this.parent.off(Ya,this.formattedBarText))},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"workbookNumberFormat"},s}();function Ee(s){var e="General";switch(s.split(" ").join("")){case"Number":e="0.00";break;case"Currency":e="$#,##0.00";break;case"Accounting":e='_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)';break;case"ShortDate":e="mm-dd-yyyy";break;case"LongDate":e="dddd, mmmm dd, yyyy";break;case"Time":e="h:mm:ss AM/PM";break;case"Percentage":e="0.00%";break;case"Fraction":e="# ?/?";break;case"Scientific":e="0.00E+00";break;case"Text":e="@"}return e}function Ft(s){var e="General";switch(s){case'_-* #,##0.00_-;-* #,##0.00_-;_-* "-"_-;_-@_-':case'_-* #,##0_-;-* #,##0_-;_-* "-"_-;_-@_-':e="Number";break;case"$#,##0.00":case"$#,##0_);[Red]($#,##0)":case"$#,##0.00_);($#,##0.00)":case"$#,##0_);($#,##0)":e="Currency";break;case'_($*#,##0.00_);_($*(#,##0.00);_($*"-"??_);_(@_)':case'_($*#,##0.00_);_($* (#,##0.00);_($*"-"??_);_(@_)':case'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)':case'_ $ * #,##0.00_ ;_ $ * -#,##0.00_ ;_ $ * "-"??_ ;_ @_ ':e="Accounting";break;case"mm-dd-yyyy":case"dd/MM/yyyy":e="ShortDate";break;case"dddd, mmmm dd, yyyy":e="LongDate";break;case"h:mm:ss AM/PM":e="Time";break;case"0.00%":case"0%":e="Percentage";break;case"# ?/?":case"# ??/??":case"# ???/???":e="Fraction";break;case"0.00E+00":e="Scientific";break;case"@":e="Text";break;default:s&&s.indexOf("[$")>-1&&(e=s.indexOf("* ")>-1?"Accounting":"Currency")}return e}var s,br=function(){function s(e){this.parent=e,this.requestedInfo=[],this.addEventListener()}return s.prototype.addEventListener=function(){this.parent.on(hn,this.updateSheetFromDataSourceHandler,this),this.parent.on(_a,this.dataSourceChangedHandler,this),this.parent.on(pn,this.dataChangedHandler,this),this.parent.on(Ci,this.triggerDataChangeHandler,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(hn,this.updateSheetFromDataSourceHandler),this.parent.off(_a,this.dataSourceChangedHandler),this.parent.off(pn,this.dataChangedHandler),this.parent.off(Ci,this.triggerDataChangeHandler))},s.prototype.updateSheetFromDataSourceHandler=function(e){var t,i,n,a,o,h,d,v,g,m,r=this,p=[],c=[],u=new re.BH;if(e.promise=u.promise,e.sheet&&e.sheet.ranges.length)for(var y=function(S){var w=e.indexes[0],x=e.indexes[2],I=e.sheet.ranges[S];v=A(I.startCell)[0],h=I.dataSource instanceof re.hm?I.dataSource:I.dataSource?new re.hm(I.dataSource):new re.hm,o=o||h.dataSource.url,e.sheet.isLocalData=!h.dataSource.url,v<=w?w-=v:v<=x?(x-=v,w=0):w=-1,I.showFieldAsHeader&&0!==w&&(w-=1);var F=!1,T=0;C.initRangeInfo(I);var k=C.getMaxCount(I);if(m=C.getLoadedInfo(w,x,I),w=m.unloadedRange[0],x=m.unloadedRange[1],I.info.insertRowRange&&(I.info.insertRowRange.forEach(function(D){T+=D[1]-D[0]+1}),w-=T,x-=T),w>=k?F=!0:x>k&&(x=k),C.requestedInfo.push({deferred:u,indexes:e.indexes,isNotLoaded:m.isNotLoaded}),w>=0&&m.isNotLoaded&&!F){c[S]=w,p[S]=!1;var R=(I.query?I.query:new re.AE).clone();h.executeQuery(R.range(w,x>=k?x:x+1).requiresCount()).then(function(D){if(r.parent&&!r.parent.isDestroyed){if(a=D.result&&D.result.result?D.result.result:D.result,n=A(I.startCell),v=n[0],g=n[1],a&&a.length){if(I.info.count||(k=D.count,I.info.count=D.count),i=Object.keys(a[0]),I.info.fldLen||(I.info.fldLen=i.length,I.info.flds=i),I.info.insertColumnRange){var N=0;I.info.insertColumnRange.forEach(function(G){for(var $=G[0];$<=G[1];$++)i.splice($<=g?0:$-g,0,"emptyCell"+N),N++})}0===c[S]&&I.showFieldAsHeader&&(d=v+c[S]+T,i.forEach(function(G,$){(t=E(d,g+$,e.sheet,!0))?G.includes("emptyCell")||(t.value=G):e.sheet.rows[v+c[S]].cells[g+$]=G.includes("emptyCell")?{}:{value:G}})),e.formulaCellRef&&ht(r.parent,e.sheet.id),a.forEach(function(G,$){d=v+c[S]+$+(I.showFieldAsHeader?1:0)+T;for(var J=0;J<i.length;J++)(t=E(d,g+J,e.sheet,!0))?i[J].includes("emptyCell")||ce(d,g+J,e.sheet,r.getCellDataFromProp(G[i[J]]),!0):e.sheet.rows[d].cells[g+J]=i[J].includes("emptyCell")?{}:r.getCellDataFromProp(G[i[J]])})}else i=[];var M;M=v+(k||D.count)>0?v+(k||D.count)+(I.showFieldAsHeader?1:0)+T-1:e.sheet.usedRange.rowIndex;var V=g+i.length-1<0?e.sheet.usedRange.colIndex:g+i.length-1;if(e.isFinite?(e.sheet.usedRange.rowIndex=M<e.sheet.rowCount?M:e.sheet.rowCount-1,e.sheet.usedRange.colIndex=V<e.sheet.colCount?V:e.sheet.colCount-1):(e.sheet.usedRange.rowIndex=M,e.sheet.usedRange.colIndex=V),T?(m=r.getLoadedInfo(w,x,I),x=m.unloadedRange[1],(w=m.unloadedRange[0])>k&&(m.isNotLoaded=!1),m.isNotLoaded&&(x>k&&(x=k),I.info.loadedRange.push([w,x]))):I.info.loadedRange.push([w,x]),p[S]=!0,-1===p.indexOf(!1)){var Y=void 0;if(x+v<v+I.info.count){e.rangeSettingCount||(e.rangeSettingCount=[]),e.rangeSettingCount.push(S),Y=!0;var X={sheet:e.sheet,indexes:[0,0,M,V],promise:new Promise(function(G,$){G(void 0)}),rangeSettingCount:e.rangeSettingCount,isFinite:e.isFinite,resolveAfterFullDataLoaded:e.resolveAfterFullDataLoaded};r.updateSheetFromDataSourceHandler(X),X.promise.then(function(){"workbook"!==r.parent.getModuleName()&&(e.rangeSettingCount.pop(),e.rangeSettingCount.length||r.parent.notify("created",null),e.formulaCellRef&&r.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex))})}else e.formulaCellRef&&r.notfyFormulaCellRefresh(e.formulaCellRef,e.sheetIndex);Y&&e.resolveAfterFullDataLoaded||(r.checkResolve(e.indexes),e.resolveAfterFullDataLoaded&&r.checkResolve([0,0,0,0]))}}})}else 0===S&&-1===p.indexOf(!1)&&C.checkResolve(e.indexes)},C=this,b=e.sheet.ranges.length-1;b>=0;b--)y(b);else u.resolve()},s.prototype.notfyFormulaCellRefresh=function(e,r){this.parent.formulaRefCell=null,this.parent.notify("updateView",{indexes:A(e),sheetIndex:r,refreshing:!0})},s.prototype.checkResolve=function(e){var r,t,i=0;this.requestedInfo.forEach(function(n,a){((t=JSON.stringify(n.indexes)===JSON.stringify(e))||r)&&(0===a?(n.deferred.resolve(),i++,r=!0):r&&(n.isLoaded||!n.isNotLoaded)||t&&r?(n.deferred.resolve(),i++):t?n.isLoaded=!0:r=!1)}),this.requestedInfo.splice(0,i)},s.prototype.getCellDataFromProp=function(e){var r={};return"[object Object]"===Object.prototype.toString.call(e)?e.formula?r.formula=e.formula:(0,f.le)(e.value)||("string"!=typeof e.value||0!==e.value.indexOf("http://")&&0!==e.value.indexOf("https://")&&0!==e.value.indexOf("ftp://")&&0!==e.value.indexOf("www.")?r.value=e.value:(r.hyperlink=e.value,r.style={textDecoration:"underline",color:"#00e"})):pe(e)?r.formula=e:"string"!=typeof e||0!==e.indexOf("http://")&&0!==e.indexOf("https://")&&0!==e.indexOf("ftp://")&&0!==e.indexOf("www.")?r.value=e:(r.hyperlink=e,r.style={textDecoration:"underline",color:"#00e"}),r},s.prototype.checkDataForFormat=function(e){if(""!==e.value){var r={value:e.value,rowIndex:e.rowIndex,colIndex:e.colIndex,isDate:!1,updatedVal:e.value,isTime:!1,sheetIndex:e.sheetIndex};this.parent.notify(Tt,r),r.isDate?e.cell?(e.cell.format||(e.cell.format=Ee("ShortDate")),e.cell.value=r.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=Ee("ShortDate"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=r.updatedVal):r.isTime&&(e.cell?(e.cell.format||(e.cell.format=Ee("Time")),e.cell.value=r.updatedVal):(e.args.sheet.rows[e.rowIndex].cells[e.colIndex].format=Ee("Time"),e.args.sheet.rows[e.rowIndex].cells[e.colIndex].value=r.updatedVal))}},s.prototype.getLoadedInfo=function(e,r,t){var i=!0;return t.info.loadedRange.forEach(function(n){n[0]<=e&&e<=n[1]?n[0]<=r&&r<=n[1]?i=!1:e=n[1]+1:n[0]<=r&&r<=n[1]&&(r=n[0]-1)}),{isNotLoaded:i,unloadedRange:[e,r]}},s.prototype.getMaxCount=function(e){if(e.query)for(var r=e.query.queries,t=0;t<r.length;t++)if("onTake"===r[t].fn)return Math.min(r[t].e.nos,e.info.count||r[t].e.nos);return e.info.count},s.prototype.initRangeInfo=function(e){e.info||(e.info={loadedRange:[]})},s.prototype.dataSourceChangedHandler=function(e){var t,r=this,i=this.parent.sheets[e.sheetIdx],n=i.ranges[e.rangeIdx];if(n&&(this.checkRangeHasChanges(i,e.rangeIdx)||!n.info)){var a=n.showFieldAsHeader,o=B(n.startCell);n.info&&(n.info.loadedRange.forEach(function(c){for(var d=c[0];d<=c[1]&&d<n.info.count+(a?1:0);d++)if(t=i.rows[d+o[0]])for(var u=o[1];u<o[1]+n.info.fldLen;u++)t.cells&&t.cells[u]&&delete t.cells[u]}),n.info=null);var l=this.parent.viewport,h=[l.topIndex,l.leftIndex,l.bottomIndex,l.rightIndex],p={sheet:i,indexes:h,dataSourceChange:!0,promise:new Promise(function(c,d){c(void 0)})};this.updateSheetFromDataSourceHandler(p),p.promise.then(function(){r.parent.trigger("dataSourceChanged",{data:e.changedData,action:"dataSourceChanged",rangeIndex:Number(e.rangeIdx),sheetIndex:Number(e.sheetIdx)}),r.parent.notify("updateView",{indexes:h,checkWrap:!0,checkCF:!0})})}},s.prototype.checkRangeHasChanges=function(e,r){if(this.parent.isAngular){var t="changedRangeIdx";return e[t]===parseInt(r,10)&&(delete e[t],!0)}return!0},s.prototype.dataChangedHandler=function(e){var i,n,a,o,l,h,p,u,v,r=this,t=[{}],c=void 0===e.sheetIdx?this.parent.activeSheetIndex:e.sheetIdx,d=this.parent.sheets[c];d.ranges.forEach(function(g,m){if(g.dataSource){var y=void 0;if(o=B(g.startCell),a=o.concat([o[0]+g.info.count+(g.showFieldAsHeader?0:-1),o[1]+g.info.fldLen-1]),"Row"===e.modelType||"Column"===e.modelType){if("Column"===e.modelType){if(e.insertType)u=[e.index],(l=a[1]<e.index&&a[3]>=e.index)||a[3]+1===e.index&&"after"===e.insertType?(e.model.forEach(function(){g.info.flds.splice(e.index-o[1],0,"")}),g.info.fldLen+=e.model.length):a[1]>=e.index&&(g.startCell=j(o[0],o[1]+e.model.length));else if(l=a[1]<=e.startIndex&&a[3]>=e.startIndex)for(var C=e.startIndex;C<=e.endIndex;C++)C<=a[3]&&(g.info.flds.splice(e.startIndex,1),g.info.fldLen-=1);return}if(e.insertType){if(u=[e.index],(l=(g.showFieldAsHeader||"above"!==e.insertType&&!e.isMethod?a[0]<e.index:a[0]<=e.index)&&a[2]>=e.index)||a[2]+1===e.index&&"below"===e.insertType?(y=!0,g.info.count+=e.model.length):a[0]>=e.index&&(g.startCell=j(o[0]+e.model.length,o[1])),e.isMethod)return}else l=a[0]<=e.startIndex&&a[2]>=e.startIndex,e.isDataRequest?u=[e.startIndex,a[1],e.startIndex,a[1]]:i="delete"}else{u=A(e.requestType&&e.requestType.toLowerCase().includes("paste")?e.pastedRange.split("!")[1]:e.sheetIdx>-1?e.address:(e.address||e.range||e.fillRange).split("!")[1]);var b=[g.showFieldAsHeader?a[0]+1:a[0]].concat(a.slice(1,4));if(g.showFieldAsHeader&&u[0]===o[0])for(C=u[1];C<=u[3];C++)C>=b[1]&&C<=b[3]&&(g.info.flds[C-o[1]]=E(o[0],C,d,!1,!0).value||"");if(l=Zi(b,u,!0),"paste"===e.requestType&&e.copiedInfo.isCut){if(v=[].slice.call(e.copiedInfo.range),g.showFieldAsHeader&&v[0]===o[0]){for(C=v[1];C<=v[3];C++)C>=b[1]&&C<=b[3]&&(g.info.flds[C-o[1]]="");l=!1}h=Zi(b,v,!0)}}if(l||y||h){if("Row"!==e.modelType||e.insertType||e.isDataRequest){i=y?"add":"edit";var S=0;if(h){S=v[2]-v[0]+1;var w=function(k){t[k]={},g.info.flds.forEach(function(R,D){R&&(n=E(v[0]+k,o[1]+D,d),t[k][R]=r.getFormattedValue(n))})};for(C=0;C<S;C++)w(C)}if(l||y)for(var F,x=!(e.isDataRequest||h||y||e.skipFilterCheck),I=function(k,R){if(x&&rr(d,u[0]+k))return F=R,"continue";t[R+S]={},g.info.flds.forEach(function(D,N){D&&(n=E(u[0]+k,o[1]+N,d),t[R+S][D]=r.getFormattedValue(n))}),R++,F=R},T=(C=0,0);C<(y?e.model.length:u[2]-u[0]+1||1);C++)I(C,T),T=F}else{if(e.deletedModel.forEach(function(k,R){t[R]={},g.info.flds.forEach(function(D,N){t[R][D]=k.cells?r.getFormattedValue(n=k.cells[o[1]+N]):null}),g.info.count-=1}),e.isMethod)return;p={count:e.deletedModel.length,index:e.endIndex}}e.isDataRequest?e.data=t:r.parent.trigger("dataSourceChanged",{data:t,action:i,rangeIndex:m,sheetIndex:c})}else p&&p.count&&a[0]>p.index&&(g.startCell=j(o[0]-p.count,o[1]))}})},s.prototype.getFormattedValue=function(e){var r=this.parent.getDisplayText(e);return""===r?null:e&&!e.format&&"number"==typeof e.value?e.value:r},s.prototype.triggerDataChangeHandler=function(e){var t=!0;if((("delete"===e.action||"insert"===e.action)&&["Sheet"].indexOf(e.eventArgs.modelType)>-1||"clear"===e.action&&["Clear Formats","Clear Hyperlinks"].indexOf(e.eventArgs.type)>-1||"clipboard"===e.action&&"Formats"===e.eventArgs.requestType)&&(t=!1),t&&["insert","delete","edit","cellDelete","cellSave","autofill","clipboard","clear"].indexOf(e.action)>-1){var i=void 0;!e.isUndo||"delete"!==e.action&&"insert"!==e.action?i=e.eventArgs:(i=(0,f.l7)({},e.eventArgs),"delete"===e.action?(i.index=i.startIndex,i.model=i.deletedModel,i.insertType="below"):(i.startIndex=i.index,i.endIndex=e.eventArgs.index+e.eventArgs.model.length-1,i.deletedModel=i.model,delete i.insertType)),this.parent.notify(pn,i)}},s.prototype.getModuleName=function(){return"dataBind"},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.requestedInfo=[]},s}(),ln=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.open=function(e){var r=this;if(this.parent.allowOpen){if(e.jsonObject)return void this.fetchSuccess(e.jsonObject,null,null,!0);var t=new FormData;if(e.file)t.append("file",e.file);else{if(!(e.sheetIndex>=0))return void(this.parent.isOpen=!1);t.append("sheetPassword",e.sheetPassword),t.append("sheetIndex",e.sheetIndex.toString())}var i={passWord:""};e.password&&e.password.length&&(i.passWord=e.password),i.passWord&&i.passWord.length&&(e.password=i.passWord),e.password&&t.append("password",e.password);var n={file:e.file||null,cancel:!1,requestData:{method:"POST",body:t},password:i.passWord},a=e.guid;if((0,f.le)(e.sheetPassword)&&!a?(this.parent.trigger("beforeOpen",n),this.parent.notify(ue,{eventArgs:n,action:"beforeOpen"})):a&&t.append("guid",a),n.cancel)return void(this.parent.isOpen=!1);fetch(this.parent.openUrl,n.requestData).then(function(o){return o.ok?o.json():Promise.reject({status:o.status,statusText:o.statusText,url:o.url})}).then(function(o){return r.fetchSuccess(o,n,e.orginalFile)}).catch(function(o){return r.fetchFailure(o)})}},s.prototype.fetchFailure=function(e){(0,f.o8)(e.status)&&(0,f.o8)(e.statusText)&&(e.statusText="Improper response"),this.parent.notify(Xa,e),this.parent.isOpen=!1},s.prototype.fetchSuccess=function(e,r,t,i){var a,o=(a="string"==typeof e?JSON.parse(e):e).Workbook;if(["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword","DataLimitExceeded","FileSizeLimitExceeded"].indexOf(o)>-1)return t&&(r.file=t),void this.parent.notify(un,{context:this,data:o,guid:a.Guid,eventArgs:r,isOpenFromJson:i});this.updateModel(o,i),this.parent.notify(un,{context:this,data:o,isOpenFromJson:i}),this.parent.isOpen=!1,r&&r.password&&r.password.length>0&&(this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.parent.password="")},s.prototype.updateModel=function(e,r){this.parent.notify(ie,{action:"unRegisterSheet"}),this.setSelectAllRange(e.sheets,r),this.parent.sheetNameCount=1,this.parent.sheets=[],this.parent.notify(ar,{}),e.activeSheetIndex=e.activeSheetIndex||0,this.parent.setProperties({sheets:e.sheets,activeSheetIndex:e.activeSheetIndex,definedNames:e.definedNames||[],filterCollection:e.filterCollection||[],sortCollection:e.sortCollection||[]},!0),Qi(this.parent),this.parent.notify(Ii,null),this.parent.notify(ie,{action:"registerSheet",isImport:!0}),this.parent.notify(ie,{action:"initiateDefinedNames"}),this.parent.notify(no,null)},s.prototype.setSelectAllRange=function(e,r){var i,n,t=this;e.forEach(function(a){if(a.selectedRange){var o=A(a.selectedRange),l=((0,f.o8)(a.rowCount)?100:a.rowCount)-1,h=((0,f.o8)(a.colCount)?100:a.colCount)-1;65535===o[2]&&(o[2]=l),255===o[3]&&(o[3]=h),65535===o[0]&&(o[0]=l),255===o[1]&&(o[1]=h),a.selectedRange=z(o)}if(r&&t.parent.isAngular)for(var p=0;p<t.parent.sheets.length;p++)if(a.name===(i=t.parent.sheets[p]).name){a.ranges&&a.ranges.forEach(function(c,d){(n=i.ranges[d])&&n.template&&(c.template=n.template)});break}})},s.prototype.addEventListener=function(){this.parent.on(cn,this.open.bind(this))},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(cn,this.open.bind(this))},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"workbookOpen"},s}(),hn="updateSheetFromDataSource",_a="dataSourceChanged",pn="dataChanged",Ci="triggerDataChange",cn="workbookOpen",bi="beginSave",ue="actionBegin",dn="sortImport",Wa="ribbonFind",fn="exportDialog",Si="getFilteredCollection",wi="saveCompleted",xi="applyNumber",ot="getFormattedCell",Ga="refreshCellElem",ye="setCellFormat",ja="findAllValues",Vr="textDecorationUpdate",He="applyCellFormat",qr="updateRowColCount",ie="workbookFormulaOperation",Sr="workbookEditOperation",Tt="checkDateFormat",Ya="getFormattedBarText",St="activeCellChanged",un="openSuccess",Xa="openFailure",Ii="sheetCreated",ar="sheetsDestroyed",Ei="aggregateComputation",Za="getUniqueRange",Ur="removeUniquecol",At="checkUniqueRange",vn="reApplyFormula",zr="clearFormulaDependentCells",mn="formulaInValidation",ki="initiateSort",Ka="updateSortedDataOnCell",Ri="sortComplete",_r="setLinkModel",gn="initiateFilter",yl="filterRangeAlert",or="wrapText",$a="onSave",Qa="insert",Ja="delete",wt="insertModel",Fi="deleteModel",Ti="isValidation",sr="cellValidation",Wr="addHighlight",eo="findNext",to="findPrevious",st="gotoHandler",Ai="replace",Gr="replaceAll",Ke="ShowDialog",ro="findKeyUp",io="removeHighlight",yn="count",no="protectSheet",Cl="updateToggleItem",jr="protectsheetHandler",Cn="replaceAllDialog",bl="unprotectsheetHandler",bn="setLockCells",tt="setMerge",zt="applyMerge",Yr="mergedRange",Ne="activeCellMergedRange",Sn="insertMerge",ao="pasteMerge",je="hideShow",Xr="setCFRule",We="applyCF",_t="clearCFRule",wr="clear",oo="clearCF",wn="setImage",lr="setChart",Zr="initiateChart",Jt="refreshRibbonIcons",Kr="refreshChart",$r="refreshChartSize",so="updateChart",xn="deleteChartColl",lo="focusChartBorder",ho="saveError",po="validationHighlight",Sl="updateFilter",Di="beforeInsert",Li="beforeDelete",In="deleteHyperlink",En="moveOrDuplicateSheet",Qr="setAutoFill",wl="refreshCell",co="getFillInfo",kn="getautofillDDB",Rn="rowFillHandler",Fn="getTextSpace",Tn="refreshClipboard",xl="updateView",Wt="selectionComplete",hr="refreshInsertDelete",An="getUpdatedFormulaOnInsertDelete",fo="duplicateSheetFilterHandler",uo="unMerge",Ah=function(){function s(e){this.parent=e}return s.prototype.processSheet=function(e,r){return[r,JSON.parse(e,function(i,n){if(!Array.isArray(n)&&"string"!=typeof n||n.length)return n})]},s.prototype.processSave=function(e,r,t,i){var a,n=new FormData,o=Object.keys(r);for(n.append("JSONData",JSON.stringify(e)),a=0;a<o.length;a++)n.append(o[a],r[o[a]]);for(o=Object.keys(t),a=0;a<o.length;a++)n.append(o[a],t[o[a]]);n.append("pdfLayoutSettings",JSON.stringify(i)),fetch(r.url,{method:"POST",body:n}).then(function(l){return l.ok?l.blob():Promise.reject({message:l.statusText})}).then(function(l){new Promise(function(h){var p=new FileReader;p.onload=function(){var c=p.result.toString();if(c.indexOf("data:text/plain;base64,")>-1||c.indexOf("data:text/html;base64,")>-1||c.indexOf("data:application/json;base64,")>-1){var d=void 0;if((c=(c=c.replace("data:text/plain;base64,","")).replace("data:text/html;base64,","")).indexOf("data:application/json;base64,")>-1?(c=c.replace("data:application/json;base64,",""),d=atob(c).split(".")):d=atob(c).split(/(\r\n|\n|\r)/gm),d.length){var u=d[0].length>1&&'"'===d[0][0]?d[0].split('"')[1]+".":d[0];postMessage({dialog:u})}}else postMessage(l);h(p.result)},p.readAsDataURL(l)})}).catch(function(l){postMessage({error:l.message})})},s}(),Dh=(s=function(e,r){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(e,r)},function(e,r){function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}),Dn=function(s){function e(r){var t=s.call(this,r)||this;return t.isProcessCompleted=!1,t.saveJSON={},t.isFullPost=!1,t.needBlobData=!1,t.customParams=null,t.pdfLayoutSettings={fitSheetOnOnePage:!1},t.addEventListener(),t}return Dh(e,s),e.prototype.getModuleName=function(){return"workbookSave"},e.prototype.destroy=function(){this.removeEventListener(),this.parent=null},e.prototype.addEventListener=function(){this.parent.on(bi,this.initiateSave,this)},e.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(bi,this.initiateSave)},e.prototype.initiateSave=function(r){var t=r.saveSettings;this.parent.notify(Si,null),this.saveSettings={saveType:t.saveType,url:t.url,fileName:t.fileName||"Sample"},this.isFullPost=r.isFullPost,this.needBlobData=r.needBlobData,this.needBlobData&&(this.isFullPost=!1),this.customParams=r.customParams,this.pdfLayoutSettings=r.pdfLayoutSettings,this.updateBasicSettings(),this.processSheets()},e.prototype.updateBasicSettings=function(){var r=this.getStringifyObject(this.parent,["sheets","_isScalar","observers","closed","isStopped","hasError","__isAsync","beforeCellFormat","beforeCellRender","beforeDataBound","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","beforeCellSave","contextMenuItemSelect","contextMenuBeforeClose","contextMenuBeforeOpen","created","dataBound","fileMenuItemSelect","fileMenuBeforeClose","fileMenuBeforeOpen","saveComplete","sortComplete","select","actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeHyperlinkClick","beforeHyperlinkCreate","openComplete","openFailure","queryCellInfo","dialogBeforeOpen","dataSourceChanged","beforeConditionalFormat","beforeCellUpdate"]),t=JSON.parse(r);this.parent.sheets.length&&(t.sheets=[]),this.saveJSON=t},e.prototype.processSheets=function(){var r=["dataSource","startCell","query","showFieldAsHeader","result"];this.parent.isAngular&&r.push("template");for(var t=0,i=this.parent.sheets.length;t<i;t++)ml(this,this.processSheet,this.updateSheet,[this.getStringifyObject(this.parent.sheets[t],r,t),t])},e.prototype.updateSheet=function(r){this.saveJSON.sheets[r[0]]=r[1],this.isProcessCompleted=this.getSheetLength(this.saveJSON.sheets)===this.parent.sheets.length,this.isProcessCompleted&&this.save(this.saveSettings)},e.prototype.getSheetLength=function(r){var t=0;return r.forEach(function(i){i&&t++}),t},e.prototype.save=function(r){var t={cancel:!1,jsonObject:this.saveJSON};this.parent.notify($a,t),t.cancel||(this.isFullPost?this.initiateFullPostSave():ml(this,{workerTask:this.processSave},this.updateSaveResult,[this.saveJSON,r,this.customParams,this.pdfLayoutSettings],!0)),this.saveJSON={}},e.prototype.updateSaveResult=function(r){var t={status:"Success",message:"",url:this.saveSettings.url,fileName:this.saveSettings.fileName,saveType:this.saveSettings.saveType,blobData:null};"object"==typeof r&&r.error?(t.status="Failure",t.message=r.error.toString()):"object"==typeof r&&r.dialog?this.parent.notify(ho,{content:r.dialog}):this.needBlobData?t.blobData=r:this.ClientFileDownload(r),this.parent.trigger("saveComplete",t),this.parent.notify(wi,t)},e.prototype.ClientFileDownload=function(r){var t=this.parent.createElement("a",{attrs:{download:this.getFileNameWithExtension()}}),i=URL.createObjectURL(r);t.href=i,document.body.appendChild(t),t.click(),URL.revokeObjectURL(i),document.body.removeChild(t)},e.prototype.initiateFullPostSave=function(){var t,r=Object.keys(this.saveSettings),i=this.parent.createElement("form",{attrs:{method:"POST",action:this.saveSettings.url}}),n=this.parent.createElement("input",{attrs:{type:"hidden",name:"JSONData"}});for(n.value=JSON.stringify(this.saveJSON),i.appendChild(n),t=0;t<r.length;t++)(n=this.parent.createElement("input",{attrs:{type:"hidden",name:r[t]}})).value=this.saveSettings[r[t]],i.appendChild(n);for(r=Object.keys(this.customParams),t=0;t<r.length;t++)(n=this.parent.createElement("input",{attrs:{type:"hidden",name:r[t]}})).value=this.customParams[r[t]],i.appendChild(n);(n=this.parent.createElement("input",{attrs:{type:"hidden",name:"pdfLayoutSettings"}})).value=JSON.stringify(this.pdfLayoutSettings),i.appendChild(n),document.body.appendChild(i),i.submit(),(0,f.og)(i),this.parent.notify(wi,{})},e.prototype.getStringifyObject=function(r,t,i){var n=this;return void 0===t&&(t=[]),0===i&&this.parent.notify(Ur,{clearAll:!0}),JSON.stringify(r,function(a,o){if(!(t.indexOf(a)>-1)){if(o&&o.cells)for(var l=0,h=o.cells.length;l<h;l++){var p=o.cells[l],c=[Number(a),l];p&&!p.value&&p.formula&&p.formula.indexOf("=UNIQUE(")<0&&(n.parent.notify(ie,{action:"refreshCalculate",value:p.formula,rowIndex:c[0],colIndex:l,isFormula:pe(p.formula),sheetIndex:i,isRefreshing:!0}),p.value=E(c[0],l,r).value)}return o&&"object"==typeof o&&o.hasOwnProperty("properties")?o.properties:null!==o?o:void 0}})},e.prototype.getFileNameWithExtension=function(r){r||(r=this.saveSettings.fileName);var t=this.getFileExtension(),i=r.lastIndexOf(".");return i>-1&&(r=r.substr(0,i)),r+t},e.prototype.getFileExtension=function(){return"."+this.saveSettings.saveType.toLowerCase()},e}(Ah),L=(()=>(function(s){s[s.na=0]="na",s[s.value=1]="value",s[s.ref=2]="ref",s[s.divzero=3]="divzero",s[s.num=4]="num",s[s.name=5]="name",s[s.null=6]="null"}(L||(L={})),L))(),q=(()=>(function(s){s[s.operators_cannot_start_with_expression=0]="operators_cannot_start_with_expression",s[s.reservedWord_And=1]="reservedWord_And",s[s.reservedWord_Xor=2]="reservedWord_Xor",s[s.reservedWord_If=3]="reservedWord_If",s[s.number_contains_2_decimal_points=4]="number_contains_2_decimal_points",s[s.reservedWord_Else=5]="reservedWord_Else",s[s.reservedWord_Not=6]="reservedWord_Not",s[s.invalid_char_in_number=7]="invalid_char_in_number",s[s.invalid_characters_following_with_operator=6]="invalid_characters_following_with_operator",s[s.mismatched_parentheses=8]="mismatched_parentheses",s[s.unknown_formula_name=9]="unknown_formula_name",s[s.requires_a_single_argument=10]="requires_a_single_argument",s[s.requires_3_args=11]="requires_3_args",s[s.invalid_Math_argument=12]="invalid_Math_argument",s[s.requires_2_args=13]="requires_2_args",s[s.bad_index=14]="bad_index",s[s.too_complex=15]="too_complex",s[s.circular_reference=16]="circular_reference",s[s.missing_formula=17]="missing_formula",s[s.improper_formula=18]="improper_formula",s[s.invalid_expression=19]="invalid_expression",s[s.cell_empty=20]="cell_empty",s[s.bad_formula=21]="bad_formula",s[s.empty_expression=22]="empty_expression",s[s.virtual_mode_required=23]="virtual_mode_required",s[s.mismatched_tics=24]="mismatched_tics",s[s.wrong_number_arguments=25]="wrong_number_arguments",s[s.invalid_arguments=26]="invalid_arguments",s[s.iterations_do_not_converge=27]="iterations_do_not_converge",s[s.calculation_overflow=29]="calculation_overflow",s[s.already_registered=28]="already_registered",s[s.missing_sheet=30]="missing_sheet",s[s.cannot_parse=31]="cannot_parse",s[s.expression_cannot_end_with_an_operator=32]="expression_cannot_end_with_an_operator",s[s.spill=33]="spill",s[s.div=34]="div"}(q||(q={})),q))(),Ln=(()=>(function(s){s.xlsx="xlsx",s.xlsm="xlsm",s.xlsb="xlsb",s.xltx="xltx",s.xltm="xltm",s.xls="xls",s.xml="xml",s.xlam="xlam",s.xla="xla",s.xlw="xlw",s.xlr="xlr",s.prn="prn",s.txt="txt",s.csv="csv",s.dif="dif",s.slk="slk"}(Ln||(Ln={})),Ln))();function Lh(s){switch(s){case"dd-MMM-yyyy":case"dd MMM yyyy":s="medium";break;case"MMM-yyyy":case"MMM yyyy":s="yMMM";break;case"MM-dd-yyyy":case"dd-MM-yyyy":case"dd-MM-yy":case"MM/dd/yyyy":case"dd/MM/yyyy":case"dd/MM/yy":s="short";break;case"dddd MMMM dd yyyy":case"dd MMMM yyyy":s="long";break;case"d MMMM yyyy":s="yMMMd";break;case"yyyy":s="y";break;case"h:mm":s="Hm";break;case"h:mm tt":s="hm";break;case"h":s="H";break;case"h tt":s="h";break;case"dddd":case"ddd":s="E";break;case"h:mm:ss tt":s="hms";break;case"h:mm:ss":s="Hms";break;case"d":s="d";break;case"d dddd":s="Ed";break;case"M":s="M";break;case"Md":s="Md";break;case"MMM":s="MMM";break;case"ddd MMM d":s="MMMEd";break;case"MMM d":s="MMMd";break;case"M/yyyy":s="yM";break;default:s=""}return s}function Il(s,e){for(var r=e,t=s.replace(/\[/g,".").replace(/\]/g,"").split("."),i=0;i<t.length&&!(0,f.o8)(r);i++)r=r[t[i]];return r}function El(s,e,r){var a,l,t=s.replace(/\[/g,".").replace(/\]/g,"").split("."),i=r||{},n=i,o=t.length;for(a=0;a<o;a++)l=t[a],a+1===o?n[l]=void 0===e?{}:e:(0,f.le)(n[l])&&(n[l]={}),n=n[l];return i}var Bh=function(){function s(e){this.loadedModules=[],this.parent=e}return s.prototype.inject=function(e,r){var t=e.length;if(0!==t){this.loadedModules.length&&this.clearUnusedModule(e);for(var i=0;i<t;i++)for(var n=e[i],a=0,o=r;a<o.length;a++){var l=o[a],h=n.member;if(l.prototype.getModuleName()===n.member&&!this.isModuleLoaded(h)){var p=this.createInstance(l,n.args),c=this.getMemberName(h);El(c,n.isProperty?l:p,this.parent);var d=n;d.member=c,this.loadedModules.push(d)}}}else this.clean()},s.prototype.createInstance=function(e,r){var t=r;return t.unshift(void 0),new(Function.prototype.bind.apply(e,t))},s.prototype.clean=function(){for(var e=0,r=this.loadedModules;e<r.length;e++){var t=r[e];t.isProperty||Il(t.member,this.parent).destroy()}this.loadedModules=[]},s.prototype.clearUnusedModule=function(e){for(var r=this,t=e.map(function(l){return r.getMemberName(l.member)}),n=0,a=this.loadedModules.filter(function(l){return-1===t.indexOf(l.member)});n<a.length;n++){var o=a[n];o.isProperty||Il(o.member,this.parent).destroy(),this.loadedModules.splice(this.loadedModules.indexOf(o),1),this.deleteObject(this.parent,o.member)}},s.prototype.getMemberName=function(e){return e[0].toLowerCase()+e.substring(1)+"Module"},s.prototype.deleteObject=function(e,r){delete e[r]},s.prototype.isModuleLoaded=function(e){for(var r=0,t=this.loadedModules;r<t.length;r++)if(t[r].member===this.getMemberName(e))return!0;return!1},s}(),Hh=function(){function s(e){this.formulas=[{formulaName:"SUM",category:"Math & Trig",description:"Sums individual values, cell references or ranges."},{formulaName:"SUMIFS",category:"Math & Trig",description:"Sums the cells specified by a given set of conditionsor criteria."},{formulaName:"SUMPRODUCT",category:"Math & Trig",description:"Returns sum of the product of given ranges of arrays."},{formulaName:"ABS",category:"Math & Trig",description:"Returns the absolute value of a number."},{formulaName:"RAND",category:"Math & Trig",description:"Return a random number between 0 and 1."},{formulaName:"FLOOR",category:"Math & Trig",description:"Returns the round a number down to the nearest integer."},{formulaName:"CEILING",category:"Math & Trig",description:"Returns a number rounded up to a multiple of another number."},{formulaName:"SUMIF",category:"Math & Trig",description:"It will sum up cells that meet the given criteria."},{formulaName:"PRODUCT",category:"Math & Trig",description:"Multiplies all the numbers given as arguments and returns the product."},{formulaName:"AVERAGE",category:"Statistical",description:"The sum of the numbers divided by how many numbers are being averaged."},{formulaName:"AVERAGEIF",category:"Statistical",description:"Computes the average of the numbers in a range that meet the supplied criteria."},{formulaName:"COUNT",category:"Statistical",description:"Counts the numbers in the list of arguments, exclude text entries."},{formulaName:"COUNTA",category:"Statistical",description:"Counts the non-empty values in the list of arguments."},{formulaName:"COUNTIF",category:"Statistical",description:"Counts the number of cells in a range that meet a specified condition."},{formulaName:"COUNTIFS",category:"Statistical",description:"Counts the number of times each cells in all the ranges that meet the specific conditions."},{formulaName:"AVERAGEA",category:"Statistical",description:"Calculates the average of values in the list of arguments.Arguments can be numbers, names, arrays or references."},{formulaName:"AVERAGEIFS",category:"Statistical",description:"Conditionally returns the average of the contents of cells for the set of ranges."},{formulaName:"MIN",category:"Statistical",description:"Returns the smaller number in set of arguments."},{formulaName:"MAX",category:"Statistical",description:"Returns the largest number in set of arguments."},{formulaName:"DATE",category:"Date",description:"Returns the date, given the year, month and day of the month."},{formulaName:"DAY",category:"Date",description:"Returns the day of a given date."},{formulaName:"TODAY",category:"Date",description:"Returns the current date as date value."},{formulaName:"DAYS",category:"Date",description:"Returns the number of days between two dates."},{formulaName:"WEEKDAY",category:"Date",description:"Returns the day of the week corresponding to a date."},{formulaName:"IF",category:"Logical",description:"Returns one value if a logical expression is TRUE and another if it is FALSE"},{formulaName:"AND",category:"Logical",description:"Returns TRUE if all the arguments are considered TRUE, and FALSE otherwise."},{formulaName:"IFS",category:"Logical",description:"Checks multiple conditions and returns a value corresponding to the first TRUE result."},{formulaName:"IFERROR",category:"Logical",description:"Returns a value you specify if a formula evaluates to an error; otherwise, it returns the result of the formula."},{formulaName:"CHOOSE",category:"Lookup & Reference",description:"Returns a value from a list, given an index number."},{formulaName:"INDEX",category:"Lookup & Reference",description:"Returns a value from a table, given a row and column number."},{formulaName:"FIND",category:"Text",description:"Returns the position of a string of text within another string."},{formulaName:"CONCATENATE",category:"Text",description:" Used to join two or more strings together."},{formulaName:"CONCAT",category:"Text",description:"Concatenates a list or range of text strings."},{formulaName:"SUBTOTAL",category:"Lookup & Reference",description:"Returns a subtotal in a list or database."},{formulaName:"RADIANS",category:"Math & Trig",description:"Converts degrees to radians."},{formulaName:"OR",category:"Logical",description:"Returns TRUE if any arguments considered TRUE, and all the arguments are FALSE it will return FALSE."},{formulaName:"MATCH",category:"Lookup & Reference",description:"Returns the relative position of an checked item in range that matches a specified value in a specified order"},{formulaName:"RANDBETWEEN",category:"Math & Trig",description:"Returns an integer random number in a specified range."},{formulaName:"SLOPE",category:"Statistical",description:"Returns the slope of the line from linear regression of the data points."},{formulaName:"INTERCEPT",category:"Statistical",description:"Calculates the point of the Y-intercept line via linear regression."},{formulaName:"UNIQUE",category:"Lookup & Reference",description:"Returns a unique values from a range or array."},{formulaName:"ROUNDUP",category:"Math & Trig",description:"Rounds a number away from zero."},{formulaName:"INT",category:"Math & Trig",description:"Returns a number to the nearest integer."},{formulaName:"LN",category:"Math & Trig",description:"Returns the natural logarithm of a number."},{formulaName:"ISNUMBER",category:"Information",description:"Returns TRUE, if the argument is number and FALSE otherwise."},{formulaName:"ROUND",category:"Math & Trig",description:"Rounds a number to a specified number of digits."},{formulaName:"LOG",category:"Math & Trig",description:"Returns the logarithm of a number to the base that you specify."},{formulaName:"POWER",category:"Math & Trig",description:"Returns the result of a number raised to power."},{formulaName:"TRUNC",category:"Math & Trig",description:"Returns the truncated value of a number to a specified number of decimal places."},{formulaName:"EXP",category:"Math & Trig",description:"Returns e raised to the power of the given number."},{formulaName:"GEOMEAN",category:"Statistical",description:"Returns the geometric mean of an array or range of positive data."},{formulaName:"TEXT",category:"Lookup & Reference",description:"Converts a value to text in specified number format."},{formulaName:"SORT",category:"Lookup & Reference",description:"Sorts a range of an array."},{formulaName:"T",category:"Text",description:"Checks whether a value is text or not and returns the text."},{formulaName:"EXACT",category:"Text",description:"Checks whether a two text strings are exactly same and returns TRUE or FALSE."},{formulaName:"LEN",category:"Text",description:"Returns a number of characters in a given string."},{formulaName:"MOD",category:"Math & Trig",description:"Returns a remainder after a number is divided by divisor."},{formulaName:"ODD",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest odd integer."},{formulaName:"PI",category:"Math & Trig",description:"Returns the value of pi."},{formulaName:"COUNTBLANK",category:"Statistical",description:"Returns the number of empty cells in a specified range of cells."},{formulaName:"EVEN",category:"Math & Trig",description:"Rounds a positive number up and negative number down to the nearest even integer."},{formulaName:"FACT",category:"Math & Trig",description:"Returns the factorial of a number."},{formulaName:"DECIMAL",category:"Math & Trig",description:"Converts a text representation of a number in a given base into a decimal number."},{formulaName:"DEGREES",category:"Math & Trig",description:"Converts radians to degrees."},{formulaName:"ADDRESS",category:"Lookup & Reference",description:"Returns a cell reference as text, given specified row and column numbers."},{formulaName:"TIME",category:"Date & Time",description:"Converts hours, minutes, seconds to the time formatted text."},{formulaName:"CHAR",category:"Text",description:"Returns the character from the specified number."},{formulaName:"CODE",category:"Text",description:"Returns the numeric code for the first character in a given string."},{formulaName:"DOLLAR",category:"Text",description:"Converts the number to currency formatted text."},{formulaName:"SMALL",category:"Statistical",description:"Returns the k-th smallest value in a given array."},{formulaName:"LARGE",category:"Statistical",description:"Returns the k-th largest value in a given array."},{formulaName:"MEDIAN",category:"Statistical",description:"Returns the median of the given set of numbers."},{formulaName:"EDATE",category:"Date & Time",description:"Returns a date with given number of months before or after the specified date."},{formulaName:"DATEVALUE",category:"Date & Time",description:"Converts a date string into date value."},{formulaName:"HOUR",category:"Date & Time",description:"Returns the number of hours in a specified time string."},{formulaName:"MINUTE",category:"Date & Time",description:"Returns the number of minutes in a specified time string."},{formulaName:"SECOND",category:"Date & Time",description:"Returns the number of seconds in a specified time string."},{formulaName:"NOW",category:"Date & Time",description:"Returns the current date and time."},{formulaName:"MONTH",category:"Date & Time",description:"Returns the number of months in a specified date string."},{formulaName:"PROPER",category:"Text",description:"Converts a text to proper case; first letter to uppercase and other letters to lowercase."}],this.isConcat=!1,this.parent=e,this.init()}return s.prototype.init=function(){for(var e,r=0;r<this.formulas.length;r++)e=(0,f.NA)("Compute"+this.formulas[r].formulaName,this).bind(this),this.addFormulaCollection(this.formulas[r].formulaName.toUpperCase(),e,this.formulas[r].category,this.formulas[r].description)},s.prototype.addFormulaCollection=function(e,r,t,i){this.parent.libraryFormulas={fName:e,handler:r,category:t,description:i}},s.prototype.ComputeSUM=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var i,n,t=0,a=0;if(!(0,f.le)(e))for(var o=e,l=function(u){u.toString().indexOf(".")>-1&&(a=Math.max(a,u.split(".")[1].length))},h=0;h<o.length;h++){var p=o[h].toString();if(p.indexOf(":")>-1&&this.parent.isCellReference(p))for(var c=this.parent.getCellCollection(p.split(this.parent.tic).join("")),d=0;d<c.length;d++){if(i=this.parent.getValueFromArg(c[d]),this.parent.getErrorStrings().indexOf(i)>-1)return i;(0,f.le)(i[0])||isNaN(this.parent.parseFloat(i))||(l(i),t+=this.parent.parseFloat(i))}else{if(o[h].split(this.parent.tic).join("")===this.parent.trueValue&&(o[h]="1"),o[h].split(this.parent.tic).join("")===this.parent.falseValue&&(o[h]="0"),n=this.parent.getValueFromArg(o[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(n)>-1)return n;if((0,f.le)(n)||isNaN(this.parent.parseFloat(n)))continue;n.length>0&&(l(n),t+=this.parent.parseFloat(n+""))}}return t.toString().indexOf(".")>-1?t.toFixed(a):t},s.prototype.ComputeINT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t,i,n;return(!(0,f.le)(e)&&1!==e.length||""===e[0])&&(t=this.parent.formulaErrorStrings[q.invalid_arguments]),""!==e[0]&&1===e.length&&(n=(t=e[0]).indexOf('"'),t=(t=t.indexOf('"')>-1?t.replace('"',""):t).indexOf('"')>-1?t.replace('"',""):t,t="TRUE"===(t=this.parent.getValueFromArg(t)).toUpperCase()?"1":"FALSE"===t?"0":t,i=this.parent.parseFloat(t),i=Math.floor(i)),isNaN(i)&&(t=n>-1?this.parent.getErrorStrings()[L.value]:this.parent.getErrorStrings()[L.name]),i||t},s.prototype.ComputeTODAY=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t;if(e&&""!==e[0])t=this.parent.formulaErrorStrings[q.invalid_arguments];else{var i=new Date(Date.now());"spreadsheet"===this.parent.parentObject.getModuleName()?(t=this.parent.parentObject.dateToInt(i),0===this.parent.parser.storedStringText.toUpperCase().indexOf("TODAY")&&this.parent.parentObject.setDateFormat(this.parent.getSheetId(this.parent.grid),this.parent.rowIndex(this.parent.cell)-1,this.parent.colIndex(this.parent.cell)-1)):t=i.getFullYear()+"/"+this.parent.calculateDate((i.getMonth()+1).toString())+"/"+this.parent.calculateDate(i.getDate().toString())}return t},s.prototype.ComputeWEEKDAY=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t;if(""===e[0])t=this.parent.formulaErrorStrings[q.invalid_arguments];else{var i=this.parent.getValueFromArg(e[0]);t=Math.ceil(Number(i))%7||7}return t},s.prototype.ComputePROPER=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t;if(e&&""===e[0]||1!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];var i=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");if(i===this.parent.getErrorStrings()[L.name])return this.parent.getErrorStrings()[L.name];for(var n=i.toLowerCase().split(" "),a=0;a<n.length;a++)if(n[a][0])for(var o=0;o<n[a].length;o++)if(n[a].charCodeAt(o)>=97&&n[a].charCodeAt(o)<=122){n[a]=n[a].replace(n[a][o],n[a][o].toUpperCase());break}if((t=n.join(" ")).indexOf("-")>0){var l=t.split("-");for(a=0;a<l.length;a++)if(l[a][0])for(o=0;o<l[a].length;o++)if(l[a].charCodeAt(o)>=97&&l[a].charCodeAt(o)<=122){l[a]=l[a].replace(l[a][o],l[a][o].toUpperCase());break}t=l.join("-")}if(t.indexOf(",")>0){var h=t.split(",");for(a=0;a<h.length;a++)if(h[a][0])for(o=0;o<h[a].length;o++)if(h[a].charCodeAt(o)>=97&&h[a].charCodeAt(o)<=122){h[a]=h[a].replace(h[a][o],h[a][o].toUpperCase());break}t=h.join(",")}return t},s.prototype.ComputeSUMPRODUCT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var n,t=0,i=0,a=null,o=e,l=0;l<o.length;++l){var h=o[l];if(h.startsWith(this.parent.tic)||!this.parent.isCellReference(h)){var b=this.parent.getValueFromArg(h);return n=b.indexOf('"'),this.parent.getErrorStrings().indexOf(b)>-1?b:n>-1?0:this.parent.formulaErrorStrings[q.invalid_arguments]}var p=h.indexOf(":"),c=this.parent.rowIndex(h.substr(0,p)),d=this.parent.rowIndex(h.substr(p+1));if(!(-1!==c||-1===d)==(-1===c||-1!==d))return this.parent.getErrorStrings()[L.name];var u=this.parent.colIndex(h.substr(0,p)),v=this.parent.colIndex(h.substr(p+1));if(null===a)for(i=(d-c+1)*(v-u+1),a=[],p=0;p<i;++p)a[p]=1;p=0;for(var g=c;g<=d;++g)for(var m=u;m<=v;++m){var y=this.getSheetReference(h)+this.parent.convertAlpha(m)+g,C=this.parent.getValueFromArg(y);if(isNaN(parseFloat(C)))a[p]=0;else{if(isNaN(a[p]))return this.parent.getErrorStrings()[L.name];a[p]=a[p]*parseFloat(C)}p++}}for(p=0;p<i;++p)t+=a[p];return t},s.prototype.ComputeROUNDUP=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t,i,n,a,o,l=e.length;if(!(0,f.le)(e)&&l>2&&(t=this.parent.formulaErrorStrings[q.invalid_arguments]),1===l&&""!==e[0])o=e[0].indexOf('"'),n="TRUE"===(n=(n=e[0].indexOf('"')>-1?e[0].replace('"',""):e[0]).indexOf('"')>-1?n.replace('"',""):n).toUpperCase()?"1":"FALSE"===n?"0":n,n=this.parent.getValueFromArg(n),(i=this.parent.parseFloat(n))>0?i+=.4999999999:i<0&&(i-=.4999999999),t=(i=this.parent.parseFloat(i.toFixed(0))).toString();else if(2===l&&""!==e[0]&&""!==e[1]){o=e[0].indexOf('"')>-1?e[0].indexOf('"'):e[1].indexOf('"')>-1?e[1].indexOf('"'):-1,n=(n=e[0].indexOf('"')>-1?e[0].replace('"',""):e[0]).indexOf('"')>-1?n.replace('"',""):n,a=(a=e[1].indexOf('"')>-1?e[1].replace('"',""):e[1]).indexOf('"')>-1?a.replace('"',""):a,n="TRUE"===n.toUpperCase()?"1":"FALSE"===n?"0":n,a="TRUE"===a.toUpperCase()?"1":"FALSE"===a?"0":a,n=this.parent.getValueFromArg(n),a=this.parent.getValueFromArg(a);var h=Math.ceil(this.parent.parseFloat(a));i=this.parent.parseFloat(n),h>0?(i>0?i+=.4999999999/Math.pow(10,h):i<0&&(i-=.4999999999/Math.pow(10,h)),t=(i=this.parent.parseFloat(i.toFixed(h))).toFixed(h),isNaN(i)&&(t=h.toString().indexOf('"')>-1?this.parent.getErrorStrings()[L.value]:this.parent.getErrorStrings()[L.name])):(i>0?i=i/Math.pow(10,-h)+.49999:i<0&&(i=i/Math.pow(10,-h)-.49999),t=(i=this.parent.parseFloat(i.toFixed(0))*Math.pow(10,-h)).toString(),isNaN(i)&&(t=h.toString().indexOf('"')>-1?this.parent.getErrorStrings()[L.value]:t=this.parent.getErrorStrings()[L.name]))}else t=o>-1?this.parent.getErrorStrings()[L.value]:this.parent.formulaErrorStrings[q.invalid_arguments];return t},s.prototype.ComputeCOUNT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.wrong_number_arguments];for(var i,n,o,t=e,a=0,l=0;l<t.length;l++)if((i=t[l]).indexOf(":")>-1&&this.parent.isCellReference(i)){n=this.parent.getCellCollection(i.split(this.parent.tic).join(""));for(var h=0;h<n.length;h++)o=this.parent.getValueFromArg(n[h]),isNaN(this.parent.parseFloat(o))||i.length>0&&""!==i&&" "!==i&&a++}else i=i.split(this.parent.tic).join(""),isNaN(this.parent.parseFloat(this.parent.getValueFromArg(i)))||i.length>0&&""!==i&&" "!==i&&a++;return a},s.prototype.ComputeDATE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.wrong_number_arguments];var t=e;if(3!==t.length)return this.parent.formulaErrorStrings[q.wrong_number_arguments];for(var i=0;i<t.length;++i)t[i]=this.parent.getValueFromArg(t[i]);t[0]="TRUE"===t[0].split(this.parent.tic).join("")?"1":"FALSE"===t[0].split(this.parent.tic).join("")?"0":t[0],t[1]="TRUE"===t[1].split(this.parent.tic).join("")?"1":"FALSE"===t[1].split(this.parent.tic).join("")?"0":t[1],t[2]="TRUE"===t[2].split(this.parent.tic).join("")?"1":"FALSE"===t[2].split(this.parent.tic).join("")?"0":t[2];var n=this.parent.parseFloat(t[0].split(this.parent.tic).join("")),a=this.parent.parseFloat(t[1].split(this.parent.tic).join("")),o=this.parent.parseFloat(t[2].split(this.parent.tic).join("")),l=0;if(isNaN(n)||isNaN(a)||isNaN(o))return this.parent.getErrorStrings()[L.value].toString();if(n<0)return this.parent.getErrorStrings()[L.num].toString();for(;a>12;)a-=12,n++;if(0===(l=this.parent.getSerialDateFromDate(n,a,o)))return this.parent.getErrorStrings()[L.num].toString();var h=this.parent.fromOADate(l);return"Invalid Date"!==h.toString()?this.parent.calculateDate((h.getMonth()+1).toString())+"/"+this.parent.calculateDate(h.getDate().toString())+"/"+h.getFullYear():l.toString()},s.prototype.ComputeFLOOR=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var o,l,t=e,i=t.length,n=t[1].split(this.parent.tic).join(""),a=[];if(2!==i)return this.parent.formulaErrorStrings[q.wrong_number_arguments];if(a.push(o=this.parent.parseFloat(this.parent.getValueFromArg(t[0].split(this.parent.tic).join("")))),t[1]=n===this.parent.trueValue?"1":n===this.parent.falseValue?"0":t[1],a.push(l=this.parent.parseFloat(this.parent.getValueFromArg(t[1].split(this.parent.tic).join("")))),o>0&&l<0)return this.parent.getErrorStrings()[L.num];if(o>0&&0===l)return this.parent.getErrorStrings()[L.divzero];for(var h=0;h<t.length;h++)if(t[h].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[L.value];return isNaN(o)?this.parent.getErrorStrings()[L.name]:Math.floor(o/l)*l},s.prototype.ComputeCEILING=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var o,l,t=e,i=[],n=t.length,a=t[1].split(this.parent.tic).join("");if(2!==n)return this.parent.formulaErrorStrings[q.wrong_number_arguments];if(i.push(o=this.parent.parseFloat(this.parent.getValueFromArg(t[0].split(this.parent.tic).join("")))),t[1]=a===this.parent.trueValue?"1":a===this.parent.falseValue?"0":t[1],i.push(l=this.parent.parseFloat(this.parent.getValueFromArg(t[1].split(this.parent.tic).join("")))),o>0&&l<0)return this.parent.getErrorStrings()[L.num];for(var h=0;h<t.length;h++)if(t[h].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[L.value];return isNaN(o)?this.parent.getErrorStrings()[L.name]:0===l?0:Math.ceil(o/l)*l},s.prototype.ComputeDAY=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,t=e;if((0,f.le)(t)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[q.invalid_arguments];if(t.length>1)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var n=this.parent.getValueFromArg(t[0].split(this.parent.tic).join(""));return isNaN(this.parent.parseFloat(n))?(i=this.parent.parseDate(n),"[object Date]"===Object.prototype.toString.call(i)&&(i=i.getDate()),i):this.parent.getErrorStrings()[L.name]},s.prototype.ComputeIF=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];if(this.parent.getErrorStrings().indexOf(e[0])>0)return e[0];var i,n,a,t=e;if(4===t.length&&"nestedFormulaTrue"===t[3]&&(i=!0,t.pop()),t.length>3||1===t.length)return this.parent.formulaErrorStrings[q.wrong_number_arguments];if(t.length<=3){if(n=this.parent.getValueFromArg(t[0]),this.parent.getErrorStrings().indexOf(n)>-1)return n;if(n===this.parent.trueValue||this.parent.parseFloat(n)>0||this.parent.parseFloat(n)<0)a=this.parent.getValueFromArg(t[1]);else{if(n!==this.parent.falseValue&&0!==this.parent.parseFloat(n))return this.parent.formulaErrorStrings[q.requires_3_args];if((0,f.le)(t[2]))return this.parent.falseValue;a=this.parent.getValueFromArg(t[2])}}return!i&&a.indexOf(this.parent.tic)>-1?a.split(this.parent.tic).join(""):a},s.prototype.ComputeIFERROR=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var i,t=e;return 2!==t.length?this.parent.formulaErrorStrings[q.wrong_number_arguments]:(i=this.parent.getValueFromArg(t[0]))===this.parent.trueValue||i===this.parent.falseValue?i:(i[0]===this.parent.arithMarker&&(i=i.replace(this.parent.arithMarker," ")),"#"===(i=this.parent.getValueFromArg(i).toUpperCase().split(this.parent.tic).join(""))[0]||i.indexOf("Infinity")>-1||this.parent.getErrorStrings().indexOf(i)>-1?this.parent.getValueFromArg(t[1]).split(this.parent.tic).join(""):i)},s.prototype.ComputePRODUCT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var i,n,o,t=1,a=!0;if(!(0,f.le)(e))for(var l=e,h=0;h<l.length;h++){var p=l[h];if(p.indexOf(":")>-1&&this.parent.isCellReference(p))for(var c=this.parent.getCellCollection(p),d=0;d<c.length;d++){if(i=this.parent.getValueFromArg(c[d].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(i)>-1)return i;i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,o=this.parent.parseFloat(i),isNaN(o)||i.length>0&&(t*=o,a=!1)}else if(n=this.parent.getValueFromArg(l[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(n)>-1||(n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,o=this.parent.parseFloat(n),isNaN(o)||n.length>0&&(t*=o,a=!1),this.parent.getErrorStrings().indexOf(n)>-1))return n}return a?"0":t.toString()},s.prototype.ComputeDAYS=function(){for(var e=this,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];var i;if((0,f.le)(r)&&1===r.length&&""===r[0])return this.parent.formulaErrorStrings[q.invalid_arguments];if(2!==r.length)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var n=r,a=function(c){return c=c.split(e.parent.tic).join(""),e.parent.isCellReference(c)&&(c=e.parent.getValueFromArg(c)),c===e.parent.trueValue?c="1":c===e.parent.falseValue?c="0":c||(c=new Date(Date.parse("1899-12-31")).toDateString()),c},o=a(n[0]),l=a(n[1]);if("#"===o[0])return o;if("#"===l[0])return l;var h=this.parent.isNaN(Number(o))?this.parent.parseDate(o):this.parent.intToDate(o),p=this.parent.isNaN(Number(l))?this.parent.parseDate(l):this.parent.intToDate(l);return"#"===h.toString()[0]?h.toString():"#"===p.toString()[0]?p.toString():"[object Date]"!==Object.prototype.toString.call(h)||"[object Date]"!==Object.prototype.toString.call(p)?this.parent.getErrorStrings()[L.value]:(i=Math.ceil(h.getTime()-p.getTime())/864e5,Math.round(i))},s.prototype.ComputeUNIQUE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,t=e;if((0,f.le)(e)||""===e[0]||t.length>3)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var n=t[1]?t[1].toUpperCase():"FALSE",a=t[2]?t[2].toUpperCase():"FALSE",o=[],l=this.parent.actCell;if(t[0].indexOf(":")>-1){if((0,f.le)(t[0].match(/[0-9]/))){var h=t[0].split(":");t[0]=h[0]+"1:"+h[1]+(this.parent.spreadSheetUsedRange[0]+1)}else(0,f.le)(t[0].toUpperCase().match(/[A-Z]/))&&(h=t[0].split(":"),t[0]="A"+h[0]+":"+Re(this.parent.spreadSheetUsedRange[1]+1)+h[1]);var p=t[0].split(":");if(this.parent.isCellReference(p[0])&&this.parent.isCellReference(p[1])){for(var c=this.parent.dependencyCollection,d=0;d<c.length;d++)c[d].split(":")[0]===t[0].split(":")[0]&&this.clearDependency(c[d]);-1===this.parent.dependencyCollection.indexOf(t[0])?this.parent.dependencyCollection.push(t[0]):this.clearDependency(t[0]);var u=t[0].indexOf(":"),v=void 0,g=this.parent.rowIndex(this.parent.substring(t[0],0,u)),m=this.parent.colIndex(this.parent.substring(t[0],0,u)),y=this.parent.rowIndex(this.parent.substring(t[0],u+1,u+t[0].length-u-1)),C=this.parent.colIndex(this.parent.substring(t[0],u+1,u+t[0].length-u-1));g>y&&(v=y,y=g,g=v),m>C&&(v=C,C=m,m=v);var b="";0===t[0].indexOf("!")&&(b=t[0].substring(0,t[0].replace("!","").indexOf("!")+2)),t[0]=b+Re(m)+g+":"+Re(C)+y;var S=this.parent.getCellCollection(t[0]),w=C-m,x=[];for(d=0;d<S.length;d++)x.push(S[d]);if("FALSE"===n)if(0===w)for(d=0;d<x.length;d++){var I=this.parent.getValueFromArg(x[d]);o.push(I=""===I?"0":I)}else{var F="",T=w;for(d=0;d<x.length;d++)d===x.length-1&&(I=this.parent.getValueFromArg(x[d]),o.push((F=F+(I=""===I?"0":I)+"+").substring(0,F.length-1))),d<=T?F=F+(I=""===(I=this.parent.getValueFromArg(x[d]))?"0":I)+"+":(o.push(F.substring(0,F.length-1)),T=w+d,F=(I=""===(I=this.parent.getValueFromArg(x[d]))?"0":I)+"+")}else{F="",T=w+1;var k=y-g;for(d=0;d<T;d++){for(var R=0;R<=k;R++)F=F+(I=""===(I=this.parent.getValueFromArg(x[R*T+d]))?"0":I)+"+";o.push(F.substring(0,F.length-1)),F=""}}var D=[],N=[];for(d=0;d<o.length;d++)-1===D.indexOf(o[d])?D.push(o[d]):N.push(o[d]);if("TRUE"===a){var P=[];for(d=0;d<D.length;d++)-1===N.indexOf(D[d])&&P.push(D[d]);D=P}l=l.indexOf("!")>-1?l.split("!")[1]:l;var M=this.parent.rowIndex(l),V=this.parent.colIndex(l);if(0===this.parent.dependencyLevel){var Y=!1;if("FALSE"===n)for(d=M,T=D.length+M;d<T;d++)for(var G=V,$=(X=D[0].split("+")).length+V;G<$;G++)d===T-1&&G===$-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+Re(G)+d)&&this.parent.uniqueRange.push(this.parent.actCell+":"+Re(G)+d),this.checkSpill(G,d)&&(Y=!0);else for(d=V,T=D.length+V;d<T;d++){var J=M;for($=(X=D[0].split("+")).length+M;J<$;J++)d===T-1&&J===$-1&&-1===this.parent.uniqueRange.indexOf(this.parent.actCell+":"+Re(d)+J)&&this.parent.uniqueRange.push(this.parent.actCell+":"+Re(d)+J),this.checkSpill(d,J)&&(Y=!0)}if(Y)return this.parent.formulaErrorStrings[q.spill]}else if(this.parent.dependencyLevel>0&&this.parent.getValueFromArg(Re(V)+M,!0).indexOf("#SPILL!")>-1)return this.parent.formulaErrorStrings[q.spill];if("FALSE"===n){var de=this.parent.getSheetFamilyItem(this.parent.grid),oe="",Le=void 0;for(null!==de.sheetNameToParentObject&&de.sheetNameToParentObject.size>0&&(Le=(oe=de.parentObjectToToken.get(this.parent.grid))+l),d=0;d<D.length;d++){var X=D[d].split("+");d>0&&(M++,V=this.parent.colIndex(l));for(var be=0;be<X.length;be++)this.setValueRefresh(X[be],M,V,l),(d>0||be>0)&&this.parent.refresh(oe+Re(V)+M.toString(),Le),X[be+1]&&V++}i=D[0].split("+")[0]}else{for(d=0;d<D.length;d++){X=D[d].split("+");for(var Ae=0;Ae<X.length;Ae++)this.setValueRefresh(X[Ae],M,V,l),X[Ae+1]?M++:(V++,M=this.parent.rowIndex(l))}i=D[0].split("+")[0]}}}else this.parent.isCellReference(t[0])&&(-1===this.parent.dependencyCollection.indexOf(t[0])?this.parent.dependencyCollection.push(t[0]):this.clearDependency(t[0]),i=this.parent.getValueFromArg(t[0]));return i},s.prototype.setValueRefresh=function(e,r,t,i){this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,e,r,t)},s.prototype.checkSpill=function(e,r){var a,t=!1,i=this.parent.getValueFromArg(Re(e)+r,!0),n="!"+this.parent.getSheetID(this.parent.grid)+"!"+Re(e)+r;return this.parent.getFormulaInfoTable().get(n)&&(a=this.parent.getFormulaInfoTable().get(n).formulaText),i&&(i.indexOf("UNIQUE")<0||a&&!a.toUpperCase().includes("UNIQUE"))&&i!==this.parent.formulaErrorStrings[q.wrong_number_arguments]&&(t=!0),t},s.prototype.clearDependency=function(e){var r=this.parent.actCell,t="";if(r.indexOf("!")>-1){var i=r.split("!");r=i[1],t=i[0]+"!"}for(var n=this.parent.rowIndex(r),a=this.parent.colIndex(r),o=e.indexOf(":"),l=this.parent.rowIndex(this.parent.substring(e,0,o)),h=this.parent.colIndex(this.parent.substring(e,0,o)),d=this.parent.rowIndex(this.parent.substring(e,o+1,o+e.length-o-1))-l+n,u=this.parent.colIndex(this.parent.substring(e,o+1,o+e.length-o-1))-h+a,v=this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+r)?this.parent.getFormulaInfoTable().get("!"+this.parent.getSheetID(this.parent.grid)+"!"+r).getFormulaText():"",g=n;g<=d;g++)for(var m=a;m<=u;m++)if(this.parent.dependencyLevel>0||v.indexOf("UNIQUE")>-1){if(this.parent.getValueFromArg("!"+this.parent.getSheetID(this.parent.grid)+"!"+Re(a)+n,!0).indexOf("#SPILL!")>-1)return;this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,"",g,m),this.parent.refresh("!"+this.parent.getSheetID(this.parent.grid)+"!"+Re(m)+g,r),this.parent.actCell=t+r}},s.prototype.ComputeT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t="";if((0,f.le)(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var i=e[0];i=i.indexOf(":")>-1?i.split(":")[0]:i;var n=/^[0-9.]+$/;return null===(i=this.parent.getValueFromArg(i)).match(n)&&"TRUE"!==i.toUpperCase()&&"FALSE"!==i.toUpperCase()&&(t=i),t},s.prototype.ComputeHOUR=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(1!==e.length||(0,f.le)(e))return this.parent.formulaErrorStrings[q.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[L.value];if(!this.parent.isCellReference(e[0])&&-1===e[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[L.value];var t=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");t=this.parent.intToTime(t);var i=new Date(Date.parse(t)),n=parseInt(t,10);if(n<0)return this.parent.getErrorStrings()[L.num];if("Invalid Date"===i.toString()){var a=new Date(Date.now()).toLocaleDateString()+" "+t;i=new Date(Date.parse(a))}return"Invalid Date"===i.toString()&&(i=this.parent.fromOADate(parseInt(t,10))),"Invalid Date"===i.toString()?this.parent.getErrorStrings()[L.value]:i.getHours()},s.prototype.ComputeMINUTE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(1!==e.length||(0,f.le)(e))return this.parent.formulaErrorStrings[q.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[L.value];if(!this.parent.isCellReference(e[0])&&-1===e[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[L.value];var t=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");t=this.parent.intToTime(t);var i=new Date(Date.parse(t)),n=parseInt(t,10);if(n<0)return this.parent.getErrorStrings()[L.num];if("Invalid Date"===i.toString()){var a=new Date(Date.now()).toLocaleDateString()+" "+t;i=new Date(Date.parse(a))}return"Invalid Date"===i.toString()&&(i=this.parent.fromOADate(parseInt(t,10))),"Invalid Date"===i.toString()?this.parent.getErrorStrings()[L.value]:i.getMinutes()},s.prototype.ComputeSECOND=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(1!==e.length||(0,f.le)(e))return this.parent.formulaErrorStrings[q.invalid_arguments];if(!this.parent.isCellReference(e[0])&&-1===e[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[L.value];if(""===e[0])return this.parent.getErrorStrings()[L.value];var t=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");t=this.parent.intToTime(t);var i=new Date(Date.parse(t)),n=parseInt(t,10);if(n<0)return this.parent.getErrorStrings()[L.num];if("Invalid Date"===i.toString()){var a=new Date(Date.now()).toLocaleDateString()+" "+t;i=new Date(Date.parse(a))}return"Invalid Date"===i.toString()&&(i=this.parent.fromOADate(parseInt(t,10))),"Invalid Date"===i.toString()?this.parent.getErrorStrings()[L.value]:i.getSeconds()},s.prototype.ComputeMONTH=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(""===e[0])return this.parent.getErrorStrings()[L.value];if(1!==e.length||(0,f.le)(e))return this.parent.formulaErrorStrings[q.invalid_arguments];if(!this.parent.isCellReference(e[0])&&-1===e[0].indexOf(this.parent.tic))return this.parent.getErrorStrings()[L.value];var t=this.spreadsheetFormat(e[0]),i=this.spreadsheetDisplayText(e[0]),n=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),a=this.parseDouble(n),o=0,l=new Date(Date.parse(n));!isNaN(a)&&l.getFullYear()>9999&&(l=this.parent.fromOADate(a));var h=parseInt(n,10);return h<0?this.parent.getErrorStrings()[L.num]:(0===h&&n!==t&&t.indexOf("h:mm")>-1&&(l=this.parent.fromOADate(parseInt(i,10))),"Invalid Date"===l.toString()&&(l=this.parent.fromOADate(parseInt(n,10))),"Invalid Date"===l.toString()?this.parent.getErrorStrings()[L.value]:("Invalid Date"!==l.toString()&&(o=l.getMonth()+1),o.toString()))},s.prototype.ComputeNOW=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(1!==e.length||""!==e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var t=new Date(Date.now()),i=new f.eC,n=i.getDateFormat({format:"M/d/yyyy h:mm a"});return n(t)},s.prototype.ComputeEXACT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=!1;if((0,f.le)(e)||2!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];var i=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join(""),n=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");return n===i&&(t=!0),t},s.prototype.ComputeLEN=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[L.value];var t=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");return"#NAME?"===t?this.parent.getErrorStrings()[L.name]:t.length},s.prototype.ComputeMOD=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||2!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];var t=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),i=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");if(""===i||"0"===i)return this.parent.formulaErrorStrings[q.div];if(""===t||"0"===t)return"0";if("#NAME?"===t||"#NAME?"===i)return this.parent.getErrorStrings()[L.name];if(t.toUpperCase().match(/[A-Z]/)||i.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[L.value];var n=parseFloat(t.replace("-",""))%parseFloat(i);return parseFloat(i)<0&&(n*=-1),isNaN(n)?this.parent.getErrorStrings()[L.name]:n},s.prototype.ComputeODD=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(""===e[0])return this.parent.getErrorStrings()[L.value];if((0,f.le)(e)||1!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];var t=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");if("#NAME?"===t)return this.parent.getErrorStrings()[L.name];if(""===t)t="0";else if(t.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[L.value];var i=Math.ceil(parseInt(t,10)),n=0===i;return i=i%2==0?i>0?i+1:i-1:i,Math.ceil(parseInt(t,10))%2!=0&&(parseInt(t,10)>0&&parseFloat(t)>parseInt(t,10)?i+=2:parseInt(t,10)<0&&parseFloat(t)<parseInt(t,10)&&(i-=2)),isNaN(i)?this.parent.getErrorStrings()[L.name]:n?1:i},s.prototype.ComputeEVEN=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[L.value];var t=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");if("#NAME?"===t)return this.parent.getErrorStrings()[L.name];if(""===t)t="0";else if(t.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[L.value];var i=Math.ceil(parseFloat(t));return i=i%2==0?i:i>0?i+1:i-1,Math.ceil(parseFloat(t))%2==0&&(parseInt(t,10)>0&&parseFloat(t)>parseInt(t,10)?i+=2:parseInt(t,10)<0&&parseFloat(t)<parseInt(t,10)&&(i-=2)),isNaN(i)?this.parent.getErrorStrings()[L.name]:i},s.prototype.ComputePI=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e&&""!==e[0]?this.parent.formulaErrorStrings[q.invalid_arguments]:Math.PI},s.prototype.ComputeMEDIAN=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t;if((0,f.le)(e)||""===e[0]||1!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];for(var i=this.parent.getCellCollection(e[0]),n=[],a=0;a<i.length;a++)n.push(parseInt(this.parent.getValueFromArg(i[a]).split(this.parent.tic).join(""),10));for(var o=(n=n.sort(function(h,p){return h-p})).length,l=0;l<o&&(!isNaN(n[l])||(n.splice(l,1),l--,0!==n.length));l++);if(n.length%2!=0&&n[parseInt((n.length/2).toString(),10)])t=n[parseInt((n.length/2).toString(),10)];else{if(isNaN(n[n.length/2])||isNaN(n[n.length/2-1]))return this.parent.getErrorStrings()[L.num];t=(n[n.length/2]+n[n.length/2-1])/2}return t},s.prototype.ComputeEDATE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t,i;if(2!==e.length||(0,f.le)(e))return this.parent.formulaErrorStrings[q.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[L.value];var n=this.parent.getValueFromArg(e[0]);return i=this.parent.getValueFromArg(e[1]),i=parseInt(i,10),isNaN(i)?this.parent.getErrorStrings()[L.num]:(t=isNaN(parseInt(n,10))?new Date(Date.parse(n)):this.parent.fromOADate(parseInt(n,10)),(0,f.le)(this.parent.isDate(t))?this.parent.getErrorStrings()[L.value]:new Date(t.setMonth(t.getMonth()+i)).toLocaleDateString())},s.prototype.ComputeDATEVALUE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t,i;return 1!==e.length||(0,f.le)(e)?this.parent.formulaErrorStrings[q.invalid_arguments]:""===e[0]||this.parent.isCellReference(e[0])||-1===e[0].indexOf(this.parent.tic)?this.parent.getErrorStrings()[L.value]:(i=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),t=isNaN(parseInt(i,10))?new Date(Date.parse(i)):this.parent.fromOADate(parseInt(i,10)),(0,f.le)(this.parent.isDate(t))||5!==parseInt(i,10).toString().length||this.parent.isDate(i)&&4!==this.parent.isDate(i).getFullYear().toString().length?this.parent.getErrorStrings()[L.value]:parseFloat(i).toFixed(0).toString())},s.prototype.ComputeCOUNTBLANK=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=0;if(1!==e.length||(0,f.le)(e)||!this.parent.isCellReference(e[0]))return this.parent.formulaErrorStrings[q.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[L.value];for(var i=this.parent.getCellCollection(e[0]),n=0;n<i.length;n++)""===this.parent.getValueFromArg(i[n])&&t++;return t},s.prototype.ComputeFACT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=1;if((0,f.le)(e)||1!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];if(""===e[0])return this.parent.getErrorStrings()[L.value];var i=parseInt(this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),10);if(this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("").toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[L.value];if(i<0)return this.parent.getErrorStrings()[L.num];for(var n=1;n<=i;n++)t*=n;return t},s.prototype.ComputeDECIMAL=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t;if((0,f.le)(e)||2!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];var i=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),n=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");return""===i&&""!==n?0:""!==i&&""===n||isNaN(parseInt(n,10))?this.parent.getErrorStrings()[L.value]:(t=parseInt(i,parseInt(n,10)),isNaN(t)?this.parent.getErrorStrings()[L.name]:t)},s.prototype.ComputeDEGREES=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t;if((0,f.le)(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var i=Math.PI,n=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");return n.toUpperCase().match(/[A-Z]/)||isNaN(parseInt(n,10))?this.parent.getErrorStrings()[L.value]:(t=parseFloat(n)*(180/i),parseInt(t.toString(),10))},s.prototype.ComputeADDRESS=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t;if((0,f.le)(e)||e.length>5||""===e[0]||""===e[1]||e.length<2)return this.parent.formulaErrorStrings[q.invalid_arguments];e[2]=e[2]?e[2]:"1",e[3]=e[3]?e[3]:"TRUE";var i=this.parent.getValueFromArg(e[0]),n=this.parent.getValueFromArg(e[1]),a=this.parent.getValueFromArg(e[2]),o=this.parent.getValueFromArg(e[3]);if(a=a.split(this.parent.tic).join(""),o=o.split(this.parent.tic).join(""),i=i.split(this.parent.tic).join(""),n=n.split(this.parent.tic).join(""),parseInt(i,10)<=0||parseInt(n,10)<=0)return this.parent.getErrorStrings()[L.value];if(i.toUpperCase().match(/[A-Z]/)||n.toUpperCase().match(/[A-Z]/)||a.toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[L.value];"TRUE"===o||"1"===o?"1"===a?t="$"+Re(parseInt(n,10))+"$"+parseInt(i,10):"2"===a?t=Re(parseInt(n,10))+"$"+parseInt(i,10):"3"===a?t="$"+Re(parseInt(n,10))+parseInt(i,10):"4"===a&&(t=Re(parseInt(n,10))+parseInt(i,10)):("FALSE"===o||"0"===o)&&("1"===a?t="R"+parseInt(i,10)+"C"+parseInt(n,10):"2"===a?t="R"+parseInt(i,10)+"C["+parseInt(n,10)+"]":"3"===a?t="R["+parseInt(i,10)+"]C"+parseInt(n,10):"4"===a&&(t="R["+parseInt(i,10)+"]C["+parseInt(n,10)+"]"));var l=["TRUE","FALSE","1","0"];if(-1===l.indexOf(o))return this.parent.getErrorStrings()[L.name];if(!(0,f.le)(e[4])&&""!==e[4]){var h=this.parent.getValueFromArg(e[4]).split(this.parent.tic).join("");if("#NAME?"===h)return this.parent.getErrorStrings()[L.name];t=h+"!"+t}return t},s.prototype.ComputeTIME=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||3!==e.length||""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var t=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),i=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join(""),n=this.parent.getValueFromArg(e[2]).split(this.parent.tic).join("");if("#NAME?"===t||"#NAME?"===i||"#NAME?"===n)return this.parent.getErrorStrings()[L.name];if(t=parseInt(t,10),i=parseInt(i,10),n=parseInt(n,10),isNaN(t)||isNaN(i)||isNaN(n))return this.parent.getErrorStrings()[L.name];if(t.toString().toUpperCase().match(/[A-Z]/)||i.toString().toUpperCase().match(/[A-Z]/)||n.toString().toUpperCase().match(/[A-Z]/))return this.parent.getErrorStrings()[L.value];if(t>32767||i>32767||n>32767)return this.parent.getErrorStrings()[L.num];var a=new Date(1900,0,1,t,i,n),o=a.getHours(),l=a.getMinutes(),h="AM",p=o;return p>=12&&(p=o-12,h="PM"),0===p&&(p=12),(p=p<10?"0"+p:p)+":"+(l=l<10?"0"+l:l)+" "+h},s.prototype.ComputeCHAR=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var i=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");if("#NAME?"===i)return this.parent.getErrorStrings()[L.name];if(!i.toUpperCase().match(/^[0-9]+$/))return this.parent.getErrorStrings()[L.value];var n=parseInt(i,10);return n>255||n<=0?this.parent.getErrorStrings()[L.value]:String.fromCharCode(n)},s.prototype.ComputeCODE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1!==e.length||""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var i=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join("");return"#NAME?"===i?this.parent.getErrorStrings()[L.name]:""===i?this.parent.getErrorStrings()[L.value]:i.charCodeAt(0)},s.prototype.ComputeDOLLAR=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(1===e.length&&e.push("2"),(0,f.le)(e)||2!==e.length||""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];var i=this.parent.getValueFromArg(e[0]).split(this.parent.tic).join(""),n=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");if(n=""===n?"0":n,"#NAME?"===(i=""===i?"0":i))return this.parent.getErrorStrings()[L.name];if(!i.toUpperCase().match(/^[0-9.]+$/)||!n.toUpperCase().match(/^[0-9.]+$/))return this.parent.getErrorStrings()[L.value];for(var a=new f.eC,o=parseInt(n,10),l="",h=1;h<=o;h++)l+="0";return a.formatNumber(parseFloat(parseFloat(i).toFixed(parseInt(n,10))),{format:"$#,##."+l})},s.prototype.ComputeSMALL=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||""===e[0]||2!==e.length)return this.parent.formulaErrorStrings[q.invalid_arguments];for(var i=this.parent.getCellCollection(e[0]),n=[],a=0;a<i.length;a++)n.push(parseFloat(this.parent.getValueFromArg(i[a]).split(this.parent.tic).join("")));for(var o=(n=n.sort(function(p,c){return p-c})).length,l=0;l<o&&(!isNaN(n[l])||(n.splice(l,1),l--,0!==n.length));l++);var h=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");return"#NAME?"===h?this.parent.getErrorStrings()[L.name]:(h=parseInt(h,10)).toString().toUpperCase().match(/^[0-9]+$/)&&n[h-1]&&n[h-1].toString().toUpperCase().match(/^[-.0-9]+$/)&&0!==h?n[h-1]:(0,f.le)(n[h-1])?this.parent.getErrorStrings()[L.num]:this.parent.getErrorStrings()[L.value]},s.prototype.ComputeLARGE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||2!==e.length||""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];for(var i=this.parent.getCellCollection(e[0]),n=[],a=0;a<i.length;a++)n.push(parseFloat(this.parent.getValueFromArg(i[a]).split(this.parent.tic).join("")));n=n.sort(function(h,p){return p-h});for(var o=0;o<n.length&&(!isNaN(n[o])||(n.splice(o,1),o--,0!==n.length));o++);var l=this.parent.getValueFromArg(e[1]).split(this.parent.tic).join("");return"#NAME?"===l?this.parent.getErrorStrings()[L.name]:(l=parseInt(l,10)).toString().toUpperCase().match(/^[0-9]+$/)&&n[l-1]&&n[l-1].toString().toUpperCase().match(/^[-.0-9]+$/)&&0!==l?n[l-1]:(0,f.le)(n[l-1])?this.parent.getErrorStrings()[L.num]:this.parent.getErrorStrings()[L.value]},s.prototype.ComputeCHOOSE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];if(e.length<2)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var t=e;if(t[0].indexOf(":")>-1&&this.parent.isCellReference(t[0])){if(1!==(i=this.parent.getCellCollection(t[0])).length)return this.parent.getErrorStrings()[L.value];t[0]=i[0]}var n=this.parent.getValueFromArg(t[0]);if(this.parent.getErrorStrings().indexOf(n)>-1)return n;var o,a=this.parent.parseFloat(this.parent.getValueFromArg(t[0].split(this.parent.tic).join("")));if(a<1)return this.parent.getErrorStrings()[L.value];if(a=Math.floor(a),(0,f.le)(t[a]))return this.parent.getErrorStrings()[L.value];if(""===(o=t[a])&&(o="0"),o.indexOf(":")>-1&&this.parent.isCellReference(o)){var i;if(1!==(i=this.parent.getCellCollection(t[0].split(this.parent.tic).join(""))).length)return this.parent.getErrorStrings()[L.value];t[0]=i[0]}return this.parent.getValueFromArg(o).split(this.parent.tic).join("")},s.prototype.ComputeSUMIF=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if(t[0].indexOf(":")<0&&!this.parent.isCellReference(t[0])||t[2]&&t[2].indexOf(":")<0&&!this.parent.isCellReference(t[2]))return this.parent.formulaErrorStrings[q.improper_formula];if(t.length>3||t.length<2)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var i=this.parent.computeSumIfAndAvgIf(e);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:i[0]},s.prototype.ComputeABS=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n,t=e,i="";if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[q.wrong_number_arguments];if(""===t[0].toString().split(this.parent.tic).join("").trim()||t[0].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[L.value];if(this.parent.isCellReference(t[0])){if(""===(i=this.parent.getValueFromArg(t[0])))return this.parent.getErrorStrings()[L.name];if(n=this.parent.parseFloat(i),isNaN(n))return this.parent.getErrorStrings()[L.value]}else if(n=this.parent.parseFloat(t[0]),isNaN(n))return this.parent.getErrorStrings()[L.name];return Math.abs(n)},s.prototype.ComputeAVERAGE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];for(var t=e,i=0;i<t.length;i++)if(t[i].indexOf(":")>-1&&t[i].indexOf(this.parent.tic)>-1)return this.parent.getErrorStrings()[L.value];return this.parent.calculateAvg(t)},s.prototype.ComputeAVERAGEIF=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if(t[0].indexOf(":")<0&&!this.parent.isCellReference(t[0]))return this.parent.formulaErrorStrings[q.improper_formula];var i=this.parent.computeSumIfAndAvgIf(e);return"string"==typeof i&&(this.parent.formulaErrorStrings.indexOf(i)||this.parent.getErrorStrings().indexOf(i))?i:this.parent.parseFloat(i[0])/this.parent.parseFloat(i[1])},s.prototype.ComputeCONCATENATE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.invalid_arguments];for(var t=e,i="",n="",a=0;a<t.length;a++){if(t[a].indexOf(":")>-1&&this.parent.isCellReference(t[a])){if(!this.isConcat)return this.parent.getErrorStrings()[L.value];for(var o=this.parent.getCellCollection(t[a]),l=0;l<o.length;l++)i+=n=this.parent.getValueFromArg(o[l])}else{if(1===t.length&&t[0].indexOf(this.parent.tic)<0)return this.parent.getErrorStrings()[L.name];i+=n=this.parent.getValueFromArg(t[a])}if(this.parent.getErrorStrings().indexOf(n)>-1)return n}return i.split(this.parent.tic).join("")},s.prototype.ComputeCONCAT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this.isConcat=!0,this.ComputeCONCATENATE.apply(this,e)},s.prototype.ComputeMAX=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this.parent.computeMinMax(e,"max")},s.prototype.ComputeMIN=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this.parent.computeMinMax(e,"min")},s.prototype.ComputeRAND=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return 1===e.length&&""===e[0]&&(e.length=0),e.length>0?this.parent.formulaErrorStrings[q.wrong_number_arguments]:Math.random().toString()},s.prototype.ComputeAND=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this.parent.computeAndOr(e,"and")},s.prototype.ComputeOR=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this.parent.computeAndOr(e,"or")},s.prototype.ComputeFIND=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.wrong_number_arguments];var t=e;if(t.length>3)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var i=this.parent.removeTics(this.parent.getValueFromArg(t[0])),n=this.parent.removeTics(this.parent.getValueFromArg(t[1]));if(this.parent.getErrorStrings().indexOf(i)>-1||this.parent.getErrorStrings().indexOf(n)>-1)return this.parent.getErrorStrings()[L.name];var a=1;if(3===t.length){if(a=this.parent.removeTics(this.parent.getValueFromArg(t[2])),this.parent.getErrorStrings().indexOf(a)>-1)return a;a=this.parent.parseFloat(a),isNaN(a)&&(a=1)}if(a<=0||a>n.length)return this.parent.getErrorStrings()[L.value];var o=n.indexOf(i,a-1);return o<0?this.parent.getErrorStrings()[L.value]:(Number(o)+Number(1)).toString()},s.prototype.ComputeINDEX=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e,i=t.length;if((0,f.le)(e)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[q.wrong_number_arguments];if(i>3)return this.parent.getErrorStrings()[L.ref];var n="",a=[];if(i>2)for(var o=0;o<i;o++){if(this.parent.isCellReference(t[o])&&t[o].indexOf(":")<0){var l=this.parent.getValueFromArg(t[o]);if(this.parent.getErrorStrings().indexOf(l)>-1)return this.parent.getErrorStrings()[L.ref];a[o]=l}this.parent.isCellReference(t[o])&&(a[o]=t[o])}if(n=t[0],t[1]=""===t[1]?"1":t[1],t[1]=this.parent.getValueFromArg(t[1]),this.parent.getErrorStrings().indexOf(t[1])>-1)return t[1];if(!(0,f.le)(t[2])){if(t[2]=""===t[2]?"1":t[2],t[2]=this.parent.getValueFromArg(t[2]),this.parent.getErrorStrings().indexOf(t[2])>-1)return t[2];if("0"===t[2])return this.parent.getErrorStrings()[L.value]}var h=parseFloat(t[1]);h=isNaN(h)?-1:h;var p=parseFloat(t[2]?t[2]:"1");if(p=isNaN(p)?-1:p,-1===h||-1===p)return this.parent.getErrorStrings()[L.value];var c=t[0].indexOf(":"),d=this.parent.rowIndex(n.substring(0,c)),u=this.parent.rowIndex(n.substring(c+1)),v=this.parent.colIndex(n.substring(0,c)),g=this.parent.colIndex(n.substring(c+1));if(h>u-d+1||p>g-v+1)return this.parent.getErrorStrings()[L.ref];h=d+h-1,p=v+p-1;var m=this.getSheetReference(n)+this.parent.convertAlpha(p)+h,y=this.parent.getValueFromArg(m);return""===y?0:y},s.prototype.getSheetReference=function(e){return 0===e.indexOf(this.parent.sheetToken)&&e.lastIndexOf(this.parent.sheetToken)>e.indexOf(this.parent.sheetToken)?e.substring(0,e.lastIndexOf(this.parent.sheetToken)+1):""},s.prototype.ComputeIFS=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if((0,f.le)(e)||1===t.length&&""===t[0])return this.parent.formulaErrorStrings[q.wrong_number_arguments];for(var i="",n="",a=0;a<t.length;a++){if((i=this.parent.getValueFromArg(t[a]))!==this.parent.trueValue&&i!==this.parent.falseValue)return this.parent.getErrorStrings()[L.value];if(i===this.parent.trueValue)return t[a+1].indexOf(this.parent.arithMarker)>-1?this.parent.trueValue:(n=this.parent.isCellReference(t[a+1].split(this.parent.tic).join(""))?this.parent.getValueFromArg(t[a+1]):t[a+1].indexOf(this.parent.tic)>-1?t[a+1].split(this.parent.tic).join(""):this.parent.getErrorStrings()[L.name],a+=1,n);i===this.parent.falseValue&&(a+=1)}return this.parent.getErrorStrings()[L.na]},s.prototype.ComputeCOUNTA=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.wrong_number_arguments];for(var i,t=e,n=0,o=0;o<t.length;o++)if(t[o].indexOf(":")>-1&&this.parent.isCellReference(t[o])){i=this.parent.getCellCollection(t[o].split(this.parent.tic).join(""));for(var l=0;l<i.length;l++)this.parent.getValueFromArg(i[l]).length>0&&n++}else{var h=this.parent.getValueFromArg(t[o].split(this.parent.tic).join(""));h.length>0&&n++}return n},s.prototype.ComputeAVERAGEA=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if((0,f.le)(e)||1===e.length&&""===e[0])return this.parent.formulaErrorStrings[q.wrong_number_arguments];for(var i,a,l,t=e,n=0,o=0,h=0;h<t.length;h++){if(t[h].indexOf(":")>-1&&this.parent.isCellReference(t[h])){i=this.parent.getCellCollection(t[h].split(this.parent.tic).join(""));for(var p=0;p<i.length;p++)if((a=this.parent.getValueFromArg(i[p])).toUpperCase()===this.parent.trueValue)a="1";else if(a.toUpperCase()===this.parent.falseValue||""===a)a="0";else{if(this.parent.getErrorStrings().indexOf(a)>-1)return a;a.length>0&&(l=parseFloat(a),n+=a=isNaN(l)?0:l,o+=1)}o=i.length}else{if(t[h]===this.parent.trueValue&&(t[h]="1"),(t[h]===this.parent.falseValue||""===t[h])&&(t[h]="0"),a=this.parent.getValueFromArg(t[h].split(this.parent.tic).join("")),this.parent.getErrorStrings().indexOf(a)>-1)return a;a.length>0&&(l=parseFloat(a),n+=a=isNaN(l)?0:l,o+=1)}if(0===o)return this.parent.getErrorStrings()[L.divzero]}return n/o},s.prototype.ComputeSORT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,t=e;if((0,f.le)(e)||""===e[0]||t.length>4)return this.parent.formulaErrorStrings[q.wrong_number_arguments];t[1]=t[1]?t[1]:"1",t[2]=t[2]?t[2]:"1";var n="1"===t[2]?"Ascending":"Descending";t[3]=t[3]?t[3].toUpperCase():"FALSE",t[0]=t[0].split("$").join("");var a,o=[];if(t[0].indexOf(":")>-1){var l=t[0].split(":");if(this.parent.isCellReference(l[0])&&this.parent.isCellReference(l[1])){var h=t[0].indexOf(":"),p=void 0,c=this.parent.rowIndex(this.parent.substring(t[0],0,h)),d=this.parent.colIndex(this.parent.substring(t[0],0,h)),u=this.parent.rowIndex(this.parent.substring(t[0],h+1,h+t[0].length-h-1)),v=this.parent.colIndex(this.parent.substring(t[0],h+1,h+t[0].length-h-1));if(c>u&&(p=u,u=c,c=p),d>v&&(p=v,v=d,d=p),t[2]=this.parent.getValueFromArg(t[2]),"1"!==t[2]&&"-1"!==t[2])return this.parent.getErrorStrings()[L.value];if(!isNaN(this.parseDouble(t[1]))&&this.parseDouble(t[1])<1)return this.parent.getErrorStrings()[L.value];if(t[3].toUpperCase()!==this.parent.trueValue&&t[3].toUpperCase()!==this.parent.falseValue)return this.parent.getErrorStrings()[L.value];var g="";0===t[0].indexOf("!")&&(g=(g=(g=t[0]).replace("!","")).indexOf("!"),g=t[0].substring(0,g+2)),t[0]=g+Re(d)+c+":"+Re(v)+u,a=this.parent.getCellCollection(t[0]);for(var m=0;m<a.length;m++)o.push(this.parent.getValueFromArg(a[m]));var y=[],C=v-d+1;if("TRUE"===t[3])for(m=0;m<C;m++)o[m+(this.parseDouble(t[1])-1)*C]&&y.push(isNaN(this.parseDouble(o[m+(this.parseDouble(t[1])-1)*C]))?o[m+(this.parseDouble(t[1])-1)*C]:this.parseDouble(o[m+(this.parseDouble(t[1])-1)*C]));if("FALSE"===t[3])for(m=0;m<o.length;m++)o[m*C+this.parseDouble(t[1])-1]&&y.push(isNaN(this.parseDouble(o[m*C+this.parseDouble(t[1])-1]))?o[m*C+this.parseDouble(t[1])-1]:this.parseDouble(o[m*C+this.parseDouble(t[1])-1]));for(var b=re.j4.sort(y,null,re.j4.fnSort(n)),S=[],w=0;w<b.length;w++)for(var x=0;x<y.length;x++)JSON.stringify(b[w])===JSON.stringify(y[x])&&-1===S.indexOf(x)&&S.push(x);if("TRUE"===t[3]){for(var I=c,F=0;I<=u;I++,F++){w=0;for(var T=0;w<S.length;w++,T++){var k=this.parent.getValueFromArg(g+Re(S[w]+d)+I);R=(R=this.parent.actCell).indexOf("!")>-1?R.split("!")[1]:R;var D=this.parent.rowIndex(R),N=this.parent.colIndex(R);this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,k,D+F,N+T)}}i=this.parent.getValueFromArg(g+Re(S[0]+d)+c)}if("FALSE"===t[3]){for(w=0,F=0;w<S.length;w++,F++){var P=d;for(T=0;P<=v;P++,T++){var R,M=this.parent.getValueFromArg(g+Re(P)+(S[w]+c));R=(R=this.parent.actCell).indexOf("!")>-1?R.split("!")[1]:R,N=this.parent.colIndex(R),D=this.parent.rowIndex(R),this.parent.parentObject.setValueRowCol(this.parent.getSheetID(this.parent.grid)+1,M,D+F,N+T)}}i=this.parent.getValueFromArg(g+Re(d)+(S[0]+c))}}}return i},s.prototype.ComputeCOUNTIF=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if((0,f.le)(e)||""===e[0]||2!==t.length)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var i,a,n=0,o=[],l="equal",h=t[1].split(this.parent.tic).join("");if(h.startsWith("<=")?(l="lessEq",h=h.substring(2)):h.startsWith(">=")?(l="greaterEq",h=h.substring(2)):h.startsWith("<>")?(l="notEq",h=h.substring(2)):h.startsWith("<")?(l="less",h=h.substring(1)):h.startsWith(">")?(l="greater",h=h.substring(1)):h.startsWith("=")&&(l="equal",h=h.substring(1)),t[0].indexOf(":")>-1&&this.parent.isCellReference(t[0])){i=this.parent.getCellCollection(t[0].split(this.parent.tic).join(""));for(var p=0;p<i.length;p++)a=this.parent.getValueFromArg(i[p]),(h.indexOf("*")>-1||h.indexOf("?")>-1)&&(a=this.parent.findWildCardValue(h,a)),o.push(a),o.push(h),this.parent.processLogical(o,l)===this.parent.trueValue&&n++}return n},s.prototype.ComputeSUMIFS=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=this.parent.computeIfsFormulas(e,this.parent.falseValue);return t},s.prototype.ComputeTEXT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var t,i=e.length,n=0;n<i;n++)t=(0,f.le)(t)?e[n]:t+","+e[n];var a=t.indexOf(","),o=t.slice(0,a),l=t.slice(t.indexOf('"')+1,t.length),h=l.indexOf('"');if(a>-1&&h!==l.length-1)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var p=o,c=l.slice(0,l.length-1),d=new Date(1900,0,1,0,0,0),u=p+","+c,v=new f.eC;if(this.parent.getErrorStrings().indexOf(u)>-1)return u;if(p=this.parent.getValueFromArg(p),""===(c=c.split(this.parent.tic).join("")))return"";""===p&&(c.length>0&&(c.toUpperCase().indexOf("M")>-1||c.toUpperCase().indexOf("D")>-1||c.toUpperCase().indexOf("Y")>-1||c.toUpperCase().indexOf("S")>-1||c.toUpperCase().indexOf("T")>-1)||c.toUpperCase().indexOf("H")>-1)&&(p=d.toString());var g=this.parseDouble(p);if(isNaN(g)&&null!==this.parent.isDate(new Date(p))&&(g=this.parent.toOADate(new Date(p))),d=Date.parse(p.split(this.parent.tic).join("")),!isNaN(g)||!isNaN(d)){if("["===c[0])return this.parent.tic+p+this.parent.tic;if(c.length>0&&(c.toUpperCase().indexOf("M")>-1||c.toUpperCase().indexOf("D")>-1||c.toUpperCase().indexOf("Y")>-1||c.toUpperCase().indexOf("S")>-1||c.toUpperCase().indexOf("T")>-1)||c.toUpperCase().indexOf("H")>-1){var m=(c=(c=c.split("Y").join("y").split("D").join("d").split("H").join("h")).split("S").join("s").split("m").join("M").split("AM/PM").join("tt")).split(""),y=!1,C=!1,b=(n=0,0),S=0;for(n=0;n<m.length;){var w=m[n];"s"===w&&"M"===m[b]&&(m[b]="m","M"===m[b-1]&&(m[b-1]="m")),this.parent.isChar(w)?(b=n,"M"===w&&S++):S>1&&S++,"M"===w&&y&&(m[n]="m",C=!0),"h"===w?y=!0:this.parent.isChar(w)&&"M"!==w&&"h"!==w&&!C&&(y=!1,C=!1),n++}c=(c=String(m)).split(",").join("").split("\n").join(" ");var x=this.parent.fromOADate(g);0===g&&(x=d);var I=Lh(c);if(""===I)return this.parent.getErrorStrings()[L.name];var F=v.getDateFormat({skeleton:I,type:"date"}),T=F(new Date(x.toString()));p=T}else p=v.formatNumber(g,{format:c})}return p},s.prototype.ComputeCOUNTIFS=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=this.parent.computeIfsFormulas(e,this.parent.trueValue);return t},s.prototype.ComputeAVERAGEIFS=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=this.parent.computeIfsFormulas(e,this.parent.falseValue,this.parent.trueValue);return t},s.prototype.ComputeMATCH=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if((0,f.le)(t)||1===t.length&&""===t[0]||t.length<2||t.length>3)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var i,n=[],a=t[0].split(this.parent.tic).join("");if(this.parent.isCellReference(a)&&(a=this.parent.getValueFromArg(a)),!a.toString().length)return this.parent.getErrorStrings()[L.na];t[2]=(0,f.le)(t[2])?"1":t[2].split(this.parent.tic).join(""),t[2].split(this.parent.tic).join("")===this.parent.trueValue&&(t[2]="1"),t[2].split(this.parent.tic).join("")===this.parent.falseValue&&(t[2]="0");var o=parseFloat(t[2]);if(-1!==o&&0!==o&&1!==o)return this.parent.getErrorStrings()[L.na];var l=0,h="";if(t[1].indexOf(":")>-1||this.parent.isCellReference(t[1])){i=this.parent.getCellCollection(t[1].split(this.parent.tic).join(""));for(var p=0;p<i.length;p++)n[p]=this.parent.getValueFromArg(i[p]).split(this.parent.tic).join("");for(var c=0;c<n.length;c++)if(n[c].toString().length)if(1===o){if(a===n[c])return c+1;a>n[c]&&(h?n[c]>h&&(l=c+1,h=n[c]):(l=c+1,h=n[c]))}else if(0===o){if((a.indexOf("*")>-1||a.indexOf("?")>-1)&&(n[c]=this.parent.findWildCardValue(a,n[c])),a===n[c]||this.parent.parseFloat(a)===this.parent.parseFloat(n[c]))return c+1}else if(-1===o){if(a===n[c])return c+1;a<n[c]&&(h?n[c]<h&&(l=c+1,h=n[c]):(l=c+1,h=n[c]))}}return l||this.parent.getErrorStrings()[L.na]},s.prototype.ComputeSUBTOTAL=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e,i="";if(t.length<2)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var n=this.parent.parseFloat(this.parent.getValueFromArg(t[0].split(this.parent.tic).join(""))),a=t.slice(1,t.length);switch(n){case 1:case 101:i=this.ComputeAVERAGE.apply(this,a);break;case 2:case 102:i=this.ComputeCOUNT.apply(this,a);break;case 3:case 103:i=this.ComputeCOUNTA.apply(this,a);break;case 4:case 104:i=this.ComputeMAX.apply(this,a);break;case 5:case 105:i=this.ComputeMIN.apply(this,a);break;case 6:case 106:i=this.ComputePRODUCT.apply(this,a);break;case 7:case 107:i=this.ComputeDAY.apply(this,a);break;case 8:case 108:i=this.ComputeCONCAT.apply(this,a);break;case 9:case 109:i=this.ComputeSUM.apply(this,a);break;case 10:case 110:i=this.ComputeAVERAGEA.apply(this,a);break;case 11:case 111:i=this.ComputeABS.apply(this,a);break;default:i=this.parent.getErrorStrings()[L.value]}return i},s.prototype.ComputeRADIANS=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if(""===t[0]||t.length>1)return this.parent.formulaErrorStrings[q.wrong_number_arguments];if(t[0].indexOf(":")>-1||""===t[0].split(this.parent.tic).join(""))return this.parent.getErrorStrings()[L.value];var n=t[0].split(this.parent.tic).join("");t[0]=isNaN(this.parent.parseFloat(n))?t[0]:n;var a=this.parent.getValueFromArg(t[0]),o=this.parent.parseFloat(a);return isNaN(o)?a.indexOf(this.parent.tic)>-1?this.parent.getErrorStrings()[L.value]:this.parent.getErrorStrings()[L.name]:Math.PI*o/180},s.prototype.ComputeRANDBETWEEN=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,n,a,t=e.length;if(2!==t)return this.parent.formulaErrorStrings[q.wrong_number_arguments];for(var o=0;o<t;o++){if(""===e[o])return this.parent.getErrorStrings()[L.na];if(e[o].indexOf(this.parent.tic)>-1){if(isNaN(parseFloat(e[o].split(this.parent.tic).join(""))))return this.parent.getErrorStrings()[L.value];e[o]=e[o].split(this.parent.tic).join("")}if(a=parseFloat(this.parent.getValueFromArg(e[o])),this.parent.isCellReference(e[o])){if(a=""===this.parent.getValueFromArg(e[o])?0:a,0===o?i=a:n=a,0===i&&0===n)return"0";if(isNaN(a))return this.parent.getErrorStrings()[L.value]}else{if(isNaN(a))return this.parent.getErrorStrings()[L.name];0===o?i=a:n=a}}return n<i?this.parent.getErrorStrings()[L.num]:0===i?Math.floor(Math.random()*(n-(i-1)))+i:n-i==1?Math.round(Math.random()*(n-i)+i):Math.floor(Math.random()*(n-(i-1)))+i},s.prototype.ComputeSLOPE=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if(2!==t.length||""===t[0])return this.parent.formulaErrorStrings[q.wrong_number_arguments];var i=this.parent.getCellCollection(t[1].split(this.parent.tic).join("")),n=this.parent.getCellCollection(t[0].split(this.parent.tic).join(""));if(n.length!==i.length)return this.parent.getErrorStrings()[L.na];var a=this.getDataCollection(n),o=this.getDataCollection(i);if(o.indexOf("#NAME?")>-1||a.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[L.name];for(var l=0,h=0,p=0,c=0,d=0,u=o.length;d<u;++d)"NaN"!==Number(o[d]).toString()&&"NaN"!==Number(a[d]).toString()&&(l+=Number(o[d])*Number(a[d]),p+=Number(o[d]),c+=Number(a[d]),h+=Number(o[d])*Number(o[d]));var v=((l-p*c/o.length)/(h-p*p/o.length)).toString();return"NaN"===v?this.parent.getErrorStrings()[L.divzero]:v},s.prototype.ComputeINTERCEPT=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if(""===t[0]||2!==t.length)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var i=this.parent.getCellCollection(t[0].split(this.parent.tic).join("")),n=this.parent.getCellCollection(t[1].split(this.parent.tic).join(""));if(i.length!==n.length)return this.parent.getErrorStrings()[L.na];var a=this.getDataCollection(n),o=this.getDataCollection(i);if(a.indexOf("#NAME?")>-1||o.indexOf("#NAME?")>-1)return this.parent.getErrorStrings()[L.name];for(var l=0,h=0,p=0,c=a.length;p<c;++p)l+=Number(a[p]),h+=Number(o[p]);l/=a.length,h/=a.length;var v,d=0,u=0;for(p=0,c=a.length;p<c;++p)d+=(v=Number(a[p])-l)*(Number(o[p])-h),u+=v*v;var g=(h-d/u*l).toString();return"NaN"===g?this.parent.getErrorStrings()[L.divzero]:g},s.prototype.ComputeLN=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n,a,t=e,i="";if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[q.wrong_number_arguments];if(this.parent.isCellReference(t[0])){if(i=this.parent.getValueFromArg(t[0]),(n=this.parent.parseFloat(i))<=0||""===i)return this.parent.getErrorStrings()[L.num];if(isNaN(n))return this.parent.getErrorStrings()[L.value]}else{if(a=this.parent.getValueFromArg(t[0].split(this.parent.tic).join("")),(n=this.parent.parseFloat(a))<=0||""===n.toString())return this.parent.getErrorStrings()[L.num];if(isNaN(n))return this.parent.getErrorStrings()[L.value]}return Math.log(n)},s.prototype.ComputeISNUMBER=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var t=e;if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[q.wrong_number_arguments];var i=this.parent.isCellReference(t[0])?this.parent.getValueFromArg(t[0]):this.parent.getValueFromArg(t[0].split(this.parent.tic).join(""));if(""===i.toString())return!1;var n=this.parent.parseFloat(i);return!isNaN(n)},s.prototype.ComputeROUND=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,o,l,h,p,t=e,n=0,a=0;return 0===e.length||e.length>2?this.parent.formulaErrorStrings[q.wrong_number_arguments]:1===e.length?(i="TRUE"===t[0].split(this.parent.tic).join("")?"1":"FALSE"===t[0].split(this.parent.tic).join("")?"0":t[0],Math.round(this.parent.parseFloat(i)).toString()):(l=this.parent.getValueFromArg(t[0]),h=""===t[1].split(this.parent.tic).join("")?"0":this.parent.getValueFromArg(t[1].split(this.parent.tic).join("")),l="TRUE"===l.split(this.parent.tic).join("")?"1":"FALSE"===l.split(this.parent.tic).join("")?"0":l,h="TRUE"===h.split(this.parent.tic).join("")?"1":"FALSE"===h.split(this.parent.tic).join("")?"0":h,""!==l&&""!==h&&(n=this.parent.parseFloat(l),a=this.parent.parseFloat(h),!isNaN(a)&&!isNaN(n)&&a>0?o=this.preciseRound(n,a):(p=Math.pow(10,-a),o=Math.round(n/p)*p)),o.toString())},s.prototype.preciseRound=function(e,r){var t=e>=0?1:-1;return(Math.round(e*Math.pow(10,r)+.001*t)/Math.pow(10,r)).toFixed(r)},s.prototype.ComputePOWER=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var n,a,t=e;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[q.wrong_number_arguments];n=this.parent.getValueFromArg(t[0]),a=this.parent.getValueFromArg(t[1]),n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,a="TRUE"===a.split(this.parent.tic).join("")?"1":"FALSE"===a.split(this.parent.tic).join("")?"0":a;var o=this.parent.parseFloat(n),l=this.parent.parseFloat(a);return isNaN(o)||isNaN(l)?this.parent.getErrorStrings()[L.value]:0===o&&l<0?this.parent.getErrorStrings()[L.divzero]:0===o&&0===l?this.parent.getErrorStrings()[L.num]:Math.pow(o,l).toString()},s.prototype.ComputeLOG=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,n,t=e;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[q.wrong_number_arguments];if(i=this.parent.getValueFromArg(t[0]),n=2===e.length?this.parent.getValueFromArg(t[1]):"10",""===i||null===i||""===n||null===n)return this.parent.getErrorStrings()[L.num];i="TRUE"===i.split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i,n="TRUE"===n.split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n;var a=this.parent.parseFloat(i),o=this.parent.parseFloat(n);return a<=0||o<=0?this.parent.getErrorStrings()[L.num]:1===o?this.parent.getErrorStrings()[L.divzero]:isNaN(a)||isNaN(o)?this.parent.getErrorStrings()[L.value]:(Math.log(a)/Math.LN10/(Math.log(o)/Math.LN10)).toString()},s.prototype.ComputeTRUNC=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,t=e,n=0;if(0===e.length||e.length>2)return this.parent.formulaErrorStrings[q.wrong_number_arguments];2===e.length&&(n="TRUE"===(n=this.parent.getValueFromArg(t[1])).split(this.parent.tic).join("")?"1":"FALSE"===n.split(this.parent.tic).join("")?"0":n,n=this.parent.parseFloat(n)),i="TRUE"===(i=this.parent.getValueFromArg(t[0])).split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i;var a=this.parent.parseFloat(i.split(this.parent.tic).join(""));if(isNaN(a)||isNaN(n))return t[0]===this.parent.tic||this.parent.isCellReference(t[0])||t[1]===this.parent.tic||this.parent.isCellReference(t[1])?this.parent.getErrorStrings()[L.value]:this.parent.getErrorStrings()[L.name];var o=Math.pow(10,n),l=a<0?-1:1;return(l*Math.floor(o*Math.abs(a))/o).toString()},s.prototype.ComputeEXP=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i,t=e;if(0===e.length||e.length>1)return this.parent.formulaErrorStrings[q.wrong_number_arguments];""===(i="TRUE"===(i=this.parent.getValueFromArg(t[0])).split(this.parent.tic).join("")?"1":"FALSE"===i.split(this.parent.tic).join("")?"0":i)&&(i="0");var n=this.parent.parseFloat(i);return n>709?this.parent.getErrorStrings()[L.num]:isNaN(n)?t[0]===this.parent.tic||this.parent.isCellReference(t[0])?this.parent.getErrorStrings()[L.value]:this.parent.getErrorStrings()[L.name]:Math.exp(n).toString()},s.prototype.ComputeGEOMEAN=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o,l,h,p,t=e,i=1,n=0,a=0;if(0===e.length)return this.parent.formulaErrorStrings[q.wrong_number_arguments];for(l=0;l<t.length;l++)if(t[l].indexOf(":")>-1){if(t[0]===this.parent.tic)return this.parent.getErrorStrings()[L.value];for(p=this.parent.getCellCollection(t[l].split(this.parent.tic).join("")),h=0;h<p.length;h++){if(a="TRUE"===(a=this.parent.getValueFromArg(p[h])).split(this.parent.tic).join("")?"1":"FALSE"===a.split(this.parent.tic).join("")?"0":a,(o=this.parent.parseFloat(a))<=0)return this.parent.getErrorStrings()[L.num];isNaN(o)||(n++,i*=o)}}else if((a=this.parent.getValueFromArg(t[l])).length>0){if(a="TRUE"===a.split(this.parent.tic).join("")?"1":"FALSE"===a.split(this.parent.tic).join("")?"0":a,!this.parent.isCellReference(t[l])&&isNaN(this.parent.parseFloat(a)))return this.parent.getErrorStrings()[L.name];if((o=this.parent.parseFloat(a))<=0)return this.parent.getErrorStrings()[L.num];isNaN(o)||(n++,i*=o)}return n>0&&(i=Math.pow(i,1/n)),i.toString()},s.prototype.getDataCollection=function(e){for(var r=[],t=0,i=e.length;t<i;t++)r.push(this.parent.getValueFromArg(e[t]));return r},s.prototype.parseDouble=function(e){var r=this.parent.parseFloat(e.toString());return isNaN(r)?NaN:r},s.prototype.spreadsheetDisplayText=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var r=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getDisplayText(this.parent.parentObject.getActiveSheet().rows[r.startIdx].cells[r.endIdx])}return e},s.prototype.spreadsheetFormat=function(e){if(this.parent.parentObject&&this.parent.parentObject.element&&this.parent.parentObject.element.classList.contains("e-spreadsheet")&&this.parent.isCellReference(e)){var r=this.parent.parentObject.getIndexes(e);e=this.parent.parentObject.getActiveSheet().rows[r.startIdx].cells[r.endIdx].format}return e},s.prototype.getModuleName=function(){return"basic-formulas"},s}(),Ph=function(){function s(e){this.emptyStr="",this.storedStringText=this.emptyStr,this.sheetToken="!",this.tokenAdd="a",this.tokenSubtract="s",this.tokenMultiply="m",this.tokenDivide="d",this.tokenLess="l",this.charEm="r",this.charEp="x",this.tokenGreater="g",this.tokenEqual="e",this.tokenLessEq="k",this.tokenGreaterEq="j",this.tokenNotEqual="o",this.tokenAnd="c",this.tokenEm="v",this.tokenEp="t",this.tokenOr=String.fromCharCode(126),this.charAnd="i",this.charLess="<",this.charGreater=">",this.charEqual="=",this.charLessEq="f",this.charGreaterEq="h",this.charNoEqual="z",this.stringGreaterEq=">=",this.stringLessEq="<=",this.stringNoEqual="<>",this.stringAnd="&",this.stringOr="^",this.charOr="w",this.charAdd="+",this.charSubtract="-",this.charMultiply="*",this.charDivide="/",this.fixedReference="$",this.spaceString=" ",this.ignoreBracet=!1,this.isError=!1,this.isFormulaParsed=!1,this.findNamedRange=!1,this.stringsColl=new Map,this.tokens=[this.tokenAdd,this.tokenSubtract,this.tokenMultiply,this.tokenDivide,this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual,this.tokenAnd,this.tokenOr],this.charNOTop=String.fromCharCode(167),this.specialSym=["~","@","#","?"],this.isFailureTriggered=!1,this.parent=e}return s.prototype.parse=function(e,r){if(this.parent.isTextEmpty(e))return e;if(function(s){var e=!1;for(var r in Ln)if(s.indexOf("."+r+"]")>-1){e=!0;break}return e}(e))return this.parent.getErrorStrings()[L.ref];this.parent.getFormulaCharacter()!==String.fromCharCode(0)&&this.parent.getFormulaCharacter()===e[0]&&(e=e.substring(1)),(this.parent.namedRanges.size>0||this.parent.storedData.size>0)&&(e=this.checkForNamedRangeAndKeyValue(e),this.findNamedRange=!1),e=(e=(e=(e=e.split("-+").join("-")).split("--").join("+")).split("+-").join("-")).split("-(-").join("(");var t=this.storeStrings(e);e=this.storedStringText;var i=0;if((0,f.le)(t)&&(e=e.split(" ").join("")),((e=(e=e.split("=>").join(">=")).split("=<").join("<="))[e.length-1]!==this.parent.arithMarker||this.indexOfAny(e,this.tokens)!==e.length-2)&&(e=e.toUpperCase()),e.indexOf(this.sheetToken)>-1){var n=this.parent.getSheetFamilyItem(this.parent.grid);if(null!=n.sheetNameToParentObject&&n.sheetNameToParentObject.size>0){e[0]!==this.sheetToken.toString()&&(e=this.parent.setTokensForSheets(e));var a=this.parent.getSheetToken(e.split(this.parent.tic).join(this.emptyStr)),o=this.checkScopedRange(e.split('"').join(this.emptyStr).split(this.sheetToken).join(""));(0,f.le)(a)&&""!==a&&this.parent.namedRanges.size>0&&""!==o&&(e=o)}}e=this.markLibraryFormulas(e);try{e=this.formulaAutoCorrection(e)}catch(d){if(!(l={message:d.message,exception:d,isForceCalculable:d.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[q.invalid_expression];if(this.isFailureTriggered||(this.parent.trigger("onFailure",l),this.isFailureTriggered=!0),!l.isForceCalculable||!l.computeForceCalculate)throw this.parent.formulaErrorStrings[q.invalid_expression];e=this.formulaAutoCorrection(e,l),this.parent.storedData.get(r).formulaText="="+e}if(!this.ignoreBracet)for(i=e.indexOf(")");i>-1;){var h=e.substring(0,i).lastIndexOf("(");if(-1===h)throw new it(this.parent.formulaErrorStrings[q.mismatched_parentheses]);if(h===i-1)throw new it(this.parent.formulaErrorStrings[q.empty_expression]);var p;p=this.ignoreBracet?this.parent.substring(e,h,i-h+1):this.parent.substring(e,h+1,i-h-1);try{e=e.substring(0,h)+this.parseSimple(p)+e.substring(i+1)}catch(d){var l=this.exceptionArgs(d);this.isFailureTriggered||(this.parent.trigger("onFailure",l),this.isFailureTriggered=!0);var c="string"==typeof l.exception?l.exception:l.message;return(this.parent.getErrorLine(d)?"":"#"+this.parent.getErrorLine(d)+": ")+c}i=e.indexOf(")")}if(!this.ignoreBracet&&e.indexOf("(")>-1)throw new it(this.parent.formulaErrorStrings[q.mismatched_parentheses]);return e=this.parseSimple(e),null!==t&&t.size>0&&(e=this.setStrings(e,t)),e},s.prototype.exceptionArgs=function(e){return{message:e.message,exception:e,isForceCalculable:e.formulaCorrection,computeForceCalculate:!1}},s.prototype.formulaAutoCorrection=function(e,r){var t=["*","+","-","/","^","&"],i=[">","=","<"],n=0,a="",o="",l="",h="",p="",c="",d="",u=0;if(this.parent.formulaErrorStrings.indexOf(e)>-1)return e;if(this.indexOfAny(e,this.specialSym)>-1)throw new it(this.parent.formulaErrorStrings[q.invalid_expression],!1);for(;n<e.length;)if(e=e.split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"),this.parent.isDigit(e[n])&&e.length>n+1&&this.indexOfAny(e[n+1],t)>-1&&e.length>n+2&&!(0,f.le)(e[n+2])&&this.indexOfAny(e[n+2],t)>-1&&("-"!==e[n+2]||"*"!==e[n+1]&&"/"!==e[n+1])){if((0,f.le)(r))throw new it(this.parent.formulaErrorStrings[q.invalid_expression],!0);if(!r.computeForceCalculate)throw this.parent.formulaErrorStrings[q.improper_formula];this.parent.isDigit(e[n])?(u<1?(c=e[n],(0,f.le)(l=e[n+1])&&(l=this.emptyStr),u+=1,a=a+c+(l="&"===l?"":l)):u<2&&(d=e[n],p=e[n+1],u=0,a="-"===(h=e[n-1])?a+h+d+(p="&"===(p=(0,f.le)(p)?this.emptyStr:p)?"":p):a+d+(p=(0,f.le)(p)?this.emptyStr:p)),n+=2):(a="-"===e[n]?a+e[n]:a,n+=1)}else if((this.parent.isDigit(e[n])||e[n]===this.parent.rightBracket||this.parent.storedData.has(e[n].toUpperCase()))&&((0,f.le)(e[n+1])||this.indexOfAny(e[n+1],t))>-1)o="&"===(o=(0,f.le)(e[n+1])?this.emptyStr:e[n+1])?"":o,a="-"===e[n-1]?a+e[n-1]+e[n]+o:a+e[n]+o,n+=2;else if(this.indexOfAny(e[n],i)>-1&&!(0,f.le)(e[n-1])&&!(0,f.le)(e[n+1]))a+=e[n],n+=1;else if("q"===e[n])for(;e[n]!==this.parent.leftBracket;)a+=e[n],n+=1;else e[n]===this.parent.leftBracket||e[n]===this.parent.rightBracket||"{"===e[n]||"}"===e[n]||"("===e[n]||")"===e[n]||this.parent.isUpperChar(e[n])||e[n].indexOf(":")>-1||e[n]===this.parent.getParseArgumentSeparator()||"%"===e[n]&&this.parent.isDigit(e[n-1])||e[n]===this.parent.tic||" "===e[n]||"."===e[n]||e[n]===this.sheetToken||"$"===e[n]?(a+=e[n],n+=1):(this.parent.isDigit(e[n])&&(a="-"===e[n-1]?a+e[n-1]+e[n]:a+e[n]),("-"===e[n]||"+"===e[n])&&(a=(a+=e[n]).split("++").join("+").split("+-").join("-").split("-+").join("-")),("/"===e[n]||"*"===e[n]||"^"===e[n])&&(a+=e[n]),n+=1);return this.indexOfAny((a=a===this.emptyStr?e:a)[a.length-1],t)>-1&&(a=a.substring(0,a.length-1)),a.split("--").join("-").split("-+").join("-").split("+-").join("-")},s.prototype.checkScopedRange=function(e){var r=this,t=this.emptyStr,i="NaN",n=this.parent.getSheetID(this.parent.grid),a=this.parent.getSheetFamilyItem(this.parent.grid);if(e[0]===this.sheetToken.toString()){var o=e.indexOf(this.sheetToken,1),l=parseInt(e.substr(1,o-1),10);o>1&&!this.parent.isNaN(l)&&(e=e.substring(o+1),n=l)}var h="!"+n.toString()+"!";return null===a||null==a.sheetNameToToken||a.sheetNameToToken.forEach(function(p,c){if(a.sheetNameToToken.get(c).toString()===h){var d=r.emptyStr;r.parent.namedRanges.forEach(function(u,v){d=(0,f.le)(r.parent.parentObject)?a.sheetNameToToken.get(v).toUpperCase():(r.parent.parentObject.getActiveSheet().name+r.sheetToken+e).toUpperCase(),r.parent.getNamedRanges().has(d)&&(t=r.parent.getNamedRanges().get(d).toUpperCase(),i=t)})}}),i},s.prototype.storeStrings=function(e){var o,r=0,t=0,i=0,n="",a=null;if(e.indexOf(this.parent.tic)>-1)for(r=e.indexOf(this.parent.tic);r>-1&&e.length>0;){if(null===a&&(a=this.stringsColl),-1===(t=r+1<e.length?e.indexOf(this.parent.tic,r+1):-1))throw new it(this.parent.formulaErrorStrings[q.mismatched_tics]);o=this.parent.substring(e,r,t-r+1),n=this.parent.tic+this.spaceString+i.toString()+this.parent.tic,a=a.set(n,o),e=e.substring(0,r)+n+e.substring(t+1),(r+=n.length)<=e.length&&(r=e.indexOf(this.parent.tic,r)),i++}return this.storedStringText=e,a},s.prototype.setStrings=function(e,r){for(var t=0;t<r.size;t++)r.forEach(function(i,n){e=e.split(n).join(i)});return e},s.prototype.parseSimple=function(e){var t=e;if(t.length>0&&"+"===t[0]&&(t=t.substring(1)),"#DIV/0!"===t)return"#DIV/0!";if("#NAME?"===t)return"#NAME?";if(""===t||this.parent.formulaErrorStrings.indexOf(t)>-1)return t;t=(t=(t=(t=(t=(t=t.split(this.stringLessEq).join(this.charLessEq)).split(this.stringGreaterEq).join(this.charGreaterEq)).split(this.stringNoEqual).join(this.charNoEqual)).split(this.stringAnd).join(this.charAnd)).split(this.stringOr).join(this.charOr)).split(this.fixedReference).join(this.emptyStr);var n=[this.tokenMultiply,this.tokenDivide],a=[this.tokenAdd,this.tokenSubtract],o=[this.charMultiply,this.charDivide],l=[this.charAdd,this.charSubtract],h=[this.tokenLess,this.tokenGreater,this.tokenEqual,this.tokenLessEq,this.tokenGreaterEq,this.tokenNotEqual],p=[this.charLess,this.charGreater,this.charEqual,this.charLessEq,this.charGreaterEq,this.charNoEqual],d=[this.tokenAnd],u=[this.charAnd],v=[this.charOr],g=[this.tokenOr];return t=this.parseSimpleOperators(t,[this.tokenEp,this.tokenEm],[this.charEp,this.charEm]),t=this.parseSimpleOperators(t,g,v),t=this.parseSimpleOperators(t,n,o),t=this.parseSimpleOperators(t,a,l),t=this.parseSimpleOperators(t,h,p),this.parseSimpleOperators(t,d,u)},s.prototype.parseSimpleOperators=function(e,r,t){if(this.parent.getErrorStrings().indexOf(e)>-1)return e;for(var i=e,n=0,a="",o=0;o<t.length;o++)a+=t[o];(i=(i=i.split("---").join("-").split("--").join("+").split(this.parent.getParseArgumentSeparator()+"-").join(this.parent.getParseArgumentSeparator()+"u").split(this.parent.leftBracket+"-").join(this.parent.leftBracket+"u").split("=-").join("=u")).split(",+").join(",").split(this.parent.leftBracket+"+").join(this.parent.leftBracket).split("=+").join("=").split(">+").join(">").split("<+").join("<").split("/+").join("/").split("*+").join("*").split("++").join("+").split("*-").join("*u").toString()).length>0&&"-"===i[0]?(i=i.substring(1).split("-").join(this.tokenOr),i=(i=this.parseSimpleOperators(i="0-"+i,[this.tokenSubtract],[this.charSubtract])).split(this.tokenOr).join("-")):i.length>0&&"+"===i[0]?i=i.substring(1):i.length>0&&"+"===i[i.length-1]&&(i=i.substring(0,i.length-1));try{if(this.indexOfAny(i,t)>-1){if(i.includes(" ")){for(var l="",h=0;h<i.length;h++){var p=i[h];if(t.indexOf(p)>=0)l=l.trim()+p;else{if(" "==p&&t.indexOf(l[l.length-1])>=0)continue;l+=p}}i=l}for(n=this.indexOfAny(i,t);n>-1;){var c="",d="",u=0,v=0,m=0;if(i[n]===this.charNOTop)u=n;else if(i[m=n-1]===this.parent.arithMarker){if((y=this.findLeftMarker(i.substring(0,m-1)))<0)throw new it(this.parent.formulaErrorStrings[q.cannot_parse]);c=this.parent.substring(i,y+1,m-y-1),u=y+1}else if(i[m]===this.parent.rightBracket){for(var C=0,y=m-1;y>0&&("q"!==i[y]||0!==C);)"q"===i[y]?C--:i[y]===this.parent.rightBracket&&C++,y--;if(y<0)throw new it(this.parent.formulaErrorStrings[q.cannot_parse]);c=this.parent.substring(i,y,m-y+1),u=y}else if(i[m]===this.parent.tic[0]){var b=i.substring(0,m-1).lastIndexOf(this.parent.tic);if(b<0)throw new it(this.parent.formulaErrorStrings[q.cannot_parse]);c=this.parent.substring(i,b,m-b+1),u=b}else{for(var S=!1;m>-1&&(this.parent.isDigit(i[m])||!S&&i[m]===this.parent.getParseDecimalSeparator());)i[m]===this.parent.getParseDecimalSeparator()&&(S=!0),m-=1;if(m>-1&&S&&i[m]===this.parent.getParseDecimalSeparator())throw new it(this.parent.formulaErrorStrings[q.number_contains_2_decimal_points]);if(0===(m+=1)||m>0&&!this.parent.isUpperChar(i[m-1]))c="n"+this.parent.substring(i,m,n-m),u=m;else{for(m-=1;m>-1&&(this.parent.isUpperChar(i[m])||this.parent.isDigit(i[m]));)m-=1;if(m>-1&&i[m]===this.sheetToken){for(m-=1;m>-1&&i[m]!==this.sheetToken;)m-=1;m>-1&&i[m]===this.sheetToken&&(m-=1)}if(m>-1&&":"===i[m]){for(m-=1;m>-1&&this.parent.isDigit(i[m]);)m-=1;for(;m>-1&&this.parent.isUpperChar(i[m]);)m-=1;if(m>-1&&i[m]===this.sheetToken){for(m--;m>-1&&i[m]!==this.sheetToken;)m--;m>-1&&i[m]===this.sheetToken&&m--}c=this.parent.substring(i,m+=1,n-m),c=this.parent.getCellFrom(c)}else c=this.parent.substring(i,m+=1,n-m);this.parent.updateDependentCell(c),u=m}(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(c.toUpperCase())||this.parent.storedData.has(c.toUpperCase()))&&(c="n"+this.checkForNamedRangeAndKeyValue(c))}if(n===i.length-1)throw new it(this.parent.formulaErrorStrings[q.expression_cannot_end_with_an_operator]);var w="u"===i[m=n+1];if(w&&(m+=1),i[m]===this.parent.tic[0]){if((y=i.substring(m+1).indexOf(this.parent.tic))<0)throw this.parent.formulaErrorStrings[q.cannot_parse];d=this.parent.substring(i,m,y+2),v=y+m+2}else if(i[m]===this.parent.arithMarker){if((y=this.findRightMarker(i.substring(m+1)))<0)throw new it(this.parent.formulaErrorStrings[q.cannot_parse]);d=this.parent.substring(i,m+1,y),v=y+m+2}else if("q"===i[m]){for(C=0,y=m+1;y<i.length&&(i[y]!==this.parent.rightBracket||0!==C);)i[y]===this.parent.rightBracket?C++:"q"===i[y]&&C--,y++;if(y===i.length)throw this.parent.formulaErrorStrings[q.cannot_parse];d=this.parent.substring(i,m,y-m+1),w&&(d="u"+d),v=y+1}else if(this.parent.isDigit(i[m])||i[m]===this.parent.getParseDecimalSeparator()){for(S=i[m]===this.parent.getParseDecimalSeparator(),m+=1;m<i.length&&(this.parent.isDigit(i[m])||!S&&i[m]===this.parent.getParseDecimalSeparator());)i[m]===this.parent.getParseDecimalSeparator()&&(S=!0),m+=1;if(m<i.length&&"%"===i[m]&&(m+=1),S&&m<i.length&&i[m]===this.parent.getParseDecimalSeparator())throw this.parent.formulaErrorStrings[q.number_contains_2_decimal_points];d="n"+this.parent.substring(i,n+1,m-n-1),v=m}else if(this.parent.isUpperChar(i[m])||i[m]===this.sheetToken||"u"===i[m]){if(i[m]===this.sheetToken)for(m+=1;m<i.length&&i[m]!==this.sheetToken;)m+=1;m+=1;for(var x=0,I=!1;m<i.length&&(this.parent.isUpperChar(i[m])||"_"===i[m]||"."===i[m]||"["===i[m]||"]"===i[m]||"#"===i[m]||" "===i[m]||"%"===i[m]||i[m]===this.parent.getParseDecimalSeparator()&&I);)m!==i.length-1&&"["===i[m]&&"["===i[m+1]&&(I=!0),m!==i.length-1&&"]"===i[m]&&"]"===i[m+1]&&(I=!1),m++,x++;var F=m===i.length||!this.parent.isDigit(i[m]);if(x>1){for(;m<i.length&&(this.parent.isUpperChar(i[m])||this.parent.isDigit(i[m])||" "===i[m]||"_"===i[m]);)m++;F=!0}for(;m<i.length&&this.parent.isDigit(i[m]);)m+=1;if(m<i.length&&":"===i[m]){if((m+=1)<i.length&&i[m]===this.sheetToken){for(m++;m<i.length&&i[m]!==this.sheetToken;)m+=1;m<i.length&&i[m]===this.sheetToken&&m++}for(;m<i.length&&this.parent.isUpperChar(i[m]);)m+=1;for(;m<i.length&&this.parent.isDigit(i[m]);)m+=1;d=this.parent.substring(i,n+1,(m-=1)-n),d=this.parent.getCellFrom(d)}else d=this.parent.substring(i,n+1,(m-=1)-n),(w="u"===i[m])&&(d="u"+d);F&&d.startsWith(this.sheetToken)&&(F=!this.parent.isCellReference(d)),F||this.parent.updateDependentCell(d),(this.parent.namedRanges.size>0&&this.parent.namedRanges.has(d.toUpperCase())||this.parent.storedData.has(d.toUpperCase()))&&(d="n"+this.checkForNamedRangeAndKeyValue(d)),v=m+1}var T=a.indexOf(i[n]),k=this.parent.arithMarker+c+d+r[T]+this.parent.arithMarker;u>0&&(k=i.substring(0,u)+k),v<i.length&&(k+=i.substring(v)),k=k.split(this.parent.arithMarker2).join(this.parent.arithMarker.toString()),n=this.indexOfAny(i=k,t)}}else if(i.length>0&&(this.parent.isUpperChar(i[0])||i[0]===this.sheetToken)){var R=!0,D=!0,N=!1,P=i.length;for(y=0;y<P;++y)if(i[y]===this.sheetToken){if(y>0&&!N)throw this.parent.getErrorStrings()[L.ref];for(N=!0,y++;y<P&&this.parent.isDigit(i[y]);)y++;if(y===P||i[y]!==this.sheetToken){R=!1;break}}else{if(!D&&this.parent.isChar(i[y])){R=!1;break}if(!this.parent.isChar(i[y])&&!this.parent.isDigit(i[y])&&i[y]!==this.sheetToken){R=!1;break}D=this.parent.isUpperChar(i[y])}R&&this.parent.updateDependentCell(i)}return i}catch(M){return M}},s.prototype.indexOfAny=function(e,r){for(var t=0;t<e.length;t++)if(r.indexOf(e[t])>-1)return t;return-1},s.prototype.findLeftMarker=function(e){var r=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var t=0,i=e.length-1;i>=0;--i)if(e[i]===this.parent.rightBracket)t--;else if(e[i]===this.parent.leftBracket)t++;else if(e[i]===this.parent.arithMarker&&0===t){r=i;break}return r},s.prototype.findRightMarker=function(e){var r=-1;if(e.indexOf(this.parent.arithMarker)>-1)for(var t=0,i=0;i<e.length;++i)if(e[i]===this.parent.rightBracket)t--;else if(e[i]===this.parent.leftBracket)t++;else if(e[i]===this.parent.arithMarker&&0===t){r=i;break}return r},s.prototype.parseFormula=function(e,r){if(e.length>0&&e[0]===this.parent.getFormulaCharacter()&&(e=e.substring(1)),e.indexOf("#REF!")>-1)return this.parent.getErrorStrings()[L.ref];e.length>0&&"+"===e[0]&&(e=e.substring(1));try{this.isFailureTriggered=!1,this.isError=!1,e=this.parse(e.trim(),r),this.isFormulaParsed=!0}catch(n){var t=this.exceptionArgs(n);this.isFailureTriggered||(this.parent.trigger("onFailure",t),this.isFailureTriggered=!0);var i="string"==typeof t.exception?t.exception:t.message;e=((0,f.le)(this.parent.getErrorLine(n))?"":"#"+this.parent.getErrorLine(n)+": ")+i,this.isError=!0}return e},s.prototype.markLibraryFormulas=function(e){var r=0,t=e.indexOf(")");if(-1===t)e=this.markNamedRanges(e);else for(;t>-1;){for(var i=0,n=t-1;n>-1&&("("!==e[n]||0!==i);)")"===e[n]&&i++,n--;if(-1===n)throw new it(this.parent.formulaErrorStrings[q.mismatched_parentheses]);for(var a=n-1;a>-1&&this.parent.isChar(e[a]);)a--;var o=n-a-1,l=this.parent.substring(e,a+1,o);if(o>0&&!(0,f.le)(this.parent.getFunction(l))){this.ignoreBracet="AREAS"===this.parent.substring(e,a+1,o);var h=this.parent.substring(e,n,t-n+1);try{var p=void 0;h=h.split("(").join("").split(")").join(""),h="("+this.formulaAutoCorrection(h,p)+")"}catch(u){if(!(p={message:u.message,exception:u,isForceCalculable:u.formulaCorrection,computeForceCalculate:!1}).isForceCalculable)throw this.parent.formulaErrorStrings[q.improper_formula];if(this.isFailureTriggered||(this.parent.trigger("onFailure",p),this.isFailureTriggered=!0,r+=1),p.computeForceCalculate=r>0||p.computeForceCalculate,!p.isForceCalculable)throw this.parent.formulaErrorStrings[q.improper_formula];if(!p.computeForceCalculate)throw this.parent.formulaErrorStrings[q.improper_formula];h=h.split("(").join("").split(")").join(""),h="("+this.formulaAutoCorrection(h,p)+")"}h=this.markNamedRanges(h),h=this.swapInnerParens(h),-1===(h=this.addParensToArgs(h)).lastIndexOf(this.parent.getParseArgumentSeparator())&&h.length>2&&"("===h[0]&&")"===h[h.length-1]&&"{"!==h[1]&&"("!==h[1]&&(h=(h=h.substring(0,h.length-1)+"}"+h.substring(h.length-1))[0]+"{"+h.substring(1)),e=e.substring(0,a+1)+"q"+this.parent.substring(e,a+1,o)+h.split("(").join(this.parent.leftBracket).split(")").join(this.parent.rightBracket)+e.substring(t+1)}else{if(o>0)return this.parent.getErrorStrings()[L.name];var d=this.emptyStr;n>0&&(d=e.substring(0,n)),d=d+"{"+this.parent.substring(e,n+1,t-n-1)+"}",t<e.length&&(d+=e.substring(t+1)),e=d=this.markNamedRanges(d)}t=e.indexOf(")")}return e.split("{").join("(").split("}").join(")")},s.prototype.swapInnerParens=function(e){return e.length>2&&(e=e[0]+e.substr(1,e.length-2).split("(").join("{").split(")").join("}")+e[e.length-1]),e},s.prototype.addParensToArgs=function(e){if(0===e.length)return this.emptyStr;var r=[];r.push(this.parent.getParseArgumentSeparator()),r.push(this.parent.rightBracket);var t=e.lastIndexOf(this.parent.getParseArgumentSeparator()),i=0;if(-1===t)e.length>2&&"("===e[0]&&")"===e[e.length-1]&&("{"!==e[1]&&"("!==e[1]?e=(e=e.substring(0,e.length-1)+"}"+e.substring(e.length-1))[0]+"{"+e.substring(1):(t=this.lastIndexOfAny(e,["+","-","*","/"]),0===i&&")"===e[e.length-1]&&(i=e.length-1),i>0&&"{"!==e[t+1]&&"}"===e[t-1]&&(e=(e=e.substr(0,i)+"}"+e.substr(i)).substr(0,t+1)+"{"+e.substr(t+1))));else for(var a=!0;t>-1;){var o=this.indexOfAny(e.substring(t+1,e.length),r);o>=0?o=t+o+1:-1===o&&")"===e[e.length-1]&&(o=e.length-1),o>0&&"{"!==e[t+1]&&"}"!==e[o-1]&&(e=(e=e.substr(0,o)+"}"+e.substr(o)).substr(0,t+1)+"{"+e.substr(t+1)),t=e.substr(0,t).lastIndexOf(this.parent.getParseArgumentSeparator()),a&&-1===t&&"("===e[0]&&(t=0,a=!1)}return e.split("{}").join(this.emptyStr)},s.prototype.lastIndexOfAny=function(e,r){for(var t=e.length-1;t>-1;t--)if(r.indexOf(e[t])>-1)return t;return-1},s.prototype.markNamedRanges=function(e){var r=[")",this.parent.getParseArgumentSeparator(),"}","+","-","*","/","<",">","=","&"],t=e.length>0&&("("===e[0]||"{"===e[0])?1:0;e.indexOf("#N/A")>-1&&(e=e.split("#N/A").join("#N~A")),e.indexOf("#DIV/0!")>-1&&(e=e.split("#DIV/0!").join("#DIV~0!"));for(var i=this.indexOfAny(e.substring(t),r);i>-1&&i+t<e.length;){var n=this.emptyStr,a=null;if(this.parent.substring(e,t,i).indexOf("[")>-1?a=this.getTableRange(this.parent.substring(e,t,i)):(this.parent.storedData.has(this.parent.substring(e,t,i))||this.parent.namedRanges.has(this.parent.substring(e,t,i)))&&(a=this.checkForNamedRangeAndKeyValue(this.parent.substring(e,t,i))),(0,f.le)(a)&&("NaN"!==(n=this.checkScopedRange(this.parent.substring(e,t,i)))?(this.findNamedRange=!0,a=n):this.parent.substring(e,t,i).startsWith(this.sheetToken.toString()),!(0,f.le)(a)&&this.findNamedRange&&a.indexOf(this.fixedReference)>-1&&(a=a.split(this.fixedReference).join(this.emptyStr))),(0,f.le)(a)||(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),a=this.markLibraryFormulas(a)),(0,f.le)(a)||a===this.emptyStr)for(t+=i+1;t<e.length&&!this.parent.isUpperChar(e[t])&&e[t]!==this.sheetToken;)t++;else e=e.substring(0,t)+a+e.substring(t+i),t+=a.length+1;for(i=t,t<e.length-1&&"{"===e[t]&&(t+=1),i=this.indexOfAny(e.substring(t),r);0===i&&t<e.length-1;)t++,i=this.indexOfAny(e.substring(t),r);if((-1===i||e.substring(t).indexOf("[")>-1)&&t<e.length){if(a=e.substring(t).indexOf("[")>-1?this.getTableRange(e.substring(t)):this.parent.storedData.has(e.substring(t))?this.parent.storedData.size>0?this.checkForNamedRangeAndKeyValue(e.substring(t)):a:this.parent.namedRanges.size>0?this.checkForNamedRangeAndKeyValue(e.substring(t)):a,(0,f.le)(a)&&"NaN"!==(n=this.checkScopedRange(e.substring(t)))&&(a=n),!(0,f.le)(a)&&a!==this.emptyStr&&(a=a.toUpperCase(),a=this.parent.setTokensForSheets(a),null!=(a=this.markLibraryFormulas(a)))){var o=e.substring(t);e=")"===o[o.length-1]?e.substring(0,t)+a+")":e.substring(0,t)+a,t+=a.toString().length+1}i=t<e.length?this.indexOfAny(e.substring(t),r):-1}}return e.indexOf("#N~A")>-1&&(e=e.split("#N~A").join("#N/A")),e.indexOf("#DIV~0!")>-1&&(e=e.split("#DIV~0!").join("#DIV/0!")),e},s.prototype.checkForNamedRangeAndKeyValue=function(e){var r;if(e.indexOf("[")>-1){var t=this.getTableRange(e);(0,f.le)(t)||(this.findNamedRange=!0,e=t)}if("NaN"!==(r=this.checkScopedRange(e)))this.findNamedRange=!0,e=r;else{if(e.indexOf(this.sheetToken)>-1){var i=this.parent.getSheetFamilyItem(this.parent.grid),n=e.split('"').join(this.emptyStr);n=n.substr(0,n.indexOf(this.sheetToken)),i.sheetNameToToken.has(n.toUpperCase())&&parseInt(i.sheetNameToToken.get(n.toUpperCase()).split(this.sheetToken).join(this.emptyStr))}this.parent.storedData.size>0&&this.parent.storedData.has(e)&&(e="A"+this.parent.colIndex(e)),this.parent.namedRanges.size>0&&this.parent.namedRanges.has(e.toUpperCase())&&((0,f.le)(this.parent.parentObject)?(e=this.parse(this.parent.namedRanges.get(e.toUpperCase())),(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&e.split(this.fixedReference).join(this.emptyStr),this.findNamedRange=!0):e=this.parse(this.parent.namedRanges.get(e.toUpperCase()))),this.findNamedRange&&"!"!==e[0]&&"q"!==e[0]&&"bq"!==e[0]&&(e=this.parent.setTokensForSheets(e)).indexOf(this.fixedReference)>-1&&(e=e.split(this.fixedReference).join(this.emptyStr))}return e},s.prototype.getTableRange=function(e){var r=(e=e.replace(" ",this.emptyStr).toUpperCase()).replace("]",this.emptyStr).replace("#DATA",this.emptyStr);return r.indexOf(this.parent.getParseArgumentSeparator())>-1&&(r.substring(0,r.indexOf(this.parent.getParseArgumentSeparator())).replace("[",this.emptyStr),r=r.replace("[",this.emptyStr).replace(this.parent.getParseArgumentSeparator(),"_")),r.toUpperCase()},s.prototype.findNextEndIndex=function(e,r){for(var t=0,i=r,n=!1;!n&&r<e.length;)"["===e[i]?t++:"]"===e[i]&&0==--t&&(n=!0),r++;return r-i},s}(),Vh=function(){var s=function(e,r){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(e,r)};return function(e,r){function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),vo=function(s,e,r,t){var a,i=arguments.length,n=i<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(s,e,r,t);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);return i>3&&n&&Object.defineProperty(e,r,n),n},qh=function(s){function e(t){var i=s.call(this,null,null)||this;i.lFormulas=new Map,i.storedData=new Map,i.keyToRowsMap=new Map,i.rowsToKeyMap=new Map,i.rightBracket=String.fromCharCode(161),i.leftBracket=String.fromCharCode(162),i.sheetToken="!",i.emptyString="",i.leftBrace="{",i.rightBrace="}",i.cell=i.emptyString,i.cellPrefix="!0!A",i.treatEmptyStringAsZero=!1,i.tic='"',i.singleTic="'",i.trueValue="TRUE",i.falseValue="FALSE",i.parseDecimalSeparator=".",i.arithMarker=String.fromCharCode(180),i.arithMarker2=i.arithMarker+i.arithMarker,i.dependentCells=null,i.dependentFormulaCells=null,i.minValue=Number.MIN_SAFE_INTEGER,i.maxValue=Number.MAX_SAFE_INTEGER,i.categoryCollection=["All"],i.dependencyLevel=0,i.randomValues=new Map,i.isRandomVal=!1,i.randCollection=[],i.dependencyCollection=[],i.uniqueRange=[],i.formulaErrorStrings=["binary operators cannot start an expression","cannot parse","bad library","invalid char in front of","number contains 2 decimal points","expression cannot end with an operator","invalid characters following an operator","invalid character in number","mismatched parentheses","unknown formula name","requires a single argument","requires 3 arguments","invalid Math argument","requires 2 arguments","#NAME?","too complex","circular reference: ","missing formula","improper formula","invalid expression","cell empty","bad formula","empty expression","","mismatched string quotes","wrong number of arguments","invalid arguments","iterations do not converge","Control is already registered","Calculation overflow","Missing sheet","cannot_parse","expression_cannot_end_with_an_operator","#SPILL!","#DIV/0!"],i.errorStrings=null,i.parseArgumentSeparator=",",i.dateTime1900=new Date(1900,0,1,0,0,0),i.isParseDecimalSeparatorChanged=!1,i.isArgumentSeparatorChanged=!1,i.sheetFamilyID=0,i.defaultFamilyItem=null,i.sheetFamiliesList=null,i.modelToSheetID=null,i.tokenCount=0,i.sortedSheetNames=null,i.tempSheetPlaceHolder=String.fromCharCode(133),i.namedRanges=new Map,i.formulaInfoTable=null,i.oaDate=new Date(1899,11,30),i.millisecondsOfaDay=864e5,i.parseDateTimeSeparator="/";var n=new Bh(i);return i.includeBasicFormulas&&r.Inject(Hh),i.injectedModules&&i.injectedModules.length&&n.inject(i.requiredModules(),i.injectedModules),i.parentObject=(0,f.le)(t)?i:t,i.grid=i.parentObject,i.parser=new Ph(i),i}var r;return Vh(e,s),r=e,Object.defineProperty(e.prototype,"libraryFormulas",{get:function(){return this.lFormulas},set:function(t){this.lFormulas.set(t.fName,{handler:t.handler,category:t.category,description:t.description})},enumerable:!0,configurable:!0}),e.prototype.getParseArgumentSeparator=function(){return!this.isArgumentSeparatorChanged&&","!==this.parseArgumentSeparator&&(this.parseArgumentSeparator=","),this.parseArgumentSeparator},e.prototype.setParseArgumentSeparator=function(t){this.parseArgumentSeparator=t,this.isArgumentSeparatorChanged=!0},e.prototype.getParseDateTimeSeparator=function(){return this.parseDateTimeSeparator},e.prototype.setTreatEmptyStringAsZero=function(t){this.treatEmptyStringAsZero=t},e.prototype.getTreatEmptyStringAsZero=function(){return this.treatEmptyStringAsZero},e.prototype.setParseDateTimeSeparator=function(t){this.parseDateTimeSeparator=t},e.prototype.requiredModules=function(){return function(s){var e=[];return s.includeBasicFormulas&&e.push({member:"basic-formulas",args:[s]}),e}(this)},e.Inject=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.prototype.injectedModules||(this.prototype.injectedModules=[]);for(var n=0;n<t.length;n++)-1===this.prototype.injectedModules.indexOf(t[n])&&this.prototype.injectedModules.push(t[n])},e.prototype.getInjectedModules=function(){return this.injectedModules},e.prototype.onPropertyChanged=function(t,i){},e.prototype.getModuleName=function(){return"calculate"},e.prototype.getFormulaCharacter=function(){return"="},e.prototype.isUpperChar=function(t){var i=t.charCodeAt(0);return i>64&&i<91},e.prototype.resetKeys=function(){this.storedData.clear(),this.keyToRowsMap.clear(),this.rowsToKeyMap.clear()},e.prototype.updateDependentCell=function(t){var i=this.getSheetFamilyItem(this.grid),n=this.cell;if(n!==this.emptyString){if(null!==i.sheetNameToParentObject){var a=i.parentObjectToToken.get(this.grid);-1===n.indexOf(this.sheetToken)&&(n=a+n),-1===t.indexOf(this.sheetToken)&&(t=a+t)}if(this.getDependentCells().has(t)){var o=this.getDependentCells().get(t);o.indexOf(n)<0&&n!==t&&o.push(n)}else this.getDependentCells().set(t,[n]);this.addToFormulaDependentCells(t)}},e.prototype.addToFormulaDependentCells=function(t){var i=this.cell,n=this.getSheetFamilyItem(this.grid);null!=n.sheetNameToParentObject&&-1===i.indexOf(this.sheetToken)&&(i=n.parentObjectToToken.get(this.grid)+i),this.getDependentFormulaCells().has(i)?this.getDependentFormulaCells().get(i).has(t)||this.getDependentFormulaCells().get(i).set(t,t):(this.getDependentFormulaCells().set(i,new Map),this.getDependentFormulaCells().get(i).set(t,t))},e.prototype.getDependentCells=function(){return null==this.dependentCells&&(this.dependentCells=new Map),this.dependentCells},e.prototype.getDependentFormulaCells=function(){if(this.isSheetMember()){var t=this.getSheetFamilyItem(this.grid);return null==t.sheetDependentFormulaCells&&(t.sheetDependentFormulaCells=new Map),t.sheetDependentFormulaCells}return null==this.dependentFormulaCells&&(this.dependentFormulaCells=new Map),this.dependentFormulaCells},e.prototype.getLibraryFormulas=function(){return this.lFormulas},e.prototype.getFunction=function(t){return this.getLibraryFormulas().has(t.toUpperCase())?this.getLibraryFormulas().get(t.toUpperCase()).handler:null},e.prototype.intToDate=function(t){var i=Number(t);return(i=i>0&&i<1?1+i:0===i?1:i)>60&&(i-=1),new Date(864e5*(i-1)+new Date("01/01/1900").getTime())},e.prototype.getFormulaInfoTable=function(){if(this.isSheetMember()){var t=this.getSheetFamilyItem(this.grid);return null===t.sheetFormulaInfotable&&(t.sheetFormulaInfotable=new Map),t.sheetFormulaInfotable}return null===this.formulaInfoTable&&(this.formulaInfoTable=new Map),this.formulaInfoTable},e.prototype.getFormula=function(t){return t=t.toUpperCase(),this.storedData.has(t)?this.storedData.get(t).getFormulaText():""},e.prototype.getParseDecimalSeparator=function(){return!this.isParseDecimalSeparatorChanged&&"."!==this.parseDecimalSeparator&&(this.parseDecimalSeparator="."),this.parseDecimalSeparator},e.prototype.setParseDecimalSeparator=function(t){this.parseDecimalSeparator=t,this.isParseDecimalSeparatorChanged=!0},e.prototype.getSheetToken=function(t){var i=0,n=this.emptyString;if(i<t.length&&t[i]===this.sheetToken){for(i++;i<t.length&&t[i]!==this.sheetToken;)i++;n=t.substring(0,i+1)}if(i<t.length)return n;throw this.formulaErrorStrings[q.bad_index]},e.prototype.getSheetID=function(t){var i=this.getSheetFamilyItem(t);if(null!=i.sheetNameToParentObject&&i.sheetNameToParentObject.size>0){var n=i.parentObjectToToken.get(t);if(n){n=n.split(this.sheetToken).join(this.emptyString);var a=this.parseFloat(n);if(!this.isNaN(a))return a}}return-1},e.prototype.parseFloat=function(t){var i=Number(t);return isNaN(i)&&"string"==typeof t&&t.includes(",")&&(i=Number(t.split(",").join(""))),i},e.prototype.rowIndex=function(t){var i=0,n=!1;if(i<t.length&&t[i]===this.sheetToken){for(i++;i<t.length&&t[i]!==this.sheetToken;)i++;i++}for(;i<t.length&&this.isChar(t[i]);)n=!0,i++;var a=parseInt(t.substring(i),10);if(i<t.length&&!this.isNaN(a))return a;if(n)return-1;throw this.formulaErrorStrings[q.bad_index]},e.prototype.colIndex=function(t){var i=0,n=0;if(i<(t=t.toUpperCase()).length&&t[i]===this.sheetToken){for(i++;i<t.length&&t[i]!==this.sheetToken;)i++;i++}for(;i<t.length&&this.isChar(t[i]);)n=26*n+t[i].charCodeAt(0)-64,i++;return 0===n?-1:n},e.prototype.getErrorStrings=function(){return null===this.errorStrings&&(this.errorStrings=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!"]),this.errorStrings},e.prototype.substring=function(t,i,n){return t.substring(i,n+i)},e.prototype.isChar=function(t){return t.charCodeAt(0)>=65&&t.charCodeAt(0)<=90||t.charCodeAt(0)>=97&&t.charCodeAt(0)<=122},e.prototype.getSheetFamilyItem=function(t){if(0===this.sheetFamilyID)return null==this.defaultFamilyItem&&(this.defaultFamilyItem=new Rl),this.defaultFamilyItem;null==this.sheetFamiliesList&&(this.sheetFamiliesList=new Map);var i=this.modelToSheetID.get(t);return this.sheetFamiliesList.has(i)||this.sheetFamiliesList.set(i,new Rl),this.sheetFamiliesList.get(i)},e.prototype.setKeyValue=function(t,i){t=t.toUpperCase();var n=i.toString().trim();(!this.storedData.get(t)||0===n.indexOf(this.leftBrace))&&(this.storedData.set(t,new kl),this.keyToRowsMap.set(t,this.keyToRowsMap.size+1),this.rowsToKeyMap.set(this.rowsToKeyMap.size+1,t));var a=this.storedData.get(t);if(null!=a.getFormulaText()&&a.getFormulaText().length>0&&a.getFormulaText()!==n){var o=this.cellPrefix+this.keyToRowsMap.get(t).toString();null!=this.getDependentFormulaCells().get(o)&&this.clearFormulaDependentCells(o)}n.length>0&&n[0]===this.getFormulaCharacter()?a.setFormulaText(n):a.getFormulaValue()!==n&&(a.setFormulaText(""),a.setParsedFormula(""),a.setFormulaValue(n))},e.prototype.clearFormulaDependentCells=function(t){var i=this,n=this.getDependentFormulaCells().get(t);n&&(n.forEach(function(a,o){var l=o,h=i.getDependentCells().get(l);i.arrayRemove(h,t),0===h.length&&i.getDependentCells().delete(l)}),this.getDependentFormulaCells().delete(t))},e.prototype.arrayRemove=function(t,i){var n=t.indexOf(i);return-1!==n&&t.splice(n,1),t},e.prototype.getKeyValue=function(t){if(t=t.toUpperCase(),null!==this.storedData.has(t)){var i=this.storedData.get(t),n=i.getFormulaText();if(n.length>0&&n[0]===this.getFormulaCharacter()){this.cell=this.cellPrefix+this.keyToRowsMap.get(t).toString(),n=n.substring(1);try{i.setParsedFormula(this.parser.parseFormula(n,t))}catch(l){return this.trigger("onFailure",a={message:l.message,exception:l,isForceCalculable:!1,computeForceCalculate:!1}),i.setFormulaValue(a.message),this.storedData.get(t).getFormulaValue()}try{i.setFormulaValue(this.computeFormula(i.getParsedFormula()))}catch(l){var a;this.trigger("onFailure",a={message:l.message,exception:l,isForceCalculable:!1,computeForceCalculate:!1});var o="string"==typeof a.exception?a.exception:a.message;return((0,f.le)(this.getErrorLine(l))?"":"#"+this.getErrorLine(l)+": ")+o}}return this.storedData.get(t).getFormulaValue()}return this.emptyString},e.prototype.getNamedRanges=function(){return this.namedRanges},e.prototype.addNamedRange=function(t,i){var n=t.split(this.sheetToken);if(n.length>1){if(!this.getSheetFamilyItem(this.grid).parentObjectToToken.get(n[0]))return!1;t=n[0]+this.sheetToken+n[1].toUpperCase()}else t=t.toUpperCase();return this.namedRanges.set(t,i),!0},e.prototype.removeNamedRange=function(t){return t=t.toUpperCase(),null!=this.namedRanges.get(t)&&(this.namedRanges.delete(t),!0)},e.prototype.convertAlpha=function(t){for(var i=[],n=0;t>0;){t--;var o="A".charCodeAt(0);i[n]=String.fromCharCode(t%26+o),t=parseInt((t/26).toString(),10),n++}for(var l=[],h=0;h<n;h++)l[n-h-1]=i[h];return l.join("")},e.prototype.getCellCollection=function(t){if(t.indexOf(":")<0){if(!this.isCellReference(t))return t.split(this.getParseArgumentSeparator());t=t+":"+t}var i=this.emptyString,n=t.indexOf(this.sheetToken);if(n>-1)for(var o=n+1;o<t.length;){if(t[o]===this.sheetToken){i=t.substr(0,o+1);break}o++}var h,p,c,d,l=t.indexOf(":");if(l>0&&this.isChar(t[l-1]))for(var u=l-2;u>=0&&this.isDigit(t[u]);)u--;h=this.rowIndex(this.substring(t,0,l)),p=this.rowIndex(this.substring(t,l+1,l+t.length-l-1)),c=this.colIndex(this.substring(t,0,l)),d=this.colIndex(this.substring(t,l+1,l+t.length-l-1)),h>p&&(l=p,p=h,h=l),c>d&&(l=d,d=c,c=l);var g,v=[],m=0;for(l=h;l<=p;l++)for(g=c;g<=d;g++)v[m]=i+this.emptyString+this.convertAlpha(g)+l.toString(),m++;return v},e.prototype.computeFormula=function(t){return this.calculateFormula(t,!1)},e.prototype.calculateFormula=function(t,i){var a,o,l,p,n=this,h=!1;if(this.parser.isError)return t;a=this.parser.isFormulaParsed?t:this.parser.parseFormula(t),this.parser.isFormulaParsed=!1;try{if((o=this.findLastIndexOfq(a))>0&&(h=!0),a!==this.emptyString&&o>-1)for(var c=o+1;c>-1;)if(a[c]===this.rightBracket){var d=a.substring(o,c+1),u=d.split(this.leftBracket)[0].split("q").join(this.emptyString),v=void 0;if(this.getLibraryFormulas().get(u.toUpperCase()).isCustom){v=d.substring(d.indexOf(this.leftBracket)+1,d.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator());var g=0,m=[],y=void 0;for(g=0;g<v.length;g++)v[g].includes(":")&&this.isCellReference(v[g])&&(y=this.getCellCollection(v[g])).length>1?(m.push(v[g]),y.forEach(function(x){n.updateDependentCell(x)})):m.push(this.getValueFromArg(v[g]));v=m}else{if(v="DAYS"===u&&d.includes('"')?d.substring(d.indexOf(this.leftBracket)+1,d.indexOf(this.rightBracket)).match(/(".*?"|[^",\s]+)/g):d.substring(d.indexOf(this.leftBracket)+1,d.indexOf(this.rightBracket)).split(this.getParseArgumentSeparator()),d.includes(this.getParseArgumentSeparator()+this.tic))for(var C=null,b=0;b<v.length;b++)v[b]&&v[b][0]===this.tic&&v[b][v[b].length-1]!==this.tic&&(C=b),null!==C&&C===b-1&&v[b][0]!==this.tic&&v[b][v[b].length-1]===this.tic&&(v[C]=v[C]+this.getParseArgumentSeparator()+v[b],v.splice(b,1),C=null);h&&u&&"IF"===u&&v.push("nestedFormulaTrue")}if(l=(0,f.le)(this.getFunction(u))?this.getErrorStrings()[L.name]:this.getFunction(u).apply(void 0,v),!h)break;p=this.processNestedFormula(a,d,l);var S=this.findLastIndexOfq(p);0===S&&(h=!1),-1===S&&(l=this.computeValue(p,i)),o=c=S,a=p}else c++;else this.formulaErrorStrings.indexOf(a)>-1?l=a:a!==this.emptyString&&-1===o&&(l=this.computeValue(a,i))}catch(x){this.trigger("onFailure",v={message:x.message,exception:x,isForceCalculable:!1,computeForceCalculate:!1});var w="string"==typeof v.exception?v.exception:v.message;l=((0,f.le)(this.getErrorLine(x))?"":"#"+this.getErrorLine(x)+": ")+w}return l},e.prototype.computeSumIfAndAvgIf=function(t){if((0,f.le)(t)||t[0]===this.emptyString||0===t.length)return this.formulaErrorStrings[q.wrong_number_arguments];for(var i=t,n=0;n<i.length;n++)if(this.isCellReference(i[n])&&(0,f.le)(i[n].match(/[0-9]/))&&i[n].indexOf("!")<0){var a=i[n].split(":");i[n]=a[0]+"1:"+a[1]+this.spreadSheetUsedRange[0]}var o=i.length;if(2!==o&&3!==o&&0===o)return this.formulaErrorStrings[q.wrong_number_arguments];var l=i[0],h=i[1].trim();if((h=h.split(this.tic).join(this.emptyString)).length>255)return this.getErrorStrings()[L.value];var p=h.includes("*"),c=p?h.replace(/\*/g,"").trim():h;c=this.isCellReference(c)?this.getValueFromArg(c):h,p&&("*"===h[0]&&(c="*"+c),"*"===h[h.length-1]&&(c+="*"));var d=this.parser.tokenEqual;(h=c).startsWith("<=")?(d=this.parser.tokenLessEq,h=h.substring(2)):h.startsWith(">=")?(d=this.parser.tokenGreaterEq,h=h.substring(2)):h.startsWith("<>")?(d=this.parser.tokenNotEqual,h=h.substring(2)):h.startsWith("<")?(d=this.parser.tokenLess,h=h.substring(1)):h.startsWith(">")?(d=this.parser.tokenGreater,h=h.substring(1)):h.startsWith("=")&&(d=this.parser.tokenEqual,h=h.substring(1));var u=this.parseFloat(h),v=i[0],g=this.getCellCollection(o>2?i[2]:l),m=this.getCellCollection(v);if(m.length>g.length){var y=this.colIndex(g[g.length-1])+this.colIndex(m[m.length-1])-this.colIndex(m[0]),C=i[2].split(":");C[1]=(this.convertAlpha(y)+this.rowIndex(m[m.length-1])).toString(),g=this.getCellCollection(C.join(":"))}var b=this.getComputeSumIfValue(m,g,h,u,d,p);return[b[0],b[1]]},e.prototype.findWildCardValue=function(t,i){var n="";if(t.indexOf("?")>-1){var a=t.indexOf("?"),o=t[a-1],l=t[a+1];if(i.indexOf(o)>-1&&i.indexOf(l)>-1){var h=i.indexOf(o);n=i[h]===o&&i[h+2]===l?t:i}else n=i}else if(t.indexOf("*")>-1){a=t.indexOf("*");for(var p="",c="",d=this.falseValue,u=this.falseValue,v=a-1;v>=0;v--)p+=t[v],u=this.trueValue;for(v=a+1;v<t.length;v++)c+=t[v],d=this.trueValue;var g=""===p?-1:i.indexOf(p.split("").reverse().join("")),m=""===c?-1:i.indexOf(c);g>-1||m>-1?u===this.trueValue?n=p.split("").reverse().join("")===i.substr(0,p.length)?t:i:d===this.trueValue&&(n=c===i.substring(i.length-c.length,i.length)?t:i):n=i}return n},e.prototype.getComputeSumIfValue=function(t,i,n,a,o,l){var h=0,p=0;switch(o){case this.parser.tokenEqual:for(var c=l?n.replace(/\*/g,""):n,d=0;d<t.length;d++){var u=this.getValueFromArg(t[d].split(this.tic).join("")),v=this.parseFloat(u);if(u===n&&v===a){var g=this.getValueFromArg(i[d].split(this.tic).join(""));h+=this.parseFloat(g),p+=1}else u===n?(h+=this.getValueFromRange(i,d),p+=1):l&&c&&u&&("*"===n[0]&&c.length<=u.length&&c===u.slice(0,c.length)&&(h+=this.getValueFromRange(i,d),p+=1),"*"===n[n.length-1]&&c.length<=u.length&&c===u.slice(u.length-c.length,u.length)&&(h+=this.getValueFromRange(i,d),p+=1))}break;case this.parser.tokenLess:for(d=0;d<t.length;d++)u=this.getValueFromArg(t[d].split(this.tic).join("")),(v=this.parseFloat(u))<a&&(g=this.getValueFromArg(i[d].split(this.tic).join("")),h+=this.parseFloat(g),p+=1);break;case this.parser.tokenGreater:for(d=0;d<t.length;d++)u=this.getValueFromArg(t[d].split(this.tic).join("")),(v=this.parseFloat(u))>a&&(g=this.getValueFromArg(i[d].split(this.tic).join("")),h+=this.parseFloat(g),p+=1);break;case this.parser.tokenLessEq:for(d=0;d<t.length;d++)u=this.getValueFromArg(t[d].split(this.tic).join("")),(v=this.parseFloat(u))<=a&&(g=this.getValueFromArg(i[d].split(this.tic).join("")),h+=this.parseFloat(g),p+=1);break;case this.parser.tokenGreaterEq:for(d=0;d<t.length;d++)u=this.getValueFromArg(t[d].split(this.tic).join("")),(v=this.parseFloat(u))>=a&&(g=this.getValueFromArg(i[d].split(this.tic).join("")),h+=this.parseFloat(g),p+=1);break;case this.parser.tokenNotEqual:for(d=0;d<t.length;d++)u=this.getValueFromArg(t[d].split(this.tic).join("")),v=this.parseFloat(u),u!==n&&v!==a&&(g=this.getValueFromArg(i[d].split(this.tic).join("")),h+=this.parseFloat(g),p+=1)}return[h,p]},e.prototype.getValueFromRange=function(t,i){var n=t[i];return n=this.getValueFromArg(n),this.parseFloat(n.toString())},e.prototype.computeAndOr=function(t,i){var a,o,n="and"===i;if(0===t.length)return this.formulaErrorStrings[q.wrong_number_arguments];for(var l=0,h=t.length;l<h;l++)if(t[l].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[L.value];for(var p=t,c=0;c<p.length;c++){if(p[c]===this.tic)return this.getErrorStrings()[L.value];if(p[c].indexOf(":")>-1&&this.isCellReference(p[c]))for(var d=this.getCellCollection(p[c]),u=0;u<d.length;u++){if(this.getErrorStrings().indexOf(d[u])>-1)return d[u];if(d[u][0]===this.tic)return this.getErrorStrings()[L.name];if(""===(a=this.getValueFromArg(d[u]))&&(a=this.trueValue),this.getErrorStrings().indexOf(a)>-1)return a;o=this.parseFloat(a)}else{if(a=this.getValueFromArg(p[c]).split(this.tic).join("").toUpperCase(),this.getErrorStrings().indexOf(a)>-1)return a;var v=Date.parse(a.split(this.tic).join(""));if(isNaN(v)){if(a!==this.trueValue&&a!==this.falseValue)return this.getErrorStrings()[L.value].toString()}else n=!0;o=this.parseFloat(a)}n="and"===i?n&&(a===this.trueValue||!isNaN(o)):n||a===this.trueValue||!isNaN(o)}return n?this.trueValue:this.falseValue},e.prototype.removeTics=function(t){return t.length>1&&t[0]===this.tic[0]&&t[t.length-1]===this.tic[0]&&(t=this.substring(t,1,t.length-2)),t},e.prototype.getCellFrom=function(t){var l,i="",n=t.indexOf(":")>-1?t.split(":"):[t],a=n.length-1,o=this.rowIndex(n[0]);if(o===this.rowIndex(n[a])){var h=this.colIndex(n[0]),p=this.colIndex(n[a]),c=this.colIndex(this.cell);c>=h&&c<=p&&(i=Re(c).toString()+o.toString())}else if(this.colIndex(n[0])===this.colIndex(n[a])){l=this.colIndex(n[0]);var d=this.rowIndex(n[a]),u=this.rowIndex(this.cell);u>=o&&u<=d&&(i=Re(l).toString()+u.toString())}return i},e.prototype.computeValue=function(t,i){try{var n=[],a=0,o="";for(n.length=0;a<t.length;){var l="u"===t[a];if(t[a]!==this.arithMarker){if(this.isDigit(t[a])){for(var h=this.emptyString;a<t.length&&(this.isDigit(t[a])||t[a]===this.parseDecimalSeparator);)h+=t[a],a+=1;if(n.push(h),!t[a])return n.toString()}if(t[a]===this.sheetToken){for(o=t[a],a+=1;a<t.length&&t[a]!==this.sheetToken;)o+=t[a],a+=1;a<t.length&&(o+=t[a],a+=1)}else if(this.isUpperChar(t[a])){var p;for(h=this.emptyString;a<t.length&&this.isUpperChar(t[a]);)h+=t[a],a+=1;for(;a<t.length&&this.isDigit(t[a]);)h+=t[a],a+=1;if(a<t.length&&":"===t[a]){if(h+=t[a],(a+=1)<t.length&&t[a]===this.sheetToken)for(h+=t[a],a+=1;a<t.length&&t[a]!==this.sheetToken;)h+=t[a],a+=1;for(;a<t.length&&this.isUpperChar(t[a]);)h+=t[a],a+=1;for(;a<t.length&&this.isDigit(t[a]);)h+=t[a],a+=1;h=o+this.getCellFrom(h)}else h=o+h;if(p=this.getParentObjectCellValue(h,i).toString(),o="","string"==typeof p&&this.getErrorStrings().indexOf(p)>-1)return p;n.push(p)}else if("q"===t[a]){var u=t.substring(a+1).indexOf(this.leftBracket),v=t.substring(a+u+1).indexOf(this.rightBracket);t=this.substring(t,a+u+2,v-1)}else if(t[a]===this.tic[0]){for(h=t[a].toString(),a+=1;a<t.length&&t[a]!==this.tic[0];)h+=t[a],a+=1;n.push(h.split(this.tic).join(this.emptyString)),a+=1}else if("%"===t[a]&&n.length>0){var m=this.parseFloat(n[0]);this.isNaN(m)||(n.pop(),n.push((m/100).toString())),a+=1}else if(0===t.substring(a).indexOf(this.trueValue))n.push(this.trueValue),a+=this.trueValue.length;else if(0===t.substring(a).indexOf(this.falseValue))n.push(this.falseValue),a+=this.falseValue.length;else if(t[a]===this.tic[0]||"|"===t[a]){for(h=t[a].toString(),a++;a<t.length&&t[a]!==this.tic[0];)h+=t[a],a+=1;n.push(h+this.tic),a+=1}else{if(" "===t[a]&&a<t.length-1){a+=1;continue}switch(t[a]){case"#":var y=0;this.getErrorStrings().indexOf(t.substring(a))>-1?(y=-1===t.indexOf("!")||-1===t.substring(a).indexOf("!")?t.indexOf("#N/A")>-1?t.indexOf("#N/A")+4+a:t.indexOf("?")+1+a:t.indexOf("!")+1+a,n.push(this.substring(t,a,y-a))):n.push(this.substring(t,a,(y=a+1)-a)),a=y;break;case"n":if(h="","n"===t[a+=1])continue;if(0===t.substring(a).indexOf("Infinity"))a+=(h="Infinity").length;else{for(("u"===t[a]||l||"-"===t[a])&&(h="-",l?l=!1:a+=1);a<t.length&&this.isDigit(t[a])||t[a]===this.getParseDecimalSeparator();)h+=t[a],a+=1;a<t.length&&"%"===t[a]&&(a+=1,""===h?n.length>0&&(m=this.parseFloat(n[0]),this.isNaN(m)||(n.pop(),n.push((m/100).toString()))):h=(this.parseFloat(h)/100).toString())}n.push(h);break;case this.parser.tokenAdd:this.getValArithmetic(n,"add"),a+=1;break;case this.parser.tokenSubtract:this.getValArithmetic(n,"sub"),a+=1;break;case this.parser.tokenMultiply:this.getValArithmetic(n,"mul"),a+=1;break;case this.parser.tokenDivide:this.getValArithmetic(n,"div"),a+=1;break;case this.parser.tokenLess:this.processLogical(n,"less"),a+=1;break;case this.parser.tokenGreater:this.processLogical(n,"greater"),a+=1;break;case this.parser.tokenGreaterEq:this.processLogical(n,"greaterEq"),a+=1;break;case this.parser.tokenLessEq:this.processLogical(n,"lessEq"),a+=1;break;case this.parser.tokenNotEqual:this.processLogical(n,"notEq"),a+=1;break;case this.parser.tokenOr:this.processLogical(n,"or"),a+=1;break;case this.parser.tokenAnd:this.processLogical(n,"and"),a+=1;break;case this.parser.tokenEqual:this.processLogical(n,"equal"),a+=1;break;default:return this.getErrorStrings()[L.value]}}}else a+=1}if(0===n.length)return this.emptyString;h=this.emptyString;for(var C=n.length;C>0;){if((h=n.pop()+h)===this.emptyString&&this.isCellReference(t)&&this.getTreatEmptyStringAsZero())return"0";C--}return h}catch(b){throw this.getErrorStrings().indexOf(b)>-1||this.formulaErrorStrings.indexOf(b)>-1?b:new it(this.formulaErrorStrings[q.invalid_expression])}},e.prototype.getValArithmetic=function(t,i){var n=t.pop();n=n===this.emptyString?"0":n;var a=Number(n);if(isNaN(a))throw n===this.getErrorStrings()[L.divzero]?this.getErrorStrings()[L.divzero]:this.getErrorStrings()[L.value];var o=t.pop();if(o=o===this.emptyString?"0":o,a=Number(o),isNaN(a))throw n===this.getErrorStrings()[L.divzero]?this.getErrorStrings()[L.divzero]:this.getErrorStrings()[L.value];"add"===i&&t.push((Number(o)+Number(n)).toString()),"sub"===i&&t.push((Number(o)-Number(n)).toString()),"mul"===i&&t.push((Number(o)*Number(n)).toString()),"div"===i&&(this.isNaN(this.parseFloat(n))||this.isNaN(this.parseFloat(o))?t.push(this.getErrorStrings()[L.value]):0===this.parseFloat(n)?t.push(this.getErrorStrings()[L.divzero]):t.push((Number(o)/Number(n)).toString()))},e.prototype.processLogical=function(t,i){var n,a,o,l,h;return"and"!==i&&"equal"!==i&&(n=t.pop(),a=t.pop(),o=n.indexOf(this.tic)>-1?n:this.parseFloat(n),l=a.indexOf(this.tic)>-1?a:this.parseFloat(a)),"less"===i&&(h=this.isNaN(o)||this.isNaN(l)?a.toUpperCase().split(this.tic).join("").localeCompare(n.toUpperCase().split(this.tic).join(""))<0?this.trueValue:this.falseValue:l<o?this.trueValue:this.falseValue),"greater"===i&&(h=this.isNaN(o)||this.isNaN(l)?a.toUpperCase().split(this.tic).join("").localeCompare(n.toUpperCase().split(this.tic).join(""))>0?this.trueValue:this.falseValue:l>o?this.trueValue:this.falseValue),"lessEq"===i&&(h=this.isNaN(o)||this.isNaN(l)?a.toUpperCase().split(this.tic).join("").localeCompare(n.toUpperCase().split(this.tic).join(""))<=0?this.trueValue:this.falseValue:l<=o?this.trueValue:this.falseValue),"greaterEq"===i&&(h=this.isNaN(o)||this.isNaN(l)?a.toUpperCase().split(this.tic).join("").localeCompare(n.toUpperCase().split(this.tic).join(""))>=0?this.trueValue:this.falseValue:l>=o?this.trueValue:this.falseValue),"notEq"===i&&(h=a!==n?this.trueValue:this.falseValue),"and"===i&&(n=t.pop().toString(),a="",t.length>0&&(a=t.pop().toString()),h=(h=this.emptyString+a+n+this.emptyString).split(this.tic).join("")),"equal"===i&&(n=t.pop().toString(),""===(a=t.pop().toString())&&""!==n&&(a="0"),h=n===a?this.trueValue:this.falseValue),"or"===i&&(h=Math.pow(this.parseFloat(l),this.parseFloat(o)).toString()),t.push(h),h},e.prototype.computeStoreCells=function(t){for(var i=t.cellValue,n=t.cellRange,a=t.criteria,o=t.argArray,l=t.isCriteria,h=t.storedCells,p=t.isCountIfS===this.trueValue,c=t.countVal||0,d=l===this.trueValue?h:i,u=[],v=0;v<d.length;v++){var g=[],m=this.getValueFromArg(i[v]),y=void 0,C="";if(y=o[p?1+2*c:2+c].split(this.tic).join(this.emptyString),y=this.isCellReference(y)?this.getValueFromArg(y):y,(l=p?this.trueValue:l)===this.trueValue){var b="",S=0,w=0,x=void 0,I=void 0,F=void 0,T=void 0;h[v]=p&&!c?i[v]:h[v],b=h[v],c&&(I=(x=n[c-1]).indexOf("!")>-1?A(x.substring(x.lastIndexOf("!")+1)):A(x),F=b.indexOf("!")>-1?B(b.substring(b.lastIndexOf("!")+1)):B(b),T=n[c].indexOf("!")>-1?A(n[c].substring(n[c].lastIndexOf("!")+1)):A(n[c]));var k=b.indexOf("!")>-1,R=void 0,D="",N="";for(k&&(N=b.substring(0,b.lastIndexOf("!")+1),b=b.substring(b.lastIndexOf("!")+1));!this.isDigit(b[S]);)S+=1;if(this.isCellReference(n[c])&&n[c].indexOf(":")>-1)for(C=p&&!c?d[v].indexOf("!")>-1?d[v].substring(d[v].lastIndexOf("!")+1):d[v]:j(T[0]+(F[0]-I[0]),T[1]+(F[1]-I[1])),(R=n[c].indexOf("!")>-1)&&(D=n[c].substring(0,n[c].lastIndexOf("!")+1));!this.isDigit(C[w]);)w+=1;var P=this.substring(b,S),M=this.substring(C,w),V=this.substring(b,S,b.length-S),Y=this.substring(C,w,C.length-S);k&&(P=N+P,M=N+M),V!==Y&&(h[v]=this.substring(h[v],k?N.length+S:S)+Y),C=h[v].split(P).join(M),R?(C.indexOf("!")>-1&&(C=C.substring(C.lastIndexOf("!")+1)),C=D+C):C=C.substring(C.lastIndexOf("!")+1),m=this.getValueFromArg(C),y=p?y:this.isCellReference(a[c-1])?this.getValueFromArg(a[c-1]):a[c-1].split(this.tic).join(this.emptyString)}var X="equal";y.startsWith("<=")?(X="lessEq",y=y.substring(2)):y.startsWith(">=")?(X="greaterEq",y=y.substring(2)):y.startsWith("<>")?(X="notEq",y=y.substring(2)):y.startsWith("<")?(X="less",y=y.substring(1)):y.startsWith(">")?(X="greater",y=y.substring(1)):y.startsWith("=")&&(X="equal",y=y.substring(1)),(y.indexOf("*")>-1||y.indexOf("?")>-1)&&(m=this.findWildCardValue(y,m)),g.push(m.toLowerCase()),g.push(y.toLowerCase()),this.processLogical(g,X)===this.trueValue&&u.push(l===this.falseValue?i[v]:C)}return h=u,u=[],h},e.prototype.computeIfsFormulas=function(t,i,n){if((0,f.le)(t)||""===t[0]||0===t.length)return this.formulaErrorStrings[q.wrong_number_arguments];var m,y,a=t,o=a.length;if(o<2||o>127)return this.formulaErrorStrings[q.wrong_number_arguments];for(var l=[],h=[],p=[],d=0,u=0;u<a.length;u++)a[u].indexOf(":")>-1&&this.isCellReference(a[u])?l.push(a[u]):h.push(a[u]);l=(l=l.toString().split(",,").join(",")).split(this.getParseArgumentSeparator());var v=[];for(u=0;u<l.length;u++)v.push(this.getCellCollection(l[u]).length);for(var g=0;g<v.length;g++)if(v[g]&&v[g+1]&&v[g]!==v[g+1])return this.getErrorStrings()[L.value];if(i===this.falseValue&&(y=this.falseValue,m=this.getCellCollection(l[1]),0===(p=this.computeStoreCells({cellValue:m,cellRange:l,criteria:h,argArray:a,isCriteria:y,storedCells:p,isCountIfS:i})).length))return n===this.trueValue?this.getErrorStrings()[L.divzero]:0;for(u=i===this.trueValue?0:2;u<l.length;u++)if(y=this.trueValue,y=i===this.trueValue&&0===u?this.falseValue:this.trueValue,m=this.getCellCollection(l[u]),0===(p=this.computeStoreCells({cellValue:m,cellRange:l,criteria:h,argArray:a,isCriteria:y,storedCells:p,isCountIfS:i,countVal:u})).length)return 0;var S=0,w=l[0].indexOf("!")>-1?A(l[0].substring(l[0].lastIndexOf("!")+1)):A(l[0]),x=l[l.length-1],I=x.indexOf("!")>-1?A(x.substring(x.lastIndexOf("!")+1)):A(x);for(g=0;g<p.length;g++){var F="",T="",k=0,R=0,D=(F=p[g]).indexOf("!")>-1,N=void 0,P="",M="";for(D&&(M=F.substring(0,F.lastIndexOf("!")+1),F=F.substring(F.lastIndexOf("!")+1));!this.isDigit(F[k]);)k+=1;if(this.isCellReference(l[0])&&l[0].indexOf(":")>-1)for(T=j(w[0]+(B(F)[0]-I[0]),w[1]+(B(F)[1]-I[1])),(N=l[0].indexOf("!")>-1)&&(P=l[0].substring(0,l[0].lastIndexOf("!")+1));!this.isDigit(T[R]);)R+=1;var V=this.substring(F,k),Y=this.substring(T,R),X=this.substring(F,k,F.length-k),G=this.substring(T,R,T.length-k);if(D&&(V=M+V,Y=M+Y),X!==G&&(p[g]=this.substring(p[g],D?M.length+k:k)+G),m=p[g].split(V).join(Y),N?(m.indexOf("!")>-1&&(m=m.substring(m.lastIndexOf("!")+1)),m=P+m):m=m.substring(m.lastIndexOf("!")+1),i===this.trueValue)d+=1;else{var $=this.getValueFromArg(m),J=parseFloat(""===$&&n!==this.trueValue?"0":$);te(J)&&(S++,d+=J)}}return n===this.trueValue&&(d/=S),d},e.prototype.processNestedFormula=function(t,i,n){return t.split(i).join("n"+n)},e.prototype.isNaN=function(t){return"NaN"===t.toString()||"string"==typeof t},e.prototype.fromOADate=function(t){var i=new Date;return i.setTime(t*this.millisecondsOfaDay+Date.parse(this.oaDate.toString())),i},e.prototype.getSerialDateFromDate=function(t,i,n){var a=0;t<1900&&(t+=1900);for(var o=!1;!o;){for(;i>12;)t++,i-=12;for(;i<1;)i+=12,t--;o=!0;for(var l=new Date(t,i,1,-1).getDate();n>l;)l=new Date(t,i,1,-1).getDate(),i++,n-=l,o=!1;n<1&&(--i<1&&(i=12,t--),n=(l=new Date(t,i,1,-1).getDate())+n)}var h=Date.parse(t.toString()+this.getParseDateTimeSeparator()+i.toString()+this.getParseDateTimeSeparator()+n.toString());return this.isNaN(h)||(a=this.toOADate(new Date(h))),a},e.prototype.intToTime=function(t){if((0,f.le)(t))return"";var i=t.toString().split(".");(0,f.le)(i[1])||(t=parseFloat(i[0]+1+"."+i[1])||t);var n=this.intToDate(t.toString());return(new f.eC).formatDate(n,{type:"time",skeleton:"medium",format:"h:mm:ss a"})},e.prototype.toOADate=function(t){return(t.getTime()-Date.parse(this.oaDate.toString()))/this.millisecondsOfaDay},e.prototype.calculateDate=function(t){return this.parseFloat(t)<10?"0"+t:t},e.prototype.isTextEmpty=function(t){return null===t||""===t},e.prototype.isDigit=function(t){var i=t.charCodeAt(0);return i>47&&i<58},e.prototype.findLastIndexOfq=function(t){return t.lastIndexOf("q")},e.prototype.getValueFromArg=function(t,i){var n=t=t.trim(),a=this.dateTime1900,o=n;if((0,f.le)(n)||this.isTextEmpty(n))return n;if(t[0]===this.tic||t[0]===this.singleTic)return a=this.isDate(t.split(this.tic).join("")),this.isNaN(this.parseFloat(t.split(this.tic).join("")))&&!(0,f.le)(a)&&!this.isNaN(a.getDate())&&this.dateTime1900<=a?this.toOADate(a).toString():t;if(t=t.split("u").join("-"),!this.isUpperChar(n[0])&&(this.isDigit(n[0])||n[0]===this.getParseDecimalSeparator()||"-"===n[0]||"n"===n[0]))return"n"===n[0]&&(n=n.substring(1)).indexOf('"n')>-1&&(n=n.replace('"n','"')),n;if(-1===this.parser.indexOfAny(n,["+","-","/","*",")",")","{"])&&this.isUpperChar(n[0])||n[0]===this.sheetToken){if(n!==this.trueValue&&n!==this.falseValue&&this.isCellReference(n)){var h=this.getSheetFamilyItem(this.grid);null!==h.sheetNameToParentObject&&h.sheetNameToParentObject.size>0&&-1===n.indexOf(this.sheetToken)&&(n=h.parentObjectToToken.get(this.grid)+n)}if(n===this.cell){var c=this.getDependentCells().get(n);if(null!=c&&c.indexOf(n)>-1&&this.arrayRemove(c,n),this.getDependentFormulaCells().has(this.cell)||this.clearFormulaDependentCells(this.cell),!i)throw this.formulaErrorStrings[q.circular_reference]+n}return o=this.getParentObjectCellValue(n,!1,i),this.updateDependentCell(n),o.toString()}return this.getErrorStrings().indexOf(t)>-1?t:this.computeValue(o.toString(),!1)},e.prototype.isDate=function(t){if("object"==typeof t||null!==Date.parse(t)){var i=new Date(Date.parse(t));return i>=this.dateTime1900?i:null}return null},e.prototype.isValidCellReference=function(t){var n=0,a=0,o=[89,71,69],l=this.emptyString;if(this.namedRanges.has(t))return!1;for(var h=0;h<t.length;h++)this.isChar(t[h])&&n++;if((l=t.substring(0,n)).length<4){for(;a<l.length;){if((0,f.le)(l[a])||!(l[a].charCodeAt(0)<o[a])){if((0,f.le)(l[a])&&a>0)break;return!1}a++}if(this.parseFloat(t.substring(n,t.length))<1048576)return!0}return!1},e.prototype.parseDate=function(t){if(!this.isNaN(t)){if(t instanceof Date)return new Date(t);var i=parseInt(t,10);return i<0?this.getErrorStrings()[L.num]:i<=60?new Date(this.dateTime1900.getTime()+864e5*(i-1)):new Date(this.dateTime1900.getTime()+864e5*(i-2))}return"string"!=typeof t||(t=new Date(t),this.isNaN(t))?this.getErrorStrings()[L.value]:t},e.prototype.isCellReference=function(t){if(t===this.emptyString)return!1;t=t.trim(),t=this.setTokensForSheets(t);var i=this.getSheetToken(t),n=!1;""!==i&&(t=t.split(i).join(this.emptyString));var a=!1,o=!1;if(t.indexOf(":")!==t.lastIndexOf(":"))return!1;for(var l=t.split("").join(this.getParseArgumentSeparator()).split(this.getParseArgumentSeparator()),h=0;h<l.length;h++)if(this.isChar(l[h]))a=!0;else if(this.isDigit(l[h]))o=!0;else{if(":"!==l[h])return!1;a&&o&&(n=!0),a=!1,o=!1}return t.indexOf(":")>-1&&-1===t.indexOf(this.tic)?!!(n&&a&&o)||!(!(a&&!o||!a&&o)||n):!(!a||!o||-1!==t.indexOf(this.tic))},e.prototype.setTokensForSheets=function(t){var i=this.getSheetFamilyItem(this.grid),n=this.getSortedSheetNames();if(null!=n)for(var a=0;a<n.length;a++){var o=i.sheetNameToToken.get(n[a]);o=o.split(this.sheetToken).join(this.tempSheetPlaceHolder);var l=this.singleTic+"SHEET"+n[a]+this.singleTic+this.sheetToken;-1===t.indexOf(l)&&(l="SHEET"+n[a]+this.sheetToken),t=(t=t.split(l).join(o)).split(l=n[a]+this.sheetToken).join(o)}if((t=t.split(this.tempSheetPlaceHolder).join(this.sheetToken)).indexOf("!!")>-1){var h=(t=t.replace("!!","!")).split("");h[1]=(parseInt(h[1],10)+1).toString(),t=h.join("")}return t},e.prototype.getParentObjectCellValue=function(t,i,n){if(t===this.trueValue||t===this.falseValue)return t;var a=t.lastIndexOf(this.sheetToken),o=0,l=0,h=this.grid,p=this.getSheetFamilyItem(h);if(a>-1&&null!==p.tokenToParentObject)this.grid=p.tokenToParentObject.get(t.substring(0,a+1)),o=this.rowIndex(t),l=this.colIndex(t);else if(-1===a){for(var c=0;c<t.length&&this.isChar(t[c]);)c++;if(c===t.length)return""===(t=t.toLowerCase())?this.getErrorStrings()[L.value]:this.getErrorStrings()[L.name];o=this.rowIndex(t),l=this.colIndex(t),p.isSheetMember&&null!=p.parentObjectToToken&&(t=p.parentObjectToToken.get(this.grid)+t)}var d=""===this.cell||null===this.cell?"":this.cell;if(this.cell=t,d===this.cell&&!n)throw this.formulaErrorStrings[q.circular_reference];var u=this.getParentCellValue(o,l,this.grid,d,h,i,n);return this.grid=h,this.cell=d,u},e.prototype.getParentCellValue=function(t,i,n,a,o,l,h){var p,c=this.getSheetId(n);return void 0!==this.parentObject.getValueRowCol?(a&&(a=o===n?"":a+","+(o&&"string"==typeof o&&Number(o)>-1?o:this.getSheetID(o))),p=this.parentObject.getValueRowCol(c,t,i,a,l,h),(0,f.le)(p)?this.emptyString:p.toString()):((""===(p=this.getValueRowCol(c,t,i))||void 0===p)&&(p=""),p)},e.prototype.getSheetId=function(t){return t&&"string"==typeof t&&Number(t)>-1?Number(t):this.getSheetID(t)+1},e.prototype.getValueRowCol=function(t,i,n){var a=this.rowsToKeyMap.get(i).toString(),o=this.getKeyValue(a).toString();if(null!=o&&"%"===o[o.length-1]&&o.length>1){var l=this.parseFloat(o.substring(0,o.length-1));this.isNaN(l)&&(o=(Number(l)/100).toString())}return o},e.prototype.defineFunction=function(t,i,n){"string"==typeof i&&(i=(0,f.NA)(i,window)),t=t.toUpperCase(),this.libraryFormulas.set(t,{handler:i,isCustom:!0,description:n})},e.prototype.valueChanged=function(t,i,n,a,o,l){var h=t;this.spreadSheetUsedRange=a,this.grid=t;var p=!0,c=!0,d=this.getSheetFamilyItem(h),u=Re(i.getColIndex())+i.getRowIndex().toString();this.actCell=l+"!"+u,null!==d.sheetNameToParentObject&&d.sheetNameToParentObject.size>0&&(u=d.parentObjectToToken.get(h)+u);var g=i.getValue().toUpperCase();if(g.indexOf("=RAND()")>-1||g.indexOf("RAND()")>-1||g.indexOf("=RANDBETWEEN(")>-1||g.indexOf("RANDBETWEEN(")>-1||this.randomValues.has(u)){var m=this.randCollection.toString();this.randomValues.has(u)?this.randomValues.has(u)&&(g.indexOf("=RAND()")>-1||g.indexOf("RAND()")>-1||g.indexOf("=RANDBETWEEN(")>-1||g.indexOf("RANDBETWEEN(")>-1?this.randomValues.set(u,i.getValue()):i.getValue().toUpperCase()!==this.randomValues.get(u.toUpperCase())&&(this.randomValues.delete(u),m=m.split(u+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+u).join("").split(u).join(""),this.randCollection=m.split(this.parseArgumentSeparator)),0===this.randomValues.size&&this.randCollection.length&&(this.isRandomVal=!1,this.randomValues.clear(),this.randCollection=[])):(this.randomValues.set(u,i.getValue()),this.randCollection.push(u),this.isRandomVal=!0)}if(i.getValue()&&i.getValue()[0]===this.getFormulaCharacter()){this.cell=u;var y=void 0;if((0,f.le)(c)||(c=n),this.getFormulaInfoTable().has(u)){if(y=this.getFormulaInfoTable().get(u),i.getValue()!==y.getFormulaText()||null==y.getParsedFormula()){y.setFormulaText(i.getValue()),this.getDependentFormulaCells().has(this.cell)&&this.clearFormulaDependentCells(this.cell);try{y.setParsedFormula(this.parser.parseFormula(i.getValue()))}catch(b){y.setFormulaValue(b),c=!1}}if(c){this.parser.isFormulaParsed=!0;var C=this.calculateFormula(y.getParsedFormula(),o);p=C!==y.getFormulaValue(),y.setFormulaValue(C)}}else{(y=new kl).setFormulaText(i.getValue()),this.getDependentFormulaCells().has(u)||this.getDependentFormulaCells().set(u,new Map);try{y.setParsedFormula(this.parser.parseFormula(i.getValue()))}catch(b){y.setFormulaValue(b),c=!1}c&&y.setFormulaValue(this.calculateFormula(y.getParsedFormula(),o)),this.getFormulaInfoTable().has(u),this.getFormulaInfoTable().set(u,y)}c&&(void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(h)+1,y.getFormulaValue(),i.getRowIndex(),i.getColIndex()):this.parentObject.setValueRowCol(this.getSheetId(h),y.getFormulaValue(),i.getRowIndex(),i.getColIndex(),y.getFormulaText()))}else this.getFormulaInfoTable().has(u)&&(this.getFormulaInfoTable().delete(u),this.getDependentFormulaCells().has(u)&&this.clearFormulaDependentCells(u));c&&p&&this.getDependentCells().has(u)&&this.getDependentCells().get(u).toString()!==u&&this.refresh(u)},e.prototype.setValueRowCol=function(t,i,n,a){},e.prototype.getSortedSheetNames=function(){var t=this.getSheetFamilyItem(this.grid);if(null!=t&&null!=t.sheetNameToToken){var i=[];t.sheetNameToToken.forEach(function(n,a){i.push(a),i.sort()}),this.sortedSheetNames=i,this.sortedSheetNames.sort(),this.sortedSheetNames.length>9&&this.sortedSheetNames[0].includes("1")&&this.sortedSheetNames[1].includes("10")&&(this.sortedSheetNames.splice(this.sortedSheetNames.indexOf("2"),0,this.sortedSheetNames[0]),this.sortedSheetNames.splice(0,1))}return this.sortedSheetNames},e.prototype.getErrorLine=function(t){var i=t.stack?t.stack.split("\n")[1].split(":"):null;return i?i[i.length-2]:null},e.prototype.createSheetFamilyID=function(){return this.sheetFamilyID===Number.MAX_SAFE_INTEGER&&(this.sheetFamilyID=Number.MIN_SAFE_INTEGER),this.sheetFamilyID++},e.prototype.computeMinMax=function(t,i){var n,a,o=0;if((0,f.le)(t)||0===t.length)return this.formulaErrorStrings[q.wrong_number_arguments];for(var l=0,h=t.length;l<h;l++)if(t[l].split(this.tic).join("").trim()===this.emptyString)return this.getErrorStrings()[L.value];n="max"===i?this.minValue:this.maxValue;var p=t;if(p.length>255)return this.getErrorStrings()[L.value];for(var c=0;c<p.length;c++)if(p[c].indexOf(":")>-1&&this.isCellReference(p[c]))for(var d=this.getCellCollection(p[c]),u=0;u<d.length;u++){if(a=this.getValueFromArg(d[u]),this.getErrorStrings().indexOf(a)>-1)return a;var v=this.parseFloat(a);""===a||this.isNaN(this.parseFloat(v))?(o+=1)===d.length&&(n=0):n="max"===i?Math.max(n,v):Math.min(n,v)}else{var g=this.getValueFromArg(p[c])||"0";if(this.getErrorStrings().indexOf(g)>-1)return g;v=this.isNaN(this.parseFloat(g))?0:this.parseFloat(g),n="max"===i?Math.max(n,v):Math.min(n,v)}return n.toString()},e.prototype.calculateAvg=function(t){for(var i=0,n=t,a=[],o=0,l=0,p=0;p<n.length;p++)if(n[p].indexOf(":")>-1&&this.isCellReference(n[p])){l=0,a=this.getCellCollection(n[p]),o=0;for(var c=0;c<a.length;c++){var d=this.getValueFromArg(a[c]);(0,f.le)(d)||isNaN(this.parseFloat(d))||(o+=this.parseFloat(d),l+=1)}if(0===l)return this.getErrorStrings()[L.divzero];i=(o/=l)+i}else{if(n[p].indexOf(this.tic)>-1&&isNaN(parseFloat(n[p].split(this.tic).join(""))))return this.getErrorStrings()[L.value];if(0===n[p].length&&(n[p]="1"),d=this.getValueFromArg(n[p].split(this.tic).join("")),(0,f.le)(d)||isNaN(this.parseFloat(d)))return this.getErrorStrings()[L.name];i+=this.parseFloat(d)}return(i/(n.length-0)).toString()},e.prototype.registerGridAsSheet=function(t,i,n){(0,f.le)(this.modelToSheetID)&&(this.modelToSheetID=new Map),(0,f.le)(this.modelToSheetID.get(i))&&this.modelToSheetID.set(i,n);var a=this.getSheetFamilyItem(i);a.isSheetMember=!0;var o=t.toUpperCase();if(0===a.parentObjectToToken.size&&(a.parentObjectToToken=new Map),0===a.sheetNameToParentObject.size&&(a.sheetNameToParentObject=new Map),0===a.sheetNameToToken.size&&(a.sheetNameToToken=new Map),0===a.tokenToParentObject.size&&(a.tokenToParentObject=new Map),(0,f.o8)(a.sheetNameToParentObject.get(o))){var l=this.sheetToken+this.tokenCount.toString()+this.sheetToken;this.tokenCount++,a.tokenToParentObject.set(l,i),a.parentObjectToToken.set(i,l),a.sheetNameToToken.set(o,l),a.sheetNameToParentObject.set(o,i)}else l=a.sheetNameToToken.get(o),a.tokenToParentObject.set(l,i),a.parentObjectToToken.set(i,l);return t},e.prototype.unregisterGridAsSheet=function(t,i,n){var a=this,o=[i];n&&(o=[],(0,f.le)(this.modelToSheetID)||this.modelToSheetID.forEach(function(l,h){o.push(h)})),o.forEach(function(l){var h=a.getSheetFamilyItem(l),p=(n?l:t).toUpperCase();if(null!=h.sheetNameToParentObject&&h.sheetNameToParentObject.has(p)){h.sheetNameToParentObject.delete(p);var c=h.sheetNameToToken.get(p);h.sheetNameToToken.delete(p),h.tokenToParentObject.delete(c),h.parentObjectToToken.delete(l)}})},e.prototype.computeExpression=function(t){var i=this.parser.parseFormula(t);return this.computeFormula(i)},e.prototype.isSheetMember=function(){var t=this.getSheetFamilyItem(this.grid);return!(0,f.le)(t)&&t.isSheetMember},e.prototype.dispose=function(){this.resetKeys(),this.namedRanges.clear(),this.lFormulas.clear()},e.prototype.refreshRandValues=function(t){var i,n,a,h,o="",l=this.randCollection.toString();this.randomValues.has(t)&&(this.randomValues.delete(t),l=l.split(t+this.parseArgumentSeparator).join("").split(this.parseArgumentSeparator+t).join("").split(t).join(""),0===this.randomValues.size&&""===l?(this.randomValues.clear(),this.randCollection=[]):this.randCollection=l.split(this.parseArgumentSeparator));for(var p=0;p<this.randomValues.size;p++)i=this.rowIndex(this.randCollection[p]),n=this.colIndex(this.randCollection[p]),o=(parseFloat(this.getSheetToken(this.randCollection[p]).split(this.sheetToken).join(""))+1).toString(),h=this.getSheetFamilyItem(o),this.grid=h.sheetNameToParentObject.get(o),a=this.randomValues.get(this.randCollection[p]),a=this.computeFormula(a),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,a,i,n):this.parentObject.setValueRowCol(this.getSheetId(this.grid),a,i,n)},e.prototype.refresh=function(t,i){if(this.getDependentCells().has(t)){var n=this.getSheetFamilyItem(this.grid);try{var a=this.getDependentCells().get(t),o=void 0;for(o=0;o<a.length;o++){var l=a[o];if(!(i&&l.indexOf(i)>-1||l===t)){var h=this.getSheetToken(l);if(h.length){this.grid=n.tokenToParentObject.get(h);var p=Number(this.grid),c=this.parentObject.sheets,d="";if(!this.isNaN(p)&&c)for(var u=0;u<c.length;u++)c[u].id===p&&(d=c[u].name);this.actCell=d+"!"+l.split(h)[1]}else this.actCell=l.split(h)[1];try{var v=this.rowIndex(l),g=this.colIndex(l),m=this.getFormulaInfoTable().get(l),y=void 0;m&&(this.cell=l,this.parser.isFormulaParsed=!0,y=this.calculateFormula(m.getParsedFormula(),!0),m.setFormulaValue(y)),void 0===this.parentObject.setValueRowCol?this.setValueRowCol(this.getSheetID(this.grid)+1,m.getFormulaValue(),v,g):this.parentObject.setValueRowCol(this.getSheetId(this.grid),m.getFormulaValue(),v,g,m.getFormulaText()),this.refresh(l)}catch(C){continue}}}}finally{this.grid=n.tokenToParentObject.get(this.getSheetToken(t))}}},vo([(0,f.Z9)(!0)],e.prototype,"includeBasicFormulas",void 0),vo([(0,f.ju)()],e.prototype,"onFailure",void 0),r=vo([f.Zl],e)}(f.XY),it=function(){return function(e,r){this.formulaCorrection=!1,this.message=e,this.formulaCorrection=r}}(),kl=function(){function s(){this.calcID=Number.MIN_VALUE+1,this.calcID1=Number.MIN_VALUE+1}return s.prototype.getFormulaText=function(){return this.formulaText},s.prototype.setFormulaText=function(e){this.formulaText=e},s.prototype.getFormulaValue=function(){return this.formulaValue},s.prototype.setFormulaValue=function(e){this.formulaValue=e},s.prototype.getParsedFormula=function(){return this.parsedFormula},s.prototype.setParsedFormula=function(e){this.parsedFormula=e},s}(),Rl=function(){return function(){this.isSheetMember=!1,this.parentObjectToToken=new Map,this.sheetDependentFormulaCells=new Map,this.sheetNameToParentObject=new Map,this.sheetNameToToken=new Map,this.tokenToParentObject=new Map,this.sheetFormulaInfotable=new Map}}();function Re(s){for(var e=[],r=0;s>0&&r<9;){s--;var i="A".charCodeAt(0);e[r]=String.fromCharCode(s%26+i),s=parseInt((s/26).toString(),10),r++}for(var n=[],a=0;a<r;a++)n[r-a-1]=e[a];return n.join("")}var Fl=function(){return function(e,r,t){return this.row=e,this.col=r,this.value=t,this.getRowIndex=function(){return e},this.setRowIndex=function(i){e=i},this.getColIndex=function(){return r},this.setColIndex=function(i){r=i},this.getValue=function(){return t},this}}(),On=function(){function s(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.sheetInfo=[],this.parent=e,this.init()}return s.prototype.init=function(){this.addEventListener(),this.initCalculate(),this.registerSheet()},s.prototype.destroy=function(){this.removeEventListener(),this.parent.refreshing&&this.clearAllUniqueFormulaValue(),this.calculateInstance.dispose(),this.calculateInstance=null,this.parent=null},s.prototype.addEventListener=function(){this.parent.on(ie,this.performFormulaOperation,this),this.parent.on(Ei,this.aggregateComputation,this),this.parent.on(Za,this.getUniqueRange,this),this.parent.on(Ur,this.removeUniquecol,this),this.parent.on(zr,this.clearFormulaDependentCells,this),this.parent.on(mn,this.formulaInValidation,this),this.parent.on(hr,this.refreshInsertDelete,this),this.parent.on(An,this.getUpdatedFormulaOnInsertDelete,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ie,this.performFormulaOperation),this.parent.off(Ei,this.aggregateComputation),this.parent.off(Za,this.getUniqueRange),this.parent.off(Ur,this.removeUniquecol),this.parent.off(zr,this.clearFormulaDependentCells),this.parent.off(mn,this.formulaInValidation),this.parent.off(hr,this.refreshInsertDelete),this.parent.off(An,this.getUpdatedFormulaOnInsertDelete))},s.prototype.getModuleName=function(){return"workbookFormula"},s.prototype.initCalculate=function(){this.calculateInstance=new qh(this.parent),this.calcID=this.calculateInstance.createSheetFamilyID(),this.calculateInstance.setTreatEmptyStringAsZero(!0),this.calculateInstance.grid=this.parent.getActiveSheet().id.toString()},s.prototype.clearFormulaDependentCells=function(e){if(e.isOpen)return this.calculateInstance.getDependentCells().clear(),void this.calculateInstance.getFormulaInfoTable().clear();var r=e.cellRef.split(":")[0],t=this.parent.getActiveSheet().id.toString(),i=this.calculateInstance.getSheetFamilyItem(t);i.isSheetMember&&!(0,f.le)(i.parentObjectToToken)&&(r=i.parentObjectToToken.get(t)+r),this.calculateInstance.clearFormulaDependentCells(r)},s.prototype.formulaInValidation=function(e){var r=this.calculateInstance.getLibraryFormulas().get(e.value);e.skip=(0,f.le)(r)},s.prototype.performFormulaOperation=function(e){var t,i,n,r=e.action;switch("refreshCalculate"!==r&&(t=this.calculateInstance.getLibraryFormulas(),i=Array.from(t.values())),r){case"getLibraryFormulas":e.formulaCollection=Array.from(t.keys());break;case"getFormulaCategory":n=["All"];for(var a=1;a<Array.from(t.values()).length;a++)n.indexOf(i[a].category)<0&&n.push(i[a].category);e.categoryCollection=n;break;case"dropDownSelectFormulas":for(a=0;a<Array.from(t.values()).length;a++)e.selectCategory===i[a].category&&(e.formulaCollection[a]=Array.from(t.keys())[a]);break;case"getFormulaDescription":for(a=0;a<Array.from(t.values()).length;a++)e.selectedList===Array.from(t.keys())[a]&&(e.description=i[a].description,e.isCustom=i[a].isCustom);break;case"registerSheet":this.registerSheet(e.sheetIndex,e.sheetCount),e.isImport&&this.updateSheetInfo();break;case"unRegisterSheet":this.unRegisterSheet(e.sheetIndex,e.sheetCount,e.propertyChange);break;case"initSheetInfo":this.updateSheetInfo();break;case"refreshCalculate":e.isFormula&&(e.value=this.autoCorrectFormula(e.value,e.rowIndex,e.colIndex,e.sheetIndex),e.isClipboard&&e.value.toString().toUpperCase().includes("UNIQUE")&&(this.parent.sheets[e.sheetIndex].rows[e.rowIndex].cells[e.colIndex].value="")),e.isFormulaDependent=this.refreshCalculate(e.rowIndex,e.colIndex,e.value,e.isFormula,e.sheetIndex,e.isRefreshing),e.value=e.value?e.value.toString().split("-*").join("-").split("/*").join("/").split("*/").join("*").split("-/").join("-").split("*+").join("*").split("+*").join("+"):e.value;break;case"getArgumentSeparator":e.argumentSeparator=this.calculateInstance.getParseArgumentSeparator();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName,!1,e.index,e.isEventTrigger);break;case"removeDefinedName":e.isRemoved=this.removeDefinedName(e.definedName,e.scope,e.isEventTrigger);break;case"initiateDefinedNames":this.initiateDefinedNames();break;case"renameUpdation":this.renameUpdation(e.value,e.pName);break;case"addSheet":this.sheetInfo.push({visibleName:e.visibleName,sheet:e.sheetName,index:e.sheetId});break;case"getSheetInfo":e.sheetInfo=this.sheetInfo;break;case"deleteSheetTab":for(a=0;a<this.sheetInfo.length;a++)if(this.sheetInfo[a].index===e.sheetId){var o=this.sheetInfo[a].sheet;this.sheetInfo.splice(a,1);var l=e.sheetId.toString();this.sheetDeletion(o,l),this.calculateInstance.unregisterGridAsSheet(l,l);break}break;case"getReferenceError":e.refError=this.referenceError();break;case"getAlpha":e.col=Re(e.col);break;case"addCustomFunction":this.addCustomFunction(e.functionHandler,e.functionName,e.formulaDescription);break;case"computeExpression":e.calcValue=this.calculateInstance.computeExpression(e.formula);break;case"registerGridInCalc":this.calculateInstance.grid=e.sheetID;break;case"dependentCellsAvailable":case"checkFormulaAdded":var h=this.calculateInstance.getSheetFamilyItem(e.sheetId);h.isSheetMember&&!(0,f.le)(h.parentObjectToToken)&&(e.address=h.parentObjectToToken.get(e.sheetId)+e.address),"checkFormulaAdded"===r?e.added=this.calculateInstance.getFormulaInfoTable().has(e.address):e.isAvailable=this.calculateInstance.getDependentCells().has(e.address)}},s.prototype.referenceError=function(){return this.calculateInstance.getErrorStrings()[L.ref]},s.prototype.getSheetInfo=function(){return this.sheetInfo},s.prototype.addCustomFunction=function(e,r,t){this.calculateInstance.defineFunction(r,e,t)},s.prototype.updateSheetInfo=function(){var e=this;this.sheetInfo=[],this.parent.sheets.forEach(function(r){e.sheetInfo.push({visibleName:r.name,sheet:"Sheet"+r.id,index:r.id})})},s.prototype.sheetDeletion=function(e,r){var n,a,o,l,h,c,d,t=this,i=this.calculateInstance.getDependentCells(),p=this.calculateInstance.getSheetFamilyItem(r);i.forEach(function(u,v){u.forEach(function(g){n=t.calculateInstance.getFormulaInfoTable().get(g),(0,f.le)(n)||(a=n.formulaText,c=e.toUpperCase(),a=a.toUpperCase(),(d=a.indexOf(c))>-1&&("'"===a[d-1]&&"'"===a[d+c.length]&&(c="'"+c+"'"),a=a.split(c+=t.calculateInstance.sheetToken).join(t.referenceError()),o=t.calculateInstance.rowIndex(g),l=t.calculateInstance.colIndex(g),h=g.slice(0,g.lastIndexOf(t.calculateInstance.sheetToken)+1),t.updateDataContainer([o-1,l-1],{value:a,visible:!1,sheetId:p.tokenToParentObject.has(h)?Number(p.tokenToParentObject.get(h)):parseInt(g.split("!")[1],10)+1}),t.calculateInstance.refresh(n.getParsedFormula()))),h=v.slice(0,v.lastIndexOf(t.calculateInstance.sheetToken)+1),r===(p.tokenToParentObject.has(h)?p.tokenToParentObject.get(h):v.split("!")[1])&&(t.calculateInstance.getFormulaInfoTable().delete(v),t.calculateInstance.clearFormulaDependentCells(v))})})},s.prototype.renameUpdation=function(e,r){var i,n,t=this,a=r.toUpperCase(),o=new RegExp("[!@#$%^&()+=';,.{}|\\\":<>~_-]","g"),h=new RegExp(r.replace(o,"\\$&")+'(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)',"gi");this.sheetInfo.forEach(function(p,c){for(var d=0,u=(i=t.parent.sheets[c]).usedRange.rowIndex;d<=u;d++)for(var v=0,g=i.usedRange.colIndex;v<=g;v++)(n=E(d,v,i,!1,!0)).formula&&pe(n.formula)&&n.formula.toUpperCase().includes(a)&&n.formula.match(h)&&(n.formula=n.formula.replace(h,e));p.visibleName===r&&(p.visibleName=e)})},s.prototype.updateDataContainer=function(e,r){for(var t,i,n,a=0,o=this.parent.sheets.length;a<o;a++)if(this.parent.sheets[a].id===r.sheetId){e[0]in(t=this.parent.sheets[a]).rows?e[1]in(i=t.rows[e[0]]).cells?((n=i.cells[e[1]]).formula=r.value,r.visible?a===this.parent.activeSheetIndex&&t.activeCell===j(e[0],e[1])&&this.parent.notify(Wt,{}):n.value=this.referenceError()):i.cells[e[1]]=n={}:(i=t.rows[e[0]]={})[e[1]]=n={};break}},s.prototype.parseSheetRef=function(e){var r,t=new RegExp("[!@#$%^&()+=';,.{}|\":<>~_-]","g"),i=0,n=this.parent.sheets.length,a=[];a.length=0;var o,l,h,p,c,d=this.getSheetInfo(),u='(?=[\'!])(?=[^"]*(?:"[^"]*"[^"]*)*$)';for(i=0;i<n;i++)if(d[i].sheet!==d[i].visibleName&&(r=new RegExp(d[i].visibleName.replace(t,"\\$&")+u,"gi"),h=i,e.match(r))){for(var v=i+1;v<n;v++)o=new RegExp(d[v].visibleName.replace(t,"\\$&")+u,"gi"),l=e.search(o),p=e.search(r),l>-1&&(l<p||l===p&&d[v].visibleName.length>d[i].visibleName.length)&&(c=new RegExp("Sheet","gi"),0!==d[v].visibleName.search(c)&&(r=o,h=v));e=e.replace(r,h+"/"),a.push(h)}for(i=0;i<a.length;)r=new RegExp(a[i]+"/"+u,"gi"),e=e.replace(r,d[a[i]].sheet),i++;return e},s.prototype.registerSheet=function(e,r){void 0===e&&(e=0),void 0===r&&(r=this.parent.sheets.length);for(var t;e<r;)t=_(this.parent,e).id+"",this.calculateInstance.registerGridAsSheet(t,t,this.calcID),e++},s.prototype.unRegisterSheet=function(e,r,t){var i;if(void 0===e&&(e=0),void 0===r&&(r=this.parent.sheets.length),this.calculateInstance.tokenCount=0,t)this.calculateInstance.unregisterGridAsSheet(i,i,t);else for(;e<r;)i=_(this.parent,e).id+"",this.calculateInstance.unregisterGridAsSheet(i,i),e++},s.prototype.getUniqueRange=function(e){e.range=this.calculateInstance.uniqueRange},s.prototype.removeUniquecol=function(e){if(e&&e.clearAll)this.clearAllUniqueFormulaValue();else for(var r=this.parent.getActiveSheet(),t=0;t<this.calculateInstance.uniqueRange.length;t++){var i=this.calculateInstance.uniqueRange[t].split(":")[0].split("!");if(i[0]===r.name&&i[1]===r.activeCell){var n=A(this.calculateInstance.uniqueRange[t]);this.calculateInstance.uniqueRange.splice(t,1);for(var a=n[0];a<=n[2];a++)for(var o=n[1];o<=n[3];o++)E(a,o,this.parent.getActiveSheet()).formula="",this.parent.updateCell({value:"",formula:""},z([a,o]))}}},s.prototype.refreshCalculate=function(e,r,t,i,n,a){var o=(0,f.le)(n)?this.parent.getActiveSheet():_(this.parent,n),l=o.id+"",h=o.name,p=this.calculateInstance.getSheetFamilyItem(l),c=_e(r+1)+(e+1);if(p.isSheetMember&&!(0,f.le)(p.parentObjectToToken)&&(c=p.parentObjectToToken.get(l)+c),i){t=this.parseSheetRef(t);var d=new Fl(e+1,r+1,t);this.calculateInstance.valueChanged(l,d,!0,[o.usedRange.rowIndex,o.usedRange.colIndex],a,h);var v=this.calculateInstance.randCollection;if(!0===this.calculateInstance.isRandomVal){var g=void 0,m=void 0,y="";if(this.calculateInstance.randomValues.size>1&&this.calculateInstance.randomValues.size===v.length)for(var C=0;C<this.calculateInstance.randomValues.size;C++){g=this.calculateInstance.rowIndex(v[C]),m=this.calculateInstance.colIndex(v[C]),y=this.calculateInstance.randomValues.get(v[C]),l=(parseFloat(this.calculateInstance.getSheetToken(v[C]).split(this.calculateInstance.sheetToken).join(""))+1).toString();var b=new Fl(g,m,y);this.calculateInstance.valueChanged(l,b,!0)}}}else this.calculateInstance.getFormulaInfoTable().has(c)&&(this.calculateInstance.getFormulaInfoTable().delete(c),this.calculateInstance.clearFormulaDependentCells(c)),this.calculateInstance.refresh(c),this.calculateInstance.refreshRandValues(c);this.calculateInstance.cell="";var S=E(e,r,this.parent.getActiveSheet());if(t&&t.toString().toUpperCase().startsWith("=DOLLAR(")&&S&&S.value&&S.value.startsWith("$")&&this.dollarFormulaDecimalHandler(S),S&&t&&0===t.toString().toUpperCase().indexOf("=SUM(")){var w=["#N/A","#VALUE!","#REF!","#DIV/0!","#NUM!","#NAME?","#NULL!","invalid arguments"],x=t.toString().toUpperCase().replace("=SUM","").replace("(","").replace(")","").split(":")[0];if(nt(x)){var I=A(x),F=E(I[0],I[1],this.parent.getActiveSheet());F&&F.value&&F.format&&w.indexOf(S.value)<0&&w.indexOf(F.value)<0&&(S.format=F.format)}}return this.calculateInstance.getDependentCells().has(c)},s.prototype.dollarFormulaDecimalHandler=function(e){for(var r=e.value.split(".")[1].length,t="",i=1;i<=r;i++)t+="0";e.format="$#,##."+t},s.prototype.autoCorrectFormula=function(e,r,t,i){if(!(0,f.le)(e)){2===(e=e.toString()).split("(").length&&e.indexOf(")")<0&&(e+=")");var n=void 0;0===e.indexOf("=")&&(e=e.slice(1),n=!0);var a=e.match(/</g),o=e.match(/>/g),l=e.match(/=/g);if(a){for(var h="",p=0;p<a.length;p++)h+=a[p];e=e.replace(h,"<")}if(o){for(var c="",d=0;d<o.length;d++)c+=o[d];e=e.replace(c,">")}if(l){for(var u="",v=0;v<l.length;v++)u+=l[v];e=e.split(u).join("=")}e=n?"="+e:e,(a||o||l)&&(E(r,t,(0,f.le)(i)?this.parent.getActiveSheet():_(this.parent,i)).formula=e)}return e},s.prototype.initiateDefinedNames=function(){for(var e=this.parent.definedNames,r=0;r<e.length;){var t=e[r],i=this.parseSheetRef(t.refersTo),n=Cr(i),a=!1,o=i.indexOf("http:")>-1||i.indexOf("https:")>-1;if((n=(n=n.split("$").join("")).split("=").join("")).indexOf(":")>-1){var l=n.split(":");nt(l[0])&&nt(l[1])&&(a=!0)}else n.indexOf(":")<0&&nt(n)&&(a=!0);o&&(a=!1),a?this.addDefinedName(t,!0,void 0,!0):(this.removeDefinedName(t.name,t.scope,!0),r--),r++}},s.prototype.addDefinedName=function(e,r,t,i){(void 0===t||t<-1)&&(t=this.parent.definedNames.length);var a,n=!0,o=e.name;if(e.refersTo.indexOf("!")<0){var l=pt(this.parent);l=-1!==l.indexOf(" ")?"'"+l+"'":l,e.refersTo=l+"!"+(e.refersTo.indexOf("=")<0?e.refersTo:e.refersTo.split("=")[1])}var h=e.refersTo,p=this.parseSheetRef(e.refersTo);return e.scope?(a=ee(this.parent,e.scope))>-1&&(o=pt(this.parent,a)+"!"+o):e.scope="",e.comment||(e.comment=""),!r&&this.checkIsNameExist(e.name,e.scope)?n=!1:(this.calculateInstance.addNamedRange(o,"="===p[0]?p.substr(1):p),"="!==p[0]&&(e.refersTo="="+h),this.parent.definedNames.indexOf(e)<0&&this.parent.definedNames.splice(t,0,e)),i||this.parent.notify("actionComplete",{eventArgs:{name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1},action:"addDefinedName"}),n},s.prototype.removeDefinedName=function(e,r,t){var i=!1,n=this.getIndexFromNameColl(e,r);if(n>-1){var a=e;if(r){var o=ee(this.parent,r);o&&(a=pt(this.parent,o)+"!"+e)}this.calculateInstance.removeNamedRange(a),this.parent.definedNames.splice(n,1),t||this.parent.notify("actionComplete",{eventArgs:{name:e,scope:r,cancel:!1},action:"removeDefinedName"}),i=!0}return i},s.prototype.checkIsNameExist=function(e,r){return this.parent.definedNames.some(function(i){return i.name===e&&(r?i.scope===r:""===i.scope)})},s.prototype.getIndexFromNameColl=function(e,r){void 0===r&&(r="");var t=-1;return this.parent.definedNames.filter(function(i,n){i.name===e&&i.scope===r&&(t=n)}),t},s.prototype.toFixed=function(e){var r=Number(e);return Math.round(r)!==r&&(e=r.toFixed(2)),e},s.prototype.aggregateComputation=function(e){var r=this.parent.getActiveSheet(),t=function(s){return s.selectedRange.split(" ")[0]}(r),i=A(t.split(":")[1]);i[0]+1===r.rowCount&&i[1]+1===r.colCount&&(t="A1:"+j(r.usedRange.rowIndex,r.usedRange.colIndex));var n,a,o=this.calculateInstance.getCellCollection(t);for(a=0;a<o.length;a++)if(te(n=this.calculateInstance.getValueFromArg(o[a]))){e.countOnly=!1;break}if(e.Count=this.calculateInstance.getFunction("COUNTA")(t),e.Count&&!e.countOnly){var l=["SUM","AVERAGE","MIN","MAX"],h=[],p=A(r.activeCell),c=E(p[0],p[1],r,!1,!0);for(a=0;a<4;a++){if(n=this.toFixed(this.calculateInstance.getFunction(l[a])(t)),c.format){var d={formattedText:n,value:n,format:c.format,cell:{value:n,format:c.format},onLoad:!0,skipRowFill:!0};this.parent.notify(ot,d),n=d.formattedText}h.push(n)}e.Sum=h[0],e.Avg=h[1],e.Min=h[2],e.Max=h[3]}},s.prototype.refreshInsertDelete=function(e){var i,r=this,t=this.calculateInstance.getDependentFormulaCells(),n=ht(this.parent,e.sheet.id);this.parent.sheets.forEach(function(a,o){for(var l=0,h=a.usedRange.rowIndex;l<=h;l++)for(var p=0,c=a.usedRange.colIndex;p<=c;p++)(i=E(l,p,a,!1,!0)).formula&&pe(i.formula)&&(o===n?(e.isInsert||!("Row"===e.modelType?l>=e.startIndex&&l<=e.endIndex:p>=e.startIndex&&p<=e.endIndex))&&r.updateFormula(e,i,l,p):i.formula.includes(e.sheet.name)&&r.updateFormula(e,i,l,p,!0,a))}),t.clear(),this.calculateInstance.getDependentCells().clear(),this.calculateInstance.getFormulaInfoTable().clear(),this.refreshNamedRange(e)},s.prototype.getUpdatedFormulaOnInsertDelete=function(e){this.updateFormula(e.insertDeleteArgs,e.cell,e.row,e.col)},s.prototype.updateFormula=function(e,r,t,i,n,a){var o,l,h,p,c;r.formula&&r.formula.includes("UNIQUE")&&this.clearUniqueRange(t,i,a||e.sheet);for(var u=this.parseFormula(r.formula,!0),v=0;v<u.length;v++)if(o=u[v].trim().replace(/[$]/g,""),this.calculateInstance.isCellReference(o)){if((l=v&&u[v-1].trim())&&"!"===l[l.length-1]){if((l=l.replace(/['!]/g,""))!==e.sheet.name)continue}else if(n)continue;h=A(o),p=this.parent.updateRangeOnInsertDelete(e,h),c=Q(h),p&&(u[v]=c[2]<c[0]||c[3]<c[1]?this.calculateInstance.getErrorStrings()[L.ref]:h[0]===h[2]&&h[1]===h[3]?j(h[0],h[1]):z(h))}var g="="+u.join("");r.formula!==g&&(r.formula=g,r.value=null)},s.prototype.clearUniqueRange=function(e,r,t){var i={cellIdx:[e,r,e,r],isUnique:!1,uniqueRange:"",sheetName:t.name};this.parent.notify(At,i);for(var n=A(i.uniqueRange),a=n[0];a<=n[2];a++)for(var o=n[1];o<=n[3];o++)delete E(a,o,t,!1,!0).value},s.prototype.clearAllUniqueFormulaValue=function(){for(var r,t,i,n,e=this.calculateInstance.uniqueRange,a=0;a<e.length;a++)if(r=e[a].split("!"),i=_(this.parent,ee(this.parent,r[0])),!(t=E((n=A(r[1]))[0],n[1],i))||"#SPILL!"!==t.value)for(var o=n[0];o<=n[2];o++)for(var l=n[1];l<=n[3];l++)(t=E(o,l,i))&&t.value&&delete t.value},s.prototype.parseFormula=function(e,r){for(var t,i,n=0,a=[],o=[],l=(o=(o=this.markSpecialChar(e.replace("=",""),r)).split(r?/\(|\)|=|\^|>|<|,|\+|-|\*|\/|%|&/g:/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;n<l;)(t=o[n])?(1===t.length?a.push(this.isUniqueChar(t)?this.getUniqueCharVal(t):t):(i=t[0],t.indexOf("!")>0?(this.isUniqueChar(i)&&(a.push(this.getUniqueCharVal(i)),t=t.substr(1)),i=t.indexOf("!")+1,a.push(t.substr(0,i)),a.push(t.substr(i))):this.isUniqueChar(i)?(a.push(this.getUniqueCharVal(i)),a.push(t.substr(1))):a.push(t)),n++):n++;return a},s.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueCOperator:return":";case this.uniquePOperator:return"+";case this.uniqueSOperator:return"-";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<"}return""},s.prototype.isUniqueChar=function(e){var r=e.charCodeAt(e);return r>=129&&r<=142},s.prototype.markSpecialChar=function(e,r){return e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket),(e=(e=(e=(e=(e=(e=(e=r?e.replace(/,/g,","+this.uniqueCSeparator):e.replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},s.prototype.refreshNamedRange=function(e){var r=this;if(e.definedNames&&e.definedNames.length)e.definedNames.forEach(function(c){r.parent.removeDefinedName(c.name,c.scope),r.parent.addDefinedName(c)});else{var t=this.parent.definedNames.length;if(t)for(var n,a,o,l,h,i=Object.assign({},this.parent.definedNames),p=0;p<t;p++)(a=(o=(l=i[p]).refersTo.split("!"))[0].split("=")[1])===e.sheet.name&&(n=A(o[1]),h=this.parent.updateRangeOnInsertDelete(e,n),e.isInsert?this.updateDefinedNames(l,a,n,h):"Row"===e.modelType?this.updateDefinedNames(l,a,n,h,[n[0],n[2]],e):"Column"===e.modelType&&this.updateDefinedNames(l,a,n,h,[n[1],n[3]],e))}},s.prototype.updateDefinedNames=function(e,r,t,i,n,a){if(i){var o=this.parent.definedNames.indexOf(e);if(this.parent.notify(ie,{action:"removeDefinedName",isRemoved:!1,definedName:e.name,scope:e.scope,isEventTrigger:!0}),n){var h={name:e.name,comment:e.comment,refersTo:e.refersTo,scope:e.scope};if(h=new Vl(this.parent,"definedNames",h,!0),a.definedNames?a.definedNames.push(h):a.definedNames=[h],n[1]<n[0])return}e.refersTo=r+"!"+z(t),this.parent.notify(ie,{action:"addDefinedName",definedName:e,isAdded:!1,index:o,isEventTrigger:!0}),this.parent.notify("actionComplete",{eventArgs:{name:e.name,scope:e.scope,comment:e.comment,refersTo:e.refersTo,cancel:!1},action:"refreshNamedRange"})}},s}(),Nn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(ki,this.initiateSortHandler,this),this.parent.on(Ka,this.updateSortedDataOnCell,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ki,this.initiateSortHandler),this.parent.off(Ka,this.updateSortedDataOnCell))},s.prototype.initiateSortHandler=function(e){var r=this,t=e.args,i=new re.BH,n=this.parent.getAddressInfo(t.range),a=_(this.parent,n.sheetIndex),o=Q(n.indices),l=t.sortOptions||{sortDescriptors:{},containsHeader:!0},h=!1;if(e.promise=i.promise,o[0]>a.usedRange.rowIndex||o[1]>a.usedRange.colIndex)i.reject(this.parent.serviceLocator.getService(jl).getConstant("SortOutOfRangeError"));else{var p=l.containsHeader,c=t.checkForHeader;if((o[0]===o[2]||c)&&(c||(o=Wl(o[0],o[1],a)),h=!0,(0,f.le)(l.containsHeader)&&(p=typeof E(o[0],o[1],a,null,!0).value!=typeof E(o[0]+1,o[1],a,null,!0).value||!this.isSameStyle(E(o[0],o[1],a,null,!0).style,E(o[0]+1,o[1],a,null,!0).style))),((0,f.le)(t.sortOptions)||(0,f.le)(t.sortOptions.containsHeader))&&!h){var d=E(o[0],o[1],a),u=E(o[0]+1,o[1],a);d&&u&&(p=typeof d.value!=typeof u.value||!this.isSameStyle(d.style,u.style))}o[0]=p?o[0]+1:o[0];var g=_e(B(a.activeCell)[1]+1);delete l.containsHeader;var m=l.sortDescriptors,y=z(o);Zt(this.parent,a.name+"!"+y,!0,null,null,null,null,null,void 0,null,o[1]).then(function(C){var b=new re.hm(C),S=new re.AE;if(Array.isArray(m)){(!m||0===m.length)&&(m=[{field:g}]);for(var w=m.length,x=w-1;x>-1;x--)if(m[w-1].field||(m[w-1].field=g),m[x].field){var I=m[x].sortComparer||r.sortComparer.bind(r,m[x],l.caseSensitive);S.sortBy(m[x].field,I)}}else m||(m={field:g}),m.field||(m.field=g),I=m.sortComparer||r.sortComparer.bind(r,m,l.caseSensitive),S.sortBy(m.field,I);b.executeQuery(S).then(function(F){r.parent.notify("setActionData",{args:{action:"beforeSort",eventArgs:{range:y,cellDetails:C,sortedCellDetails:F.result}}}),r.updateSortedDataOnCell({result:F.result,range:o,sheet:a,jsonData:C});var T={range:a.name+"!"+y,sortOptions:t.sortOptions};e.previousSort&&(T.previousSort=e.previousSort),i.resolve(T)})})}},s.prototype.updateSortedDataOnCell=function(e){for(var i,o,r=this,t=[],n=function(p,c){for(var d=e.range[1],u=0;d<=e.range[3];d++,u++){if(t[u]||(t[u]=_e(d+1)),c[t[u]])i=(0,f.l7)({},c[t[u]],null,!0);else{if(!E(p,d,e.sheet))continue;i=null}(i=r.skipBorderOnSorting(p,d,e.sheet,i))&&i.formula&&(i.formula=_l([p,d],[parseInt(c.__rowIndex,10)-1,d],e.sheet,i,r.parent,!0)),ce(p,d,e.sheet,i)}},a=e.isUndo&&{},l=e.range[0],h=0;l<=e.range[2];l++,h++)if(ne(e.sheet,l))h--;else if(e.isUndo){if(e.result[h]&&(a[o=parseInt(e.result[h].__rowIndex,10)-1]=!0,n(o,e.result[h]),l===o))continue;!a[l]&&e.sheet.rows[l]&&n(l,{})}else n(l,e.result[h]||{})},s.prototype.skipBorderOnSorting=function(e,r,t,i){var n=E(e,r,t),a=["borderBottom","borderTop","borderRight","borderLeft","border"];if(i&&i.style)for(var o=0,l=a;o<l.length;o++)delete i.style[h=l[o]];if(n&&n.style)for(var p=0,c=a;p<c.length;p++){var h;n.style[h=c[p]]&&(i||(i={}),i.style||(i.style={}),i.style[h]=n.style[h])}return i},s.prototype.isSameStyle=function(e,r){e||(e={}),r||(r={});for(var t=!0,i=Object.keys(e),n=0;n<i.length;n++){if(e[i[n]]!==r[i[n]]&&this.parent.cellStyle[i[n]]!==e[i[n]]){t=!1;break}t=!0}return t},s.prototype.sortComparer=function(e,r,t,i){var n=e.order||"",a=re.j4.fnSort(n),o=!1;if(t&&i&&("string"==typeof t.value||"string"==typeof i.value)&&""!==t.value&&""!==i.value&&(te(t.value)&&(t.value=Pr(t.value)),te(i.value)&&(i.value=Pr(i.value),o=!0),!o&&!o)){var h=new Intl.Collator(this.parent.locale,{sensitivity:r?"case":"base"});return n&&"ascending"!==n.toLowerCase()?-1*h.compare(t.value,i.value):h.compare(t.value,i.value)}var p=(0,f.le)(t)||t&&((0,f.le)(t.value)||""===t.value),c=(0,f.le)(i)||i&&((0,f.le)(i.value)||""===i.value);return p&&c?-1:p?1:c?-1:a(t&&t.value,i&&i.value)},s.prototype.getModuleName=function(){return"workbookSort"},s}(),Mn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(gn,this.initiateFilterHandler,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(gn,this.initiateFilterHandler)},s.prototype.initiateFilterHandler=function(e){var r=this,t=e.args,i=new re.BH,n=_(this.parent,qt(this.parent,t.range)),a=t.filterOptions||{};if(e.promise=i.promise,a.datasource)this.setFilter(a.datasource,a.predicates,t.range,e.refresh),i.resolve({range:t.range,filterOptions:a});else{var l=Q(De(t.range));if(l[0]>n.usedRange.rowIndex||l[1]>n.usedRange.colIndex)return void i.reject("Select a cell or range inside the used range and try again.");l[0]===l[2]&&l[2]-l[0]==0&&(l[0]=0,l[1]=0,l[3]=n.usedRange.colIndex),l[2]=n.usedRange.rowIndex,l[0]=l[0]+1;var h=z(l);Zt(this.parent,n.name+"!"+h,!0,!0,null,null,null,null,!1).then(function(p){var c=new re.hm(p);r.setFilter(c,a.predicates,t.range,e.refresh),i.resolve({range:h,filterOptions:a})})}},s.prototype.setFilter=function(e,r,t,i){var n=this;if(e&&r){var a=e.dataSource.json,o=new re.AE;r.length&&o.where(re.$G.and(r));var p,c,l=e.executeLocal(o),h="__rowIndex";if(t.indexOf("!")>-1?(c=ee(this.parent,t.split("!")[0]),p=this.parent.sheets[c]):(p=this.parent.getActiveSheet(),c=ee(this.parent,p.name)),"spreadsheet"===this.parent.getModuleName()){var u,v,d=this.parent;if(d.scrollSettings.enableVirtualization&&a.length>d.viewport.rowCount+2*d.getThreshold("row")||p.frozenRows||p.frozenColumns||i){a.forEach(function(y){u=l.indexOf(y)<0,dt(p,Number(y[h])-1,{hidden:u,isFiltered:u})}),v=c===d.activeSheetIndex;var g=A(p.paneTopLeftCell);this.parent.updateTopLeftCell(U(p,g[0],!0)-this.parent.frozenRowCount(p),null,"col")}else a.forEach(function(y){if(u=l.indexOf(y)<0,v)dt(p,Number(y[h])-1,{hidden:u,isFiltered:u});else{var C={startIndex:Number(y[h])-1,hide:u,isFiltering:!0,sheetIndex:c};C.endIndex=C.startIndex,n.parent.notify(je,C),v=C.refreshUI}});v&&d.renderModule.refreshSheet(!1,!1,!0)}else{var m;a.forEach(function(y){m=l.indexOf(y)<0,dt(p,Number(y[h])-1,{hidden:m,isFiltered:m})})}}},s.prototype.getModuleName=function(){return"workbookFilter"},s}(),Bn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.setImage=function(e){var o,r=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,t=e.range&&e.range.indexOf("!")>0?ee(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,i=A(r),n=(0,f.o8)(t)?this.parent.getActiveSheet():this.parent.sheets[t],a=E(i[0],i[1],n),l=e.options;if(a&&a.image){o=a.image;for(var h=0;h<l.length;h++)o.push(l[h])}ce(i[0],i[1],n,{image:a&&a.image?o:l},!0)},s.prototype.addEventListener=function(){this.parent.on(wn,this.setImage,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(wn,this.setImage)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"workbookImage"},s}(),Hn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.addEventListener=function(){this.parent.on(lr,this.setChartHandler,this),this.parent.on(Kr,this.refreshChartData,this),this.parent.on(xn,this.deleteChartColl,this),this.parent.on($r,this.refreshChartSize,this),this.parent.on(lo,this.focusChartBorder,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(lr,this.setChartHandler),this.parent.off(Kr,this.refreshChartData),this.parent.off(xn,this.deleteChartColl),this.parent.off($r,this.refreshChartSize),this.parent.off(lo,this.focusChartBorder))},s.prototype.setChartHandler=function(e){var r=0;e.isInitCell=!(0,f.le)(e.isInitCell)&&e.isInitCell,e.isUndoRedo=!!(0,f.le)(e.isUndoRedo)||e.isUndoRedo,e.isPaste=!(0,f.le)(e.isPaste)&&e.isPaste;var t=e.chart;if(t.length>0)for(;r<t.length;){if(!1===e.isCut&&document.getElementById(e.chart[r].id)&&(t[r]={range:t[r].range,id:(0,f.QI)("e_spreadsheet_chart"),isSeriesInRows:t[r].isSeriesInRows,theme:t[r].theme,type:t[r].type}),document.getElementById(e.chart[r].id))return;if(t[r].theme=t[r].theme||"Material",t[r].type=t[r].type||"Line",t[r].isSeriesInRows=t[r].isSeriesInRows||!1,t[r].range=t[r].range||this.parent.getActiveSheet().selectedRange,t[r].range.indexOf("!")<0&&(t[r].range=this.parent.getActiveSheet().name+"!"+t[r].range),(0,f.le)(t[r].id)&&(t[r].id=(0,f.QI)("e_spreadsheet_chart")),t[r].height=t[r].height||290,t[r].width=t[r].width||480,this.parent.notify(Zr,{option:t[r],isInitCell:e.isInitCell,triggerEvent:e.isUndoRedo,dataSheetIdx:e.dataSheetIdx,range:e.range,isPaste:e.isPaste}),this.parent.chartColl.push(t[r]),!e.isInitCell||e.isPaste){var i=t[r].range&&t[r].range.indexOf("!")>0?ee(this.parent,t[r].range.split("!")[0]):this.parent.activeSheetIndex,n=A(e.isPaste?e.range:t[r].range),a=(0,f.o8)(i)?this.parent.getActiveSheet():this.parent.sheets[i],o=E(n[0],n[1],a);o&&o.chart?o.chart.push(t[r]):ce(n[0],n[1],a,{chart:[t[r]]},!0)}r++}},s.prototype.refreshChartData=function(e){if(this.parent.chartColl&&this.parent.chartColl.length)for(var r,t,i,a=0,o=this.parent.chartColl.length;a<o;a++){if((r=this.parent.chartColl[a]).range.includes("!")){if(t=r.range.split("!"),this.parent.activeSheetIndex!==ee(this.parent,t[0]))continue;i=t[1]}else i=r.range;(e.range?Gl([e.range],i):e.showHide?this.inRowColumnRange(A(i),e.rIdx,e.showHide):Ht(A(i),e.rIdx,e.cIdx))&&this.parent.notify(so,{chart:r})}},s.prototype.inRowColumnRange=function(e,r,t){return"rows"===t?r>=e[0]&&r<=e[2]:r>=e[1]&&r<=e[3]},s.prototype.refreshChartSize=function(e){for(var r,t=1,i=this.parent.sheets.length+1;t<i;){var n=this.parent.chartColl;if(r=n?n.length:0)for(;r--;){var a=this.parent.chartColl[r];if(!(0,f.le)(e.overlayEle.querySelector("#"+a.id))){var o=this.parent.element.querySelector("."+a.id),l=(0,f.Xr)(o,"chart");l&&(l.height=e.height,l.width=e.width)}}t++}},s.prototype.focusChartBorder=function(e){for(var r=0;r<this.parent.chartColl.length;r++){var t=document.getElementById(e.id),i=document.getElementById(this.parent.chartColl[r].id);t&&i&&(0,f.oq)(i,"."+t.classList[1])===t&&this.parent.notify(Zr,{option:this.parent.chartColl[r],isRefresh:!0})}},s.prototype.deleteChartColl=function(e){for(var r=0;r<this.parent.chartColl.length;r++)this.parent.chartColl[r].id+"_overlay"===e.id&&this.parent.chartColl.splice(r,1)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"workbookChart"},s}(),Pn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.format=function(e){var t,r=this,i=e.range;i&&"string"==typeof i&&i.indexOf("!")>-1?(i=i.split("!")[1],t=this.parent.sheets[ee(this.parent,e.range.split("!")[0])]):t=this.parent.getActiveSheet(),void 0===i&&(i=t.selectedRange);var n="object"!=typeof i&&e.onActionUpdate,a={range:i,style:Object.assign({},e.style),requestType:"CellFormat"};e.borderType&&(a.borderType=e.borderType);var o={};if(Object.assign(o,a.style,null,!0),n&&(this.parent.trigger("beforeCellFormat",a),this.parent.notify("actionBegin",{eventArgs:a,action:"format"}),a.cancel))e.cancel=!0;else{var l="object"==typeof a.range?a.range:Q(A(a.range));e.borderType&&(this.setTypedBorder(t,e.style.border,l,e.borderType,e.onActionUpdate),delete e.style.border,delete a.style.border);var h,p,y,C,b,c={cell:null,rowIdx:0,colIdx:0,eventOnly:!0,preventEvt:!n},d=function(V){return c.cell={style:V},c.rowIdx=h,c.colIdx=p,Je(r.parent,t,c)};if(void 0!==a.style.borderTop){for(p=l[1];p<=l[3];p++)h=l[0],d({borderTop:a.style.borderTop})||(this.checkAdjacentBorder(t,"borderBottom",h-1,p),this.checkFullBorder(t,"borderBottom",h-1,p),this.checkFullBorder(t,"borderTop",h,p),this.setCellBorder(t,c.cell.style,h,p,e.onActionUpdate,p===l[3]));delete a.style.borderTop}if(void 0!==a.style.borderBottom){var u=void 0,v=void 0;for(p=l[1];p<=l[3];p++)u=E(h=l[0],p,t,!1,!0),v=E(l[2],u.rowSpan>0?l[1]:l[3],t,!1,!0),u.rowSpan>1&&v.rowSpan<0||(h=l[2]),d({borderBottom:a.style.borderBottom})||(this.checkAdjacentBorder(t,"borderTop",l[2]+1,p),this.checkFullBorder(t,"borderTop",l[2]+1,p),this.checkFullBorder(t,"borderBottom",l[2],p),this.setCellBorder(t,c.cell.style,h,p,e.onActionUpdate,p===l[3]),this.setBottomBorderPriority(t,l[2],p));delete a.style.borderBottom}if(void 0!==a.style.borderLeft){for(var g=l[0];g<=l[2];g++)p=l[1],d({borderLeft:a.style.borderLeft})||(this.checkAdjacentBorder(t,"borderRight",g,p-1),this.checkFullBorder(t,"borderRight",g,p-1),this.checkFullBorder(t,"borderLeft",g,p),this.setCellBorder(t,c.cell.style,g,p,e.onActionUpdate));delete a.style.borderLeft}if(void 0!==a.style.borderRight){for(var m=l[0];m<=l[2];m++)p=l[3],d({borderRight:a.style.borderRight})||(this.checkAdjacentBorder(t,"borderLeft",m,p+1),this.checkFullBorder(t,"borderLeft",m,p+1),this.checkFullBorder(t,"borderRight",m,p),this.setCellBorder(t,c.cell.style,m,p,e.onActionUpdate));delete a.style.borderRight}if(Object.keys(a.style).length){var S=this.parent,w=S.viewport&&this.parent.getActiveSheet().id===t.id,x=this.parent.frozenRowCount(t),I=this.parent.frozenColCount(t),F=[x+S.viewport.topIndex,I+S.viewport.leftIndex,S.viewport.bottomIndex,S.viewport.rightIndex],T=void 0,k=void 0,R=void 0;for(h=l[0];h<=l[2];h++)if(!(k=vr(t,h)||{}).isFiltered)for(T=h>=F[0]&&h<=F[2]||h<x,R=!1,p=l[1];p<=l[3];p++)if(!d(a.style)){if(void 0===C&&(void 0!==a.style.border?(y=a.style.border,delete a.style.border,C=!0):C=!1),(b=E(h,p,t,!1,!0)).rowSpan>1||b.colSpan>1)for(var D=h,N=b.rowSpan>1?h+(b.rowSpan-1):h;D<=N;D++)for(var P=p,M=b.colSpan>1?p+(b.colSpan-1):p;P<=M;P++)C&&this.setFullBorder(t,y,l,D,P,e.onActionUpdate,!0),this.setCellStyle(t,D,P,a.style);C&&this.setFullBorder(t,y,l,h,p,e.onActionUpdate),this.setCellStyle(t,h,p,a.style),w&&(T&&(p>=F[1]&&p<=F[3]||p<I)?this.parent.notify(He,{style:a.style,rowIdx:h,colIdx:p,lastCell:p===l[3],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:e.onActionUpdate}):k.customHeight||(R=R||ws(a.style,e.onActionUpdate))&&this.parent.notify(He,{rowIdx:h,colIdx:p,lastCell:p===l[3],checkHeight:!0,outsideViewport:!T,onActionUpdate:e.onActionUpdate}))}}C&&(a.style.border=y),this.parent.setUsedRange(l[2],l[3]),e.refreshRibbon&&this.parent.notify(St,null),n&&(a.style=o,a.range=t.name+"!"+i,this.parent.notify("actionComplete",{eventArgs:a,action:"format"}))}},s.prototype.setBottomBorderPriority=function(e,r,t){if(ne(e,r+1)){var i=this.skipHiddenRows(e,r+1);""!==this.parent.getCellStyleValue(["borderTop"],[i,t]).borderTop&&(e.rows[r].cells[t].style.bottomPriority=!0)}},s.prototype.setFullBorder=function(e,r,t,i,n,a,o){var l={};i===t[0]&&(this.checkAdjacentBorder(e,"borderBottom",i-1,n),this.checkFullBorder(e,"borderBottom",i-1,n)),n===t[1]&&(this.checkAdjacentBorder(e,"borderRight",i,n-1),this.checkFullBorder(e,"borderRight",i,n-1)),n===t[3]?(this.checkAdjacentBorder(e,"borderLeft",i,n+1),this.checkFullBorder(e,"borderLeft",i,n+1)):this.checkAdjacentBorder(e,"border",i,n+1),l.borderRight=r,l.borderTop=r,l.borderLeft=r,l.borderBottom=r,this.setCellBorder(e,l,i,n,a,n===t[3],null,o),i===t[2]?(this.checkAdjacentBorder(e,"borderTop",i+1,n),this.checkFullBorder(e,"borderTop",i+1,n),this.setBottomBorderPriority(e,i,n)):this.checkAdjacentBorder(e,"border",i+1,n)},s.prototype.checkAdjacentBorder=function(e,r,t,i){var n={};""!==this.parent.getCellStyleValue([r],[t,i])[r]&&(n[r]=void 0,this.setCellStyle(e,t,i,n))},s.prototype.checkFullBorder=function(e,r,t,i){var n=this.parent.getCellStyleValue(["border"],[t,i]).border;if(""!==n){var a={border:void 0};["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(o){o!==r&&(a[o]=n)}),this.setCellStyle(e,t,i,a)}},s.prototype.textDecorationActionUpdate=function(e){var r=this.parent.getActiveSheet(),t={range:r.selectedRange,style:e.style,requestType:"CellFormat"};if(this.parent.trigger("beforeCellFormat",t),this.parent.notify("actionBegin",{eventArgs:t,action:"format"}),t.cancel)e.cancel=!0;else{var h,i=Q(A(r.selectedRange)),n=e.style.textDecoration,a=n,o=A(r.activeCell),l=this.parent.getCellStyleValue(["textDecoration"],o).textDecoration,p=!1;"underline"===l?a="underline"===n?"none":"underline line-through":"line-through"===l?a="line-through"===n?"none":"underline line-through":"underline line-through"===l&&(a="underline"===n?"line-through":"underline",p=!0),"none"===a&&(p=!0),this.format({style:{textDecoration:a},range:o,refreshRibbon:e.refreshRibbon,onActionUpdate:!0});for(var c=i[0];c<=i[2];c++)for(var d=i[1];d<=i[3];d++)if(c!==o[0]||d!==o[1]){if(h={},"none"===(l=this.parent.getCellStyleValue(["textDecoration"],[c,d]).textDecoration)){if(p)continue;h.textDecoration=n}else if("underline"===l||"line-through"===l)if(p){if(n!==l)continue;h.textDecoration="none"}else h.textDecoration=n!==l?"underline line-through":n;else if("underline line-through"===l){if(!p)continue;h.textDecoration="underline"===n?"line-through":"underline"}this.format({style:h,range:[c,d,c,d],refreshRibbon:e.refreshRibbon,onActionUpdate:!0})}t.range=r.name+"!"+t.range,t.style.textDecoration=a,this.parent.notify("actionComplete",{eventArgs:t,action:"format"})}},s.prototype.setTypedBorder=function(e,r,t,i,n){var a;if("Outer"===i){for(var o=t[1];o<=t[3];o++)this.checkAdjacentBorder(e,"borderBottom",t[0]-1,o),this.checkFullBorder(e,"borderBottom",t[0]-1,o),this.setCellBorder(e,{borderTop:r},t[0],o,n,o===t[3]),this.checkAdjacentBorder(e,"borderTop",t[2]+1,o),this.checkFullBorder(e,"borderTop",t[2]+1,o),this.setCellBorder(e,{borderBottom:r},t[2],o,n,o===t[3],i),this.setBottomBorderPriority(e,t[2],o);for(var l=t[0];l<=t[2];l++)this.checkAdjacentBorder(e,"borderRight",l,t[1]-1),this.checkFullBorder(e,"borderRight",l,t[1]-1),this.setCellBorder(e,{borderLeft:r},l,t[1],n),this.checkAdjacentBorder(e,"borderLeft",l,t[3]+1),this.checkFullBorder(e,"borderLeft",l,t[3]+1),this.setCellBorder(e,{borderRight:r},l,t[3],n,null,i)}else if("Inner"===i)for(var h=t[0];h<=t[2];h++)for(var p=t[1];p<=t[3];p++){var c={};""!==(a=this.parent.getCellStyleValue(["border"],[h,p]).border)&&(c.border=void 0,(p===t[3]||p===t[1]||h===t[0]||h===t[2])&&(h===t[0]&&(c.borderTop=a),h===t[2]&&(c.borderBottom=a),p===t[3]&&(c.borderRight=a),p===t[1]&&(c.borderLeft=a))),p!==t[3]&&(c.borderRight=r),h!==t[0]&&(c.borderTop=r),h!==t[2]&&(c.borderBottom=r),p!==t[1]&&(c.borderLeft=r),this.setCellBorder(e,c,h,p,n,p===t[3])}else if("Vertical"===i)for(h=t[0];h<=t[2];h++)for(p=t[1];p<=t[3];p++)c={borderRight:r,borderLeft:r},p===t[1]&&(this.checkAdjacentBorder(e,"borderRight",h,p-1),this.checkFullBorder(e,"borderRight",h,p-1)),p===t[3]&&(this.checkAdjacentBorder(e,"borderLeft",h,p+1),this.checkFullBorder(e,"borderLeft",h,p+1)),this.setCellBorder(e,c,h,p,n);else for(h=t[0];h<=t[2];h++)for(p=t[1];p<=t[3];p++)c={borderTop:r,borderBottom:r},h===t[0]&&(this.checkAdjacentBorder(e,"borderBottom",h-1,p),this.checkFullBorder(e,"borderBottom",h-1,p)),this.setCellBorder(e,c,h,p,n,p===t[3]),h===t[2]&&(this.checkAdjacentBorder(e,"borderTop",h+1,p),this.checkFullBorder(e,"borderTop",h+1,p),this.setBottomBorderPriority(e,h,p))},s.prototype.setCellBorder=function(e,r,t,i,n,a,o,l){if(this.setCellStyle(e,t,i,r),!l&&this.parent.getActiveSheet().id===e.id){if("Outer"===o&&(r.borderBottom||r.borderRight)){var h={range:[t,i,t,i]};this.parent.notify(Ne,h),t=h.range[0],i=h.range[1]}this.parent.notify(He,{style:r,rowIdx:t,colIdx:i,onActionUpdate:n,first:"",lastCell:a,isHeightCheckNeeded:!0,manualUpdate:!0})}},s.prototype.setCellStyle=function(e,r,t,i){e.rows[r]?e.rows[r].cells||(e.rows[r].cells=[]):e.rows[r]={cells:[]},e.rows[r].cells[t]||(e.rows[r].cells[t]={}),e.rows[r].cells[t].style||(e.rows[r].cells[t].style={}),Object.assign(e.rows[r].cells[t].style,i,null,!0)},s.prototype.skipHiddenRows=function(e,r){return ne(e,++r)&&(r=this.skipHiddenRows(e,r)),r},s.prototype.addEventListener=function(){this.parent.on(ye,this.format,this),this.parent.on(Vr,this.textDecorationActionUpdate,this),this.parent.on(wr,this.clearCellObj,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(ye,this.format),this.parent.off(Vr,this.textDecorationActionUpdate),this.parent.off(wr,this.clearCellObj))},s.prototype.clearCellObj=function(e){for(var p,c,d,u,v,r=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,t=e.range&&e.range.indexOf("!")>0?ee(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,i=_(this.parent,t),n=Q(De(r)),a=n[0],o=n[2],l=i.conditionalFormats&&i.conditionalFormats.length&&[].slice.call(i.conditionalFormats),h=[];a<=o;a++)for(d=n[1],u=n[3];d<=u;d++){var g=E(a,d,i);if(g)switch(e.type){case"Clear Formats":delete g.format,delete g.rowSpan,delete g.style,delete g.wrap,delete g.colSpan;break;case"Clear Contents":g.hyperlink&&this.parent.notify(In,{sheet:i,rowIdx:a,colIdx:d,preventRefresh:!0}),v=!(!g.value&&!g.formula),delete g.value,delete g.formula,v&&(this.parent.notify(ie,c={action:"refreshCalculate",rowIndex:a,colIndex:d,sheetIndex:t}),l&&!p&&((p=c.isFormulaDependent)||Ki(l,h,a,d)));break;case"Clear Hyperlinks":delete g.hyperlink;break;case"Clear All":v=!(!g.value&&!g.formula),ce(a,d,i,{},!1),v&&(this.parent.notify(ie,c={action:"refreshCalculate",rowIndex:a,colIndex:d,sheetIndex:t}),l&&!p&&(p=c.isFormulaDependent))}}(h.length||p)&&t===this.parent.activeSheetIndex&&this.parent.notify(We,{cfModel:!p&&h,refreshAll:p,isAction:!0})},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"workbookcellformat"},s}(),Vn=function(){function s(e){this.parent=e,this.localeObj=(0,f.NE)(this.parent.locale),this.decimalSep=this.localeObj.decimal,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(Sr,this.performEditOperation,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Sr,this.performEditOperation)},s.prototype.getModuleName=function(){return"workbookEdit"},s.prototype.performEditOperation=function(e){"updateCellValue"===e.action&&(e.isFormulaDependent=this.updateCellValue(e.address,e.value,e.sheetIndex,e.isValueOnly,e.formula))},s.prototype.checkDecimalPoint=function(e,r){if(Number(e)){var t=e.toString().indexOf(this.decimalSep)+1,i=e.toString().substr(t).length<=6;e=i?!r||r.includes("RANDBETWEEN")?t<7?e:parseFloat(e).toFixed(0):e.toString().length<11?e:t<11?parseFloat(e).toFixed(9-t+2):parseFloat(e).toFixed(0):t>7?parseFloat(e).toFixed(0):parseFloat(e).toFixed(6-t+2)}return e},s.prototype.updateCellValue=function(e,r,t,i,n){var a,o;void 0===t&&(t=this.parent.activeSheetIndex),a="string"==typeof e?A(e):e;var l=_(this.parent,t),h=E(a[0],a[1],l,!0);if(h||(h=l.rows[a[0]].cells[a[1]]={}),i)r&&r.toString().indexOf(this.decimalSep)>-1&&(r=this.checkDecimalPoint(r,n)),h.value=r;else{var c=pe(r);c="#SPILL!"===r||c;var d=!1;h.formula&&h.formula.indexOf("UNIQUE")>-1&&""===r&&(d=!0);var u="Text"!==Ft(h.format);!c&&!d&&(h.formula&&(h.formula=""),h.value=u?Pr(r):r);var v={action:"refreshCalculate",value:r,rowIndex:a[0],colIndex:a[1],sheetIndex:t,isFormula:c};if(u){var g={value:r,rowIndex:a[0],colIndex:a[1],sheetIndex:t,updatedVal:""};this.parent.notify(Tt,g),!(0,f.le)(g.updatedVal)&&g.updatedVal.length>0&&(h.value=g.updatedVal)}"#SPILL!"===r?h.value=r:(this.parent.notify(At,{cellIdx:a,isUnique:!1}),d?r=h.value:(this.parent.notify(ie,v),o=v.isFormulaDependent),c?(h.formula=v.value,r=h.value,"=NOW()"===h.formula&&"M/d/yyyy h:mm"!==h.format&&(h.format="M/d/yyyy h:mm")):h.value&&"string"==typeof h.value&&(0===h.value.indexOf("www.")||0===h.value.indexOf("https://")||0===h.value.indexOf("http://")||0===h.value.indexOf("ftp://"))&&this.parent.notify(_r,{hyperlink:h.value,cell:l.name+"!"+j(a[0],a[1])}))}return this.parent.setUsedRange(a[0],a[1],l),this.parent.chartColl.length&&this.parent.notify(Kr,{cell:h,rIdx:a[0],cIdx:a[1],sheetIdx:t}),o},s}(),qn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(_r,this.setLinkHandler,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(_r,this.setLinkHandler)},s.prototype.setLinkHandler=function(e){var i,r=e.hyperlink,t=e.cell;if(t&&-1!==t.indexOf("!")){var n=t.split("!");if(i=_(this.parent,ee(this.parent,n[0])),t=n[1],!i)return}else i=this.parent.getActiveSheet(),t=t||i.selectedRange;var a=Q(A(t));"string"==typeof r?0===r.toLowerCase().indexOf("www.")&&(r="http://"+r):0===r.address.toLowerCase().indexOf("www.")&&(r.address="http://"+r.address);for(var o,l=A(i.activeCell),h=a[0];h<=a[2];h++)for(var p=a[1];p<=a[3];p++)o={hyperlink:r},e.displayText&&(e.triggerEvt?h===l[0]&&p===l[1]&&(o.value=e.displayText):(0,f.le)(E(h,p,i,!1,!0).value)&&(o.value=e.displayText)),o.style={textDecoration:"underline",color:"#00e"},Je(this.parent,i,{cell:o,rowIdx:h,colIdx:p,preventEvt:!e.triggerEvt})},s.prototype.getModuleName=function(){return"workbookHyperlink"},s}(),Un=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.insertModel=function(e){var t,i,n,a,r=this;if("Column"===e.modelType){if("number"==typeof e.start)for(var o=0;o<=this.parent.getActiveSheet().usedRange.rowIndex+1;o++)if(this.parent.notify(At,l={cellIdx:[o,e.start],isUnique:!1}),l.isUnique)return}else if("Row"===e.modelType&&"number"==typeof e.start)for(var h=0;h<=this.parent.getActiveSheet().usedRange.colIndex+1;h++){var l;if(this.parent.notify(At,l={cellIdx:[e.start,h],isUnique:!1}),l.isUnique)return}if(e.model){var p,d,u,v,c=[];if("number"==typeof e.start)for(p=e.start,e.end=e.end||p,p>e.end&&(p=e.end,e.end=e.start),"Row"===e.modelType&&p<e.model.maxHgts.length&&(v=[]),o=p;o<=e.end;o++)c.push({}),v&&v.push(null);else e.start?(p=e.start[0].index||0,c=e.start,u=!0):(p=0,c.push({})),"Row"===e.modelType&&p<e.model.maxHgts.length&&(v=[],c.forEach(function(){v.push(null)}));var g={model:c,index:p,modelType:e.modelType,insertType:e.insertType,cancel:!1,isUndoRedo:e.isUndoRedo},m={eventArgs:g,action:"insert"};if(e.isAction){if(this.parent.notify(ue,m),g.cancel)return;delete g.cancel,g.isAction=e.isAction}var y={startIndex:p,endIndex:p+c.length-1,modelType:e.modelType,sheet:e.model,isInsert:!0};if("Row"===e.modelType){if(void 0!==e.checkCount&&e.model.rows&&e.checkCount===e.model.rows.length)return;if(this.parent.notify(hr,y),e.model=e.model,e.model.rows||(e.model.rows=[]),u&&e.model.usedRange.rowIndex>-1&&p>e.model.usedRange.rowIndex)for(o=e.model.usedRange.rowIndex;o<p-1;o++)c.splice(0,0,{});var C=this.parent.frozenRowCount(e.model);p<C&&(this.parent.setSheetPropertyOnMute(e.model,"frozenRows",e.model.frozenRows+c.length),g.freezePane=!0),(t=e.model.rows).splice.apply(t,[p,0].concat(c)),v&&(i=e.model.maxHgts).splice.apply(i,[p,0].concat(v)),this.setRowColCount(y.startIndex,y.endIndex,e.model,"row"),this.parent.setUsedRange(p>e.model.usedRange.rowIndex?p+(c.length-1):e.model.usedRange.rowIndex+c.length,e.model.usedRange.colIndex,e.model,!0);var S,b=p+c.length,w=void 0,x=function(M){e.model.rows[b]&&e.model.rows[b].cells&&e.model.rows[b].cells[M]&&(void 0!==(w=e.model.rows[b].cells[M]).rowSpan&&w.rowSpan<0&&void 0===w.colSpan&&I.parent.notify(Sn,{range:[b,M,b,M],insertCount:c.length,insertModel:"Row"}),w.style&&E(p-1,M,e.model,!1,!0).style&&(S=I.checkBorder(w.style,e.model.rows[p-1].cells[M].style))!=={}&&c.forEach(function(V){V.cells||(V.cells=[]),V.cells[M]||(V.cells[M]={}),V.cells[M].style||(V.cells[M].style={}),Object.assign(V.cells[M].style,S)}))},I=this;for(o=0;o<=e.model.usedRange.colIndex;o++)x(o);g.sheetCount=e.model.rows.length}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.model.columns&&e.checkCount===e.model.columns.length)return;this.parent.notify(hr,y),e.model=e.model,e.model.columns||(e.model.columns=[]),p&&!e.model.columns[p-1]&&(e.model.columns[p-1]={}),(n=e.model.columns).splice.apply(n,[p,0].concat(c));var F=this.parent.frozenColCount(e.model);p<F&&(this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",e.model.frozenColumns+c.length),g.freezePane=!0),this.setRowColCount(y.startIndex,y.endIndex,e.model,"col"),this.parent.setUsedRange(e.model.usedRange.rowIndex,p>e.model.usedRange.colIndex?p+(c.length-1):e.model.usedRange.colIndex+c.length,e.model,!0),e.model.rows||(e.model.rows=[]);var T=[];for(e.columnCellsModel||(e.columnCellsModel=[]),o=0;o<c.length;o++)T.push(null);d=[],w=void 0;var k=void 0;for(o=0;o<=e.model.usedRange.rowIndex;o++)if(e.model.rows[o]?e.model.rows[o].cells||(e.model.rows[o].cells=[]):e.model.rows[o]={cells:[]},p&&!e.model.rows[o].cells[p-1]&&(e.model.rows[o].cells[p-1]={}),(a=e.model.rows[o].cells).splice.apply(a,[p,0].concat(e.columnCellsModel[o]&&e.columnCellsModel[o].cells?e.columnCellsModel[o].cells:T)),e.model.rows[o].cells[b=p+c.length]&&(void 0!==(w=e.model.rows[o].cells[b]).colSpan&&w.colSpan<0&&void 0===w.rowSpan&&d.push({range:[o,b,o,b],insertCount:T.length,insertModel:"Column"}),w.style&&E(o,p-1,e.model,!1,!0).style&&(k=this.checkBorder(w.style,e.model.rows[o].cells[p-1].style))!=={}))for(h=p;h<b;h++)e.model.rows[o].cells[h]||(e.model.rows[o].cells[h]={}),e.model.rows[o].cells[h].style||(e.model.rows[o].cells[h].style={}),Object.assign(e.model.rows[o].cells[h].style,k);d.forEach(function(V){r.parent.notify(Sn,V)}),g.sheetCount=e.model.columns.length}else{if(void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;var P,R=c,D=pt(this.parent),N=e.isFromUpdateAction;for(o=0;o<R.length;o++)if(R[o].name)for(h=0;h<this.parent.sheets.length;h++)if(R[o].name===this.parent.sheets[h].name){R.splice(o,1),o--;break}if(!R.length)return;delete c[0].index,this.parent.createSheet(p,c),e.activeSheetIndex?(g.activeSheetIndex=e.activeSheetIndex,this.parent.setProperties({activeSheetIndex:e.activeSheetIndex},!0)):!e.isAction&&e.start<this.parent.activeSheetIndex&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),N&&this.parent.setProperties({activeSheetIndex:ee(this.parent,D)},!0),c.forEach(function(M){u&&r.updateRangeModel(M.ranges),r.parent.notify(ie,{action:"addSheet",visibleName:M.name,sheetName:"Sheet"+(P=M.id),sheetId:P})}),g.activeSheetIndex=e.activeSheetIndex,g.sheetCount=this.parent.sheets.length}"Sheet"!==e.modelType&&(this.insertConditionalFormats(e),this.parent.notify(Tn,{start:p,end:p+c.length-1,modelType:e.modelType,model:e.model,isInsert:!0}),g.activeSheetIndex=ee(this.parent,e.model.name)),this.parent.notify(Qa,m)}},s.prototype.setRowColCount=function(e,r,t,i){var n=i+"Count";this.parent.setSheetPropertyOnMute(t,n,t[n]+(r-e+1)),t.id===this.parent.getActiveSheet().id&&this.parent.notify(qr,{index:t[n]-1,update:i,isInsert:!0,start:e,end:r})},s.prototype.updateRangeModel=function(e){e.forEach(function(r){r.dataSource&&(r.startCell=r.startCell||"A1",r.showFieldAsHeader=void 0===r.showFieldAsHeader||r.showFieldAsHeader,r.template=r.template||"",r.address=r.address||"A1")})},s.prototype.checkBorder=function(e,r){var t={};return e.borderLeft&&e.borderLeft===r.borderLeft&&(t.borderLeft=e.borderLeft),e.borderRight&&e.borderRight===r.borderRight&&(t.borderRight=e.borderRight),e.borderTop&&e.borderTop===r.borderTop&&(t.borderTop=e.borderTop),e.borderBottom&&e.borderBottom===r.borderBottom&&(t.borderBottom=e.borderBottom),t},s.prototype.setInsertInfo=function(e,r,t,i,n){void 0===n&&(n="Row");var a=t=r+(t-1);e.ranges.forEach(function(o){o.info&&r<o.info[i]&&(o.info["insert"+n+"Range"]?o.info["insert"+n+"Range"].push([r,a]):o.info["insert"+n+"Range"]=[[r,a]],o.info[i]+=a-r+1)})},s.prototype.insertConditionalFormats=function(e){var r=e.model.conditionalFormats;if("delete"===e.prevAction)this.parent.setSheetPropertyOnMute(e.model,"conditionalFormats",e.conditionalFormats);else if(r)for(var t=0,i=r.length;t<i;t++)r[t].range=z(tp(e,A(r[t].range),!e.isAction&&!e.isUndoRedo))},s.prototype.addEventListener=function(){this.parent.on(wt,this.insertModel,this)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(wt,this.insertModel)},s.prototype.getModuleName=function(){return"workbookinsert"},s}(),mo=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.deleteModel=function(e){var r=this;if("Sheet"!==e.modelType||1!==this.parent.sheets.length){if("Column"===e.modelType){if("number"==typeof e.start)for(var i=0;i<=this.parent.getActiveSheet().usedRange.rowIndex+1;i++)if(this.parent.notify(At,n={cellIdx:[i,e.start],isUnique:!1}),n.isUnique)return}else if("Row"===e.modelType&&"number"==typeof e.start)for(var a=0;a<=this.parent.getActiveSheet().usedRange.colIndex+1;a++){var n;if(this.parent.notify(At,n={cellIdx:[e.start,a],isUnique:!1}),n.isUnique)return}var o=e.modelType.toLowerCase()+"s";if(e.start=e.start,e.start>e.end){var l=e.start;e.start=e.end,e.end=l}var h={startIndex:e.start,endIndex:e.end,modelType:e.modelType,cancel:!1,isUndoRedo:e.isUndoRedo},p={eventArgs:h,action:"delete"};if(!e.isAction||(this.parent.notify(ue,p),!h.cancel)){var c,d,u=[],v=e.end-e.start+1,g={startIndex:e.start,endIndex:e.end,modelType:e.modelType,sheet:e.model},m=this.parent.scrollSettings.isFinite;if("Row"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.rowIndex)return;if(this.parent.notify(hr,g),e.model=e.model,m){if(e.start>=e.model.rowCount)return;e.end>=e.model.rowCount&&(e.end=e.model.rowCount-1)}else{if(e.start>e.model.usedRange.rowIndex)return;e.end>e.model.usedRange.rowIndex&&(e.end-=e.end-e.model.usedRange.rowIndex)}this.setRowColCount(e.start,e.end,e.model,"row"),e.start<=e.model.usedRange.rowIndex&&(e.model.usedRange.rowIndex-=e.end-e.start+1,e.model.usedRange.rowIndex<0&&(e.model.usedRange.rowIndex=0));var y=this.parent.frozenRowCount(e.model);e.start<y&&(this.parent.setSheetPropertyOnMute(e.model,"frozenRows",y=e.model.frozenRows-(y=e.end<y?e.end-e.start+1:y-e.start)),h.freezePane=!0);var C=e.end+1,b=void 0,S=void 0;if(e.model.rows[e.start]&&e.model.rows[e.start].cells)for(a=0;a<=e.model.usedRange.colIndex;a++)e.model.rows[e.start].cells[a]&&void 0!==e.model.rows[e.start].cells[a].rowSpan&&e.model.rows[e.start].cells[a].rowSpan<0&&void 0===e.model.rows[e.start].cells[a].colSpan&&(this.parent.notify(Ne,S={range:[e.start,a,e.start,a]}),S.range=S.range,S.range[2]<=e.end&&((d=E(S.range[0],a,e.model))&&d.rowSpan>1&&(d.rowSpan-(S.range[2]-e.start+1)>1?ce(S.range[0],a,e.model,{colSpan:d.rowSpan-(S.range[2]-e.start+1)},!0):delete e.model.rows[S.range[0]].cells[a].rowSpan),S=null)),e.model.rows[C]&&e.model.rows[C].cells&&e.model.rows[C].cells[a]&&void 0!==e.model.rows[C].cells[a].rowSpan&&e.model.rows[C].cells[a].rowSpan<0&&void 0===e.model.rows[C].cells[a].colSpan&&(S||this.parent.notify(Ne,S={range:[C,a,C,a]}),b=new Object,S.range=S.range,Object.assign(b,E(S.range[0],S.range[1],e.model)),b&&b.rowSpan&&(b.rowSpan>1||b.colSpan>1))&&((w=[])[1]=a,w[3]=b.colSpan>1?a+(b.colSpan-1):a,S.range=S.range,S.range[0]<e.start?(w[0]=w[2]=S.range[0],b.rowSpan-v>1&&(w[2]+=b.rowSpan-v-1)):(w[0]=w[2]=e.start,b.rowSpan-(e.end-S.range[0]+1)>1&&(w[2]+=b.rowSpan-(e.end-S.range[0]+1)-1)),u.push({range:w,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})),S=null;h.sheetCount=e.model.usedRange.rowIndex}else if("Column"===e.modelType){if(void 0!==e.checkCount&&e.checkCount===e.model.usedRange.colIndex)return;if(this.parent.notify(hr,g),e.model=e.model,m){if(e.start>=e.model.colCount)return;e.end>=e.model.colCount&&(e.end=e.model.colCount-1)}else{if(e.start>e.model.usedRange.colIndex)return;e.end>e.model.usedRange.colIndex&&(e.end-=e.end-e.model.usedRange.colIndex)}this.setRowColCount(e.start,e.end,e.model,"col"),e.start<=e.model.usedRange.colIndex&&(e.model.usedRange.colIndex-=v,e.model.usedRange.colIndex<0&&(e.model.usedRange.colIndex=0));var x=this.parent.frozenColCount(e.model);for(e.start<x&&(this.parent.setSheetPropertyOnMute(e.model,"frozenColumns",x=e.model.frozenColumns-(x=e.end<x?e.end-e.start+1:x-e.start)),this.parent.updateTopLeftCell(),h.freezePane=!0),c=[],C=e.end+1,b=void 0,S=void 0,a=0;a<=e.model.usedRange.rowIndex;a++)if(c.push({}),e.model.rows[a]&&e.model.rows[a].cells){if(e.model.rows[a].cells[e.start]&&void 0!==e.model.rows[a].cells[e.start].colSpan&&e.model.rows[a].cells[e.start].colSpan<0&&void 0===e.model.rows[a].cells[e.start].rowSpan&&(this.parent.notify(Ne,S={range:[a,e.start,a,e.start]}),S.range=S.range,S.range[3]<=e.end)){var I=E(a,S.range[1],e.model);I&&I.colSpan>1&&(I.colSpan-(S.range[3]-e.start+1)>1?ce(a,S.range[1],e.model,{colSpan:I.colSpan-(S.range[3]-e.start+1)},!0):delete e.model.rows[a].cells[S.range[1]].colSpan),S=null}var w;e.model.rows[a].cells[C]&&void 0!==e.model.rows[a].cells[C].colSpan&&e.model.rows[a].cells[C].colSpan<0&&void 0===e.model.rows[a].cells[C].rowSpan&&(S||this.parent.notify(Ne,S={range:[a,C,a,C]}),b=new Object,S.range=S.range,Object.assign(b,E(S.range[0],S.range[1],e.model)),b&&b.colSpan&&(b.colSpan>1||b.rowSpan>1))&&((w=[])[0]=a,w[2]=b.rowSpan>1?a+(b.rowSpan-1):a,S.range=S.range,S.range[1]<e.start?(w[1]=w[3]=S.range[1],b.colSpan-v>1&&(w[3]+=b.colSpan-v-1)):(w[1]=w[3]=e.start,b.colSpan-(e.end-S.range[1]+1)>1&&(w[3]+=b.colSpan-(e.end-S.range[1]+1)-1)),u.push({range:w,isAction:!1,preventRefresh:!0,merge:!0,type:"All",skipChecking:!0})),c[a].cells=e.model.rows[a].cells.splice(e.start,v),S=null}h.sheetCount=e.model.usedRange.colIndex,h.deletedCellsModel=c}else{if(e.end-e.start==this.parent.sheets.length-1||void 0!==e.checkCount&&e.checkCount===this.parent.sheets.length)return;h.sheetCount=this.parent.sheets.length,h.activeSheetIndex=this.parent.activeSheetIndex}var F=[],T="Row"===e.modelType&&e.start<e.model.maxHgts.length;for(a=e.start;a<=e.end;a++)"Sheet"===e.modelType&&e.model[o][a]&&this.parent.notify(ie,{action:"deleteSheetTab",sheetId:e.model[o][a].id}),e.model[o][e.start]||e.start<e.model[o].length?(F.push(e.model[o][e.start]||{}),e.model[o].splice(e.start,1)):F.push({}),a===e.start&&(F[0].index=e.start),T&&e.model.maxHgts.splice(e.start,1);u.forEach(function(k){return r.parent.notify(tt,k)}),this.parent.notify(Li,e),"Sheet"!==e.modelType&&(this.parent.notify(Tn,e),h.refreshSheet=e.refreshSheet,h.activeSheetIndex=ee(this.parent,e.model.name),h.conditionalFormats=[],this.deleteConditionalFormats(e,h)),h.definedNames=g.definedNames,h.isAction=e.isAction,h.deletedModel=F,delete h.cancel,this.parent.notify(Ja,p)}}},s.prototype.setRowColCount=function(e,r,t,i){var n=i+"Count";r>=t[n]&&(r=t[n]-1),!(r<e)&&(this.parent.setSheetPropertyOnMute(t,n,t[n]-(r-e+1)),t.id===this.parent.getActiveSheet().id&&this.parent.notify(qr,{index:t[n]-1,update:i,isDelete:!0,start:e,end:r}))},s.prototype.setDeleteInfo=function(e,r,t,i){void 0===i&&(i="Row");var n=r-e+1,a=[];this.parent.getActiveSheet().ranges.forEach(function(o){o.info&&e<o.info[t]&&(o.info["delete"+i+"Range"]?o.info["delete"+i+"Range"].push([e,r]):o.info["delete"+i+"Range"]=[[e,r]],o.info[t]-=n,o.info["insert"+i+"Range"]&&(o.info["insert"+i+"Range"]=a))})},s.prototype.deleteConditionalFormats=function(e,r){var t=e.model.conditionalFormats;if(t)for(var i=0;i<t.length;i++){r.conditionalFormats.push((0,f.l7)({},t[i],null,!0));var n=A(t[i].range),a=A(e.model.selectedRange);"Column"===e.modelType&&a[1]<=n[1]&&a[3]>=n[3]||"Row"===e.modelType&&a[0]<=n[0]&&a[2]>=n[2]?(t.splice(t.indexOf(t[i]),1),i--):t[i].range=z(rp(e,n))}},s.prototype.addEventListener=function(){this.parent.on(Fi,this.deleteModel,this)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Fi,this.deleteModel)},s.prototype.getModuleName=function(){return"workbookdelete"},s}(),zn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(sr,this.validationHandler,this),this.parent.on(Wr,this.addHighlightHandler,this),this.parent.on(io,this.removeHighlightHandler,this),this.parent.on(Di,this.beforeInsertDeleteHandler,this),this.parent.on(Li,this.beforeInsertDeleteHandler,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(sr,this.validationHandler),this.parent.off(Wr,this.addHighlightHandler),this.parent.off(io,this.removeHighlightHandler),this.parent.off(Di,this.beforeInsertDeleteHandler),this.parent.off(Li,this.beforeInsertDeleteHandler))},s.prototype.validationHandler=function(e){var i,r=e.range,t="";e.range.indexOf("!")>-1&&(r=e.range.split("!")[1],t=e.range.split("!")[0]);var n=_(this.parent,t?ee(this.parent,t):this.parent.activeSheetIndex);this.parent.dataValidationRange=(this.parent.dataValidationRange.indexOf("!")>-1?"":n.name+"!")+this.parent.dataValidationRange+r+",";var a=!1,o=this.getRangeWhenColumnSelected(r,n);r=o.range,a=o.isFullCol,(0,f.le)(t)||(e.range=t+"!"+r),e.range=e.range||n.selectedRange;var l=Q(A(e.range));if(a)for(var h=l[1];h<=l[3];h++)i=Fe(n,h),a=!(a&&e.isRemoveValidation&&i&&!i.validation);if(a)for(h=l[1];h<=l[3];h++)i=Fe(n,h),e.isRemoveValidation&&i&&i.validation?delete n.columns[h].validation:e.isRemoveValidation||((0,f.le)(i)&&(n.columns[h]=Fe(n,h)),n.columns[h].validation={operator:e.rules.operator,type:e.rules.type,value1:e.rules.value1,value2:e.rules.value2,inCellDropDown:e.rules.inCellDropDown,ignoreBlank:e.rules.ignoreBlank});else for(var p=void 0,c=l[0];c<=l[2];c++)for(h=l[1];h<=l[3];h++)e.isRemoveValidation?(c===l[2]&&(i=Fe(n,h))&&i.validation&&(i.validation.address=ep(i.validation.address,[l[0],h,l[2],h],h)),(p=E(c,h,n))&&p.validation&&!Je(this.parent,n,{cell:{validation:{}},rowIdx:c,colIdx:h})&&(delete p.validation,this.parent.notify(He,{rowIdx:c,colIdx:h,style:this.parent.getCellStyleValue(["backgroundColor","color"],[c,h])}))):(p={validation:Object.assign({},e.rules)},Je(this.parent,n,{cell:p,rowIdx:c,colIdx:h}))},s.prototype.addHighlightHandler=function(e){this.InvalidDataHandler(e.range,!1,e.td,e.isclearFormat)},s.prototype.removeHighlightHandler=function(e){this.InvalidDataHandler(e.range,!0)},s.prototype.getRange=function(e){var r=A(e),t=this.parent.getActiveSheet(),i=t.colCount;return r[2]===t.rowCount-1&&0===r[0]?e=e.replace(/[0-9]/g,""):r[3]===i-1&&0===r[2]&&(e=e.replace(/\D/g,"")),e},s.prototype.InvalidDataHandler=function(e,r,t,i){for(var a,l=e?qt(this.parent,e):this.parent.activeSheetIndex,h=_(this.parent,l),p=(e=e||h.selectedRange).includes("!")?Et(e):h.name,c=this.getRangeWhenColumnSelected(Cr(e),h),d=c.isFullCol,u=(e=p+"!"+c.range)?Q(A(e)):[],v=(e=this.getRange(e))?u[0]:0,g=e?u[2]:h.rows.length;v<=g;v++)if(h.rows[v])for(var m=e?u[1]:0,y=e?u[3]:h.rows[v].cells.length;m<=y;m++){var C=void 0;if(h.rows[v].cells&&h.rows[v].cells[m]){var b=Fe(h,m);if((a=h.rows[v].cells[m])&&a.validation){if(C=a.validation,i&&!C.isHighlighted)return;r?C.isHighlighted&&(a.validation.isHighlighted=!1):a.validation.isHighlighted=!0}else if(b&&b.validation){if(C=b.validation,i&&!C.isHighlighted)return;r&&d?C.isHighlighted&&(b.validation.isHighlighted=!1):d&&(b.validation.isHighlighted=!0)}if(C&&this.parent.allowDataValidation){var w={value:a.value?a.value:"",range:[v,m],sheetIdx:l,isCell:!1,td:t,isValid:!0};this.parent.notify(Ti,w),w.isValid||!ne(h,v)&&l===this.parent.activeSheetIndex&&this.parent.notify(po,{isRemoveHighlightedData:r,rowIdx:v,colIdx:m,td:t})}}}},s.prototype.beforeInsertDeleteHandler=function(e){if("Sheet"!==e.modelType)for(var r,t,i=0,n=this.parent.sheets.length;i<n;i++)for(var a=0,o=(t=this.parent.sheets[i]).rows.length;a<o;a++)if(t.rows[a]&&t.rows[a].cells)for(var l=0,h=t.rows[a].cells.length;l<h;l++)if((r=t.rows[a].cells[l])&&r.validation){var p="beforeInsert"===e.name,c=e.index+(e.model.length-1),d="Row"===e.modelType?a>=e.index&&a<=c:l>=e.index&&l<=c,u=void 0;u=p?{insertDeleteArgs:{startIndex:e.index,endIndex:e.index+e.model.length-1,modelType:e.modelType,isInsert:!0,sheet:_(this.parent,e.activeSheetIndex)},row:a,col:l}:{insertDeleteArgs:{startIndex:e.start,endIndex:e.end,modelType:e.modelType,sheet:e.model},row:a,col:l},pe(r.validation.value1)&&!d&&(u.cell={formula:r.validation.value1},this.parent.notify(An,u),r.validation.value1=u.cell.formula),pe(r.validation.value2)&&!d&&(u.cell={formula:r.validation.value2},this.parent.notify(An,u),r.validation.value2=u.cell.formula),e.activeSheetIndex===i&&p&&this.updateValidationForInsertedModel(e,t,a,l,r.validation)}},s.prototype.getRangeWhenColumnSelected=function(e,r){var t,i=e.split(":");return e.match(/\D/g)&&!e.match(/[0-9]/g)?(i[0]+=1,i[1]+=r.rowCount,e=i[0]+":"+i[1],t=!0):!e.match(/\D/g)&&e.match(/[0-9]/g)&&(i[0]="A"+i[0],i[1]=j(0,r.colCount-1).replace(/[0-9]/g,"")+i[1],e=i[0]+":"+i[1]),{range:e,isFullCol:t}},s.prototype.updateValidationForInsertedModel=function(e,r,t,i,n){var a=e.index+(e.model.length-1);if("Column"===e.modelType){if("before"===e.insertType&&a===i-1||"after"===e.insertType&&e.index-1===i)for(var o=e.index;o<=a;o++)ce(t,o,r,{validation:(0,f.l7)({},n)},!0)}else if("Row"===e.modelType&&("above"===e.insertType&&a===t-1||"below"===e.insertType&&e.index-1===t))for(o=e.index;o<=a;o++)ce(o,i,r,{validation:(0,f.l7)({},n)},!0)},s.prototype.getModuleName=function(){return"workbookDataValidation"},s}(),go=function(){return go=Object.assign||function(s){for(var e,r=1,t=arguments.length;r<t;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},go.apply(this,arguments)},_n=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(eo,this.findNext,this),this.parent.on(to,this.findPrevious,this),this.parent.on(Ai,this.replace,this),this.parent.on(Gr,this.replaceAll,this),this.parent.on(yn,this.totalCount,this),this.parent.on(ja,this.findAllValues,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(eo,this.findNext),this.parent.off(to,this.findPrevious),this.parent.off(Ai,this.replace),this.parent.off(Gr,this.replaceAll),this.parent.off(yn,this.totalCount),this.parent.off(ja,this.findAllValues))},s.prototype.findNext=function(e){var p,c,m,r=this.parent.sheets,i=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,n=r[i],a=B(n.activeCell),o=n.usedRange,l=o.colIndex,h=e.value.toString(),d=0,u=o.rowIndex,y=p=a[1],C=c=a[0];if(n.rows[c]&&n.rows[c].cells&&n.rows[c].cells[p]&&(n.rows[c].cells[p].format?m=this.parent.getDisplayText(n.rows[c].cells[p]).toString():n.rows[c].cells[p].value&&(m=n.rows[c].cells[p].value.toString())),m){var S=m.toLowerCase(),w=m.indexOf(e.value)>-1,x=S.indexOf(e.value.toString().toLowerCase())>-1;(h===m||h===S||w||x)&&("By Column"===e.searchBy?c++:p++,d++)}(a[0]>n.usedRange.rowIndex||a[1]>n.usedRange.colIndex)&&(a[0]>n.usedRange.rowIndex&&a[1]<=n.usedRange.colIndex?(c=0,p=a[1]):a[0]<=n.usedRange.rowIndex&&a[1]>n.usedRange.colIndex?(c=a[0],p=0):(c=0,p=0));var I={rowIndex:c,colIndex:p,usedRange:o,endRow:u,endColumn:l,startRow:C,mode:e.mode,loopCount:0,count:d,args:e,val:void 0,stringValue:h,sheetIndex:i,startColumn:y,sheets:r};"By Row"===e.searchBy&&this.findNxtRow(I),"By Column"===e.searchBy&&this.findNxtCol(I)},s.prototype.findNxtRow=function(e){var r,t=e.sheets[e.sheetIndex],i=this.parent.sheets.length;r=t.usedRange;var n=B(t.activeCell);for(e.colIndex>=e.usedRange.colIndex+1&&(e.colIndex=0,e.rowIndex++);e.rowIndex<=e.endRow+1;e.rowIndex++){if(e.rowIndex>e.endRow){if("Workbook"===e.mode){var a=this.parent.activeSheetIndex;if(e.sheetIndex++,i===e.sheetIndex&&(e.sheetIndex=0),a===e.sheetIndex&&0===e.count)return void this.parent.notify(Ke,null);r=(t=e.sheets[e.sheetIndex]).usedRange,n=B(t.activeCell),e.rowIndex=0,e.colIndex=0,e.endColumn=r.colIndex,e.endRow=r.rowIndex}if(0===e.colIndex&&e.rowIndex>e.endRow)if(0===n[0]&&0===n[1]){if(0===e.count)return void this.parent.notify(Ke,null)}else(0!==n[0]&&0!==n[1]||0!==n[0]||0!==n[1])&&(e.startColumn=0,e.startRow=0,e.endColumn=r.colIndex,e.endRow=n[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++)}if(e.count>0&&r.rowIndex<e.rowIndex&&(e.rowIndex=0,0===e.rowIndex&&(e.colIndex=0)),t.rows[e.rowIndex]){for(var o=t.rows[e.rowIndex];e.colIndex<=e.endColumn;e.colIndex++)if(o&&o.cells&&o.cells[e.colIndex]&&this.nextCommon(e))return;if(e.colIndex>e.endColumn&&(e.colIndex=0),e.loopCount>0&&n[0]===e.rowIndex)return void this.parent.notify(Ke,null)}}0!==e.count||this.parent.notify(Ke,null)},s.prototype.findNxtCol=function(e){var t,r=e.sheets[e.sheetIndex],i=B(r.activeCell),n=this.parent.sheets.length;for(e.rowIndex>=e.usedRange.rowIndex&&(e.rowIndex=0,e.colIndex++);e.colIndex<=e.usedRange.colIndex+1;e.colIndex++){if(e.colIndex>=e.endColumn+1&&"Workbook"===e.mode){if(t=this.parent.activeSheetIndex,e.sheetIndex++,n===e.sheetIndex&&(e.sheetIndex=0),t===e.sheetIndex&&0===e.count)return void this.parent.notify(Ke,null);e.usedRange=(r=e.sheets[e.sheetIndex]).usedRange,i=B(r.activeCell),e.colIndex=0,e.rowIndex=0,e.endColumn=e.usedRange.colIndex,e.endRow=e.usedRange.rowIndex}if(e.colIndex>=e.endColumn+1&&(e.colIndex=0),e.rowIndex>e.endRow&&0===e.colIndex)if(0===i[0]&&0===i[1]||i[1]>r.usedRange.rowIndex||i[0]>r.usedRange.colIndex){if(0===e.count)return void this.parent.notify(Ke,null)}else(0!==i[1]||0!==i[0]||0!==i[1]&&0!==i[0])&&(e.startRow=0,e.startColumn=0,e.endRow=i[0],e.endColumn=e.usedRange.colIndex,e.colIndex=e.startColumn,e.rowIndex=e.startRow,e.loopCount++);if(e.count>0&&e.usedRange.colIndex+1<e.colIndex&&(e.colIndex=0,e.rowIndex=0),e.rowIndex>=e.endRow&&(e.rowIndex=0),e.colIndex<=e.usedRange.colIndex){for(;e.rowIndex<=e.usedRange.rowIndex;e.rowIndex++)if(r.rows[e.rowIndex]&&r.rows[e.rowIndex].cells&&r.rows[e.rowIndex].cells[e.colIndex]&&this.nextCommon(e))return;if(e.loopCount>0&&i[1]===e.colIndex)return void this.parent.notify(Ke,null)}}0!==e.count||this.parent.notify(Ke,null)},s.prototype.nextCommon=function(e){var r=e.sheets[e.sheetIndex],t=r.rows[e.rowIndex];if(t&&(!t.isFiltered||!t.hidden)){var i=t.cells[e.colIndex];if(i&&i.value){if(r.isProtected&&(i.isLocked||void 0===i.isLocked)&&r.protectSettings.selectUnLockedCells)return!1;var n=t.cells[e.colIndex];if(n){var a=void 0;if(a=n.format?this.parent.getDisplayText(t.cells[e.colIndex]):t.cells[e.colIndex].value.toString(),e.args.isCSen&&e.args.isEMatch){if(a===e.stringValue){var l=r.name+"!"+j(e.rowIndex,e.colIndex);return this.parent.notify(st,{address:l}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var h=a.indexOf(e.args.value)>-1;if(a===e.stringValue||h)return l=r.name+"!"+j(e.rowIndex,e.colIndex),this.parent.notify(st,{address:l}),e.count++,!0}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=a.toString().toLowerCase(),e.val===e.stringValue)return l=r.name+"!"+j(e.rowIndex,e.colIndex),this.parent.notify(st,{address:l}),e.count++,!0}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=a.toString().toLowerCase(),h=e.val.indexOf(e.args.value.toString().toLowerCase())>-1;var p=e.val.indexOf(e.args.value)>-1;if(e.val===e.stringValue||a===e.stringValue||h||a===e.stringValue||p)return l=r.name+"!"+j(e.rowIndex,e.colIndex),this.parent.notify(st,{address:l}),e.count++,!0}}}}return!1},s.prototype.findPrevious=function(e){var n,r=this.parent.sheets,t=e.sheetIndex,i=r[t],l=B(i.activeCell),p=0,c=i.usedRange.rowIndex,d=i.usedRange.colIndex,u=e.value.toString(),v=l[1],g=l[0],m=v,y=g;if(i.rows[g]&&i.rows[g].cells[v]&&(i.rows[g].cells[v].format?n=this.parent.getDisplayText(i.rows[g].cells[v]).toString():i.rows[g].cells[v].value&&(n=i.rows[g].cells[v].value.toString())),n){var b=n.toLowerCase(),S=n.indexOf(e.value)>-1,w=b.indexOf(e.value.toString().toLowerCase())>-1;(u===n||u===b||S||w)&&("By Row"===e.searchBy&&v--,"By Column"===e.searchBy&&g--,p++)}(l[0]>i.usedRange.rowIndex||l[1]>i.usedRange.colIndex)&&(l[0]>i.usedRange.rowIndex&&l[1]<=i.usedRange.colIndex?(g=i.usedRange.rowIndex,v=l[1]):l[0]<=i.usedRange.rowIndex&&l[1]>i.usedRange.colIndex?(g=l[0],v=i.usedRange.colIndex):(g=i.usedRange.rowIndex,v=i.usedRange.colIndex));var x={rowIndex:g,colIndex:v,endRow:c,endColumn:d,startRow:y,loopCount:0,count:p,args:e,val:void 0,stringValue:u,sheets:r,sheetIndex:t,startColumn:m};"By Row"===e.searchBy&&this.findPreRow(x),"By Column"===e.searchBy&&this.findPreCol(x)},s.prototype.findPreRow=function(e){var r,t=e.sheets[e.sheetIndex],i=this.parent.sheets.length,n=!1,a=B(t.activeCell);for(-1===e.colIndex&&(e.colIndex=e.endColumn,e.rowIndex--);e.rowIndex>=-1;e.rowIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){var o=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=i-1),o===e.sheetIndex&&0===e.count)return void this.parent.notify(Ke,null);r=(t=e.sheets[e.sheetIndex]).usedRange,a=B(t.activeCell),e.rowIndex=r.rowIndex,e.colIndex=r.colIndex,e.endColumn=0,e.endRow=0}n=this.commonCondition(e,a)}if(!n){"Workbook"!==e.args.mode&&e.count>0&&-1===e.rowIndex&&(e.rowIndex=e.endRow),-1===e.rowIndex&&(e.rowIndex=t.usedRange.rowIndex,e.colIndex=t.usedRange.colIndex);var l=t.rows[e.rowIndex];if(l){for(-1===e.colIndex&&(e.colIndex=t.usedRange.colIndex);e.colIndex>=0;e.colIndex--)if(l&&l.cells&&l.cells[e.colIndex]&&this.prevCommon(e))return;if(e.loopCount>0&&a[0]===e.rowIndex)return void this.parent.notify(Ke,null)}}}n||0!==e.count||this.parent.notify(Ke,null)},s.prototype.findPreCol=function(e){for(var r,t=e.sheets[e.sheetIndex],i=this.parent.sheets.length,n=!1,a=B(t.activeCell);e.colIndex>=-1;e.colIndex--){if(e.rowIndex<0&&e.colIndex<=0){if("Workbook"===e.args.mode){var o=this.parent.activeSheetIndex;if(e.sheetIndex--,-1===e.sheetIndex&&(e.sheetIndex=i-1),o===e.sheetIndex&&0===e.count)return void this.parent.notify(Ke,null);r=(t=e.sheets[e.sheetIndex]).usedRange,a=B(t.activeCell),e.rowIndex=r.rowIndex,e.colIndex=r.colIndex,e.endColumn=0,e.endRow=0}n=this.commonCondition(e,a)}if(!n){e.count>0&&e.colIndex<0&&(e.colIndex=e.endColumn),e.rowIndex<0&&(e.rowIndex=t.usedRange.rowIndex),e.colIndex<-1&&(e.colIndex=t.usedRange.colIndex,e.rowIndex--);var l=t.rows[e.rowIndex];for(l&&t.rows[e.rowIndex].cells[e.colIndex]&&-1===e.rowIndex&&(e.rowIndex=t.usedRange.rowIndex);e.rowIndex>=0;e.rowIndex--){if(l&&l.cells&&l.cells[e.colIndex]&&this.prevCommon(e))return;if(e.loopCount>0&&a[1]===e.colIndex)return void this.parent.notify(Ke,null)}}}n||0!==e.count||this.parent.notify(Ke,null)},s.prototype.commonCondition=function(e,r){var i,t=e.sheets[e.sheetIndex];return r[0]!==e.endRow&&r[1]!==e.endColumn||r[0]!==e.endRow||r[1]!==e.endColumn?(e.startColumn=t.usedRange.colIndex,e.startRow=t.usedRange.rowIndex,e.endColumn=0,e.endRow=r[0],e.rowIndex=e.startRow,e.colIndex=e.startColumn,e.loopCount++,i=!1):(r[0]===t.usedRange.rowIndex&&r[1]===t.usedRange.colIndex||r[0]>t.usedRange.rowIndex||r[1]>t.usedRange.colIndex)&&0!==r[0]&&0!==r[1]&&(this.parent.notify(Ke,null),i=!0),i},s.prototype.prevCommon=function(e){var r=e.sheets[e.sheetIndex],t=r.rows[e.rowIndex];if(t&&(!t.isFiltered||!t.hidden)){var i=t.cells[e.colIndex];if(i&&i.value){if(r.isProtected&&(i.isLocked||void 0===i.isLocked)&&r.protectSettings.selectUnLockedCells)return!1;var n=t.cells[e.colIndex];if(n){var a=void 0;if(a=n.format?this.parent.getDisplayText(t.cells[e.colIndex]):t.cells[e.colIndex].value.toString(),e.args.isCSen&&e.args.isEMatch){if(a===e.stringValue){var l=r.name+"!"+j(e.rowIndex,e.colIndex);return this.parent.notify(st,{address:l}),e.count++,!0}}else if(e.args.isCSen&&!e.args.isEMatch){var h=a.indexOf(e.args.value)>-1;if(a===e.stringValue||h)return l=r.name+"!"+j(e.rowIndex,e.colIndex),this.parent.notify(st,{address:l}),e.count++,!0}else if(!e.args.isCSen&&e.args.isEMatch){if(e.val=a.toString().toLowerCase(),e.val===e.stringValue)return l=r.name+"!"+j(e.rowIndex,e.colIndex),this.parent.notify(st,{address:l}),e.count++,!0}else if(!e.args.isCSen&&!e.args.isEMatch){e.val=a.toString().toLowerCase(),h=e.val.indexOf(e.args.value.toString().toLowerCase())>-1;var p=e.val.indexOf(e.args.value)>-1;if(a===e.stringValue||a===e.stringValue||h||e.val===e.stringValue||p)return l=r.name+"!"+j(e.rowIndex,e.colIndex),this.parent.notify(st,{address:l}),e.count++,!0}}}}return!1},s.prototype.replace=function(e){var r=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,t=_(this.parent,e.sheetIndex);if(t.isProtected)this.parent.notify("editAlert",null);else{var o,n=A(e.address||t.activeCell),a=this.parent.getDisplayText(E(n[0],n[1],t,!1,!0)).toString();e.value=e.value.toString(),e.isCSen||(o=e.value.toLowerCase());var l=this.getReplaceValue(e,a,o);if(l||(e.findOpt="next",this.findNext(e),n=B(t.activeCell),a=this.parent.getDisplayText(E(n[0],n[1],t)).toString(),l=this.getReplaceValue(e,a,o))){var h={address:t.name+"!"+j(n[0],n[1]),cancel:!1,compareValue:e.value,replaceValue:e.replaceValue,sheetIndex:r};if(e.isAction){if(this.parent.notify(ue,{action:"beforeReplace",eventArgs:h}),h.cancel)return;delete h.cancel}Je(this.parent,t,{cell:{value:l},rowIdx:n[0],colIdx:n[1],uiRefresh:!0,valChange:!0}),e.isAction&&this.parent.notify("actionComplete",{action:"replace",eventArgs:h})}}},s.prototype.replaceAll=function(e){for(var u,v,g,r=this,t="Sheet"===e.mode?e.sheetIndex:0,i=this.parent.sheets[t],n=i.usedRange.rowIndex,a=0,o=i.usedRange.colIndex,l=0,h=[],p=e.isAction,c=go({addressCollection:h,cancel:!1},e),d=function(y,C){requestAnimationFrame?requestAnimationFrame(function(){if(!c.cancel&&c.addressCollection[C]){var b=B(c.addressCollection[C].split("!")[1]),S=qt(r.parent,c.addressCollection[C]);Je(r.parent,r.parent.sheets[S],{cell:{value:y},rowIdx:b[0],colIdx:b[1],uiRefresh:!0,valChange:!0}),C===c.addressCollection.length-1&&p&&r.parent.notify("actionComplete",{action:"replaceAll",eventArgs:c})}}):r.parent.updateCell({value:y},c.addressCollection[C])};a<=n+1;a++){if(l>o&&a>n&&"Workbook"===e.mode){if(t++,!(i=this.parent.sheets[t]))break;l=0,a=0,o=i.usedRange.colIndex,n=i.usedRange.rowIndex}if(v=i.rows[a])for(l===o+1&&(l=0);l<=o;l++)if(v&&v.cells&&v.cells[l]&&(u=this.parent.getDisplayText(i.rows[a].cells[l]).toString()))if(e.isCSen)e.isEMatch?u===e.value&&(d(e.replaceValue,h.length),h.push(i.name+"!"+j(a,l))):u.indexOf(e.value)>-1&&(d(u.replace(e.value,e.replaceValue),h.length),h.push(i.name+"!"+j(a,l)));else if(e.isEMatch)u.toLowerCase()===e.value&&(d(e.replaceValue,h.length),h.push(i.name+"!"+j(a,l)));else{var m=u.toLowerCase();(u===e.value||m.indexOf(e.value.toString().toLowerCase())>-1||m===e.value||u===e.value||m.indexOf(e.value)>-1)&&(g=new RegExp(e.value.toString().replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),d(u.replace(g,e.replaceValue),h.length),h.push(i.name+"!"+j(a,l)))}}h.length&&p?(this.parent.notify("actionBegin",{action:"beforeReplaceAll",eventArgs:c}),c.cancel||this.parent.notify(Cn,{count:c.addressCollection.length,replaceValue:c.replaceValue})):this.parent.notify(Cn,{count:c.addressCollection.length,replaceValue:c.replaceValue})},s.prototype.getReplaceValue=function(e,r,t){return e.isCSen?e.isEMatch?r===e.value&&e.replaceValue:r.indexOf(e.value)>-1&&r.replace(e.value,e.replaceValue):e.isEMatch?r.toLowerCase()===t&&e.replaceValue:r.toLowerCase().includes(t)&&r.replace(new RegExp(e.value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"ig"),e.replaceValue)},s.prototype.totalCount=function(e){var r=this,t=this.parent.sheets[e.sheetIndex],i=B(t.activeCell),n=0,a=0,l=e.value.toLowerCase();t.rows.filter(function(p,c){return p&&p.cells&&(!p.isFiltered||!p.hidden)&&p.cells.filter(function(d,u){d&&(d.value||0===d.value)&&(d.format?r.parent.getDisplayText(d):d.value.toString()).toLowerCase().includes(l)&&(n++,(c===i[0]&&u>=i[1]||c>i[0])&&a++)})});var h=n;(n=h-(a-=1))>h&&(n=h),0!==n&&!this.parent.getDisplayText(E(i[0],i[1],t)).toLowerCase().includes(l)&&(n-=1),e.findCount=n+" of "+h},s.prototype.findAllValues=function(e){for(var o,r=e.sheetIndex,t=this.parent.sheets[r],i=t.usedRange.rowIndex,n=0,l=t.usedRange.colIndex,h=0,p=this.parent.sheets.length,c=e.sheetIndex;n<=i+1;n++){if(1!==c&&e.sheetIndex===p&&(r=1),n>i&&h>l&&"Workbook"===e.mode){if(c===++r)return;r>p-1&&(r=0),(t=this.parent.sheets[r])&&(n=0,h=0,l=t.usedRange.colIndex,i=t.usedRange.rowIndex)}if(!(0,f.le)(t)&&t.rows[n]){var d=t.rows[n];for(h===l+2&&(h=0);h<=l+1;h++)if(d&&d.cells&&d.cells[h]){var u=t.rows[n].cells[h];if(u){var g=void 0;if(g=u.format?this.parent.getDisplayText(t.rows[n].cells[h]).toString():u.value.toString(),e.isCSen&&e.isEMatch)g===e.value&&(o=t.name+"!"+j(n,h),e.findCollection.push(o));else if(e.isCSen&&!e.isEMatch){var y=g.indexOf(e.value)>-1;(g===e.value||y)&&(o=t.name+"!"+j(n,h),e.findCollection.push(o))}else if(!e.isCSen&&e.isEMatch)(C=g.toString().toLowerCase())===e.value&&(o=t.name+"!"+j(n,h),e.findCollection.push(o));else if(!e.isCSen&&!e.isEMatch){var C;y=(C=g.toString().toLowerCase()).indexOf(e.value.toLowerCase())>-1,(C===e.value||g===e.value||y||g===e.value)&&(o=t.name+"!"+j(n,h),e.findCollection.push(o))}}}}}},s.prototype.getModuleName=function(){return"workbookfindAndReplace"},s}(),Wn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.protectsheetHandler=function(e){var r=(0,f.le)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,t=_(this.parent,r);this.parent.setSheetPropertyOnMute(t,"isProtected",!0),this.parent.setSheetPropertyOnMute(t,"protectSettings",{selectCells:e.protectSettings.selectCells,formatCells:e.protectSettings.formatCells,formatColumns:e.protectSettings.formatColumns,formatRows:e.protectSettings.formatRows,insertLink:e.protectSettings.insertLink,selectUnLockedCells:e.protectSettings.selectUnLockedCells}),this.parent.notify(no,{sheetIndex:r,triggerEvent:e.triggerEvent}),this.parent.notify(Cl,{props:"Protect"}),t.password=e.password?e.password:"",t.columns.forEach(function(i){i&&(0,f.o8)(i.isLocked)&&(i.isLocked=!0)})},s.prototype.unprotectsheetHandler=function(e){var r=this.parent.getActiveSheet();e.sheet&&(r=this.parent.sheets[e.sheet]),r.protectSettings.formatCells=r.protectSettings.formatColumns=!1,r.protectSettings.formatRows=r.protectSettings.selectCells=!1,this.parent.setSheetPropertyOnMute(r,"isProtected",!1),this.parent.notify(no,r.protectSettings),this.parent.notify(Cl,{props:"Protect"})},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(jr,this.protectsheetHandler,this),this.parent.on(bl,this.unprotectsheetHandler,this),this.parent.on(bn,this.lockCells,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(jr,this.protectsheetHandler),this.parent.off(bn,this.lockCells),this.parent.off(jr,this.unprotectsheetHandler))},s.prototype.lockCells=function(e){var r=this.parent.getAddressInfo(e.range),t=Q(r.indices),i=_(this.parent,r.sheetIndex),n=!!e.isLocked&&e.isLocked;if(0===t[0]&&t[2]===i.rowCount-1)for(var a=t[1];a<=t[3];a++)en(i,a,{isLocked:e.isLocked});for(a=t[0];a<=t[2];a++)for(var o=t[1];o<=t[3];o++)ce(a,o,i,{isLocked:n},!0);e.triggerEvent&&this.parent.notify("actionComplete",{action:"lockCells",eventArgs:e})},s.prototype.getModuleName=function(){return"workbookProtectSheet"},s}(),Gn=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.merge=function(e){e.sheetIndex=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,e.isAction&&(this.parent.notify("actionBegin",{eventArgs:e,action:"merge"}),e.model||(e.model=[])),"string"==typeof e.range&&(e.range=A(e.range)),e.range=Q(e.range),e.skipChecking||this.mergedRange(e),e.merge&&"All"!==e.type?"Horizontally"===e.type?this.mergeHorizontally(e):"Vertically"===e.type&&this.mergeVertically(e):(this.mergeAll(e),e.refreshRibbon&&this.parent.notify(St,null)),this.parent.setUsedRange(e.range[2],e.range[3]),e.isAction&&this.parent.notify("actionComplete",{eventArgs:e,action:"merge"}),e.sheetIndex===this.parent.activeSheetIndex&&(this.parent.notify("selectRange",{address:_(this.parent,e.sheetIndex).selectedRange,skipChecking:!0}),this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(Kr,{range:e.range}))},s.prototype.mergeAll=function(e){var t,r=0;e.range=e.range;for(var i,n,a,l,o=(0,f.o8)(e.sheetIndex)?this.parent.getActiveSheet():_(this.parent,e.sheetIndex),h=e.range[0];h<=e.range[2];h++){i=0,e.isAction&&e.model.push({cells:[]});for(var p=e.range[1];p<=e.range[3];p++){if((t=E(h,p,o))&&(t.value||t.formula)&&!n&&(n=t.formula||t.value),e.isAction&&e.merge&&(e.model[h-e.range[0]].cells[p-e.range[1]]={},(0,f.l7)(e.model[h-e.range[0]].cells[p-e.range[1]],t,null,!0)),o.rows[h]&&o.rows[h].cells&&o.rows[h].cells[p]&&(delete o.rows[h].cells[p].rowSpan,delete o.rows[h].cells[p].colSpan,!e.merge&&!e.isAction&&e.model&&e.model[h-e.range[0]]&&e.model[h-e.range[0]].cells[p-e.range[1]]&&e.model[h-e.range[0]].cells[p-e.range[1]]!=={}&&ce(h,p,o,e.model[h-e.range[0]].cells[p-e.range[1]])),e.merge){if(t=new Object,h===e.range[0]&&p===e.range[1]){e.range[3]-e.range[1]>0&&(t.colSpan=e.range[3]-e.range[1]+1),e.range[2]-e.range[0]>0&&(t.rowSpan=e.range[2]-e.range[0]+1),ce(e.range[0],e.range[1],o,t,!0);continue}h!==e.range[0]&&(t.rowSpan=-r),p!==e.range[1]&&(i++,t.colSpan=-i),o.rows[h]&&o.rows[h].cells&&o.rows[h].cells[p]&&(delete o.rows[h].cells[p].value,delete o.rows[h].cells[p].formula),a=E(h,p,o)||{},ce(h,p,o,Object.assign(t,a))}e.preventRefresh||(this.parent.notify(zt,{rowIdx:h,colIdx:p}),l=this.isFormulaDependent(o,h,p,l))}r++}e.merge&&(t=this.getCellValue(e.range[0],e.range[1],n,o),ce(e.range[0],e.range[1],o,t,!0),e.preventRefresh||(this.parent.notify(zt,{rowIdx:e.range[0],colIdx:e.range[1]}),this.refreshCF(o,e.range[0],e.range[1],l)))},s.prototype.isFormulaDependent=function(e,r,t,i){if(!i){var n={action:"dependentCellsAvailable",sheetId:e.id.toString(),address:j(r,t)};return this.parent.notify(ie,n),n.isAvailable}return i},s.prototype.refreshCF=function(e,r,t,i){e.conditionalFormats&&e.conditionalFormats.length&&this.parent.notify(We,{indexes:[r,t],refreshAll:i,isAction:!0})},s.prototype.mergeHorizontally=function(e){var r;e.range=e.range;for(var t,n,a,o,l,i=_(this.parent,e.sheetIndex),h=e.range[0];h<=e.range[2];h++){r=0,e.isAction&&e.model.push({cells:[]});for(var p=e.range[1];p<=e.range[3];p++){if(o=E(h,p,i),t=new Object,e.isAction&&(e.model[h-e.range[0]].cells[p-e.range[1]]={},Object.assign(e.model[h-e.range[0]].cells[p-e.range[1]],o)),p===e.range[1]){if(h===e.range[0])continue;i.rows[a=h-1]&&i.rows[a].cells&&i.rows[a].cells[p]&&delete i.rows[a].cells[p].rowSpan,t=this.getCellValue(a,p,n,i),e.range[3]-e.range[1]>0&&(t.colSpan=e.range[3]-e.range[1]+1),n=null,ce(a,p,i,t,!0)}else o&&(o.value||o.formula)&&!n&&(n=o.formula||o.value),i.rows[a=h]&&i.rows[a].cells&&i.rows[a].cells[p]&&(delete i.rows[a].cells[p].rowSpan,delete i.rows[a].cells[p].value,delete i.rows[a].cells[p].formula),r++,t.colSpan=-r,ce(a,p,i,t,!0);this.parent.notify(zt,{rowIdx:a,colIdx:p}),l=this.isFormulaDependent(i,a,p,l)}}i.rows[e.range[2]]&&i.rows[e.range[2]].cells&&i.rows[e.range[2]].cells[e.range[1]]&&delete i.rows[e.range[2]].cells[e.range[1]].rowSpan,t=this.getCellValue(e.range[2],e.range[1],n,i),e.range[3]-e.range[1]>0&&(t.colSpan=e.range[3]-e.range[1]+1),ce(e.range[2],e.range[1],i,t,!0),this.parent.notify(zt,{rowIdx:e.range[2],colIdx:e.range[1]}),this.refreshCF(i,e.range[2],e.range[1],l)},s.prototype.getCellValue=function(e,r,t,i){var n=new Object,a=E(e,r,i);return t&&(!a||!a.value&&!a.formula)&&(pe(t)?n.formula=t:n.value=t),n},s.prototype.mergeVertically=function(e){var r=0;e.range=e.range;for(var i,n,a,o,l,t=_(this.parent,e.sheetIndex),h=e.range[1];h<=e.range[3];h++)for(var p=e.range[0];p<=e.range[2];p++){if(o=E(p,h,t),e.isAction&&(void 0===e.model[p-e.range[0]]&&(e.model[p-e.range[0]]={cells:[]}),e.model[p-e.range[0]].cells[h-e.range[1]]={},Object.assign(e.model[p-e.range[0]].cells[h-e.range[1]],o)),p===e.range[0]){if(r=0,h===e.range[1])continue;a=h-1,t.rows[p]&&t.rows[p].cells&&t.rows[p].cells[a]&&delete t.rows[p].cells[a].colSpan,i=this.getCellValue(p,a,n,t),e.range[2]-e.range[0]>0&&(i.rowSpan=e.range[2]-e.range[0]+1),n=null,ce(p,a,t,i,!0)}else i=new Object,o&&(o.value||o.formula)&&!n&&(n=o.formula||o.value),r++,a=h,t.rows[p]&&t.rows[p].cells&&t.rows[p].cells[a]&&(delete t.rows[p].cells[a].colSpan,delete t.rows[p].cells[a].value,delete t.rows[p].cells[a].formula),i.rowSpan=-r,ce(p,a,t,i,!0);this.parent.notify(zt,{rowIdx:p,colIdx:a}),l=this.isFormulaDependent(t,h,a,l)}t.rows[e.range[0]]&&t.rows[e.range[0]].cells&&t.rows[e.range[0]].cells[e.range[3]]&&delete t.rows[e.range[0]].cells[e.range[3]].colSpan,i=this.getCellValue(e.range[0],e.range[1],n,t),e.range[2]-e.range[0]>0&&(i.rowSpan=e.range[2]-e.range[0]+1),ce(e.range[0],e.range[3],t,i,!0),this.parent.notify(zt,{rowIdx:e.range[0],colIdx:e.range[3]}),this.refreshCF(t,e.range[0],e.range[3],l)},s.prototype.activeCellRange=function(e){e.range=e.range;var r=this.parent.getActiveSheet(),t=E(e.range[0],e.range[1],r);t&&(!(0,f.le)(t.rowSpan)&&t.rowSpan<0&&(e.range[0]+=t.rowSpan,e.insertCount&&(e.range[0]-=e.insertCount)),!(0,f.le)(t.colSpan)&&t.colSpan<0&&(e.range[1]+=t.colSpan,e.insertCount&&(e.range[1]-=e.insertCount)),(t=E(e.range[0],e.range[1],r))&&(t.rowSpan>1&&(e.range[0]+(t.rowSpan-1)>=e.range[2]||e.insertCount)&&(e.range[2]=e.range[0]+(t.rowSpan-1)),t.colSpan>1&&(e.range[1]+(t.colSpan-1)>=e.range[3]||e.insertCount)&&(e.range[3]=e.range[1]+(t.colSpan-1))))},s.prototype.mergedRange=function(e){"string"==typeof e.range&&(e.range=A(e.range)),e.range[0]<=e.range[2]&&e.range[1]<=e.range[3]?this.forward(e):e.range[0]>=e.range[2]&&e.range[1]>=e.range[3]?this.reverse(e):e.range[0]<e.range[2]&&e.range[1]>e.range[3]?this.forwardReverse(e):e.range[0]>e.range[2]&&e.range[1]<e.range[3]&&this.reverseForward(e)},s.prototype.forward=function(e){e.range=e.range;var i,n,r=(0,f.o8)(e.sheetIndex)?this.parent.getActiveSheet():_(this.parent,e.sheetIndex),t=E(e.range[0],e.range[1],r),a=i=e.range[0],o=n=e.range[1];if(t&&(!(0,f.le)(t.rowSpan)&&t.rowSpan<0&&(a=i=e.range[0]+t.rowSpan),!(0,f.le)(t.colSpan)&&t.colSpan<0&&(o=n=e.range[1]+t.colSpan),(t=E(a,o,r))&&(t.rowSpan>1&&(i+=t.rowSpan-1,a+(t.rowSpan-1)>=e.range[2]&&(e.range[2]=e.range[0],e.range[2]=a+(t.rowSpan-1))),t.colSpan>1&&(n+=t.colSpan-1,o+(t.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=o+(t.colSpan-1))))),e.range[0]=a,e.range[1]=o,e.range[0]===a&&e.range[1]===o&&e.range[2]===i&&e.range[3]===n&&(e.isActiveCell=!0),!e.skipChecking){for(var l=e.range[1];l<=e.range[3];l++)(t=E(e.range[2],l,r))&&(a=e.range[2],o=l,!(0,f.le)(t.colSpan)&&t.colSpan<0&&(o+=t.colSpan)<e.range[1]&&(e.range[1]=o),!(0,f.le)(t.rowSpan)&&t.rowSpan<0&&(a+=t.rowSpan)<e.range[0]&&(e.range[0]=a),(t=E(a,o,r))&&(t.colSpan>1&&o+(t.colSpan-1)>e.range[3]&&(e.range[3]=o,e.range[3]=o+(t.colSpan-1)),t.rowSpan>1&&a+(t.rowSpan-1)>e.range[2]&&(e.range[2]=a,e.range[2]=a+(t.rowSpan-1))));var h,p;for(l=e.range[1];l<=e.range[3];l++)(t=E(e.range[0],l,r))&&(p=l,h=e.range[0],!(0,f.le)(t.colSpan)&&t.colSpan<0&&(p+=t.colSpan)<e.range[1]&&(e.range[1]=p),!(0,f.le)(t.rowSpan)&&t.rowSpan<0&&(h+=t.rowSpan)<e.range[0]&&(e.range[0]=h));for(l=e.range[0];l<=e.range[2];l++)(t=E(l,e.range[3],r))&&(a=l,o=e.range[3],!(0,f.le)(t.rowSpan)&&t.rowSpan<0&&(a+=t.rowSpan)<e.range[0]&&(e.range[0]=a),!(0,f.le)(t.colSpan)&&t.colSpan<0&&(o+=t.colSpan)<e.range[1]&&(e.range[1]=o),(t=E(a,o,r))&&(t.rowSpan>1&&a+(t.rowSpan-1)>e.range[2]&&(e.range[2]=a,e.range[2]=a+(t.rowSpan-1)),t.colSpan>1&&o+(t.colSpan-1)>e.range[3]&&(e.range[3]=o,e.range[3]=o+(t.colSpan-1))))}},s.prototype.forwardReverse=function(e){var r=this.parent.getActiveSheet();e.range=e.range;var t=e.range[1],i=E(e.range[0],e.range[1],r),n=e.range[0];if(i&&(!(0,f.le)(i.colSpan)&&i.colSpan<0&&e.range[3]>=(t+=i.colSpan)&&(e.range[3]=t),!(0,f.le)(i.rowSpan)&&i.rowSpan<0&&(n+=i.rowSpan)<e.range[0]&&(e.range[0]=n),(i=E(n,t,r))&&(i.rowSpan>1&&n+(i.rowSpan-1)>=e.range[2]&&(e.range[2]=n+(i.rowSpan-1)),i.colSpan>1&&t+(i.colSpan-1)>=e.range[1]&&(e.range[1]=t+(i.colSpan-1)))),e.range[0]=n,!e.skipChecking){for(var a,o,l=e.range[3];l<=e.range[1];l++)(i=E(e.range[2],l,r))&&(o=l,a=e.range[2],!(0,f.le)(i.rowSpan)&&i.rowSpan<0&&(a+=i.rowSpan)<e.range[0]&&(e.range[0]=a),!(0,f.le)(i.colSpan)&&i.colSpan<0&&(o+=i.colSpan)<e.range[3]&&(e.range[3]=o),(i=E(a,o,r))&&(i.rowSpan>1&&a+(i.rowSpan-1)>e.range[2]&&(e.range[2]=a+(i.rowSpan-1)),i.colSpan>1&&o+(i.colSpan-1)>e.range[1]&&(e.range[1]=o+(i.colSpan-1))));var h,p;for(l=e.range[3];l<=e.range[1];l++)(i=E(e.range[0],l,r))&&(o=l,h=e.range[0],!(0,f.le)(i.rowSpan)&&i.rowSpan<0&&(h+=i.rowSpan)<e.range[0]&&(e.range[0]=h),!(0,f.le)(i.colSpan)&&i.colSpan<0&&(o+=i.colSpan),(i=E(h,o,r))&&(i.rowSpan>1&&h+(i.rowSpan-1)>e.range[2]&&(e.range[2]=h+(i.rowSpan-1)),i.colSpan>1&&o+(i.colSpan-1)>e.range[1]&&(e.range[1]=o,e.range[1]=o+(i.colSpan-1))));for(l=e.range[0];l<=e.range[2];l++)(i=E(l,e.range[3],r))&&(h=l,p=e.range[3],!(0,f.le)(i.rowSpan)&&i.rowSpan<0&&(h+=i.rowSpan)<e.range[0]&&(e.range[0]=h),!(0,f.le)(i.colSpan)&&i.colSpan<0&&(p+=i.colSpan)<e.range[3]&&(e.range[3]=p),(i=E(h,p,r))&&(i.rowSpan>1&&h+(i.rowSpan-1)>e.range[2]&&(e.range[2]=h,e.range[2]=h+(i.rowSpan-1)),i.colSpan>1&&p+(i.colSpan-1)>e.range[1]&&(e.range[1]=p,e.range[1]=p+(i.colSpan-1))))}},s.prototype.reverse=function(e){e.range=e.range;var r=e.range[1],t=(0,f.o8)(e.sheetIndex)?this.parent.getActiveSheet():_(this.parent,e.sheetIndex),i=E(e.range[0],e.range[1],t),n=e.range[0];i&&(!(0,f.le)(i.colSpan)&&i.colSpan<0&&(r+=i.colSpan),!(0,f.le)(i.rowSpan)&&i.rowSpan<0&&(n+=i.rowSpan),e.range[2]>=n&&(e.range[2]=n,e.isActiveCell=!0),e.range[3]>=r?(e.range[3]=r,e.range[2]===n&&(e.isActiveCell=!0)):e.isActiveCell&&(e.isActiveCell=!1),(i=E(n,r,t))&&(i.rowSpan>1&&n+(i.rowSpan-1)>=e.range[0]&&(e.range[0]=n,e.range[0]=n+(i.rowSpan-1)),i.colSpan>1&&r+(i.colSpan-1)>=e.range[1]&&(e.range[1]=r,e.range[1]=r+(i.colSpan-1))));var a=e.range[3];if(!e.skipChecking){for(var o=e.range[3];o<=e.range[1];o++)(i=E(e.range[2],o,t))&&(a=o,n=e.range[2],!(0,f.le)(i.rowSpan)&&i.rowSpan<0&&(n+=i.rowSpan)<e.range[2]&&(e.range[2]=n),!(0,f.le)(i.colSpan)&&i.colSpan<0&&(a+=i.colSpan)<e.range[3]&&(e.range[3]=a),(i=E(n,a,t))&&(i.rowSpan>1&&n+(i.rowSpan-1)>e.range[0]&&(e.range[0]=n,e.range[0]=n+(i.rowSpan-1)),i.colSpan>1&&a+(i.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(i.colSpan-1))));for(a=e.range[3],o=e.range[3];o<=e.range[1];o++)(i=E(e.range[0],o,t))&&(a=o,n=e.range[0],!(0,f.le)(i.colSpan)&&i.colSpan<0&&(a+=i.colSpan),!(0,f.le)(i.rowSpan)&&i.rowSpan<0&&(n+=i.rowSpan),(i=E(n,a,t))&&(i.colSpan>1&&a+(i.colSpan-1)>e.range[1]&&(e.range[1]=a,e.range[1]=a+(i.colSpan-1)),i.rowSpan>1&&n+(i.rowSpan-1)>e.range[0]&&(e.range[0]=n,e.range[0]=n+(i.rowSpan-1))));var l,h;for(o=e.range[2];o<=e.range[0];o++)(i=E(o,e.range[3],t))&&(h=o,l=e.range[3],!(0,f.le)(i.rowSpan)&&i.rowSpan<0&&(h+=i.rowSpan)<e.range[2]&&(e.range[2]=h),!(0,f.le)(i.colSpan)&&i.colSpan<0&&(l+=i.colSpan)<e.range[3]&&(e.range[3]=l),(i=E(h,l,t))&&(i.rowSpan>1&&h+(i.rowSpan-1)>e.range[0]&&(e.range[0]=h,e.range[0]=h+(i.rowSpan-1)),i.colSpan>1&&l+(i.colSpan-1)>e.range[1]&&(e.range[1]=l,e.range[1]=l+(i.colSpan-1))))}},s.prototype.reverseForward=function(e){e.range=e.range;var r=(0,f.o8)(e.sheetIndex)?this.parent.getActiveSheet():_(this.parent,e.sheetIndex),t=e.range[0],i=e.range[1],n=E(e.range[0],e.range[1],r);if(n&&(!(0,f.le)(n.rowSpan)&&n.rowSpan<0&&e.range[2]>=(t+=n.rowSpan)&&(e.range[2]=t),!(0,f.le)(n.colSpan)&&n.colSpan<0&&(i+=n.colSpan),(n=E(t,i,r))&&(n.rowSpan>1&&t+(n.rowSpan-1)>=e.range[0]&&(e.range[0]=t,e.range[0]=t+(n.rowSpan-1)),n.colSpan>1&&i+(n.colSpan-1)>=e.range[3]&&(e.range[3]=e.range[1],e.range[3]=i+(n.colSpan-1)))),!e.skipChecking){for(var o,a=e.range[3],l=e.range[1];l<=e.range[3];l++)(n=E(e.range[2],l,r))&&(o=e.range[2],a=l,!(0,f.le)(n.rowSpan)&&n.rowSpan<0&&(o+=n.rowSpan)<e.range[2]&&(e.range[2]=o),!(0,f.le)(n.colSpan)&&n.colSpan<0&&(a+=n.colSpan)<e.range[1]&&(e.range[1]=a),(n=E(o,a,r))&&(n.colSpan>1&&a+(n.colSpan-1)>e.range[3]&&(e.range[3]=a+(n.colSpan-1)),n.rowSpan>1&&n.rowSpan-1+o>e.range[0]&&(e.range[0]=n.rowSpan-1+o)));var h,p,c;for(l=e.range[1];l<=e.range[3];l++)(n=E(e.range[0],l,r))&&(p=l,h=e.range[0],!(0,f.le)(n.colSpan)&&n.colSpan<0&&(p+=n.colSpan)<e.range[1]&&(e.range[1]=p),!(0,f.le)(n.rowSpan)&&n.rowSpan<0&&(h+=n.rowSpan),(n=E(h,p,r))&&n.rowSpan>1&&h+(n.rowSpan-1)>e.range[0]&&(e.range[0]=h+(n.rowSpan-1)));for(l=e.range[2];l<=e.range[0];l++)(n=E(l,e.range[3],r))&&(o=l,c=e.range[3],!(0,f.le)(n.rowSpan)&&n.rowSpan<0&&(o+=n.rowSpan)<e.range[2]&&(e.range[2]=o),!(0,f.le)(n.colSpan)&&n.colSpan<0&&(c+=n.colSpan)<e.range[1]&&(e.range[1]=c),(n=E(o,c,r))&&(n.rowSpan>1&&n.rowSpan-1+o>e.range[0]&&(e.range[0]=n.rowSpan-1+o),n.colSpan>1&&n.colSpan-1+c>e.range[3]&&(e.range[3]=c,e.range[3]=n.colSpan-1+c)))}},s.prototype.insertHandler=function(e){this.activeCellRange(e),e.range=e.range,"Row"===e.insertModel?e.range[2]+=e.insertCount:e.range[3]+=e.insertCount,e.preventRefresh=!0,e.merge=!0,this.mergeAll(e)},s.prototype.pasteHandler=function(e){for(var t,i,n,r=this.parent.getActiveSheet(),a=B(r.activeCell),o=e.range[0],l=0;o<=e.range[2];o++,l++)for(var h=e.range[1],p=0;h<=e.range[3];h++,p++){if((t=E(o,h,e.prevSheet)||{}).rowSpan>1&&(n=E(a[0]+(t.rowSpan-1),a[1],r)||{},i=E(a[0]+1,a[1],r)||{},void 0!==n.colSpan&&n.colSpan<0||void 0!==i.colSpan&&i.colSpan<0))return e.cancel=!0,void this.parent.notify(zt,{showDialog:!0});if(t.colSpan>1&&(n=E(a[0],a[1]+(t.colSpan-1),r)||{},i=E(a[0],a[1]+1,r)||{},void 0!==n.rowSpan&&n.rowSpan<0||void 0!==i.rowSpan&&i.rowSpan<0))return e.cancel=!0,void this.parent.notify(zt,{showDialog:!0})}},s.prototype.addEventListener=function(){this.parent.on(tt,this.merge,this),this.parent.on(Yr,this.mergedRange,this),this.parent.on(Ne,this.activeCellRange,this),this.parent.on(Sn,this.insertHandler,this),this.parent.on(ao,this.pasteHandler,this)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(tt,this.merge),this.parent.off(Yr,this.mergedRange),this.parent.off(Ne,this.activeCellRange),this.parent.off(Sn,this.insertHandler),this.parent.off(ao,this.pasteHandler))},s.prototype.getModuleName=function(){return"workbookmerge"},s}(),Jr="ribbon",Oi="formulaBar",jn="sheetTabs",pr="refreshSheetTabs",ei="isFormulaBarEdit",Ye="contentLoaded",er="mouseDown",rt="spreadsheetDestroyed",fe="editOperation",tr="formulaOperation",cr="formulaBarOperation",xr="click",lt="keyUp",Dt="keyDown",Ni="verticalScroll",Mi="horizontalScroll",yo="beforeContentLoaded",Co="beforeVirtualContentLoaded",Lt="virtualContentLoaded",Yn="cellNavigate",bo="mouseUpAfterSelection",Ir="contextmenuBeforeOpen",So="insertSheetTab",Xn="removeSheetTab",wo="renameSheetTab",Bi="ribboClick",dr="enableToolbarItems",xo="tabSwitch",Er="selectRange",kr="cut",Rr="copy",Ot="paste",ti="clearCopy",Io="addContextMenuItems",Eo="removeContextMenuItems",ko="enableContextMenuItems",Ro="enableFileMenuItems",Fo="hideFileMenuItems",To="addFileMenuItems",Ao="hideRibbonTabs",Do="enableRibbonTabs",Lo="addRibbonTabs",Oo="addToolbarItems",No="hideToolbarItems",Mo="beforeRibbonCreate",Xe="rowHeightChanged",$e="colWidthChanged",Bo="onContentScroll",Zn="deInitProperties",Hi="activeSheetChanged",Ho="renameSheet",Kn="initiateCustomSort",Fr="applySort",Po="autoFitRowsColumns",Tr="updateToggleItem",Pi="initiateHyperlink",Vi="editHyperlink",Vo="openHyperlink",qi="removeHyperlink",qo="createHyperlinkElement",$n="sheetNameUpdate",Qn="hideSheet",Gt="performUndoRedo",Jn="updateUndoRedoCollection",ea="setActionData",Uo="getBeforeActionData",ri="clearUndoRedoCollection",jt="initiateFilterUI",Ui="renderFilterCell",ta="reapplyFilter",zo="filterByCellValue",zi="clearFilter",ra="getFilteredColumn",Z="actionComplete",ia="filterCellKeyDown",ii="getFilterRange",_o="setAutoFit",Wo="refreshFormulaDatasource",Al="setScrollEvent",Go="initiatedatavalidation",_i="invalidData",ni="protectSheet",Wi="applyProtect",jo="protectCellFormat",Yo="renderGotoDlgt",na="renderFindDlg",Gi="findHandler",xt="created",Nt="editAlert",Xo="setUndoRedo",Zo="enableFormulaInput",aa="protectSelection",oa="hiddenMerge",sa="checkPrevMerge",la="checkMerge",ji="removeDataValidation",ai="showAggregate",Ko="goToSheet",$o="showSheet",Qo="renderCFDlg",Yi="clearViewer",Ar="initiateFormulaReference",Jo="initiateCur",es="clearCellRef",ha="editValue",oi="addressHandle",ts="initiateEdit",si="forRefSelRender",rs="insertImage",Dl="refreshImgElem",li="refreshImgCellObj",Yt="getRowIdxFromClientY",Xt="getColIdxFromClientX",Mt="createImageElement",It="deleteImage",Dr="deleteChart",hi="refreshChartCellObj",pa="refreshImagePosition",is="updateTableWidth",pi="focusBorder",ns="clearChartBorder",as="insertChart",ci="chartRangeSelection",ca="insertDesignChart",Lr="removeDesignChart",Or="chartDesignTab",Ll="addChartEle",os="undoRedoForChartDesign",da="isReact",Ol="renderReactTemplates",Nl="clearTemplate",fa="protectWorkbook",ua="unProtectWorkbook",Ml="getPassWord",ss="setProtectWorkbook",ls="removeWorkbookProtection",hs="importProtectWorkbook",ps="selectionStatus",Xi="freeze",cs="overlayEleSize",va="updateScroll",Bt="positionAutoFillElement",ma="hideAutoFillOptions",ds="performAutoFill",fs="selectAutoFillRange",us="fillRange",fr="hideAutoFillElement",vs="unProtectSheetPassword",Nr="updateTranslate",ms="getUpdatedScrollPosition",ga="updateScrollValue",Bl="beforeCheckboxfilterRenderer",Hl="refreshCheckbox",gs="renderInsertDlg",ys="toggleFormulaBar",ya="toggleProtect",Ca=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(Xr,this.setCFRule,this),this.parent.on(_t,this.clearCFRule,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Xr,this.setCFRule),this.parent.off(_t,this.clearCFRule))},s.prototype.setCFRule=function(e){var r=e.cfModel,t=void 0===e.sheetIdx?qt(this.parent,r.range):e.sheetIdx,i=_(this.parent,t);r.range=r.range||i.selectedRange;var n=Q(A(r.range));if(r.range=z(n),e.isAction){var a={range:r.range,type:r.type,cancel:!1,cFColor:r.cFColor,value:r.value,sheetIdx:t};if(this.parent.notify(ue,{eventArgs:a,action:"conditionalFormat"}),a.cancel)return;r.type=a.type,r.cFColor=a.cFColor,r.value=a.value,a.range!==r.range&&(r.range=a.range,n=A(a.range)),delete a.cancel}i.conditionalFormats||this.parent.setSheetPropertyOnMute(i,"conditionalFormats",[]),i.conditionalFormats.push(r),t!==this.parent.activeSheetIndex?e.isUndoRedo&&!e.isFromUpdateAction&&this.parent.notify(st,{address:i.name+"!"+r.range}):this.parent.notify(We,{cfModel:[r],isAction:!0}),e.isAction&&this.parent.notify(Z,{eventArgs:{range:r.range,type:r.type,cFColor:r.cFColor,value:r.value,sheetIdx:t},action:"conditionalFormat"})},s.prototype.clearCFRule=function(e){void 0===e.sheetIdx&&(e.sheetIdx=this.parent.activeSheetIndex);var i,r=_(this.parent,e.sheetIdx),t=r.conditionalFormats;if(e.isUndo)return e.updatedCFModel&&e.updatedCFModel.forEach(function(w){(i=t.indexOf(w))>-1&&t.splice(i,1)}),t.splice.apply(t,[t.length,0].concat(e.oldCFModel)),this.parent.notify(We,{cfModel:e.oldCFModel,isAction:!0}),void(e.sheetIdx!==this.parent.activeSheetIndex&&this.parent.notify(st,{address:r.name+"!"+e.range}));if(t&&t.length){var n,a,o,l,h,p,c,d,u,v=e.range&&("string"==typeof e.range?A(e.range):e.range);e.oldCFModel=[],e.updatedCFModel=[];for(var g=[],m=[],y=[],C=0;C<t.length;C++){a=(n=t[C]).range.split(",");for(var b=0;b<a.length;b++){if(o=A(a[b]),e.range)if(v[0]<=o[0]&&v[1]<=o[1]&&v[2]>=o[2]&&v[3]>=o[3])a.splice(b,1),b--;else{if(d=v[2]>=o[0]&&v[2]<=o[2],h=v[1]>=o[1]&&v[1]<=o[3],p=v[3]>=o[1]&&v[3]<=o[3],l=[],(c=v[0]>=o[0]&&v[0]<=o[2])&&d?((h||p||v[1]<o[1]&&v[3]>o[3])&&(v[0]-o[0]>0&&l.push(z([o[0],o[1],v[0]-1,o[3]])),o[2]-v[2]>0&&l.push(z([v[2]+1,o[1],o[2],o[3]]))),h&&v[1]!==o[1]&&l.push(z([v[0],o[1],v[2],v[1]-1])),p&&v[3]!==o[3]&&l.push(z([v[0],v[3]+1,v[2],o[3]]))):h&&p?((c||d||v[0]<o[0]&&v[2]>o[2])&&(v[1]-o[1]>0&&l.push(z([o[0],o[1],o[2],v[1]-1])),o[3]-v[3]>0&&l.push(z([o[0],v[3]+1,o[2],o[3]]))),c?v[0]!==o[0]&&l.push(z([o[0],v[1],v[0]-1,v[3]])):d&&v[2]!==o[2]&&l.push(z([v[2]+1,v[1],o[2],v[3]]))):(c||d)&&(h?(v[1]!==o[1]&&l.push(z([o[0],o[1],o[2],v[1]-1])),v[0]-o[0]>0?l.push(z([o[0],v[1],v[0]-1,o[3]])):o[2]-v[2]>0&&l.push(z([v[2]+1,v[1],o[2],o[3]]))):p&&(v[3]!==o[3]&&l.push(z([o[0],v[3]+1,o[2],o[3]])),v[0]-o[0]>0?l.push(z([o[0],o[1],v[0]-1,v[3]])):o[2]-v[2]>0&&l.push(z([v[2]+1,o[1],o[2],v[3]])))),!l.length)continue;a[b]=l.join(",")}else v=o,a.splice(b,1),b--;e.sheetIdx===this.parent.activeSheetIndex&&this.parent.notify(oo,{indexes:v})}if((u=a.join(","))!==n.range){if(e.cfModel&&(e.cfModel.cFColor!==n.cFColor||e.cfModel.type!==n.type||e.cfModel.value!==n.value)){y.push(n);continue}m.push(n.range),u?(e.oldCFModel.push({type:n.type,cFColor:n.cFColor,format:n.format,range:n.range,value:n.value}),n.range=u,n.result&&(delete n.result,this.parent.notify(We,{cfModel:[n],isAction:!0})),e.updatedCFModel.push(n),g.push(n)):(e.oldCFModel.push(n),g.concat(t.splice(C,1)),C--)}}if(e.sheetIdx!==this.parent.activeSheetIndex?e.isUndoRedo&&!e.isFromUpdateAction&&this.parent.notify(st,{address:r.name+"!"+e.range}):y.length&&this.parent.notify(We,{cfModel:y,isAction:!0}),(e.isAction||e.isClear)&&e.oldCFModel.length){var S={cFormats:g,oldRange:m,previousConditionalFormats:e.oldCFModel,sheetIdx:e.sheetIdx,selectedRange:e.range};e.updatedCFModel.length&&(S.conditionalFormats=e.updatedCFModel),e.isClear?e.cfClearActionArgs=S:this.parent.notify(Z,{eventArgs:S,action:"clearCF"})}}},s.prototype.getModuleName=function(){return"workbookConditionalFormatting"},s}(),ba=function(){function s(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueLTOperator=String.fromCharCode(142),this.uniqueMOperator=String.fromCharCode(135),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.parent=e,this.addEventListener()}return s.prototype.getFillInfo=function(e){for(var r="",t=!0,i="CopyCells",n=[],a=["Down","Up"].indexOf(e.direction)>-1,o=this.getRangeData({range:e.dataRange,sheetIdx:this.parent.activeSheetIndex}),l=o.join().replace(/,/g,"").length,h=this.isRange(e.dataRange)&&l?o.length:1;h--;)if(te(r=o[h]&&!(0,f.le)(o[h].value)?o[h].value:"")||pe(r)||te(r[r.length-1])){t=!1,i=this.parent.autoFillSettings.fillType;break}return(!l||t)&&(n.push("Fill Series"),i="FillSeries"===e.fillType?i:e.fillType),(!a||a&&e.dataRange[1]!==e.dataRange[3])&&n.push("Flash Fill"),{fillType:i,disableItems:n}},s.prototype.isRange=function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},s.prototype.autoFill=function(e){if(e.dataRange&&e.fillRange&&e.direction&&this.parent.allowEditing&&(!this.parent.getActiveSheet().isProtected||!e.isLockedCell)){var r={dataRange:null,fillRange:null,fillType:null,direction:null,sheetIndex:qt(this.parent,e.dataRange)},t=Q(A(e.dataRange)),i=Q(A(e.fillRange));switch(this.fillInfo=this.getFillInfo({dataRange:t,fillRange:i,fillType:e.fillType,direction:e.direction}),r.dataRange=t,r.fillRange=i,r.direction=e.direction,r.fillType=e.fillType||this.fillInfo.fillType,this.fillInfo.fillType=e.isFillOptClick?e.fillType:this.fillInfo.fillType,e.fillType){case"FillSeries":case"FillWithoutFormatting":this.fillSeries(r);break;case"CopyCells":case"FillFormattingOnly":this.copyCells(r)}}},s.prototype.fillSeries=function(e){for(var r,t,i,n,a,o,l,h,p,c,d,u,v,g,m,y,C,b,S,I,de,oe,w={},x=0,F=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,T=_(this.parent,F),k=e.dataRange[0],R=e.dataRange[1],D=e.dataRange[2],N=e.dataRange[3],P=e.fillRange[0],M=e.fillRange[1],V=e.fillRange[2],Y=e.fillRange[3],X=["Down","Up"].indexOf(e.direction)>-1,G=["Up","Left"].indexOf(e.direction)>-1,$=X?N-R:D-k,J="FillSeries"===e.fillType,Le=T.conditionalFormats&&T.conditionalFormats.length&&[].slice.call(T.conditionalFormats),be=[];x<=$;){if(l=(a=this.updateFillValues(X,k,R,D,N,P,M,V,Y,x)).fillRange,i=this.getPattern(o=a.patternRange,{isRFill:G,isVFill:X}),c=(h=this.getRangeData({range:o,sheetIdx:F})).length,!i)return;for(t=i.length,b=(C=this.getSelectedRange(T,{rowIndex:l[0],colIndex:l[1]},{rowIndex:l[2],colIndex:l[3]})).length,G&&(C=C.reverse(),i=i.reverse(),i=this.ensurePattern(i),h=h.reverse()),d=0;d<b;){switch(S=C[d],te(n=i[d%t])&&(n=i[n]),v=d%c,n.type){case"number":if(r=this.round(n.regVal.a+n.regVal.b*n.i,5).toString(),n.dataVal){if(void 0===n.copy&&(n.copy=n.val.length>2,n.copy))for(var Ae=2;Ae<n.val.length&&(n.copy=Math.abs(this.round(n.regVal.a+n.regVal.b*Ae,5))!==n.val[Ae],!n.copy);Ae++);r=n.copy?h[v]&&!(0,f.le)(h[v].value)?h[v].value:"":n.start?Math.abs(Number(r))+n.dataVal:n.dataVal+Math.abs(Number(r))}G?n.i--:n.i++;break;case"string":r=n.val[n.i%n.val.length],n.i++;break;case"formula":for(y=!1,r="=",u=0,g=n.val.length;u<g;)"object"==typeof(p=n.val[u])?(y=!0,r+=(m=this.round(p.a+p.b*n.i,5))<1?"#REF!":X?p.c+(p.b?m:"$"+m):(p.b?_e(m):p.c.substring(0,p.c.search(/\d/))+"$"+_e(m))+p.c.trim()):r+=p,u++;y&&G?n.i--:n.i++;break;case"time":r=(n.regVal.a+n.regVal.b*n.i).toString(),G?n.i--:n.i++}I=E(S.rowIndex,S.colIndex,T,!1,!0),J?Object.assign(w,h[v],null,!0):(w.style=I.style,w.format=I.format,w.wrap=I.wrap,w.rowSpan=I.rowSpan,w.colSpan=I.colSpan),w.value=r,pe(r)&&(w.formula=r),Je(this.parent,T,de={cell:w,rowIdx:S.rowIndex,colIdx:S.colIndex,valChange:!0,uiRefresh:!0,pvtExtend:!0}),Le&&!oe&&((oe=de.isFormulaDependent)||Ki(Le,be,S.rowIndex,S.colIndex)),w={},d++}x++}(be.length||oe)&&this.parent.notify(We,{cfModel:!oe&&be,refreshAll:oe,isAction:!0})},s.prototype.copyCells=function(e){for(var t,i,a,o,l,h,p,c,u,D,N,P,r=0,d={},v=e.dataRange[0],g=e.dataRange[1],m=e.dataRange[2],y=e.dataRange[3],C=e.fillRange[0],b=e.fillRange[1],S=e.fillRange[2],w=e.fillRange[3],x=["Down","Up"].indexOf(e.direction)>-1,I=["Up","Left"].indexOf(e.direction)>-1,F=x?y-g:m-v,T=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,k=_(this.parent,T),R="FillFormattingOnly"===e.fillType,M=k.conditionalFormats&&k.conditionalFormats.length&&[].slice.call(k.conditionalFormats),V=[];r<=F;){for(a=(o=this.updateFillValues(x,v,g,m,y,C,b,S,w,r)).fillRange,h=(l=this.getRangeData({range:o.patternRange,sheetIdx:T})).length,c=(p=this.getSelectedRange(k,{rowIndex:a[0],colIndex:a[1]},{rowIndex:a[2],colIndex:a[3]})).length,t=0,I&&(p=p.reverse());t<c;)i=t%h,u=p[t],R&&(D=E(u.rowIndex,u.colIndex,k)),Object.assign(d,l[i],null,!0),R&&(d.value=D.value,d.formula=D.formula),Je(this.parent,k,P={cell:d,rowIdx:u.rowIndex,colIdx:u.colIndex,valChange:!0,uiRefresh:!0,pvtExtend:!0}),M&&!N&&((N=P.isFormulaDependent)||Ki(M,V,u.rowIndex,u.colIndex)),d={},t++;r++}(V.length||N)&&this.parent.notify(We,{cfModel:!N&&V,refreshAll:N,isAction:!0})},s.prototype.updateFillValues=function(e,r,t,i,n,a,o,l,h,p){var c,d,u,v;return e?(c={rowIndex:r,colIndex:t+p},d={rowIndex:i,colIndex:t+p},u={rowIndex:a,colIndex:o+p},v={rowIndex:l,colIndex:o+p}):(c={rowIndex:r+p,colIndex:t},d={rowIndex:r+p,colIndex:n},u={rowIndex:a+p,colIndex:o},v={rowIndex:a+p,colIndex:h}),{patternRange:[c.rowIndex,c.colIndex,d.rowIndex,d.colIndex],fillRange:[u.rowIndex,u.colIndex,v.rowIndex,v.colIndex]}},s.prototype.getType=function(e,r){var t;return r?t="time":pe(e)?t="formula":te(e)&&(t="number"),t||"string"},s.prototype.getDataPattern=function(e){var r,t,h,i=0,n={val:null,type:null},a=[],o=this.getRangeData({range:e,sheetIdx:this.parent.activeSheetIndex}),l=o.length;if(l){for(var p=void 0,c=void 0,d=function(u){return!h&&u&&"-"===u[u.length-1]?u.slice(0,u.length-1):u};i<l;){if(r=o[i]?o[i].formula?o[i].formula:(0,f.le)(o[i].value)?"":o[i].value:"",c="","string"===(t=this.getType(r,o[i]&&"h:mm:ss AM/PM"===o[i].format))){if(h=!1,te(r[0])){p=0;do{p++}while(te(r[p]));" "===r[p]&&(h=!0,t="number",c=r.slice(p,r.length),r=Number(r.slice(0,p)))}if(!h&&te(r[r.length-1])){p=1;do{p++}while(te(r[r.length-p]));t="number",c=r.slice(0,r.length-(p-=1)),r=Number(r.slice(r.length-p,r.length)),n.dataVal&&n.dataVal!==c&&n.dataVal===d(c)&&(c=n.dataVal)}}0===i?(n={val:[r],type:t},c&&(n.dataVal=c,n.start=h)):t!==n.type||n.dataVal&&d(n.dataVal)!==d(c)?(a.push(n),n={val:[r],type:t},c&&(n.dataVal=c,n.start=h)):n.val.push(r),i++}return a.push(n),a}return[{val:null,type:null}]},s.prototype.getPredictionValue=function(e,r){for(var t=0,i=0,n=0,a=0,o=0,l=0,h=0,p=e.length;t<p;)i+=t,n+=Number(e[t]),a+=t*Number(e[t]),o+=t*t,t++;return r?(l=(n*o-i*a)/(p*o-i*i),h=(p*a-i*n)/(p*o-i*i)):(l=this.round((n*o-i*a)/(p*o-i*i),5),h=this.round((p*a-i*n)/(p*o-i*i),5)),{a:l,b:h}},s.prototype.getPattern=function(e,r){var t,i,n,a,o,l,u,h=0,p=[],c=this.getDataPattern(e),d=c.length;if(c){for(;h<d;){switch((u=c[h]).type){case"number":if(i=p.length,l=u.val.length,o=r.isRFill?-1:l,1===l){var v=parseFloat(u.val[0])+1;u.val.push(v)}for(n={regVal:a=this.getPredictionValue(u.dataVal?u.val.slice(0,2):u.val),type:u.type,i:o},u.dataVal&&(n.dataVal=u.dataVal,n.val=u.val,n.start=u.start),p.push(n),t=1;t<l;)p.push(i),t++;break;case"string":for(i=p.length,p.push(n={val:u.val,type:u.type,i:0}),t=1,l=u.val.length;t<l;)p.push(i),t++;break;case"formula":if(l=u.val.length,u=this.getFormulaPattern(u.val,r),o=r.isRFill?-1:l,u.isInPattern)for(i=p.length,p.push(n={val:u.val,type:"formula",i:o}),t=1;t<l;)p.push(i),t++;else for(t=0,o=r.isRFill?-1:1;t<l;)p.push({val:u.val[t],type:"formula",i:o}),t++;break;case"time":if(i=p.length,o=r.isRFill?-1:1,1===(l=u.val.length)){var g=nr(u.val[0]),m=Ut(new Date(g.getTime()+36e5),!0);u.val.push(m)}for(a=this.getPredictionValue(u.val,!0),p.push(n={regVal:a,type:u.type,i:o}),t=1;t<l;)p.push(i),t++}h++}return p}return[{regVal:null}]},s.prototype.isCellReference=function(e){return/^[a-z]{1,3}\d{1,7}$/gi.test(e)?"relative":/^\$[a-z]{1,3}\$\d{1,7}$/gi.test(e)?"absolute":!!/^((\$[a-z]{1,3})\d{1,7}|[a-z]{1,3}(\$\d{1,7}))$/gi.test(e)&&"mixed"},s.prototype.round=function(e,r){return Number(Math.round(parseFloat(e+"e"+r))+"e-"+r)},s.prototype.getRangeData=function(e){for(var h,r=[],t=this.parent.getActiveSheet(),i=e.range[0],n=e.range[1],a=e.range[2],o=e.range[3],l=n;i<=a;)if(ne(t,i))i++;else{for(n=l;n<=o;)we(t,n)||(h=E(i,n,t),r.push(h)),n++;i++}return r},s.prototype.getFormulaPattern=function(e,r){for(var t,i,n,h,a=[],o=0,l=e.length;o<l;)a.push(this.parseFormula(e[o])),o++;var p=this.isInPattern(a,r.isVFill);if(p){for(o=(n=a[0]).length;o--;)(h=this.isCellReference(i=n[o]))&&"absolute"!==h&&(n[o]=this.getCellRefPrediction(i,r,null,h));return{isInPattern:p,val:n}}for(o=0;o<l;){for(t=(n=a[o]).length;t--;)(h=this.isCellReference((i=n[t]).trim()))&&"absolute"!==h&&(a[o][t]=this.getCellRefPrediction(i,r,l,h));o++}return{isInPattern:p,val:a}},s.prototype.generateColCount=function(e){for(var r=0,t=e.split("").reverse().join(""),i=t.length-1;i>=0;i--)r+=(e[i].charCodeAt(parseInt(t[i],10))-64)*Math.pow(26,i);return r},s.prototype.getCellRefPrediction=function(e,r,t,i){e=e.toUpperCase();var a=new RegExp("[a-z$]","gi"),o=new RegExp("[0-9$]","g"),l=e.replace(r.isVFill?o:a,""),h=r.isVFill?Number(e.replace(a,"")):this.generateColCount(e.replace(o,"").trim()),p=null,c=[h],d="$"===e[0];if(!d&&e.includes("$")&&"$"===e.trim()[0])for(var u=1;u<e.length;u++)if("$"===e[u]){p=u,d=!0;break}return c.push(t&&1!==t?h+t:h+1),h=this.getPredictionValue(c),i&&"mixed"===i&&(d===r.isVFill?l=p?l.substring(0,p)+"$"+l.substring(p):"$"+l:h.b=0),h.c=l,h},s.prototype.isInPattern=function(e,r){var t,i,n,o,l,h,p,d=0,u=1,v=e.length,g=new RegExp("[0-9$]","g"),m=new RegExp("[a-z$]","gi");if(1===v)return!1;for(;u<v;){if((i=(t=e[d]).length)!==(n=e[u]).length)return!1;for(;i--;)if(l=n[i],this.isCellReference(o=t[i])===this.isCellReference(l)){if(r?(h=Number(o.replace(m,"")),p=Number(l.replace(m,""))):(h=this.generateColCount(o.replace(g,"")),p=this.generateColCount(l.replace(g,""))),h!==p-1)return!1}else if(o!==l)return!1;d++,u++}return!0},s.prototype.parseFormula=function(e){for(var r,t,i=0,n=[],a=(e=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g)).length;i<a;)(r=e[i])?(1===r.length?n.push(this.isUniqueChar(r)?this.getUniqueCharVal(r):r):(t=r[0],r.indexOf("!")>0?(this.isUniqueChar(t)&&(n.push(this.getUniqueCharVal(t)),r=r.substr(1)),t=r.indexOf("!")+1,n.push(r.substr(0,t)),n.push(r.substr(t))):this.isUniqueChar(t)?(n.push(this.getUniqueCharVal(t)),n.push(r.substr(1))):n.push(r)),i++):i++;return n},s.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueSOperator:return"-";case this.uniqueOBracket:return"(";case this.uniqueCOperator:return":";case this.uniqueCBracket:return")";case this.uniqueCSeparator:return",";case this.uniqueGTOperator:return">";case this.uniqueLTOperator:return"<";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueModOperator:return"%";case this.uniquePOperator:return"+"}return""},s.prototype.isUniqueChar=function(e){var r=e.charCodeAt(parseInt(e,10));return r>=129&&r<=142},s.prototype.markSpecialChar=function(e){return(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket)).replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},s.prototype.ensurePattern=function(e){for(var r,t=-1,i=e.length;i--;)"object"==typeof(r=e[i])?(t=i,"string"===r.type&&(r.val=r.val.reverse())):e[i]=t;return e},s.prototype.getSelectedRange=function(e,r,t){var i,n,a,o=[],l=Q([r.rowIndex,r.colIndex,t.rowIndex,t.colIndex]);i=l[0];for(var h=l[2];i<=h;)if(rr(e,i))i++;else{for(n=l[1],a=l[3];n<=a;)o.push({rowIndex:i,colIndex:n}),n++;i++}return o},s.prototype.getFillType=function(e){return e.fillType=this.fillInfo.fillType,e.disableItems=this.fillInfo.disableItems,e},s.prototype.addEventListener=function(){this.parent.on(Qr,this.autoFill,this),this.parent.on(co,this.getFillType,this)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Qr,this.autoFill),this.parent.off(co,this.getFillType))},s.prototype.getModuleName=function(){return"workbookautofill"},s}();function Pl(s,e){return void 0===e&&(e=[]),e.push({member:"workbookBasic",args:[]}),e.push({member:"workbookAll",args:[]}),e.push({member:"dataBind",args:[s]}),e.push({member:"workbookProtectSheet",args:[s]}),s.allowSave&&e.push({member:"workbookSave",args:[s]}),s.allowOpen&&e.push({member:"workbookOpen",args:[s]}),s.allowEditing&&(e.push({member:"workbookEdit",args:[s]}),e.push({member:"workbookFormula",args:[s]})),s.allowNumberFormatting&&e.push({member:"workbookNumberFormat",args:[s]}),s.allowCellFormatting&&e.push({member:"workbookcellformat",args:[s]}),s.allowSorting&&e.push({member:"workbookSort",args:[s]}),s.allowHyperlink&&e.push({member:"workbookHyperlink",args:[s]}),s.allowFiltering&&e.push({member:"workbookFilter",args:[s]}),s.allowFindAndReplace&&e.push({member:"workbookfindAndReplace",args:[s]}),s.allowInsert&&e.push({member:"workbookinsert",args:[s]}),s.allowDelete&&e.push({member:"workbookdelete",args:[s]}),s.allowDataValidation&&e.push({member:"workbookDataValidation",args:[s]}),s.allowMerge&&e.push({member:"workbookmerge",args:[s]}),s.allowCellFormatting&&e.push({member:"workbookConditionalFormatting",args:[s]}),s.allowImage&&e.push({member:"workbookImage",args:[s]}),s.allowChart&&e.push({member:"workbookChart",args:[s]}),s.allowAutoFill&&e.push({member:"workbookautofill",args:[s]}),e}var Qe=function(){var s=function(e,r){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(e,r)};return function(e,r){function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),W=function(s,e,r,t){var a,i=arguments.length,n=i<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(s,e,r,t);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);return i>3&&n&&Object.defineProperty(e,r,n),n},Cs=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Qe(e,s),W([(0,f.Z9)("Calibri")],e.prototype,"fontFamily",void 0),W([(0,f.Z9)("bottom")],e.prototype,"verticalAlign",void 0),W([(0,f.Z9)("left")],e.prototype,"textAlign",void 0),W([(0,f.Z9)("0pt")],e.prototype,"textIndent",void 0),W([(0,f.Z9)("#000000")],e.prototype,"color",void 0),W([(0,f.Z9)("#ffffff")],e.prototype,"backgroundColor",void 0),W([(0,f.Z9)("normal")],e.prototype,"fontWeight",void 0),W([(0,f.Z9)("normal")],e.prototype,"fontStyle",void 0),W([(0,f.Z9)("11pt")],e.prototype,"fontSize",void 0),W([(0,f.Z9)("none")],e.prototype,"textDecoration",void 0),W([(0,f.Z9)("")],e.prototype,"border",void 0),W([(0,f.Z9)("")],e.prototype,"borderTop",void 0),W([(0,f.Z9)("")],e.prototype,"borderBottom",void 0),W([(0,f.Z9)("")],e.prototype,"borderLeft",void 0),W([(0,f.Z9)("")],e.prototype,"borderRight",void 0),e}(f.rt),Vl=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Qe(e,s),W([(0,f.Z9)("")],e.prototype,"name",void 0),W([(0,f.Z9)("")],e.prototype,"scope",void 0),W([(0,f.Z9)("")],e.prototype,"comment",void 0),W([(0,f.Z9)("")],e.prototype,"refersTo",void 0),e}(f.rt),_h=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Qe(e,s),W([(0,f.Z9)(!1)],e.prototype,"selectCells",void 0),W([(0,f.Z9)(!1)],e.prototype,"selectUnLockedCells",void 0),W([(0,f.Z9)(!1)],e.prototype,"formatCells",void 0),W([(0,f.Z9)(!1)],e.prototype,"formatRows",void 0),W([(0,f.Z9)(!1)],e.prototype,"formatColumns",void 0),W([(0,f.Z9)(!1)],e.prototype,"insertLink",void 0),e}(f.rt),bs=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Qe(e,s),W([(0,f.Z9)("General")],e.prototype,"format",void 0),W([(0,f.Zz)({},Cs)],e.prototype,"style",void 0),W([(0,f.Z9)(!0)],e.prototype,"isLocked",void 0),e}(f.rt),Wh=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Qe(e,s),W([(0,f.Z9)("GreaterThan")],e.prototype,"type",void 0),W([(0,f.Zz)({},bs)],e.prototype,"format",void 0),W([(0,f.Z9)("RedFT")],e.prototype,"cFColor",void 0),W([(0,f.Z9)("")],e.prototype,"value",void 0),W([(0,f.Z9)("")],e.prototype,"range",void 0),e}(f.rt),$h=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Qe(e,s),W([(0,f.Z9)("FillSeries")],e.prototype,"fillType",void 0),W([(0,f.Z9)(!0)],e.prototype,"showFillOptions",void 0),e}(f.rt);function pe(s,e){return s&&"="===s[0]&&(s.length>1||e)}function nt(s){var e=s;if((e=e.split("$").join("")).indexOf(":")>-1){var r=e.split(":");if(Ss(r[0])&&Ss(r[1]))return!0}else if(e.indexOf(":")<0&&Ss(e))return!0;return!1}function Qh(s){return s.charCodeAt(0)>=65&&s.charCodeAt(0)<=90||s.charCodeAt(0)>=97&&s.charCodeAt(0)<=122}function Ul(s,e){return 0===e[1]&&e[3]===s.colCount-1}function Jh(s,e){return 0===e[0]&&e[2]===s.rowCount-1}function Ht(s,e,r){return s&&e>=s[0]&&e<=s[2]&&r>=s[1]&&r<=s[3]}function zl(s,e,r){for(var i,n=s.split(" "),a=0,o=n.length;a<o&&!(i=Ht(A(n[a]),e,r));a++);return i}function Zi(s,e,r){var t=s[0]<=e[0]&&s[2]>=e[2]&&s[1]<=e[1]&&s[3]>=e[3];if(t)return!0;if(r){if(e[0]<s[0]&&e[2]<s[0]||e[0]>s[2]&&e[2]>s[2]||(e[0]<s[0]&&e[2]>s[0]&&(e[0]=s[0],t=!0),e[2]>s[2]&&(e[2]=s[2],t=!0),e[1]<s[1]&&e[3]<s[1]||e[1]>s[3]&&e[3]>s[3]))return!1;e[1]<s[1]&&e[3]>s[1]&&(e[1]=s[1],t=!0),e[3]>s[3]&&(e[3]=s[3],t=!0)}return t}function ep(s,e,r){var t=_e(r+1);return s?s.split(" ").forEach(function(i){var n=A(i);if(Zi(n,e))s=s.split(i).join(t+(n[0]+1)+":"+t+e[0]+" "+t+(e[2]+2)+":"+t+(n[2]+1));else if(Zi(n,e,!0)){var a;a=e[0]>n[0]?t+(n[0]+1)+":"+t+e[0]:t+(e[2]+2)+":"+t+(n[2]+1),s=s.split(i).join(a)}}):s=t+"1:"+t+e[0]+" "+t+(e[2]+2)+":"+t+"1048576",s}function ur(s,e){return s||(s={}),!!s.isLocked||!1!==s.isLocked&&(!(!e||!e.isLocked)||!(s.isLocked||!e||!1===e.isLocked))}function Ss(s){for(var e=s,t=0,i=0,n=[89,71,69],a="",o=e.length,l=0;l<o;l++)Qh(e[l])&&t++;var h=(a=e.substring(0,t)).length;if(h!==o&&h<4&&1!==o&&isNaN(parseInt(e,10))){for(;i<h;){if(!(a[i]&&a[i].charCodeAt(0)<n[i])){if(!a[i]&&i>0)break;return!1}i++}var p=parseFloat(e.substring(t,o));if(p>0&&p<1048577)return!0}return!1}function U(s,e,r,t){if(void 0===t&&(t="rows"),r)for(var i=e;i<1/0&&s[t][e]&&s[t][e].hidden;i++)e++;else for(i=e;i>-1&&s[t][e]&&s[t][e].hidden;i--)e--;return e}function ws(s,e){var r=Object.keys(s);return(e?r.indexOf("fontSize")>-1:r.indexOf("fontSize")>-1&&Number(s.fontSize.split("pt")[0])>12)||r.indexOf("fontFamily")>-1||r.indexOf("borderTop")>-1||r.indexOf("borderBottom")>-1}function _l(s,e,r,t,i,n){var a,o;if(e&&(a=(o=t||E(e[0],e[1],r,!1,!0)).formula?o.formula.toUpperCase():""),a){n&&i.notify(zr,{cellRef:j(e[0],e[1])}),0===a.indexOf("=")&&(a=a.slice(1));for(var l=["+","-","*","/",">=","<=","<>",">","<","=","%"],h=void 0,p=a=a.split("(").join(",").split(")").join(","),c=0;c<l.length;c++)h=p.split(l[c]),p=h.join(",");h=p.split(",");for(var d=[],u=void 0,v=void 0,g=0;g<h.length;g++)if(nt(h[g])){var m=A(h[g]),y=[s[0]-(e[0]-m[0]),s[1]-(e[1]-m[1]),s[0]-(e[0]-m[2]),s[1]-(e[1]-m[3])];y[1]<0||y[2]<0||y[3]<0||!n&&y[0]<0?u="#REF!":(n&&y[0]<0&&(y[0]=y[2]),u=j(y[0],y[1]),h[g].includes(":")&&(u+=":"+j(y[2],y[3])),u=nt(u)?u:"#REF!"),(v={})[h[g]]=u,h[g].includes(":")?d.splice(0,0,v):d.push(v)}var C=void 0,b=void 0,S=a=o.formula;for(g=0;g<d.length;g++){C=Object.keys(d[g])[0],b=d[g][C].toUpperCase();for(var w=C.length,x=S.indexOf(C),I="",F=0;F<b.length;F++)I+=" ";a=a.slice(0,x)+b+a.slice(x+w),S=S.slice(0,x)+I+S.slice(x+w)}return a}return null}function Je(s,e,r){var t={cell:r.cell,rowIndex:r.rowIdx,colIndex:r.colIdx,cancel:!1,sheet:e.name};if(r.preventEvt||s.trigger("beforeCellUpdate",t),!r.eventOnly&&!t.cancel)if(r.valChange){var i=E(t.rowIndex,t.colIndex,e),n=!r.preventEvt&&s.getDisplayText(i),a=!(!i||!i.formula);ce(t.rowIndex,t.colIndex,e,t.cell,!r.pvtExtend);var o=E(t.rowIndex,t.colIndex,e,!1,!0),l={action:"updateCellValue",address:[t.rowIndex,t.colIndex],sheetIndex:ee(s,e.name),value:a&&!o.formula?o.value||(0===o.value?"0":""):o.formula||o.value||(0===o.value?"0":"")};if(s.notify(Sr,l),r.isFormulaDependent=l.isFormulaDependent,r.requestType&&null===t.cell&&ce(t.rowIndex,t.colIndex,e,t.cell,!r.pvtExtend),r.cellDelete&&(delete o.value,delete o.formula,delete o.hyperlink),r.uiRefresh&&s.serviceLocator.getService("cell").refresh(t.rowIndex,t.colIndex,r.lastCell,r.td,r.checkCF,r.checkWrap),!r.preventEvt){var h=s.getDisplayText(o);if(h!==n){var p=E(t.rowIndex,t.colIndex,e,!1,!0).value,c={value:p=p||(0===p?"0":""),oldValue:n,formula:o.formula||"",address:e.name+"!"+j(t.rowIndex,t.colIndex),displayText:h};r.requestType&&(c.requestType=r.requestType),s.trigger("cellSave",c)}}}else ce(t.rowIndex,t.colIndex,e,t.cell,!r.pvtExtend);return t.cancel}function Wl(s,e,r){for(var t=s,i=s,n=e,a=e,o=r.usedRange.rowIndex,l=r.usedRange.colIndex,h=function(d){for(var u=0;u<=l;u++)if(!(0,f.o8)(E(d,u,r,null,!0).value))return!1;return!0},p=function(d){for(var u=t;u<=i;u++)if(!(0,f.o8)(E(u,d,r,null,!0).value))return!1;return!0},c=t;c<=o&&(!(0,f.o8)(E(c,e,r,null,!0).value)||!h(c));c++)i=c;for(c=t;c>=0&&(!(0,f.o8)(E(c,e,r,null,!0).value)||!h(c));c--)t=c;for(c=n;c<=l&&(!(0,f.o8)(E(s,c,r,null,!0).value)||!p(c));c++)a=c;for(c=n;c>=0&&(!(0,f.o8)(E(s,c,r,null,!0).value)||!p(c));c--)n=c;return[t,n,i,a]}function tp(s,e,r){var t=A(s.model.selectedRange),i=0,n=0;return"Column"===s.modelType?(r&&(t=[0,s.start,0,s.end]),"before"===s.insertType?e[1]<=t[1]&&e[3]>=t[1]?(i=0,n=t[3]-t[1]+1):t[1]<e[1]&&(i=n=t[3]-t[1]+1):e[1]<=t[3]&&e[3]>=t[3]?(i=0,n=t[3]-t[1]+1):t[3]<e[3]&&(i=n=t[3]-t[1]+1),[e[0],e[1]+i,e[2],e[3]+n]):(r&&(t=[s.start,0,s.end,0]),"above"===s.insertType?e[0]<=t[0]&&e[2]>=t[0]?(i=0,n=t[2]-t[0]+1):t[0]<e[0]&&(i=n=t[2]-t[0]+1):e[0]<=t[2]&&e[2]>=t[2]?(i=0,n=t[2]-t[0]+1):t[2]<e[2]&&(i=n=t[2]-t[0]+1),[e[0]+i,e[1],e[2]+n,e[3]])}function rp(s,e){var r,t=0,i=0;return"Column"===s.modelType?((r=[0,s.start,s.model.usedRange.rowIndex,s.end])[3]<e[1]?t=i=r[3]-r[1]+1:r[1]>=e[1]&&r[3]<=e[3]?i=r[3]-r[1]+1:r[1]>=e[1]&&r[1]<=e[3]?i=e[3]-r[1]+1:r[1]<e[1]&&r[3]>=e[1]?(t=e[1]-r[1],i=r[3]-r[1]+1):r[1]<e[1]&&r[3]<e[3]&&(t=r[3]-e[1]+(r[3]-r[1])+1,i=r[3]-r[1]+1),[e[0],e[1]-t,e[2],e[3]-i]):((r=[s.start,0,s.end,s.model.usedRange.colIndex])[2]<e[0]?t=i=r[2]-r[0]+1:r[0]>=e[0]&&r[2]<=e[2]?i=r[2]-r[0]+1:r[0]>=e[0]&&r[0]<=e[2]?i=e[2]-r[0]+1:r[0]<e[0]&&r[2]>=e[0]?(t=e[0]-r[0],i=r[2]-r[0]+1):r[0]<e[0]&&r[2]<e[2]&&(t=r[2]-e[0]+(r[2]-r[0])+1,i=r[2]-r[0]+1),[e[0]-t,e[1],e[2]-i,e[3]])}function Ki(s,e,r,t){for(var i,n,a=s.length-1;a>=0;a--){i=s[a].range.trim().split(",");for(var o=0;o<i.length;o++)if(r>=(n=A(i[o].includes(":")?i[o]:i[o]+":"+i[o]))[0]&&t>=n[1]&&r<=n[2]&&t<=n[3]){e.push(s[a]),s.splice(a,1);break}}}function Gl(s,e){for(var t,i,n,a,o,r=e.trim().split(","),l=function(p){for(var c=0;c<r.length;c++){if(o=A(r[c].includes(":")?r[c]:r[c]+":"+r[c]),p[0]<=o[0]&&p[1]<=o[1]&&p[2]>=o[2]&&p[3]>=o[3])return!0;if(a=p[2]>=o[0]&&p[2]<=o[2],t=p[1]>=o[1]&&p[1]<=o[3],i=p[3]>=o[1]&&p[3]<=o[3],(n=p[0]>=o[0]&&p[0]<=o[2])&&a){if((t||i||p[1]<o[1]&&p[3]>o[3])&&(p[0]-o[0]>0||o[2]-p[2]>0)||t&&p[1]!==o[1]||i&&p[3]!==o[3])return!0}else if(t&&i){if((n||a||p[0]<o[0]&&p[2]>o[2])&&(p[1]-o[1]>0||o[3]-p[3]>0))return!0;if(n){if(p[0]!==o[0])return!0}else if(a&&p[2]!==o[2])return!0}else if(n||a)if(t){if(p[1]!==o[1]||p[0]-o[0]>0)return!0;if(o[2]-p[2]>0)return!0}else if(i){if(p[3]!==o[3]||p[0]-o[0]>0)return!0;if(o[2]-p[2]>0)return!0}}return!1},h=0;h<s.length;h++)if(l(s[h]))return!0;return!1}var jl="spreadsheetLocale",ip={SortOutOfRangeError:"Select a cell or range inside the used range and try again."};function Zt(s,e,r,t,i,n,a,o,l,h,p,c){return void 0===l&&(l=!0),new Promise(function(d,u){d(function(){var v;e.indexOf("!")>-1?(v=ee(s,e.split("!")[0]),e=e.slice(e.indexOf("!")+1,e.length)):v=s.activeSheetIndex;var g=_(s,v),m=De(h||e),y={sheet:g,indexes:m,formulaCellRef:a,sheetIndex:o,isFinite:s.scrollSettings&&s.scrollSettings.isFinite,promise:new Promise(function(C,b){C(void 0)})};return s.notify(hn,y),y.promise.then(function(){var C,b,S,w=m[0],x=s.frozenRowCount(g),I=s.frozenColCount(g),F=!!c;if(r){var T,k,R;S=[],e.split(",").forEach(function(J,de){for(m=A(J),T=0,w=m[0];w<=m[2];){for(k=S[T]||{},b=vr(g,w),C=m[1];C<=m[3];)if(l&&ne(g,w)&&!n)w++;else{R=_e(C+1);var oe=b?E(w,C,g):null;t?(k[R]=b?xs(s,E(w,C,g),w,C):"","string"==typeof k[R]&&te(k[R])&&!(oe.format&&"@"===oe.format)&&(k[R]=parseFloat(k[R]))):(oe&&(oe.formula||!(0,f.le)(oe.value))||Object.keys(k).length)&&(C===p?(k[R]=(0,f.l7)({},oe,{value:xs(s,oe,w,C,!0)}),"string"==typeof k[R].value&&te(k[R].value)&&!(oe.format&&"@"===oe.format)&&(k[R].value=parseFloat(k[R].value))):k[R]=oe),C===m[3]&&Object.keys(k).length&&(k.__rowIndex=(w+1).toString(),S[T]=k,F&&0===de&&!rr(g,w)&&c.push(k),T++),C++}w++}})}else{S=new Map;for(var D=!(t||!i||!i.length);w<=m[2];)if(D&&w>=x&&w<i[0])w=i[0];else if(t||!ne(g,w)){for(b=vr(g,w),C=m[1];C<=m[3];){var N={cell:E(w,C,g),address:j(w,C),rowIndex:w,colIndex:C};s.trigger("queryCellInfo",N);var P=E(w,C,g,!1,!0);if(P.colSpan>1&&P.rowSpan>1)for(var M=void 0,V=w,Y=w+P.rowSpan;V<Y;V++)for(var X=C,G=C+P.colSpan;X<G;X++)V===w&&X===C||(M=new Object,V!==w&&(M.rowSpan=w-V),X!==C&&(M.colSpan=C-X),g.rows[V]&&g.rows[V].cells&&g.rows[V].cells[X]&&(delete g.rows[V].cells[X].value,delete g.rows[V].cells[X].formula),ce(V,X,g,M,!0));else if(P.colSpan>1)for(V=C+1,Y=C+P.colSpan;V<Y;V++)ce(w,V,g,{colSpan:C-V},!0),g.rows[w]&&g.rows[w].cells&&g.rows[w].cells[V]&&(delete g.rows[w].cells[V].value,delete g.rows[w].cells[V].formula);else if(P.rowSpan>1)for(V=w+1,Y=w+P.rowSpan;V<Y;V++)ce(V,C,g,{rowSpan:w-V},!0),g.rows[V]&&g.rows[V].cells&&g.rows[V].cells[C]&&(delete g.rows[V].cells[C].value,delete g.rows[V].cells[C].formula);if(t||!we(g,C))if(D&&C>=I&&C<i[1])C=i[1];else{if(P.style){var $={};Object.assign($,P.style),P.style=$}S.set(N.address,P),C++}else C++}w++}else w++}return S})}())})}function xs(s,e,r,t,i){if(e){if((0,f.le)(e.value))return"";if(e.format){var n={value:e.value,formattedText:e.value,cell:e,format:e.format,onLoad:!0,checkDate:!i,rowIndex:r,colIndex:t,dataUpdate:!0};return s.notify(ot,n),n.dateObj&&"Invalid Date"!==n.dateObj.toString()?n.dateObj:i?n.value:n.formattedText}return e.value}return""}function Sa(s,e,r){for(var t,n,l,i=0,a=s.length,o=function(p){if(!(0,f.le)(s[p])&&!(0,f.o8)(s[p].index)&&(n=i=s[p].index-p,delete s[p].index),i>0){for(t=0;i--;)e?(r.createSheet(p+t),t++):s.splice(p,0,null);p+=n,a+=n}if(e){s[p].id<1&&(s[p].id=Xl(r.sheets),s[p].properties&&(s[p].properties.id=s[p].id)),s[p].name||r.setSheetPropertyOnMute(s[p],"name","Sheet"+function(s){var e=[];s.sheets.forEach(function(t){e.push(t.name.toLowerCase())});for(var r=0;r<e.length;r++){if(!(e.indexOf("sheet"+s.sheetNameCount)>-1))return s.sheetNameCount++;s.sheetNameCount++}return s.sheetNameCount++}(r));var c=0;s[p].rows.forEach(function(d){c=Math.max(c,d&&d.cells&&d.cells.length-1||0)}),r.setSheetPropertyOnMute(s[p],"usedRange",{rowIndex:s[p].rows.length?s[p].rows.length-1:0,colIndex:c})}l=p},h=0;h<a;h++)o(h),h=l}var Is=function(){var s=function(e,r){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(e,r)};return function(e,r){function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),Se=function(s,e,r,t){var a,i=arguments.length,n=i<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(s,e,r,t);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);return i>3&&n&&Object.defineProperty(e,r,n),n},np=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Is(e,s),e.prototype.setProperties=function(r,t){var i=this,o="parentObj",l="currRangeIdx",h="controlParent";if(this[o].isComplexArraySetter&&this[h]&&this[h].isAngular)if(Object.keys(r).length){void 0===this[o][l]?this[o][l]=0:this[o][l]+=1;var p=this[o].ranges[this[o][l]];p&&p.info&&(this.info=p.info),setTimeout(function(){void 0!==i[o][l]&&delete i[o][l]})}else if(this[h].tagObjects[0].instance&&this[h].tagObjects[0].instance.hasChanges&&!this[h].tagObjects[0].instance.isInitChanges){var c=this[h].sheets.indexOf(this[o]);if(void 0===this[o].changedRangeIdx){for(var d,u=this[h].tagObjects[0].instance.list[c].tagObjects,v=0;v<u.length;v++)if("ranges"===u[v].name){u[v].instance.list.forEach(function(g,m){g.hasChanges&&(d=m)});break}this[o].changedRangeIdx=d}}s.prototype.setProperties.call(this,r,t)},Se([(0,f.Z9)(null)],e.prototype,"dataSource",void 0),Se([(0,f.Z9)("A1")],e.prototype,"startCell",void 0),Se([(0,f.Z9)(null)],e.prototype,"query",void 0),Se([(0,f.Z9)(!0)],e.prototype,"showFieldAsHeader",void 0),Se([(0,f.Z9)("")],e.prototype,"template",void 0),Se([(0,f.Z9)("A1")],e.prototype,"address",void 0),e}(f.rt),ap=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return Is(e,s),Se([(0,f.Z9)(null)],e.prototype,"rows",void 0),Se([(0,f.Z9)(null)],e.prototype,"columns",void 0),Se([(0,f.Zz)({},_h)],e.prototype,"protectSettings",void 0),Se([(0,f.FE)([],np)],e.prototype,"ranges",void 0),Se([(0,f.FE)([],Wh)],e.prototype,"conditionalFormats",void 0),Se([(0,f.Z9)(0)],e.prototype,"index",void 0),Se([(0,f.Z9)("")],e.prototype,"name",void 0),Se([(0,f.Z9)(100)],e.prototype,"rowCount",void 0),Se([(0,f.Z9)(100)],e.prototype,"colCount",void 0),Se([(0,f.Z9)("A1:A1")],e.prototype,"selectedRange",void 0),Se([(0,f.Z9)("A1")],e.prototype,"activeCell",void 0),Se([(0,f.Z9)({})],e.prototype,"usedRange",void 0),Se([(0,f.Z9)("A1")],e.prototype,"topLeftCell",void 0),Se([(0,f.Z9)(!0)],e.prototype,"showHeaders",void 0),Se([(0,f.Z9)(!0)],e.prototype,"showGridLines",void 0),Se([(0,f.Z9)(!1)],e.prototype,"isProtected",void 0),Se([(0,f.Z9)("Visible")],e.prototype,"state",void 0),Se([(0,f.Z9)(0)],e.prototype,"frozenRows",void 0),Se([(0,f.Z9)(0)],e.prototype,"frozenColumns",void 0),Se([(0,f.Z9)("A1")],e.prototype,"paneTopLeftCell",void 0),Se([(0,f.Z9)("")],e.prototype,"password",void 0),e}(f.rt);function ee(s,e){for(var r,t=0;t<s.sheets.length;t++)if(s.sheets[t].name.toLowerCase()===e.toLowerCase()){r=t;break}return r}function ht(s,e){for(var r,t=0;t<s.sheets.length;t++)if(s.sheets[t].id===e){r=t;break}return r}function Et(s){return s.split("!")[0].replace(/\'/gi,"")}function $i(s,e,r,t){void 0===r&&(r={}),s.setSheetPropertyOnMute(r,"selectedRange",t?r.selectedRange+" "+e:e)}function Yl(s){return s&&s.selectedRange||"A1"}function _(s,e){return s.sheets[e]}function Xl(s){var e=0;return s.forEach(function(r){e=Math.max(r.id,e)}),e+1}function Qi(s,e){var r=e||s.sheets;r.forEach(function(t){if(t.id=t.id||0,t.name=t.name||"",t.rowCount=(0,f.o8)(t.rowCount)?100:t.rowCount,t.colCount=(0,f.o8)(t.colCount)?100:t.colCount,t.topLeftCell=t.topLeftCell||"A1",t.activeCell=t.activeCell||"A1",t.selectedRange=t.selectedRange||"A1:A1",t.usedRange=t.usedRange||{rowIndex:0,colIndex:0},s.setSheetPropertyOnMute(t,"ranges",t.ranges?t.ranges:[]),s.setSheetPropertyOnMute(t,"rows",t.rows&&(0,f.l7)([],t.rows,null,!0)||[]),s.setSheetPropertyOnMute(t,"columns",t.columns||[]),t.showHeaders=!!(0,f.o8)(t.showHeaders)||t.showHeaders,t.showGridLines=!!(0,f.o8)(t.showGridLines)||t.showGridLines,t.state=t.state||"Visible",t.maxHgts=[],t.protectSettings=t.protectSettings||{selectCells:!1,formatCells:!1,formatRows:!1,formatColumns:!1,insertLink:!1},t.isProtected=t.isProtected||!1,!t.paneTopLeftCell||"A1"===t.paneTopLeftCell){t.frozenRows=t.frozenRows?t.frozenRows:0,t.frozenColumns=t.frozenColumns?t.frozenColumns:0;var i=B(t.topLeftCell);s.setSheetPropertyOnMute(t,"paneTopLeftCell",j(t.frozenRows?i[0]+t.frozenRows:i[0],t.frozenColumns?i[1]+t.frozenColumns:i[1]))}Sa(t.columns),function(s){s.forEach(function(e){e&&e.cells&&Sa(e.cells)}),Sa(s)}(t.rows)}),Sa(r,!0,s)}function pt(s,e){return void 0===e&&(e=s.activeSheetIndex),_(s,e).name}function wa(s,e,r,t,i){var n=!!r;r=r||[s.activeSheetIndex];var a=pt(s);e=function(s,e,r){for(var t=e;r?t>=0:t<s.length;r?t--:t++)if("Hidden"!==s[t].state&&"VeryHidden"!==s[t].state){e=t;break}return e}(s.sheets,e,s.activeSheetIndex>e);var o={action:"moveSheet",eventArgs:{position:e,sheetIndexes:r,cancel:!1}};t&&s.trigger("actionBegin",o),o.eventArgs.cancel||(r.forEach(function(l,h){s.sheets.splice(e+h,0,s.sheets.splice(l+(e>l?-1*h:0),1)[0])}),s.setProperties({activeSheetIndex:i?ee(s,a):e>r[0]?e-(r.length-1):e},!0),s.notify(En,{refresh:n}),t&&(delete o.eventArgs.cancel,s.trigger("actionComplete",o)))}function Es(s,e,r,t){var i={action:"duplicateSheet",eventArgs:{sheetIndex:e=(0,f.o8)(e)?s.activeSheetIndex:e,cancel:!1}};if(r&&s.trigger("actionBegin",i),!i.eventArgs.cancel){var n=_(s,e),a=(0,f.l7)({},n.properties?n.properties:n,!0);a.id=Xl(s.sheets);var o=a.name;/^\(\d+\)$/.test("("+o.split(" (")[1])&&(o=o.split(" (")[0]);var l=[];s.sheets.forEach(function(p){l.push(p.name)});for(var h=2;;h++)if(-1===l.indexOf(o+" ("+h+")")){a.name=o+" ("+h+")";break}s.notify(fo,{sheetIndex:e,newSheetIndex:e+1}),s.createSheet(e+1,[a]),s.notify(ie,{action:"addSheet",sheetName:"Sheet"+a.id,visibleName:a.name,sheetId:a.id}),t||s.setProperties({activeSheetIndex:e+1},!0),s.notify(En,{refresh:!0,isDuplicate:!0}),r&&(delete i.eventArgs.cancel,s.trigger("actionComplete",i))}}function E(s,e,r,t,i){var n=vr(r,s);if(!n||!n.cells){if(!t)return i?{}:null;n?r.rows[s].cells=[]:r.rows[s]={cells:[]}}return r.rows[s].cells[e]||(i?{}:null)}function ce(s,e,r,t,i){r.rows[s]?r.rows[s].cells||(r.rows[s].cells=[]):r.rows[s]={cells:[]},i&&r.rows[s].cells[e]?(0,f.l7)(r.rows[s].cells[e],t,null,!0):r.rows[s].cells[e]=t}function ks(s,e){var r={fontFamily:"Calibri",verticalAlign:"bottom",textIndent:"0pt",backgroundColor:"#ffffff",color:"#000000",textAlign:"left",fontSize:"11pt",fontWeight:"normal",fontStyle:"normal",textDecoration:"none",border:"",borderLeft:"",borderTop:"",borderRight:"",borderBottom:""},t={};return Object.keys(e?r:s).forEach(function(i){s[i]!==r[i]&&(t[i]=s[i])}),t}function di(s,e,r,t){void 0===e&&(e=!0);for(var i=r.getAddressInfo(s),n=i.indices,a=_(r,i.sheetIndex),o=i.sheetIndex===r.activeSheetIndex,h=n[0];h<=n[2];h++)for(var p=n[1];p<=n[3];p++)!Je(r,a,{cell:{wrap:e},rowIdx:h,colIdx:p,preventEvt:t})&&o&&r.notify(or,{range:[h,p,h,p],wrap:e,sheet:a});r.setProperties({sheets:r.sheets},!0)}function Ji(s){var e;if(s.indexOf("[")>-1){var r=s.split("[")[1].split("]")[0];["Black","Blue","Cyan","Green","Magenta","Red","White","Yellow"].indexOf(r)>-1&&(e=r)}return e}function Kl(s,e){return!!((s.format.includes("d")||s.format.includes("y"))&&-1===s.format.indexOf("#")&&!Ji(s.format)||e&&(s.format.includes("h")||s.format.includes("m")||s.format.includes("s"))&&-1===s.format.indexOf("#")&&!Ji(s.format))}var $l=function(){function s(){this.services={}}return s.prototype.getService=function(e){if((0,f.le)(this.services[e]))throw"The service "+e+" is not registered";return this.services[e]},s.prototype.register=function(e,r){(0,f.le)(this.services[e])&&(this.services[e]=r)},s}(),fp=function(){var s=function(e,r){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(e,r)};return function(e,r){function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),Rs=function(){return Rs=Object.assign||function(s){for(var e,r=1,t=arguments.length;r<t;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},Rs.apply(this,arguments)},se=function(s,e,r,t){var a,i=arguments.length,n=i<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(s,e,r,t);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);return i>3&&n&&Object.defineProperty(e,r,n),n},Fs=function(s){function e(t){var i=s.call(this,t)||this;return i.isEdit=!1,i.sheetNameCount=1,i.dataValidationRange="",i.isOpen=!1,i.chartColl=[],r.Inject(br,Dn,ln,sn,Pn,Vn,On,Nn,qn,Mn,Un,_n,zn,Wn,Gn,Ca,Bn,Hn,ba),i.commonCellStyle={},t&&t.cellStyle&&(i.commonCellStyle=t.cellStyle),"workbook"===i.getModuleName()&&(i.serviceLocator=new $l,i.initWorkbookServices(),i.dataBind(),i.initEmptySheet()),i}var r;return fp(e,s),r=e,e.prototype.preRender=function(){Object.keys(this.commonCellStyle).length||(this.commonCellStyle=ks(this.cellStyle,!0)),"spreadsheet"===this.getModuleName()&&!this.refreshing&&this.initEmptySheet()},e.prototype.initWorkbookServices=function(){this.serviceLocator.register(jl,new f.E7(this.getModuleName(),ip,this.locale))},e.prototype.render=function(){},e.prototype.requiredModules=function(){return Pl(this)},e.prototype.getPersistData=function(){return this.addOnPersist([])},e.prototype.cellFormat=function(t,i){var n=this.getActiveSheet();this.notify(ye,{style:t,range:i=i||n.selectedRange,refreshRibbon:i.indexOf(n.activeCell)>-1})},e.prototype.lockCells=function(t,i){var n=this.getActiveSheet();this.notify(bn,{range:t=t||n.selectedRange,isLocked:i,triggerEvent:!0})},e.prototype.getCellStyleValue=function(t,i){var n=this,a=E(i[0],i[1],this.getActiveSheet()),o={};return t.forEach(function(l){o[l]=n.cellStyle[l],a&&a.style&&a.style[l]&&(o[l]=a.style[l])}),o},e.prototype.numberFormat=function(t,i){this.notify(xi,{format:t,range:i})},e.prototype.createSheet=function(t,i){var n;void 0===t&&(t=this.sheets.length),void 0===i&&(i=[{}]),(n=this.sheets).splice.apply(n,[t,0].concat(i)),Qi(this,i),this.notify(Ii,{sheetIndex:t||0,sheets:i}),this.notify(ie,{action:"registerSheet",sheetIndex:t||0,sheetCount:t+i.length})},e.prototype.removeSheet=function(t){this.sheets.splice(t,1)},e.prototype.destroy=function(){this.notify("workbookDestroyed",null),s.prototype.destroy.call(this)},e.prototype.onPropertyChanged=function(t,i){for(var n=0,a=Object.keys(t);n<a.length;n++)switch(a[n]){case"cellStyle":(0,f.TS)(this.commonCellStyle,t.cellStyle);break;case"sheets":t.sheets===this.sheets?(this.notify(ie,{action:"unRegisterSheet",propertyChange:!0}),this.sheetNameCount=1,this.notify(ar,{}),Qi(this),this.notify(Ii,null),this.notify(ie,{action:"registerSheet"})):Qi(this)}},e.prototype.appendTo=function(t){s.prototype.appendTo.call(this,t)},e.prototype.hideRow=function(t,i,n){void 0===i&&(i=t),void 0===n&&(n=!0);for(var a=this.getActiveSheet(),o=t;o<=i;o++)dt(a,o,{hidden:n})},e.prototype.hideColumn=function(t,i,n){void 0===i&&(i=t),void 0===n&&(n=!0);for(var a=this.getActiveSheet(),o=t;o<=i;o++)en(a,o,{hidden:n})},e.prototype.setBorder=function(t,i,n){this.notify(ye,{style:t,borderType:n,range:i||this.getActiveSheet().selectedRange})},e.prototype.insertRow=function(t,i,n){this.notify(wt,{model:this.getSheetModel(n),start:t,end:i,modelType:"Row",insertType:"below"})},e.prototype.insertColumn=function(t,i,n){this.notify(wt,{model:this.getSheetModel(n),start:t,end:i,modelType:"Column",insertType:"after"})},e.prototype.insertSheet=function(t,i){this.notify(wt,{model:this,start:t,end:i,modelType:"Sheet"})},e.prototype.delete=function(t,i,n,a){var o;if(t=t||0,n&&"Sheet"!==n){if(!(o=this.getSheetModel(a)))return}else o=this;this.notify(Fi,{model:o,start:t,end:(0,f.le)(i)?t:i,modelType:n||"Sheet"})},e.prototype.moveSheet=function(t,i){wa(this,t,i)},e.prototype.duplicateSheet=function(t){Es(this,t)},e.prototype.getSheetModel=function(t){if((0,f.le)(t))return this.getActiveSheet();var i="string"==typeof t?ee(this,t):t;return(0,f.le)(i)||i>=this.sheets.length?null:this.sheets[i]},e.prototype.merge=function(t,i){var n,a;t?a=_(this,n=qt(this,t)):t=(a=this.getActiveSheet()).selectedRange,this.notify(tt,{merge:!0,range:t,type:i||"All",sheetIndex:n,refreshRibbon:t.indexOf(a.activeCell)>-1,preventRefresh:this.activeSheetIndex!==n})},e.prototype.unMerge=function(t){this.notify(uo,{range:t})},e.prototype.computeExpression=function(t){var i={action:"computeExpression",formula:t};return this.notify(ie,i),i.calcValue},e.prototype.initEmptySheet=function(){this.sheets.length?Qi(this):this.createSheet()},e.prototype.getActiveSheet=function(){return this.sheets[this.activeSheetIndex]},e.prototype.skipHiddenSheets=function(t,i,n){return void 0===n&&(n=0),this.sheets[t]&&"Visible"!==this.sheets[t].state&&(void 0===i&&(i=t),t=t&&t+1===this.sheets.length?i-1:t<i?--t:++t,t=this.skipHiddenSheets(t,i,++n)),n===this.sheets.length?(this.setSheetPropertyOnMute(this.sheets[0],"state","Visible"),0):t},e.prototype.setUsedRange=function(t,i,n,a,o){if(void 0===n&&(n=this.getActiveSheet()),o)return n.usedRange.rowIndex=t,void(n.usedRange.colIndex=i);t>n.usedRange.rowIndex&&(n.usedRange.rowIndex=t,n===this.getActiveSheet()&&!a&&this.notify(qr,{index:t,update:"row"})),i>n.usedRange.colIndex&&(n.usedRange.colIndex=i,n===this.getActiveSheet()&&!a&&this.notify(qr,{index:i,update:"col"}))},e.prototype.getData=function(t){return Zt(this,t)},e.prototype.getModuleName=function(){return"workbook"},e.prototype.goTo=function(t){},e.prototype.getValueRowCol=function(t,i,n,a,o,l){var h={action:"getSheetInfo",sheetInfo:[]};if(this.notify(ie,h),-1===function(s,e,r){for(var t=r.length,i=0;i<t;i++)if(r[i].sheet.toUpperCase()===e.toUpperCase())return r[i].index;return-1}(0,"Sheet"+t,h.sheetInfo)){var p={action:"getReferenceError",refError:""};return this.notify(ie,p),p.refError}var c=ht(this,t),d=_(this,c),u=E(i-1,n-1,d);if(a&&a.includes("!")&&!u&&d.ranges&&d.ranges.length){var v;if(this.formulaRefCell&&this.formulaRefCell===a)return u&&u.value;if(d.ranges.forEach(function(g){g.info&&g.info.loadedRange&&g.info.loadedRange.length||(v=!0)}),v){if(this.formulaRefCell=a,c=ht(this,Number(a.substring(a.lastIndexOf(",")+1,a.length))),(0,f.le)(c))return u&&u.value;a=a.substring(a.lastIndexOf("!")+1,a.lastIndexOf(",")),Zt(this,d.name+"!A1:"+j(i-1,n-1),null,null,null,null,a,c)}}else u&&u.formula&&(o||(0,f.le)(u.value))&&!l&&this.notify("calculateFormula",{cell:u,rowIdx:i-1,colIdx:n-1,sheetIndex:c,formulaRefresh:!0});return u&&u.value},e.prototype.setValueRowCol=function(t,i,n,a,o){this.notify(Sr,{action:"updateCellValue",address:[n-1,a-1],value:i,sheetIndex:ht(this,t),isValueOnly:!0,formula:o})},e.prototype.open=function(t){this.notify(cn,t)},e.prototype.openFromJson=function(t){this.isOpen=!0;var i="object"==typeof t.file?JSON.stringify(t.file):t.file;this.notify(cn,{jsonObject:i})},e.prototype.save=function(t){if(void 0===t&&(t={}),this.allowSave){var n=Rs({},{url:this.saveUrl,fileName:t.fileName||"Sample",saveType:"Xlsx"},t,{customParams:{},isFullPost:!0,needBlobData:!1,cancel:!1,pdfLayoutSettings:{fitSheetOnOnePage:!1}});this.trigger("beforeSave",n),this.notify(ue,{eventArgs:n,action:"beforeSave"}),n.cancel||this.notify(bi,{saveSettings:n,isFullPost:n.isFullPost,needBlobData:n.needBlobData,customParams:n.customParams,pdfLayoutSettings:n.pdfLayoutSettings})}},e.prototype.saveAsJson=function(){var t=this;return new Promise(function(i){t.on($a,function(n){n.cancel=!0,t.off($a),i({jsonObject:{Workbook:n.jsonObject}}),t.notify(wi,n)}),t.save()})},e.prototype.addHyperlink=function(t,i){this.notify(_r,{hyperlink:t,cell:i})},e.prototype.findHandler=function(t){"next"===t.findOpt?this.notify(eo,t):"prev"===t.findOpt&&this.notify(to,t)},e.prototype.replaceHandler=function(t){this.notify("replace"===t.replaceBy?Ai:Gr,t)},e.prototype.protectSheet=function(t,i,n){this.notify(jr,{protectSettings:i,password:n,sheetIndex:t})},e.prototype.unprotectSheet=function(t){this.notify(bl,{sheet:t})},e.prototype.sort=function(t,i){if(!this.allowSorting)return Promise.reject();var o={args:{range:i||this.getActiveSheet().selectedRange,sortOptions:t||{sortDescriptors:{}},cancel:!1},promise:new Promise(function(l,h){l(void 0)})};return this.notify(ki,o),o.promise},e.prototype.addDataValidation=function(t,i){"List"===t.type&&t.value1.length>256&&(t.value1=t.value1.substring(0,255)),this.notify(sr,{rules:t,range:i||this.getActiveSheet().selectedRange})},e.prototype.removeDataValidation=function(t){this.notify(sr,{range:t,isRemoveValidation:!0})},e.prototype.addInvalidHighlight=function(t){this.notify(Wr,{range:t})},e.prototype.removeInvalidHighlight=function(t){this.notify(io,{range:t})},e.prototype.isValidCell=function(t){var i=B(t),n=E(i[0],i[1],this.getActiveSheet());if(n&&n.validation){var l={value:n.value?n.value:"",range:i,sheetIdx:this.activeSheetIndex,isCell:!1,td:null,isValid:!0};return this.notify(Ti,l),l.isValid}return!0},e.prototype.conditionalFormat=function(t){t.range=t.range||this.getActiveSheet().selectedRange,this.notify(Xr,{cfModel:t})},e.prototype.clearConditionalFormat=function(t){var i={};if(t&&t.includes("!")){var n=t.split("!");i.range=n[1],i.sheetIdx=ee(this,n[0])}else i.range=t||this.getActiveSheet().selectedRange,i.sheetIdx=this.activeSheetIndex;this.notify(_t,i)},e.prototype.updateCell=function(t,i){var n,a;if(i||(i=this.getActiveSheet().activeCell),i.includes("!")){if(n=De(i),void 0===(a=ee(this,i.split("!")[0])))return}else n=A(i),a=this.activeSheetIndex;Je(this,this.sheets[a],{cell:t,rowIdx:n[0],colIdx:n[1],preventEvt:!0});var o=(0,f.le)(t.value)?t.formula||null:t.value;null!==o&&this.notify(Sr,{action:"updateCellValue",address:n,value:o,sheetIndex:a}),a===this.activeSheetIndex&&(this.serviceLocator.getService("cell").refresh(n[0],n[1],!0,null,null!==o),this.notify(St,null),Ht(A(this.sheets[a].activeCell),n[0],n[1])&&this.notify(cr,{action:"refreshFormulabar",value:this.getDisplayText(t)||t.formula}))},e.prototype.getRowData=function(t,i){(0,f.le)(t)&&(t=0),(0,f.le)(i)&&(i=this.activeSheetIndex);var n={sheetIdx:i,startIndex:t,modelType:"Row",isDataRequest:!0};return this.notify(pn,n),n.data},e.prototype.updateRange=function(t,i){var n=_(this,i=i?i-1:this.activeSheetIndex),a=n.ranges;(0,f.le)(n)||(a.push(t),n.ranges=a)},e.prototype.wrap=function(t,i){void 0===i&&(i=!0),di(t,i,this)},e.prototype.addDefinedName=function(t){var i={action:"addDefinedName",isAdded:!1,definedName:t};return this.notify(ie,i),i.isAdded},e.prototype.removeDefinedName=function(t,i){void 0===i&&(i="");var n={action:"removeDefinedName",isRemoved:!1,definedName:t,scope:i};return this.notify(ie,n),n.isRemoved},e.prototype.clearRange=function(t,i,n){},e.prototype.insertImage=function(t,i){this.notify(wn,{options:t,range:i||this.getActiveSheet().selectedRange})},e.prototype.autoFill=function(t,i,n,a){var o={dataRange:i||this.getActiveSheet().selectedRange,fillRange:t,direction:n||"Down",fillType:a||"FillSeries"};this.notify(Qr,o)},e.prototype.insertChart=function(t){this.notify(lr,{chart:t})},e.prototype.deleteChart=function(t){this.notify(Dr,{id:t})},e.prototype.filter=function(t,i){if(!this.allowFiltering)return Promise.reject();var o={args:{range:i||this.getActiveSheet().selectedRange,filterOptions:t,cancel:!1},promise:new Promise(function(l,h){l(void 0)})};return this.notify(gn,o),o.promise},e.prototype.addCustomFunction=function(t,i,n){i=i||("string"==typeof t?t:t.name.replace("bound ","")),this.notify(ie,{action:"addCustomFunction",functionHandler:t,functionName:i,formulaDescription:n})},e.prototype.clear=function(t){this.notify(wr,t)},e.prototype.getDisplayText=function(t){if(!t)return"";if(t.format&&!(0,f.le)(t.value)){var i={formattedText:t.value,value:t.value,format:t.format,onLoad:!0,cell:t,skipRowFill:!0};return this.notify(ot,i),i.formattedText}return!t.value&&t.hyperlink?"string"==typeof t.hyperlink?t.hyperlink:t.hyperlink.address:t.value||"number"==typeof t.value?t.value.toString():""},e.prototype.freezePanes=function(t,i,n){void 0===t&&(t=1),void 0===i&&(i=1);var a=this.getSheetModel(n);!this.allowFreezePane||a.frozenRows===t&&a.frozenColumns===i||(this.setSheetPropertyOnMute(a,"frozenRows",t),this.setSheetPropertyOnMute(a,"frozenColumns",i),this.updateTopLeftCell(),a.id===this.getActiveSheet().id&&"spreadsheet"===this.getModuleName()&&this.renderModule.refreshSheet())},e.prototype.Unfreeze=function(t){this.freezePanes(0,0,t)},e.prototype.unfreezePanes=function(t){this.freezePanes(0,0,t)},e.prototype.updateTopLeftCell=function(t,i,n,a){a||(a=this.getActiveSheet());var o=B(a.topLeftCell);a.frozenRows||a.frozenColumns?((0,f.le)(t)&&(t=a.frozenRows?0:o[0]),(0,f.le)(i)&&(i=a.frozenColumns?0:o[1]),t+=this.frozenRowCount(a),i+=this.frozenColCount(a),n&&("row"===n?t=B(a.paneTopLeftCell)[0]:i=B(a.paneTopLeftCell)[1]),this.setSheetPropertyOnMute(a,"paneTopLeftCell",j(t,i)),a.frozenRows&&(t=o[0]),a.frozenColumns&&(i=o[1])):((0,f.le)(t)&&(t=o[0]),(0,f.le)(i)&&(i=o[1]),this.setSheetPropertyOnMute(a,"paneTopLeftCell",j(t,i))),this.setSheetPropertyOnMute(a,"topLeftCell",j(t,i))},e.prototype.getAddressInfo=function(t){return ul(this,t)},e.prototype.setSheetPropertyOnMute=function(t,i,n){this.isProtectedOnChange=!0,t[i]=n,this.isProtectedOnChange=!1},e.prototype.frozenRowCount=function(t){return t.frozenRows?"A1"===t.topLeftCell?t.frozenRows:B(t.topLeftCell)[0]+t.frozenRows:0},e.prototype.frozenColCount=function(t){return t.frozenColumns?"A1"===t.topLeftCell?t.frozenColumns:B(t.topLeftCell)[1]+t.frozenColumns:0},e.prototype.updateRangeOnInsertDelete=function(t,i){var n,a=!1;return t.isInsert?(n=t.endIndex-t.startIndex+1,"Row"===t.modelType?(t.startIndex<=i[0]&&(i[0]+=n,a=!0),t.startIndex<=i[2]&&(i[2]+=n,a=!0)):(t.startIndex<=i[1]&&(i[1]+=n,a=!0),t.startIndex<=i[3]&&(i[3]+=n,a=!0))):"Row"===t.modelType?((n=i[0]-t.startIndex)>0&&(i[0]>t.endIndex?(n=t.endIndex-t.startIndex+1)>0&&(i[0]-=n,a=!0):(i[0]-=n,a=!0)),t.startIndex<=i[2]&&(i[2]-=t.endIndex<=i[2]?t.endIndex-t.startIndex+1:i[2]-t.startIndex+1,a=!0)):((n=i[1]-t.startIndex)>0&&(i[1]>t.endIndex?(n=t.endIndex-t.startIndex+1)>0&&(i[1]-=n,a=!0):(i[1]-=n,a=!0)),t.startIndex<=i[3]&&(i[3]-=t.endIndex<=i[3]?t.endIndex-t.startIndex+1:i[3]-t.startIndex+1,a=!0)),a},e.prototype.dateToInt=function(t){return Ut(t)},e.prototype.setDateFormat=function(t,i,n){var a=_(this,ht(this,t));E(i,n,a,null,!0).format||ce(i,n,a,{format:Ee("ShortDate")},!0)},se([(0,f.FE)([],ap)],e.prototype,"sheets",void 0),se([(0,f.Z9)(0)],e.prototype,"activeSheetIndex",void 0),se([(0,f.Z9)("100%")],e.prototype,"height",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowFindAndReplace",void 0),se([(0,f.Z9)()],e.prototype,"filterCollection",void 0),se([(0,f.Z9)()],e.prototype,"sortCollection",void 0),se([(0,f.Z9)("100%")],e.prototype,"width",void 0),se([(0,f.Z9)(!0)],e.prototype,"showRibbon",void 0),se([(0,f.Z9)(!0)],e.prototype,"showFormulaBar",void 0),se([(0,f.Z9)(!0)],e.prototype,"showSheetTabs",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowEditing",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowOpen",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowSave",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowSorting",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowFiltering",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowNumberFormatting",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowCellFormatting",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowHyperlink",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowInsert",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowDelete",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowMerge",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowDataValidation",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowImage",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowChart",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowAutoFill",void 0),se([(0,f.Zz)({},$h)],e.prototype,"autoFillSettings",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowConditionalFormat",void 0),se([(0,f.Zz)({},Cs)],e.prototype,"cellStyle",void 0),se([(0,f.Z9)("")],e.prototype,"openUrl",void 0),se([(0,f.Z9)("")],e.prototype,"saveUrl",void 0),se([(0,f.Z9)("")],e.prototype,"password",void 0),se([(0,f.Z9)(!1)],e.prototype,"isProtected",void 0),se([(0,f.FE)([],Vl)],e.prototype,"definedNames",void 0),se([(0,f.ju)()],e.prototype,"beforeOpen",void 0),se([(0,f.ju)()],e.prototype,"openFailure",void 0),se([(0,f.ju)()],e.prototype,"beforeSave",void 0),se([(0,f.ju)()],e.prototype,"saveComplete",void 0),se([(0,f.ju)()],e.prototype,"beforeCellFormat",void 0),se([(0,f.ju)()],e.prototype,"queryCellInfo",void 0),se([(0,f.ju)()],e.prototype,"beforeCellUpdate",void 0),se([(0,f.Z9)(!0)],e.prototype,"allowFreezePane",void 0),r=se([f.Zl],e)}(f.wA);function vr(s,e){return s.rows[e]}function dt(s,e,r){s.rows[e]||(s.rows[e]={}),Object.keys(r).forEach(function(t){s.rows[e][t]=r[t]})}function ne(s,e){return s.rows[e]&&s.rows[e].hidden}function rr(s,e){return s.rows[e]&&s.rows[e].isFiltered}function le(s,e,r,t){var i;if(s&&s.rows&&s.rows[e]){if(!t&&s.rows[e].hidden)return 0;i=void 0===s.rows[e].height?20:s.rows[e].height}else i=20;if(r&&window.devicePixelRatio%1>0){var n=i*window.devicePixelRatio%1;return i+(n?(n>.5?1-n:-1*n)/window.devicePixelRatio:0)}return i}function ui(s,e,r){s&&s.rows&&(s.rows[e]||(s.rows[e]={}),s.rows[e].height=r)}function Ce(s,e,r,t,i){void 0===r&&(r=e);var a,n=0;e>r&&(a=e,e=r,r=a);for(var o=e;o<=r;o++)n+=le(s,o,t,i);return n}function Fe(s,e){return s.columns?s.columns[e]||(s.columns[e]={}):(s.columns=[],s.columns[e]={}),s.columns[e]}function en(s,e,r){var t=Fe(s,e);Object.keys(r).forEach(function(i){t[i]=r[i]})}function Te(s,e,r,t){var i;if(s&&s.columns&&s.columns[e]){if(!r&&s.columns[e].hidden)return 0;i=s.columns[e].width||s.columns[e].customWidth?s.columns[e].width:64}else i=64;if(t&&window.devicePixelRatio%1>0){var n=i*window.devicePixelRatio%1;return i+(n?(n>.5?1-n:-1*n)/window.devicePixelRatio:0)}return i}function ge(s,e,r,t){void 0===r&&(r=e);var i=0;if(e>r){var n=e;e=r,r=n}for(var a=e;a<=r;a++)i+=Te(s,a,null,t);return i}function we(s,e){return s.columns[e]&&s.columns[e].hidden}function Ql(s,e,r){return!!(s&&s.validation&&(!s.validation.address||s.validation.address&&zl(s.validation.address,e,r)))}function Pe(s){requestAnimationFrame(function(){s()})}function Ts(s){for(;s.firstChild;)s.removeChild(s.firstChild)}function Jl(s){var e=30;return s.toString().length>3&&(e=10*s.toString().length),e}var As=null;function Ds(){if(null!==As)return As;var e,s=document.createElement("div");return s.style.cssText="width:100px;height: 100px;overflow: scroll;position: absolute;top: -9999px;",document.body.appendChild(s),e=s.offsetWidth-s.clientWidth|0,document.body.removeChild(s),As=e}var yp=["e-ribbon","e-formula-bar-panel","e-sheet-tab-panel","e-header-toolbar"];function th(s,e){return void 0===e&&(e=yp),rh(s,"previous",e)+rh(s,"next",e)}function rh(s,e,r){for(var t=s[e+"ElementSibling"],i=0;t;)r.some(function(n){return t.classList.contains(n)})&&(i+=t.offsetHeight),t=t[e+"ElementSibling"];return i}function ih(s,e,r){if(s.scrollSettings.enableVirtualization){var t=s.getActiveSheet(),i=s.frozenRowCount(t),n=s.frozenColCount(t),a=s.viewport.topIndex+i,o=s.viewport.leftIndex+n,l=s.viewport.bottomIndex,h=s.viewport.rightIndex;if(t.frozenRows||t.frozenColumns){if(s.insideViewport(e[0],e[1])||s.insideViewport(e[2],e[3]))return!0}else if(a<=e[0]&&l>=e[2]&&o<=e[1]&&h>=e[3])return!0;var p=!1;if(r){if(e[0]<a&&e[2]<a||e[0]>l&&e[2]>l||(e[0]<a&&e[2]>a&&e[0]>=i&&(e[0]=a,p=!0),e[2]>l&&(e[2]=l,p=!0),e[1]<o&&e[3]<o||e[1]>h&&e[3]>h))return!1;e[1]<o&&e[3]>o&&e[1]>=n&&(e[1]=o,p=!0),e[3]>h&&(e[3]=h,p=!0)}return p}return!0}function xa(s,e,r,t,i,n,a){var o,l_left_idx=0,h=0,p=0;for(o=0;o<e[0];o++)r&&r-1<e[0]&&o<r||(h+=le(s,o,!0));for(o=l_left_idx;o<e[1];o++)t&&t-1<e[1]&&o<t||(p+=Te(s,o,null,!0));return r&&e[0]<r&&(s.showHeaders&&(h+=30),i&&(h-=i)),t&&e[1]<t&&(s.showHeaders&&(p+=a||30),n&&(p-=n)),{top:h,left:p}}function ft(s,e,r,t,i,n,a){void 0===t&&(t="e-selection");var o=s.getActiveSheet();if(!o.frozenRows&&!o.frozenColumns){var b=ut(s,e,r,o,s.enableRtl,0,0,i);return e&&!s.getMainContent().querySelector("."+t)&&s.getMainContent().appendChild(e),b}var l,h=s.frozenRowCount(o),p=s.frozenColCount(o);if("e-active-cell"===t)r[0]<h||r[1]<p?(e.style.display="none",(c=(l=r[0]<h&&r[1]<p?s.getSelectAllContent():r[0]<h?s.getColumnHeaderContent():s.getRowHeaderContent()).querySelector("."+t))||(c=e.cloneNode(!0),l.appendChild(c)),ut(s,e=c,r,o,s.enableRtl,h,p,i,!0,s.viewport.beforeFreezeHeight,s.viewport.beforeFreezeWidth,s.sheetModule.colGroupWidth)):ut(s,e,r,o,s.enableRtl,h,p,i),e.style.display&&(e.style.display=""),xe(s.getSelectAllContent(),l,"e-active-cell"),xe(s.getColumnHeaderContent(),l,"e-active-cell"),xe(s.getRowHeaderContent(),l,"e-active-cell");else if("e-autofill"===t){var d=void 0,u=s.frozenRowCount(o),v=s.frozenColCount(o);r[0]<u||r[1]<v?(e.style.display="none",(c=(d=r[0]<u&&r[1]<v?s.getSelectAllContent():r[0]<u?s.getColumnHeaderContent():s.getRowHeaderContent()).querySelector("."+t))||(c=e.cloneNode(!0),d.appendChild(c)),ut(s,e=c,r,o,s.enableRtl,u,v,i,!0,s.viewport.beforeFreezeHeight,s.viewport.beforeFreezeWidth,s.sheetModule.colGroupWidth,"e-autofill")):ut(s,e,r,o,s.enableRtl,u,v,i,!1,0,0,0,"e-autofill"),e.style.display&&(e.style.display=""),xe(s.getSelectAllContent(),d,"e-autofill"),xe(s.getColumnHeaderContent(),d,"e-autofill"),xe(s.getRowHeaderContent(),d,"e-autofill")}else if("e-filloption"===t){if(d=void 0,u=s.frozenRowCount(o),v=s.frozenColCount(o),r[0]<u||r[1]<v)if(r[3]+1===v&&r[2]+1>u)ut(s,s.getMainContent().querySelector(".e-filloption"),r,o,s.enableRtl,u,v,i,!1,0,0,0,"e-filloption",!0,{left:-4});else if(r[2]+1===u&&r[3]+1>v)ut(s,s.getMainContent().querySelector(".e-filloption"),r,o,s.enableRtl,u,v,i,!1,0,0,0,"e-filloption",!0,{top:-4});else if(r[3]+1===v&&r[2]+1<u)(d=s.getColumnHeaderContent()).querySelector("."+t)||s.notify(kn,{id:s.element.id+"_autofilloptionbtn",appendElem:d}),ut(s,e=s.autofillModule.autoFillDropDown.element,r,o,s.enableRtl,u,v,i,!1,0,0,0,"e-filloption",!0,{left:-4});else if(r[2]+1===u&&r[3]+1===v)ut(s,s.getMainContent().querySelector(".e-filloption"),r,o,s.enableRtl,u,v,i,!1,0,0,0,"e-filloption",!0,{top:-4,left:-4});else{var c;(c=(d=r[0]<u&&r[1]<v?s.getSelectAllContent():r[0]<u?s.getColumnHeaderContent():s.getRowHeaderContent()).querySelector("."+t))||s.notify(kn,{id:s.element.id+"_autofilloptionbtn",appendElem:d}),ut(s,e=s.autofillModule.autoFillDropDown.element,r,o,s.enableRtl,u,v,i,!0,s.viewport.beforeFreezeHeight,s.viewport.beforeFreezeWidth,s.sheetModule.colGroupWidth,"e-filloption",!0)}else ut(s,s.getMainContent().querySelector(".e-filloption"),r,o,s.enableRtl,u,v,i,!1,0,0,0,"e-filloption",!0);e.style.display&&(e.style.display=""),xe(s.getSelectAllContent(),d,"e-filloption"),xe(s.getColumnHeaderContent(),d,"e-filloption"),xe(s.getRowHeaderContent(),d,"e-filloption")}else{var m=Q(r);if(m[0]<h||m[1]<p){e&&!e.classList.contains("e-multi-range")&&e.classList.add("e-hide");var C,y=[];m[0]<h&&m[1]<p?m[2]<h&&m[3]<p?(y.push(r),n||(xe(s.getColumnHeaderContent(),l,t,!0),xe(s.getRowHeaderContent(),l,t,!0))):m[2]>h-1?m[3]<p?(n||xe(s.getColumnHeaderContent(),l,t,!0),y.push([m[0],m[1],h-1,m[3]]),y.push([h,m[1],m[2],m[3]])):(y.push([m[0],m[1],h-1,p-1]),y.push([h,m[1],m[2],p-1]),y.push([m[0],p,h-1,m[3]]),y.push([h,p,m[2],m[3]])):m[2]<h?(y.push([m[0],m[1],m[2],p-1]),y.push([m[0],p,m[2],m[3]]),n||xe(s.getRowHeaderContent(),l,t,!0)):(y.push([h,m[1],m[2],p-1]),y.push([m[0],m[1],h-1,p-1]),y.push([h,p,m[2],m[3]]),y.push([m[0],p,h-1,m[3]])):m[0]<h?m[2]<h?(y.push(r),n||xe(s.getRowHeaderContent(),l,t,!0)):(y.push([m[0],m[1],h-1,m[3]]),y.push([h,m[1],m[2],m[3]]),n||(xe(s.getSelectAllContent(),l,t,!0),xe(s.getRowHeaderContent(),l,t,!0))):m[3]<p?(y.push(r),n||xe(s.getSelectAllContent(),l,t,!0)):(y.push([m[0],m[1],m[2],p-1]),y.push([m[0],p,m[2],m[3]]),n||(xe(s.getSelectAllContent(),l,t,!0),xe(s.getColumnHeaderContent(),l,t,!0))),y.forEach(function(S){var w;l=S[2]<h&&S[3]<p?s.getSelectAllContent():S[2]<h?s.getColumnHeaderContent():S[3]<p?s.getRowHeaderContent():s.getMainContent(),"e-copy-indicator"===t||"e-range-indicator"===t?(w=e.cloneNode(!0),l.appendChild(w),h&&(S[2]+1===h&&y.forEach(function(x){x!==S&&(C=w.getElementsByClassName("e-bottom")[0])&&x[0]===h&&(0,f.og)(C)}),S[0]===h&&l.parentElement.classList.contains("e-main-panel")&&y.forEach(function(x){x!==S&&(C=w.getElementsByClassName("e-top")[0])&&x[2]+1===h&&(0,f.og)(C)})),p&&(S[3]+1===p&&y.forEach(function(x){x!==S&&(C=w.getElementsByClassName("e-right")[0])&&x[1]===p&&(0,f.og)(C)}),S[1]===p&&(l.classList.contains("e-sheet-content")||l.classList.contains("e-column-header"))&&y.forEach(function(x){x!==S&&(C=w.getElementsByClassName("e-left")[0])&&x[3]+1===p&&(0,f.og)(C)}))):((w=l.querySelector("."+t))||(w=e.cloneNode(!0),n&&!w.classList.contains("e-multi-range")&&w.classList.add("e-multi-range"),l.appendChild(w)),a&&w.classList.remove(t)),ut(s,w,S,o,s.enableRtl,h,p,i,!1,s.viewport.beforeFreezeHeight,s.viewport.beforeFreezeWidth,s.sheetModule.colGroupWidth),w.classList.contains("e-hide")&&w.classList.remove("e-hide")})}else n||(xe(s.getSelectAllContent(),null,t,!0),xe(s.getColumnHeaderContent(),null,t,!0),xe(s.getRowHeaderContent(),null,t,!0)),ut(s,e,r,o,s.enableRtl,h,p,i),("e-range-indicator"===t||!s.getMainContent().querySelector("."+t))&&s.getMainContent().appendChild(e),e.classList.contains("e-hide")&&e.classList.remove("e-hide"),a&&e.classList.remove(t)}}function xe(s,e,r,t,i){if(t||s!==e)if(i)for(var n=s.querySelectorAll("."+r),a=0;a<n.length;)n[a].classList.remove(r),a++;else{var o=s.querySelector("."+r);o&&!o.classList.contains("e-multi-range")&&(0,f.og)(o)}}function ut(s,e,r,t,i,n,a,o,l,h,p,c,d,u,v){var C,b,g=Q(r),m=xa(t,g,n,a,h,p,c),y=[U(t,0,!0),U(t,0,!0,"columns")];s.scrollSettings.isFinite?(C=g[0]>=t.rowCount?0:Ce(t,g[0],g[2]<t.rowCount?g[2]:t.rowCount-1,!0),b=g[1]>=t.colCount?0:ge(t,g[1],g[3]<t.colCount?g[3]:t.colCount-1,!0)):(C=Ce(t,g[0],g[2],!0),b=ge(t,g[1],g[3],!0));var S=0===g[1]&&g[3]===t.colCount-1,w=0===g[0]&&g[2]===t.rowCount-1,x=0,I=-5,F=-5,T=0,k=6,R=6;if((0,f.le)(d)){if((D={top:(g[0]===y[0]?m.top:m.top-Ve(1))+"px",height:C&&C+(g[0]===y[0]?0:Ve(1))+"px",width:b&&b+(g[1]===y[1]?0:Ve(1))+(l&&a&&g[1]<a&&g[3]>=a?1:0)+"px"})[i?"right":"left"]=(g[1]===y[1]?m.left:m.left-1)+"px",e)return Ls([{element:e,attrs:D}],o)}else{S&&(I=-5,F=-2,k=6,R=3),w&&(F=-5,I=0,k=1,R=6),w||(x+=C),S||(T+=b),x+=Math.round(m.top)+I,T+=Math.round(m.left)+F;var D={};u?((0,f.IV)([e],"e-hide"),D={top:(x=v&&v.top?v.top:x)+k+"px",left:(T=v&&v.left?v.left:T)+R+"px"},e&&Ls([{element:e,attrs:D}],o)):((D={top:x+"px"})[i?"right":"left"]=T+"px",e&&Ls([{element:e,attrs:D}],o))}}function Ls(s,e){return new Promise(function(t){var i=function(){s.forEach(function(n){(0,f.V7)(n.element,n.attrs),t()})};e?i():requestAnimationFrame(function(){return i()})})}function Ia(){return f.AR.isPointer?"pointerdown":"mousedown touchstart"}function Ea(){return f.AR.isPointer?"pointermove":"mousemove touchmove"}function nh(){return f.AR.isPointer?"pointerup":"mouseup touchend"}function Os(s){return"touchstart"===s.type||"pointerdown"===s.type&&"touch"===s.pointerType}function ah(s){return"touchmove"===s.type||"pointermove"===s.type&&"touch"===s.pointerType}function Ns(s){return"touchend"===s.type||"pointerup"===s.type&&"touch"===s.pointerType}function oh(s){return s&&("mousedown"===s.type||"pointerdown"===s.type)}function ka(s){return s&&("mousemove"===s.type||"pointermove"===s.type)}function sh(s){return s&&("mouseup"===s.type||"pointerup"===s.type)}function vi(s){return s.changedTouches?s.changedTouches[0].clientX:s.clientX}function mi(s){return s.changedTouches?s.changedTouches[0].clientY:s.clientY}function Ve(s,e){if(window.devicePixelRatio%1>0){var r=s*window.devicePixelRatio%1;return s+(r?(r>.5||e?1-r:-1*r)/window.devicePixelRatio:0)}return s}var Cp={role:"role",selected:"aria-selected",multiselectable:"aria-multiselectable",busy:"aria-busy",colcount:"aria-colcount"};function Br(s,e){Object.keys(e).forEach(function(t){s&&s.setAttribute(Cp[t],e[t])})}function Ms(s,e,r,t,i){var n,a,o,l,h,p,c,d,u,v=i.getActiveSheet(),g=i.frozenRowCount(v),m=i.frozenColCount(v);if(t){var y=s<m?i.getSelectAllContent():i.getColumnHeaderContent();n=y.getElementsByTagName("th")[e],a=y.getElementsByTagName("col")[e],o=(s<m?i.getRowHeaderContent():i.getMainContent()).getElementsByTagName("col")[e]}else{n=a=g||m?i.getRow(s,null,m-1):i.getRow(s,i.getRowHeaderTable()),a.style.height=parseInt(r,10)>0?Ve(parseInt(r,10))+"px":"2px",(o=i.getRow(s,null,m)).style.height=parseInt(r,10)>0?Ve(parseInt(r,10))+"px":"0px";var C=void 0;if(v.showHeaders){var b=i.getRowHeaderContent().getElementsByClassName("e-row"),S=[];S[0]=b[e].getElementsByTagName("td")[0].cloneNode(!0),C=Bs(i.getRowHeaderTable(),S,!1,i)+1}for(var w=i.getMainContent().getElementsByClassName("e-row"),x=[],I=0;I<w[e].getElementsByTagName("td").length;I++)x[I]=w[e].getElementsByTagName("td")[I].cloneNode(!0);var F=Bs(i.getContentTable(),x,!1,i)+1,T=C>=F?C:F;parseInt(o.style.height,10)<T||n&&n.classList.contains("e-reach-fntsize")&&parseInt(o.style.height,10)===T?(v.showHeaders&&(n.classList.add("e-reach-fntsize"),a.style.lineHeight=parseInt(r,10)>=4?parseInt(r,10)-4+"px":parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"),o.style.lineHeight=parseInt(r,10)>0?parseInt(r,10)-1+"px":"0px"):(a&&a.style.removeProperty("line-height"),o.style.removeProperty("line-height"),n&&n.classList.contains("e-reach-fntsize")&&n.classList.remove("e-reach-fntsize"))}if((p=o.previousElementSibling)&&(v.showHeaders&&(l=n.previousElementSibling,h=a.previousElementSibling),p=o.previousElementSibling),(u=o.nextElementSibling)&&(v.showHeaders&&(c=n.nextElementSibling,d=a.nextElementSibling),u=o.nextElementSibling),parseInt(r,10)<=0&&!o.classList.contains("e-zero")&&!o.classList.contains("e-zero-start")){if(p&&u)if(t?(v.showHeaders&&(a.style.width="2px"),o.style.width="0px"):(v.showHeaders&&(a.style.height="2px"),o.style.height="0px"),p.classList.contains("e-zero-start")?(v.showHeaders&&n.classList.add("e-zero-start"),o.classList.add("e-zero-start")):(v.showHeaders&&n.classList.add("e-zero"),o.classList.add("e-zero")),c&&!c.classList.contains("e-zero")&&!c.classList.contains("e-zero-last")&&(v.showHeaders&&n.classList.add("e-zero-last"),o.classList.add("e-zero-last")),p.classList.contains("e-zero-last")&&(v.showHeaders&&l.classList.remove("e-zero-last"),p.classList.remove("e-zero-last")),v.showHeaders&&l.classList.contains("e-zero")?(n.classList.contains("e-zero-end"),Ze(h,-2,t)):v.showHeaders&&Ze(h,-1,t),v.showHeaders&&l.classList.contains("e-zero-start")&&Ze(a,-1,t),v.showHeaders&&c.classList.contains("e-zero"))if(n.classList.contains("e-zero-start"))for(;c;){if(c.classList.contains("e-zero")&&0!==parseInt(d.style.height,10)&&!t||0!==parseInt(d.style.width,10)&&t){t?(a.style.width=parseInt(a.style.width,10)-1+"px",d.style.width=parseInt(d.style.width,10)-1+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",d.style.height=parseInt(d.style.height,10)-1+"px"),c.classList.remove("e-zero"),c.classList.add("e-zero-start");break}var k=void 0;c.classList.remove("e-zero"),c.classList.add("e-zero-start"),t?(k=parseInt(c.getAttribute("aria-colindex"),10)-1,c=i.getColHeaderTable().getElementsByTagName("th")[k+1],d=i.getColHeaderTable().getElementsByTagName("col")[k+1]):(k=parseInt(c.getAttribute("aria-rowindex"),10)-1,c=i.getRowHeaderTable().getElementsByTagName("tr")[k+1],d=i.getRowHeaderTable().getElementsByTagName("tr")[k+1])}else Ze(a,-2,t);else v.showHeaders&&(c.classList.contains("e-zero-end")?t?a.style.width="0px":a.style.height="0px":Ze(d,-1,t));else if(p)t?(v.showHeaders&&(a.style.width="1px"),o.style.width="0px"):(v.showHeaders&&(a.style.height="1px"),o.style.height="0px"),v.showHeaders&&n.classList.add("e-zero-end"),o.classList.add("e-zero-end"),v.showHeaders&&n.classList.add("e-zero-last"),o.classList.add("e-zero-last"),v.showHeaders&&l.classList.contains("e-zero")?Ze(h,-2,t):Ze(h,-1,t);else if(c)if(n.classList.add("e-zero-start"),o.classList.add("e-zero-start"),c.classList.contains("e-zero")||(n.classList.add("e-zero-last"),o.classList.add("e-zero-last")),t?(a.style.width="1px",o.style.width="0px"):(a.style.height="1px",o.style.height="0px"),v.showHeaders&&c.classList.contains("e-zero"))for(;c;){if(c.classList.contains("e-zero")&&0!==parseInt(d.style.width,10)&&t||0!==parseInt(d.style.height,10)&&!t){t?(d.style.width=parseInt(d.style.width,10)-1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(d.style.height=parseInt(d.style.height,10)-1+"px",a.style.height=parseInt(a.style.height,10)-1+"px"),c.classList.add("e-zero-start"),c.classList.remove("e-zero");break}k=void 0,c.classList.add("e-zero-start"),c.classList.remove("e-zero"),t?(k=parseInt(c.getAttribute("aria-colindex"),10)-1,d=i.getColHeaderTable().getElementsByTagName("col")[k+1],c=i.getColHeaderTable().getElementsByTagName("th")[k+1]):(k=parseInt(c.getAttribute("aria-rowindex"),10)-1,d=i.getRowHeaderTable().getElementsByTagName("tr")[k+1],c=i.getRowHeaderTable().getElementsByTagName("tr")[k+1])}else v.showHeaders&&Ze(d,-1,t)}else if(parseInt(r,10)>0){var R=Ve(parseInt(r,10))+"px";t?(a.style.width=R,o.style.width=R):(a.style.height=R,o.style.height=R),v.showHeaders&&l&&c?(l.classList.contains("e-zero")?n.classList.contains("e-zero")?t?(h.style.width=parseInt(h.style.width,10)+2+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(h.style.height=parseInt(h.style.height,10)+2+"px",a.style.height=parseInt(a.style.height,10)-1+"px"):Ze(a,-1,t):n.classList.contains("e-zero")?Ze(h,1,t):n.classList.contains("e-zero-start")&&(t?(h.style.width=parseInt(h.style.width,10)+1+"px",a.style.width=parseInt(a.style.width,10)-1+"px"):(h.style.height=parseInt(h.style.height,10)+1+"px",a.style.height=parseInt(a.style.height,10)-1+"px")),c.classList.contains("e-zero")?Ze(a,-1,t):(n.classList.contains("e-zero")||n.classList.contains("e-zero-start"))&&Ze(d,1,t),n.classList.contains("e-zero")&&n.classList.remove("e-zero"),n.classList.contains("e-zero-start")&&n.classList.remove("e-zero-start"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"),n.classList.contains("e-zero-last")&&n.classList.remove("e-zero-last"),o.classList.contains("e-zero-last")&&o.classList.remove("e-zero-last"),(l.classList.contains("e-zero")||l.classList.contains("e-zero-start"))&&(l.classList.add("e-zero-last"),p.classList.add("e-zero-last"))):v.showHeaders&&l?(l.classList.contains("e-zero")?n.classList.contains("e-zero")?t?(a.style.width=parseInt(a.style.width,10)-1+"px",h.style.width=parseInt(h.style.width,10)+2+"px"):(a.style.height=parseInt(a.style.height,10)-1+"px",h.style.height=parseInt(h.style.height,10)+2+"px"):Ze(a,-1,t):n.classList.contains("e-zero")?Ze(h,1,t):Ze(a,-1,t),n.classList.contains("e-zero")&&n.classList.remove("e-zero"),n.classList.contains("e-zero-end")&&n.classList.remove("e-zero-end"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),o.classList.contains("e-zero-end")&&o.classList.remove("e-zero-end")):v.showHeaders&&c&&(c.classList.contains("e-zero")?Ze(a,-1,t):n.classList.contains("e-zero-start")&&(Ze(d,1,t),n.classList.remove("e-zero-start")),n.classList.contains("e-zero")&&n.classList.remove("e-zero"),o.classList.contains("e-zero")&&o.classList.remove("e-zero"),n.classList.contains("e-zero-start")&&n.classList.remove("e-zero-start"),o.classList.contains("e-zero-start")&&o.classList.remove("e-zero-start"))}}function Ze(s,e,r){r?s.style.width=parseInt(s.style.width,10)+e+"px":s.style.height=parseInt(s.style.height,10)+e+"px"}function Bs(s,e,r,t,i,n){var a=t.createElement("div",{className:t.element.className,styles:"display: block"}),o=t.createElement("table",{className:s.className+"e-resizetable",styles:"width: auto;height: auto"}),l=t.createElement("tr");r?e.forEach(function(u){var v=l.cloneNode();v.appendChild(u),o.appendChild(v)}):(e.forEach(function(u){l.appendChild(u.cloneNode(!0))}),o.appendChild(l)),a.appendChild(o),document.body.appendChild(a);var h,p,c=o.getBoundingClientRect().width,d=o.getBoundingClientRect().height;return n?(h=r&&parseInt(i,10)>c?c:parseInt(i,10),p=!r&&parseInt(i,10)>d?d:parseInt(i,10)):(p=d,h=c),document.body.removeChild(a),Math.ceil(r?h:p)}function qe(s,e,r,t,i,n){var o,l,h,p,c,d,v,g,m,y,C,b,a=s.eventArgs,S=s.isFromUpdateAction||(0,f.o8)(r);if(s.isUndoRedo)return S=s.isFromUpdateAction=!0,delete s.isUndoRedo,void e.notify(Gt,s);if(S&&!n){var w=a.address||a.range||a.pastedRange||a.addressCollection&&a.addressCollection[0]||a.dataRange;if((x=(0,f.o8)(a.sheetIndex)?(0,f.o8)(a.sheetIdx)?(0,f.o8)(a.activeSheetIndex)?w?qt(e,w):e.activeSheetIndex:a.activeSheetIndex:a.sheetIdx:a.sheetIndex)!==e.activeSheetIndex){var I={sheet:_(e,x),resolveAfterFullDataLoaded:!0,indexes:[0,0,0,0],promise:new Promise(function($){$(void 0)})};return e.notify(hn,I),void I.promise.then(function(){qe(s,e,r,t,i,!0)})}}switch(s.action){case"sorting":h={range:s.eventArgs.range,sortOptions:s.eventArgs.sortOptions,cancel:!1},p=new Promise(function(J,de){J(void 0)}),e.notify(ki,c={args:h,promise:p}),c.promise.then(function(J){e.serviceLocator.getService("cell").refreshRange(De(J.range))});break;case"cellSave":var F={element:(d=s.eventArgs).element,value:d.value,oldValue:d.oldValue,address:d.address,displayText:d.displayText,formula:d.formula,originalEvent:d.originalEvent};e.updateCell(F.formula?{formula:F.formula}:{value:F.value},F.address),!0===r&&e.trigger("cellSave",F);break;case"cellDelete":var T=ul(e,s.eventArgs.address);ph(e,T.indices,T.sheetIndex);break;case"format":if("CellFormat"===a.requestType){if(a.style&&a.style.border&&!(0,f.le)(a.borderType)){var k={};Object.assign(k,a.style,null,!0),a.style.border=void 0,e.notify(ye,{style:a.style,refreshRibbon:!0,range:a.range}),a.style.border=k.border,e.setBorder(a.style,a.range,a.borderType),a.style=k}else e.notify(ye,{style:a.style,refreshRibbon:!0,range:a.range});Pe(function(){return e.selectRange(e.getActiveSheet().selectedRange)})}else e.numberFormat(a.format,a.range);break;case"clipboard":v=new Promise(function(J){J(void 0)}),b=e.getAddressInfo(a.copiedRange),e.notify(a.copiedInfo.isCut?kr:Rr,{range:b.indices,sId:_(e,b.sheetIndex).id,promise:p,invokeCopy:!0,isPublic:!0,isFromUpdateAction:!0}),v.then(function(){return e.notify(Ot,{range:De(a.pastedRange),sIdx:ee(e,Et(a.pastedRange)),type:a.type,isAction:!1,isInternal:!0,isFromUpdateAction:!0})});break;case"gridLines":e.setSheetPropertyOnMute(e.sheets[a.sheetIdx],"showGridLines",a.isShow),e.serviceLocator.getService("sheet").toggleGridlines(),e.notify(Jt,null);break;case"headers":e.setSheetPropertyOnMute(e.sheets[a.sheetIdx],"showHeaders",a.isShow),e.serviceLocator.getService("sheet").showHideHeaders(),e.notify(Jt,null);break;case"resize":case"resizeToFit":S&&(y=Fe(m=e.sheets[a.sheetIndex],a.index),C=vr(m,a.index),(a.isCol&&y&&y.hidden||C&&C.hidden)&&e.notify(je,{startIndex:a.index,endIndex:a.index,hide:!1,isCol:a.isCol,sheetIndex:a.sheetIndex})),a.isCol?void 0===a.hide?e.setColWidth(S&&!(0,f.o8)(r)?a.oldWidth:a.width,a.index,a.sheetIndex):e.hideColumn(a.index,a.index,a.hide):void 0===a.hide?e.setRowHeight(S&&!(0,f.o8)(r)?a.oldHeight:a.height,a.index,a.sheetIndex):e.hideRow(a.index,a.index,a.hide);break;case"renameSheet":var x=ht(e,a.index);e.setSheetPropertyOnMute(e.sheets[x],"name",a.value),e.notify($n,{items:e.element.querySelector(".e-sheet-tabs-items"),value:a.value,idx:x});break;case"hideSheet":e.notify(Qn,{sheetIndex:a.sheetIndex});break;case"showSheet":e.notify($o,a);break;case"removeSheet":e.notify(Xn,{index:a.index,isAction:!0,count:a.sheetCount,clicked:!0});break;case"gotoSheet":e.notify(Ko,{selectedIndex:a.currentSheetIndex,previousIndex:a.previousSheetIndex});break;case"moveSheet":wa(e,a.position,a.sheetIndexes,null,S);break;case"wrap":di(s.eventArgs.address,s.eventArgs.wrap,e);break;case"hideShow":e.notify(je,a.isCol?{startIndex:a.startIndex,endIndex:a.endIndex,isCol:!0,hide:!1===r?!a.hide:a.hide,sheetIndex:a.sheetIndex}:{startIndex:a.startIndex,endIndex:a.endIndex,hide:!1===r?!a.hide:a.hide,sheetIndex:a.sheetIndex});break;case"replace":e.notify(Ai,{value:a.compareValue,replaceValue:a.replaceValue,sheetIndex:a.sheetIndex,address:a.address});break;case"replaceAll":e.notify(Gr,a);break;case"filter":p=new Promise(function(J,de){J(void 0)}),e.notify(jt,!1===r?{predicates:a.previousPredicates,range:a.range,sIdx:a.sheetIndex,promise:p,isInternal:!0}:{predicates:a.predicates,range:a.range,sIdx:a.sheetIndex,promise:p,isInternal:!0,useFilterRange:a.useFilterRange}),i&&!S&&p.then(function(){e.notify(Z,(0,f.l7)({isUndo:!r,isUndoRedo:!S},i))});break;case"insert":if("Sheet"===s.eventArgs.modelType)m=e;else if(!(m=_(e,s.eventArgs.activeSheetIndex)))break;!1===r?e.notify(Fi,{model:m,start:s.eventArgs.index,isUndoRedo:!0,end:s.eventArgs.index+(s.eventArgs.model.length-1),modelType:s.eventArgs.modelType}):e.notify(wt,{model:m,start:s.eventArgs.index,end:s.eventArgs.index+(s.eventArgs.model.length-1),modelType:s.eventArgs.modelType,checkCount:void 0===r?s.eventArgs.sheetCount:null,activeSheetIndex:s.eventArgs.activeSheetIndex,isUndoRedo:!0,insertType:s.eventArgs.insertType,isFromUpdateAction:S});break;case"delete":if("Sheet"===s.eventArgs.modelType)m=e;else if(!(m=_(e,s.eventArgs.activeSheetIndex)))break;!1===r?e.notify(wt,{model:m,start:s.eventArgs.deletedModel,modelType:s.eventArgs.modelType,columnCellsModel:s.eventArgs.deletedCellsModel,definedNames:s.eventArgs.definedNames,activeSheetIndex:s.eventArgs.activeSheetIndex,isUndoRedo:!0,insertType:"Row"===s.eventArgs.modelType?"above":"before",conditionalFormats:s.eventArgs.conditionalFormats,prevAction:s.action}):e.notify(Fi,{model:m,start:s.eventArgs.startIndex,checkCount:s.eventArgs.sheetCount,end:s.eventArgs.endIndex,modelType:s.eventArgs.modelType,isUndoRedo:!0,insertType:"Row"===s.eventArgs.modelType?"above":"before"});break;case"validation":!1===r?e.notify(ji,{range:a.range}):e.notify(sr,{rules:{type:a.type,operator:a.operator,value1:a.value1,value2:a.value2,ignoreBlank:a.ignoreBlank,inCellDropDown:a.inCellDropDown},range:a.range});break;case"removeHighlight":case"addHighlight":e.notify(_i,{isRemoveHighlight:"removeHighlight"===s.action?!1!==r:!1===r,range:a.range,isPublic:!0});break;case"merge":s.eventArgs.isAction=!1,g=[];for(var R=0,D=a.model.length;R<D;R++){g.push({cells:[]});for(var N=0,P=a.model[R].cells.length;N<P;N++)g[R].cells[N]={},Object.assign(g[R].cells[N],a.model[R].cells[N])}e.notify(tt,s.eventArgs),a.model=g;break;case"clear":var M={options:s.eventArgs,isFromUpdateAction:S};e.notify(Yi,M),!S&&M.cfClearActionArgs&&(a.cfClearActionArgs.previousConditionalFormats=M.cfClearActionArgs.previousConditionalFormats,a.cfClearActionArgs.conditionalFormats=M.cfClearActionArgs.conditionalFormats);break;case"conditionalFormat":!1===r?e.notify(_t,{range:a.range,cfModel:{type:a.type,cFColor:a.cFColor,value:a.value},sheetIdx:a.sheetIdx,isUndoRedo:!a.cancel,isFromUpdateAction:S}):e.notify(Xr,{cfModel:{type:a.type,cFColor:a.cFColor,value:a.value,range:a.range},sheetIdx:a.sheetIdx,isUndoRedo:!0,isFromUpdateAction:S});break;case"clearCF":if(!1===r)e.notify(_t,{oldCFModel:a.previousConditionalFormats,updatedCFModel:a.conditionalFormats,range:a.selectedRange,isUndo:!0,sheetIdx:a.sheetIdx});else{var V={range:a.selectedRange,sheetIdx:a.sheetIdx,isUndoRedo:!0,isFromUpdateAction:S};e.notify(_t,V),S||(a.previousConditionalFormats=V.oldCFModel,V.updatedCFModel.length?a.conditionalFormats=V.updatedCFModel:delete a.conditionalFormats)}break;case"insertImage":!1===r?e.notify(It,{id:s.eventArgs.id,sheetIdx:s.eventArgs.sheetIndex+1,range:s.eventArgs.range,preventEventTrigger:!0}):e.notify(Mt,{options:{src:s.eventArgs.imageData,height:s.eventArgs.imageHeight,width:s.eventArgs.imageWidth,imageId:s.eventArgs.id},range:s.eventArgs.range,isPublic:!1,isUndoRedo:!0});break;case"deleteImage":!1===r?e.notify(Mt,{options:{src:s.eventArgs.imageData,height:s.eventArgs.imageHeight,width:s.eventArgs.imageWidth,imageId:s.eventArgs.id},range:s.eventArgs.address,isPublic:!1,isUndoRedo:!0}):e.notify(It,{id:s.eventArgs.id,range:s.eventArgs.address,preventEventTrigger:!0});break;case"imageRefresh":l=document.getElementById(s.eventArgs.id),!1===r?e.notify(li,{prevTop:s.eventArgs.currentTop,prevLeft:s.eventArgs.currentLeft,currentTop:s.eventArgs.prevTop,currentLeft:s.eventArgs.prevLeft,id:s.eventArgs.id,currentHeight:s.eventArgs.prevHeight,currentWidth:s.eventArgs.prevWidth,requestType:"imageRefresh",prevHeight:s.eventArgs.currentHeight,prevWidth:s.eventArgs.currentWidth,isUndoRedo:!0}):(s.eventArgs.isUndoRedo=!0,e.notify(li,s.eventArgs)),l&&(l.style.height=!1===r?s.eventArgs.prevHeight+"px":s.eventArgs.currentHeight+"px",l.style.width=!1===r?s.eventArgs.prevWidth+"px":s.eventArgs.currentWidth+"px",l.style.top=!1===r?s.eventArgs.prevTop+"px":s.eventArgs.currentTop+"px",l.style.left=!1===r?s.eventArgs.prevLeft+"px":s.eventArgs.currentLeft+"px");break;case"insertChart":!1===r?e.notify(Dr,{id:a.id,range:a.range,isUndoRedo:!0}):e.notify(lr,{chart:[{type:a.type,theme:a.theme,isSeriesInRows:a.isSeriesInRows,range:a.range,id:a.id,height:a.height,width:a.width}],isUndoRedo:!1,range:a.posRange});break;case"deleteChart":!1===r?e.notify(lr,{chart:[{type:a.type,theme:a.theme,isSeriesInRows:a.isSeriesInRows,range:a.range,id:a.id,height:a.height,width:a.width,top:a.top,left:a.left}],isUndoRedo:!1,range:a.posRange}):e.notify(Dr,{id:a.id,range:a.range,isUndoRedo:!0});break;case"chartRefresh":(o=document.getElementById(s.eventArgs.id))&&(o.style.height=!1===r?s.eventArgs.prevHeight+"px":s.eventArgs.currentHeight+"px",o.style.width=!1===r?s.eventArgs.prevWidth+"px":s.eventArgs.currentWidth+"px",o.style.top=!1===r?s.eventArgs.prevTop+"px":s.eventArgs.currentTop+"px",o.style.left=!1===r?s.eventArgs.prevLeft+"px":s.eventArgs.currentLeft+"px"),!1===r?e.notify(hi,(0,f.l7)({},s.eventArgs,{currentColIdx:s.eventArgs.prevColIdx,currentHeight:s.eventArgs.prevHeight,currentLeft:s.eventArgs.prevLeft,currentRowIdx:s.eventArgs.prevRowIdx,currentTop:s.eventArgs.prevTop,currentWidth:s.eventArgs.prevWidth,prevColIdx:s.eventArgs.currentColIdx,prevHeight:s.eventArgs.currentHeight,prevLeft:s.eventArgs.currentLeft,prevRowIdx:s.eventArgs.currentRowIdx,prevTop:s.eventArgs.currentTop,prevWidth:s.eventArgs.currentWidth,isUndoRedo:!0})):(s.eventArgs.isUndoRedo=!0,e.notify(hi,s.eventArgs));break;case"chartDesign":e.notify(Or,s.eventArgs);break;case"autofill":e.notify(Qr,{fillRange:s.eventArgs.fillRange,dataRange:s.eventArgs.dataRange,fillType:s.eventArgs.fillType,direction:s.eventArgs.direction});break;case"removeValidation":!1!==r&&e.notify(ji,{range:a.range});break;case"addDefinedName":e.notify(ie,!1===r?{action:"removeDefinedName",isRemoved:!1,definedName:a.name,scope:a.scope,isEventTrigger:!0}:{action:"addDefinedName",isAdded:!1,definedName:{name:a.name,refersTo:a.refersTo,scope:a.scope,comment:a.comment},isEventTrigger:!0});break;case"hyperlink":e.notify(_r,{hyperlink:a.hyperlink,cell:a.address,displayText:a.displayText,triggerEvt:!1}),e.serviceLocator.getService("cell").refreshRange(De(a.address));break;case"removeHyperlink":e.notify(qi,{range:a.address,preventEventTrigger:!0});break;case"freezePanes":e.freezePanes(a.row,a.column,a.sheetIndex);break;case"duplicateSheet":Es(e,a.sheetIndex,null,S);break;case"protectSheet":a.isProtected?e.notify(jr,a):(e.setSheetPropertyOnMute(_(e,a.sheetIndex),"password",""),e.notify(Wi,{isActive:!0,sheetIndex:a.sheetIndex}));break;case"protectWorkbook":a.isProtected?e.notify(ss,a):e.notify(ls,null);break;case"lockCells":e.notify(bn,a)}}function lh(s,e,r,t){for(var a,n=s.sheets[t].ranges,o=0,l=n.length;o<l;o++)if(n[o].template&&(a=A(n[o].address.length?n[o].address:n[o].startCell))[0]<=e&&a[1]<=r&&a[2]>=e&&a[3]>=r)return!0;return!1}function Kt(s,e,r,t,i,n,a){void 0===a&&(a=!0);var o=le(e,t,!0),l=s.frozenColCount(e),h=Ve(r);if((i=i||(e.frozenRows?s.getRow(t,null,l):s.getRow(t)))&&(i.style.height=h+"px"),e.frozenColumns)n=s.getRow(t,null,l-1);else{var p=s.frozenRowCount(e);n=n||s.getRow(t,t<p?s.sheetModule.getSelectAllTable():s.getRowHeaderTable())}n&&(n.style.height=h+"px"),ui(e,t,r),s.setProperties({sheets:s.sheets},!0),a&&s.notify(Xe,{rowIdx:t,threshold:h-o})}function Hs(s,e,r,t){void 0===r&&(r=1);var i=e&&e.fontSize||s.cellStyle.fontSize,a=(i.indexOf("pt")>-1?parseInt(i,10)/.75:parseInt(i,10))*(t||Ps(e&&e.fontFamily?e:s.cellStyle))*r;return Math.ceil(a%1>.9?a+1:a)}function Ps(s){var e=1.24;return s&&("Arial Black"===s.fontFamily||"Comic Sans MS"===s.fontFamily?e=1.44:'"Segoe UI", sans-serif'===s.fontFamily&&(e=1.36)),e}function vt(s,e,r,t){e||(e=r);var n=document.createElement("canvas").getContext("2d");return n.font=(e.fontStyle||r.fontStyle)+" "+(e.fontWeight||r.fontWeight)+" "+(e.fontSize||r.fontSize)+" "+(e.fontFamily||r.fontFamily),t?n.measureText(s).width:Ve(n.measureText(s).width,!0)}function tn(s,e,r,t){var i,n,a,o,c,l=0,h=s.toString().split(" "),p=vt(" ",r,t),u=0,v=0,g=0,m=function(C,b){l&&u++,i/e>=1&&(C.split("").forEach(function(S){o=vt(S,r,t,!0),(a+=o)>e&&(u++,a=o)}),i=Ve(a,!0)),b||y(i),l=i},y=function(C){i+=(C+p)/e>=1?0:p};return h.forEach(function(C){a=0,o=0,i=vt(C,r,t),(l+i)/e>1?(n=C.split("-")).length>1?n.forEach(function(b){a=0,o=0,c||(c=vt("-",r,t)),i=vt(b,r,t),n[n.length-1]!==b&&(i+=c),(l+i)/e>=1?m(b,n[n.length-1]!==b):(n[n.length-1]===b&&h[h.length-1]!==C&&y(l+i),l+=i)}):m(C,!1):(y(l+i),l+=i)}),l&&(v=(l-p)/e,g=parseFloat(v.toString().split(".")[0]),u+=v+.05>=g+1?Math.ceil(v)+1:Math.ceil(v)),u}function hh(s,e,r){var t=0,i=E(s,e,r,null,!0);i.style&&(i.style.border?t=(0===s?2:1)*parseFloat(i.style.border.split("px")[0]):(0===s&&i.style.borderTop&&(t=parseFloat(i.style.borderTop.split("px")[0])),i.style.borderBottom&&(t+=parseFloat(i.style.borderBottom.split("px")[0]))));var n=E(s+1,e,r,null,!0);return!(i.style&&(i.style.border||i.style.borderBottom))&&n.style&&n.style.borderTop&&(t+=parseFloat(n.style.borderTop.split("px")[0])),Math.ceil(t)||1}function Ra(s,e,r,t){return void 0===t&&(t=r),ge(s,r,t,!0)-Ve(4+(function(s,e,r){var t=0,i=E(s,e,r,null,!0),n=E(s,e+1,r,null,!0);return i.style&&(i.style.border?t=(0===e?2:1)*parseFloat(i.style.border.split("px")[0]):(0===e&&i.style.borderLeft&&(t=parseFloat(i.style.borderLeft.split("px")[0])),i.style.borderRight&&(t+=parseFloat(i.style.borderRight.split("px")[0])))),!(i.style&&(i.style.border||i.style.borderRight))&&n.style&&n.style.borderLeft&&(t+=parseFloat(n.style.borderLeft.split("px")[0])),t>0&&t<1?1:t}(e,r,s)||1))}function gi(s,e,r,t,i,n,a){return Hs(s,i,n,a)+hh(e,r,t)}function mr(s,e,r,t){s.maxHgts[e]||(s.maxHgts[e]={}),s.maxHgts[e][r]=t}function $t(s,e){var r=0,t=s.maxHgts[e];return t&&Object.keys(t).forEach(function(i){t[i]>r&&(r=t[i])}),r}function K(s){if(!document.activeElement.classList.contains("e-text-findNext-short"))if(f.AR.isIE){var e=window.scrollX,r=window.scrollY;s.focus(),window.scrollTo(e,r)}else{if(s.classList.contains("e-input")){var i=s.value.length;s.setSelectionRange(i,i)}s.focus({preventScroll:!0})}}function Qt(s,e){for(var t,r=s.getActiveSheet(),i=(0,f.le)(e)?Q(A(r.selectedRange)):e,n=i[0];n<=i[2];n++)for(var a=i[1];a<=i[3];a++)if(ur(E(n,a,r),Fe(r,a))){t=!0;break}return t}function Vs(s){return s.includes(" ")}function ph(s,e,r){for(var i,n,a,o,l,p,t=_(s,r),h=r===s.activeSheetIndex,c=t.conditionalFormats&&t.conditionalFormats.length&&[].slice.call(t.conditionalFormats),d=[],u=e[0],v=e[2];u<=v;u++)if(!rr(t,u))for(var g=e[1],m=e[3];g<=m;g++){var y={cellIdx:[u,g],isUnique:!1,uniqueRange:""};if(s.notify(At,y),i=!1,""!==y.uniqueRange){var C=De(y.uniqueRange);i="#SPILL!"===E(C[0],C[1],t).value}if((!y.isUnique||i)&&(n=E(u,g,t))){if(a={},n.formula&&(a.formula=""),(n.value||0===n.value)&&(a.value=""),n.hyperlink&&(a.hyperlink=""),l={cell:a,rowIdx:u,colIdx:g,valChange:!0,uiRefresh:h,td:o=s.getCell(u,g),cellDelete:!0},!Object.keys(a).length||Je(s,t,l))continue;c&&!p&&((p=l.isFormulaDependent)||Ki(c,d,u,g)),o&&(o.querySelector(".e-cf-databar")&&o.removeChild(o.querySelector(".e-cf-databar")),o.querySelector(".e-iconsetspan")&&o.removeChild(o.querySelector(".e-iconsetspan")))}}(d.length||p)&&h&&s.notify(We,{cfModel:!p&&d,refreshAll:p,isAction:!0})}var Fa=function(){function s(e){this.parent=e,this.init(),this.addEventListener()}return s.prototype.init=function(){this.parent.element.appendChild(this.parent.createElement("input",{className:"e-clipboard",attrs:{contenteditable:"true"}}))},s.prototype.addEventListener=function(){var e=this.getClipboardEle();this.parent.on(kr,this.cut,this),this.parent.on(Rr,this.copy,this),this.parent.on(Ot,this.paste,this),this.parent.on(ti,this.clearCopiedInfo,this),this.parent.on(xo,this.tabSwitchHandler,this),this.parent.on(Ir,this.cMenuBeforeOpenHandler,this),this.parent.on(Bi,this.ribbonClickHandler,this),this.parent.on(Ye,this.initCopyIndicator,this),this.parent.on(Xe,this.rowHeightChanged,this),this.parent.on($e,this.colWidthChanged,this),this.parent.on(Tn,this.refreshOnInsertDelete,this),f.bi.add(e,"cut",this.cut,this),f.bi.add(e,"copy",this.copy,this),f.bi.add(e,"paste",this.paste,this)},s.prototype.removeEventListener=function(){var e=this.getClipboardEle();this.parent.isDestroyed||(this.parent.off(kr,this.cut),this.parent.off(Rr,this.copy),this.parent.off(Ot,this.paste),this.parent.off(ti,this.clearCopiedInfo),this.parent.off(xo,this.tabSwitchHandler),this.parent.off(Ir,this.cMenuBeforeOpenHandler),this.parent.off(Bi,this.ribbonClickHandler),this.parent.off(Ye,this.initCopyIndicator),this.parent.off(Xe,this.rowHeightChanged),this.parent.off($e,this.colWidthChanged),this.parent.off(Tn,this.refreshOnInsertDelete)),f.bi.remove(e,"cut",this.cut),f.bi.remove(e,"copy",this.copy),f.bi.remove(e,"paste",this.paste)},s.prototype.ribbonClickHandler=function(e){var r=this.parent.element.id;switch(e.item.id){case r+"_cut":this.cut({invokeCopy:!0});break;case r+"_copy":this.copy({invokeCopy:!0})}},s.prototype.tabSwitchHandler=function(e){0===e.activeTab&&!this.copiedInfo&&!this.copiedShapeInfo&&this.hidePaste()},s.prototype.cMenuBeforeOpenHandler=function(e){var r=this.parent.getActiveSheet(),t=this.parent.serviceLocator.getService(O),i=[],n=[],a=[],o=[],h=B(r.activeCell),p=E(h[0],h[1],r),c=r.isProtected&&ur(p,Fe(r,h[1]));("Content"===e.target||"RowHeader"===e.target||"ColumnHeader"===e.target||"SelectAll"===e.target)&&(this.parent.enableContextMenuItems([t.getConstant("Paste"),t.getConstant("PasteSpecial")],!!(this.copiedInfo||this.copiedShapeInfo&&!c)),this.parent.enableContextMenuItems([t.getConstant("Cut")],!c)),"Content"===e.target&&c&&this.parent.enableContextMenuItems([t.getConstant("Cut"),t.getConstant("Filter"),t.getConstant("Sort")],!1),"Content"===e.target&&c&&!r.protectSettings.insertLink&&this.parent.enableContextMenuItems([t.getConstant("Hyperlink")],!1),"ColumnHeader"===e.target&&r.isProtected&&(a=[t.getConstant("DeleteColumn"),t.getConstant("DeleteColumns"),t.getConstant("InsertColumn"),t.getConstant("InsertColumns")],o=[t.getConstant("HideColumn"),t.getConstant("HideColumns"),t.getConstant("UnHideColumns")],this.parent.enableContextMenuItems(a,!1),this.parent.enableContextMenuItems(o,!!r.protectSettings.formatColumns)),"RowHeader"===e.target&&r.isProtected&&(i=[t.getConstant("DeleteRow"),t.getConstant("DeleteRows"),t.getConstant("InsertRow"),t.getConstant("InsertRows")],n=[t.getConstant("HideRow"),t.getConstant("HideRows"),t.getConstant("UnHideRows")],this.parent.enableContextMenuItems(i,!1),this.parent.enableContextMenuItems(n,!!r.protectSettings.formatRows))},s.prototype.rowHeightChanged=function(e){if(this.copiedInfo){var r=this.getCopyIndicator();r&&(this.copiedInfo.range[0]>e.rowIdx?r.style.top=parseFloat(r.style.top)+e.threshold+"px":Ht(this.copiedInfo.range,e.rowIdx,this.copiedInfo.range[1])&&(r.style.height=parseFloat(r.style.height)+e.threshold+"px"))}},s.prototype.colWidthChanged=function(e){if(this.copiedInfo){var r=this.getCopyIndicator();r&&(this.copiedInfo.range[1]>e.colIdx?r.style.left=parseFloat(r.style.left)+e.threshold+"px":Ht(this.copiedInfo.range,this.copiedInfo.range[0],e.colIdx)&&(r.style.width=parseFloat(r.style.width)+e.threshold+"px"))}},s.prototype.cut=function(e){this.setCopiedInfo(e,!0)},s.prototype.copy=function(e){this.setCopiedInfo(e,!1)},s.prototype.paste=function(e){if(!(this.parent.isEdit||this.parent.element.getElementsByClassName("e-dlg-overlay").length>0)){var r,t=e&&e.clipboardData||window.clipboardData;if(!(t&&e.clipboardData&&e.clipboardData.getData("isInternalCut").length)||this.copiedInfo)if(t||this.copiedShapeInfo||e.isInternal&&this.copiedInfo){e.isInternal=!t;var i=void 0,n=this.getCopiedIdx();e.isAction=!!t||e.isAction;var a=e&&e.sIdx>-1?e.sIdx:this.parent.activeSheetIndex,o=_(this.parent,a),l=Q(e&&e.range||A(o.selectedRange)),h=t&&this.getExternalCells(e);if(!e.isInternal&&h&&h.internal&&(t=!1,!this.copiedInfo))return;if(t&&!h.length){if(h.file)return void this.parent.notify(rs,{file:h.file});if(!this.copiedInfo)return;t=!1}var p=Object.assign({isExternal:t},this.copiedInfo),c=1;if(h)for(var d=0;d<h.length;d++)c=h[d].cells.length>c?h[d].cells.length:c;var u=l[0],v=t?[0,0,h.length-1,c-1]:Q(this.copiedShapeInfo?A(o.selectedRange):this.copiedInfo.range),g=(l[2]-l[0]+1)%(v[2]-v[0]+1)==0&&(l[3]-l[1]+1)%(v[3]-v[1]+1)==0;r=g?l:[l[0],l[1]].concat([l[0]+v[2]-v[0],l[1]+v[3]-v[1]||l[1]]);var m={requestType:"paste",copiedInfo:this.copiedInfo,copiedRange:z(v),pastedRange:z(r),type:e&&e.type||"All",cancel:!1};if(e.isAction&&!this.copiedShapeInfo&&this.parent.notify(ue,{eventArgs:m,action:"clipboard"}),m.cancel)return;var y=void 0,C=void 0,b=void 0,S=[],w=t?a:n,x=_(this.parent,w),I=yi(v)&&this.isRangeMerged(l,o);if(u=(l=A(m.pastedRange))[0],v=t?[0,0,h.length-1,c-1]:Q(this.copiedShapeInfo?A(o.selectedRange):this.copiedInfo.range),r=(g=(l[2]-l[0]+1)%(v[2]-v[0]+1)==0&&(l[3]-l[1]+1)%(v[3]-v[1]+1)==0&&!I)?l:[l[0],l[1]].concat([l[0]+v[2]-v[0],l[1]+v[3]-v[1]||l[1]]),o.isProtected&&Qt(this.parent,r))return void this.parent.notify(Nt,null);if(this.copiedShapeInfo&&!this.copiedInfo){var T=this.copiedShapeInfo.pictureElem;T.classList.contains("e-datavisualization-chart")?(this.copiedShapeInfo.chartInfo.top=null,this.copiedShapeInfo.chartInfo.left=null,this.parent.notify(lr,{chart:[this.copiedShapeInfo.chartInfo],isInitCell:!0,isUndoRedo:!0,isPaste:!0,dataSheetIdx:this.copiedShapeInfo.sheetIdx,isCut:this.copiedShapeInfo.isCut,range:e.range||o.selectedRange})):this.parent.notify(Mt,{options:{src:T.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:this.copiedShapeInfo.height,width:this.copiedShapeInfo.width,imageId:this.copiedShapeInfo.isCut?T.id:""},range:z([u,l[1],u,l[1]]),isPublic:!1,isUndoRedo:!0});var k=E(u,l[1],o);if(k&&!(0,f.le)(k.image)){var R=k.image?k.image.length-1:0,D={requestType:"imagePaste",copiedShapeInfo:this.copiedShapeInfo,pasteSheetIndex:this.parent.activeSheetIndex,pastedRange:pt(this.parent)+"!"+z([u,l[1],u,l[1]]),pastedPictureElement:document.getElementById(k.image[R].id)};this.parent.notify(Z,{eventArgs:D,action:"clipboard"})}}else{var N={range:v,prevSheet:x,cancel:!1};if(this.parent.notify(ao,N),N.cancel)return;var P=m.type||e.type,M=[],V=this.isInRange(v,l,n),Y=0===l[1]&&l[3]===o.colCount-1,X=0===l[0]&&l[2]===o.rowCount-1,G=!1,$=!1,J=0,de=[];!g&&"Values"!==P&&this.setCF(v,r,x,o,de);for(var oe=void 0,be=!1,Ae=[],Ie=(d=v[0],0);d<=v[2];d++,Ie++)if(t||p.isCut||!rr(x,d)){V&&(M[l[0]+Ie]={cells:[]});for(var ve=v[1],et=0;ve<=v[3];ve++,et++){if(V&&(M[l[0]+Ie].cells[l[1]+et]=E(l[0]+Ie,l[1]+et,x,!1,!0)),y=t?h[d].cells[ve]:(0,f.l7)({},V&&M[d]&&M[d].cells[ve]?M[d].cells[ve]:E(d,ve,x),null,!0),Y||X){if(y&&y.rowSpan)if(y.rowSpan>0)y.rowSpan+d-1<=v[2]?G=!0:y={};else if(G){if(y.rowSpan<0){var yr=E(u+y.rowSpan,l[1]+et+(y.colSpan?y.colSpan:0),o);yr&&!yr.rowSpan&&(y={})}}else y={};y&&y.colSpan&&(y.colSpan>0?y.colSpan+ve-1<=v[3]?$=!0:y={}:$||(y={}))}if(y&&P){switch(P){case"Formats":y={format:y.format,style:y.style};break;case"Values":(y={value:y.value}).value&&y.value.toString().indexOf("\n")>-1&&this.parent.getCell(l[0],l[1]).classList.add("e-alt-unwrap")}C=["Formats","Values"].indexOf(P)>-1}if(!this.parent.scrollSettings.isFinite&&(v[2]-v[0]>1048575-l[0]||v[3]-v[1]>16383-l[1])||this.parent.scrollSettings.isFinite&&(v[2]-v[0]>o.rowCount-1-l[0]||v[3]-v[1]>o.colCount-1-l[1]))return void this.showDialog();if(g){for(var gt=l[0];gt<=l[2];gt+=v[2]-v[0]+1)if(p.isCut||J||!rr(o,gt+Ie))for(var yt=l[1];yt<=l[3];yt+=v[3]-v[1]+1){if(d===v[0]&&ve===v[1]&&(void 0===oe||oe.length)&&"Values"!==P&&(oe=this.setCF(v,[gt,yt,gt+(v[2]-v[0]),yt+(v[3]-v[1])],x,o,de,oe)),b=E(gt+Ie,yt+et,o,!1,!0),!t&&(void 0!==b.colSpan||void 0!==b.rowSpan)){if(Y||X)continue;var rn={range:(N={range:[gt+Ie,yt+et,gt+Ie,yt+et]}).range,merge:!1,isAction:!1,type:"All"};S.push(rn),this.parent.activeSheetIndex===o.index&&this.parent.notify(tt,rn)}var ke=yt+et;if(y=(0,f.l7)({},y||{},null,!0),!C&&this.copiedInfo&&!this.copiedInfo.isCut&&y.formula){var vh=_l([gt+Ie,ke],[d,ve],x,V?y:null);(0,f.le)(vh)||(y.formula=vh)}o.isProtected&&y&&!1!==y.isLocked&&(y.isLocked=b.isLocked),b&&b.formula&&b.formula.indexOf("=UNIQUE(")>-1&&this.parent.notify(Ur,null);var mh={cellIdx:[d,ve],isUnique:!1,uniqueRange:"",sheetName:x.name};this.parent.notify(At,mh),mh.isUnique&&(y.value=null),be=!1,y&&y.formula&&y.formula.indexOf("=UNIQUE(")>-1&&(be=!0,Ae.push([gt,ke]),y.value=null),!this.setCell(gt+Ie,ke,o,y,C,ke===l[3],!!t,be)&&y.formula&&this.copiedInfo.isCut&&this.parent.notify(zr,{cellRef:z([d,ve,d,ve])})}}else(t||!lh(this.parent,d,ve,n))&&(I?this.setCell(u,l[1]+et,o,{value:y.value},!0,ve===v[3]):this.setCell(u,l[1]+et,o,y,C,ve===v[3]));if(!t&&this.copiedInfo.isCut&&(!Ht(l,d,ve)||n!==this.parent.activeSheetIndex)){var Ct=E(d,ve,x);if(Ct)if(Ct.isLocked||(0,f.le)(Ct.isLocked))if(!Y&&!X||void 0===Ct.rowSpan&&void 0===Ct.colSpan)Ct=null;else{if(!(Ct.rowSpan>1||Ct.colSpan>1))continue;this.parent.notify(tt,{merge:!1,range:[d,ve,d,ve],type:"All"}),Ct=null}else!1===Ct.isLocked&&(Ct=x.isProtected?{isLocked:!1}:null);this.setCell(d,ve,x,Ct,!1,ve===v[3])}}u++}else Ie--,J++;if(Ae.length)for(d=0;d<Ae.length;d++)this.parent.serviceLocator.getService("cell").refresh(Ae[d][0],Ae[d][1]);this.parent.notify(Jt,null),r[2]-=J,this.parent.setUsedRange(r[2],r[3]),a===this.parent.activeSheetIndex&&!e.isFromUpdateAction&&this.parent.notify(Er,{address:z(r)}),!t&&this.copiedInfo.isCut&&(i=this.copiedInfo.isCut,n===this.parent.activeSheetIndex&&this.parent.serviceLocator.getService("cell").refreshRange(v),this.clearCopiedInfo()),(t||V)&&this.copiedInfo&&this.clearCopiedInfo();var nn=void 0;if(i){oe&&oe.length&&"Values"!==P&&this.parent.notify(_t,nn={range:v,sheetIdx:w,isClear:!0}),mr(x,v[0],v[1],(this.parent.getRow(v[0],null,this.parent.frozenColCount(x))||{offsetHeight:20}).offsetHeight);var pl=$t(x,v[0]);Kt(this.parent,x,pl,v[0])}de.length&&a===this.parent.activeSheetIndex&&this.parent.notify(We,{cfModel:de,isAction:!0});var cl=_(this.parent,n);if(!t&&v[0]===v[2]&&v[3]-v[1]==cl.colCount-1){for(pl=cl.rows[v[0]].height,d=l[0];d<=l[2];d++)Kt(this.parent,this.parent.getActiveSheet(),pl,d);i&&Kt(this.parent,cl,20,v[0])}e.isAction&&(D={requestType:"paste",copiedInfo:p,mergeCollection:S,pasteSheetIndex:this.parent.activeSheetIndex,copiedRange:x.name+"!"+(p.range?z(p.range):x.selectedRange),pastedRange:o.name+"!"+z(r),type:P||"All"},J&&(D.skipFilterCheck=!0),nn&&nn.cfClearActionArgs&&(D.cfClearActionArgs=nn.cfClearActionArgs),de.length&&(D.cfActionArgs={cfModel:de,sheetIdx:a}),this.parent.notify(Z,{eventArgs:D,action:"clipboard"}))}}else this.getClipboardEle().select()}},s.prototype.setCF=function(e,r,t,i,n,a){var l,h,o=this,p=function(u){l=[r[0]+(h[0]<=e[0]?0:h[0]-e[0]),r[1]+(h[1]<=e[1]?0:h[1]-e[1]),r[2]-(h[2]>=e[2]?0:e[2]-h[2]),r[3]-(h[3]>=e[3]?0:e[3]-h[3])],i.conditionalFormats||o.parent.setSheetPropertyOnMute(i,"conditionalFormats",[]);var v={range:z(l),type:u.type,cFColor:u.cFColor,value:u.value,format:u.format};i.conditionalFormats.push(v),n.push(v)};if(a)for(var c=0,d=a.length;c<d;c++)h=A(a[c].range),p(a[c]);else if(a=[],t.conditionalFormats)for(c=0,d=t.conditionalFormats.length;c<d;c++)((h=A(t.conditionalFormats[c].range))[0]>=e[0]&&h[0]<=e[2]||h[2]>=e[0]&&h[2]<=e[2])&&(h[1]>=e[1]&&h[1]<=e[3]||h[3]>=e[1]&&h[3]<=e[3])&&(a.push(t.conditionalFormats[c]),p(t.conditionalFormats[c]));return a},s.prototype.isRangeMerged=function(e,r){var t=E(e[0],e[1],r);if(t&&(t.colSpan>1||t.rowSpan>1)){var i={range:e.slice(2,4).concat(e.slice(2,4))};return this.parent.notify(Ne,i),i.range[0]===e[0]&&i.range[1]===e[1]&&i.range[2]===e[2]&&i.range[3]===e[3]}return!1},s.prototype.updateFilter=function(e,r){var t,i;this.parent.notify(Si,null);for(var n=0;n<this.parent.sheets.length;n++)if(this.parent.filterCollection&&this.parent.filterCollection[n]&&this.parent.filterCollection[n].sheetIndex===ht(this.parent,e.sId)){var a=e.range,o=A(this.parent.filterCollection[n].filterRange);a=Q(a),o[0]===a[0]&&o[2]===a[2]&&o[1]===a[1]&&o[3]===a[3]&&(t=!0,i=[Math.abs(a[0]-o[0]),Math.abs(a[1]-o[1]),Math.abs(a[2]-o[2]),Math.abs(a[3]-o[3])])}var l=this.parent.getCell(e.range[0],e.range[1]),h=(l=l&&(l.querySelector(".e-filter-icon")?l:this.parent.getCell(e.range[2],e.range[3])))&&l.querySelector(".e-sortasc-filter"),p=l&&l.querySelector(".e-sortdesc-filter");if(t)for(var c=0;c<this.parent.filterCollection.length;c++){var d=this.parent.filterCollection[c],u=e&&e.sId?ht(this.parent,e.sId):this.parent.activeSheetIndex;if(d.sheetIndex===u&&this.parent.notify(jt,{predicates:null,range:d.filterRange,sIdx:u,isCut:!0}),d.sheetIndex===u&&u===this.parent.activeSheetIndex&&(i=[r[0]+i[0],r[1]+i[1],Math.abs(r[2]-i[2]),Math.abs(r[3]-i[3])],this.parent.notify(jt,{predicates:null,range:z(i),sIdx:null,isCut:!0}),e.range[3]===e.range[1])){var v=this.parent.getCell(r[0],r[1]);h&&v&&v.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"),p&&v&&v.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter")}}},s.prototype.isInRange=function(e,r,t){var i=this.parent.activeSheetIndex;return Ht(e,r[0],r[1])&&t===i||Ht(e,r[2],r[3])&&t===i},s.prototype.setCell=function(e,r,t,i,n,a,o,l){var h=Je(this.parent,t,{cell:i,rowIdx:e,colIdx:r,pvtExtend:!n,valChange:!l,lastCell:a,uiRefresh:t.name===this.parent.getActiveSheet().name,requestType:"paste"});if(!h&&i&&i.style&&o){var p=gi(this.parent,e,r,t,i.style||this.parent.cellStyle,i.wrap?tn(this.parent.getDisplayText(i),Ra(t,e,r),i.style,this.parent.cellStyle):1);(p=Math.round(p))<20&&(p=20),mr(t,e,r,p);var c=Ce(t,e),d=$t(t,e);d>c&&Kt(this.parent,t,d,e)}return h},s.prototype.getCopiedIdx=function(){if(this.copiedInfo){for(var e=0;e<this.parent.sheets.length;e++)if(this.parent.sheets[e].id===this.copiedInfo.sId)return e;this.clearCopiedInfo()}return-1},s.prototype.setCopiedInfo=function(e,r){var t=this;if(!this.parent.isEdit){var i=new re.BH;e.promise=i.promise;var a,n=this.parent.getActiveSheet();if(e&&e.range){var h={range:e.range};0===e.range[1]&&e.range[3]===n.colCount-1||0===e.range[0]&&e.range[2]===n.rowCount-1||this.parent.notify(Yr,h),a=h.range}else a=A(n.selectedRange);if(e&&!e.isPublic&&!e.clipboardData){var p={copiedRange:n.name+"!"+z(a),cancel:!1,action:r?"cut":"copy"};if(this.parent.notify(ue,p),p.cancel)return}var c={sheet:n,indexes:[0,0,n.rowCount-1,n.colCount-1],isFinite:this.parent.scrollSettings.isFinite,promise:new Promise(function(v,g){v(void 0)})},d=document.getElementsByClassName("e-ss-overlay-active"),u=d.length;n.isLocalData&&!(e&&e.clipboardData)&&0===a[0]&&a[2]===n.rowCount-1&&(this.parent.showSpinner(),this.parent.notify("updateSheetFromDataSource",c)),this.checkForUncalculatedFormula(a,e&&e.sId?e.sId:n.id),c.promise.then(function(){if(u>0){var v={clientY:d[0].offsetTop,isImage:!0};t.parent.notify(Yt,v);var g={clientX:d[0].offsetLeft,isImage:!0};t.parent.notify(Xt,g),t.copiedShapeInfo={sId:e&&e.sId?e.sId:n.id,sheetIdx:n.index,isCut:r,pictureElem:d[0],copiedRange:z([v.clientY,g.clientX,v.clientY,g.clientX]),height:d[0].offsetHeight,width:d[0].offsetWidth,chartInfo:t.getChartElemInfo(d[0])},t.hidePaste(!0),r&&(d[0].classList.contains("e-datavisualization-chart")?t.parent.deleteChart(t.copiedShapeInfo.chartInfo.id):t.parent.notify(It,{id:t.copiedShapeInfo.pictureElem.id,sheetIdx:t.copiedShapeInfo.sId,range:t.copiedShapeInfo.copiedRange}))}else e&&e.clipboardData||(t.copiedInfo&&t.clearCopiedInfo(),t.copiedInfo={range:a,sId:e&&e.sId?e.sId:n.id,isCut:r},t.hidePaste(!0),e.isFromUpdateAction||t.initCopyIndicator(),f.AR.isIE||t.getClipboardEle().select(),e&&e.invokeCopy&&document.execCommand(r?"cut":"copy"),t.parent.hideSpinner());f.AR.isIE&&t.setExternalCells(e,r),i.resolve()}),e&&e.clipboardData&&(this.setExternalCells(e,r),this.getClipboardEle().setAttribute("aria-label",n.selectedRange+" "+this.parent.serviceLocator.getService(O).getConstant(r?"Cut":"Copy")))}},s.prototype.checkForUncalculatedFormula=function(e,r){for(var t,i=ht(this.parent,r),n=_(this.parent,i),a=e[0];a<=e[2];a++)for(var o=e[1];o<=e[3];o++)(t=E(a,o,n,null,!0)).formula&&(0,f.o8)(t.value)&&this.parent.notify(ie,{action:"refreshCalculate",value:t.formula,rowIndex:a,colIndex:o,isFormula:pe(t.formula),sheetIndex:i})},s.prototype.getChartElemInfo=function(e){var r=this.parent.chartColl;if(e.classList.contains("e-datavisualization-chart"))for(var t=e.getElementsByClassName("e-control")[0].id,i=0;i<r.length;i++)if(r[i].id===t)return r[i];return null},s.prototype.clearCopiedInfo=function(){this.copiedInfo&&(this.parent.getActiveSheet().id===this.copiedInfo.sId&&(this.removeIndicator(this.parent.getSelectAllContent()),this.removeIndicator(this.parent.getColumnHeaderContent()),this.removeIndicator(this.parent.getRowHeaderContent()),this.removeIndicator(this.parent.getMainContent())),this.copiedInfo=null,this.hidePaste()),this.copiedShapeInfo&&(this.copiedShapeInfo=null,this.hidePaste())},s.prototype.removeIndicator=function(e){if(e){var r=e.getElementsByClassName("e-copy-indicator")[0];r&&(0,f.og)(r)}},s.prototype.initCopyIndicator=function(){if(this.copiedInfo&&this.parent.getActiveSheet().id===this.copiedInfo.sId){var e=this.parent.createElement("div",{className:"e-copy-indicator"});e.appendChild(this.parent.createElement("div",{className:"e-top"})),e.appendChild(this.parent.createElement("div",{className:"e-bottom"})),e.appendChild(this.parent.createElement("div",{className:"e-left"})),e.appendChild(this.parent.createElement("div",{className:"e-right"})),ft(this.parent,e,this.copiedInfo.range,"e-copy-indicator")}},s.prototype.showDialog=function(){var e=this;this.parent.serviceLocator.getService(ae).show({header:"Spreadsheet",target:this.parent.element,height:205,width:340,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(O).getConstant("PasteAlert"),beforeOpen:function(r){var t={dialogName:"PasteDialog",element:r.element,target:r.target,cancel:r.cancel};e.parent.trigger("dialogBeforeOpen",t),t.cancel&&(r.cancel=!0)}})},s.prototype.hidePaste=function(e){this.parent.getActiveSheet().isProtected&&(e=!1),this.parent.notify(dr,[{items:[this.parent.element.id+"_paste"],enable:e||!1}])},s.prototype.setExternalCells=function(e,r){for(var t,i,n="",a=Q(this.copiedInfo.range),o=this.parent.getActiveSheet(),l='<html><body><table class="e-spreadsheet" xmlns="http://www.w3.org/1999/xhtml"><tbody>',h=a[0];h<=a[2];h++)if(r||!rr(o,h)){l+="<tr>";for(var p=a[1];p<=a[3];p++)if(!((t=E(h,p,o,!1,!0)).colSpan<0||t.rowSpan<0)){if(l+="<td",t.colSpan&&(l+=' colspan="'+t.colSpan+'"'),t.rowSpan&&(l+=' rowspan="'+t.rowSpan+'"'),l+=' style="white-space:'+(t.wrap?"normal":"nowrap")+";vertical-align:bottom;",t.style&&Object.keys(t.style).forEach(function(d){var u=d.match(/[A-Z]/);l+=("backgroundColor"===d?"background":u?d.replace(u[0],"-"+u[0].toLowerCase()):d)+":"+("backgroundColor"===d||"color"===d?t.style[d].slice(0,7):t.style[d])+";"}),l+='"',(0,f.le)(t.value))l+="></td>";else{if(i=t.value,t.format&&"General"!==t.format){l+=t.value.toString().includes('"')?" cell-value='"+i+"'":' cell-value="'+t.value+'"';var c={formattedText:i,value:i,format:t.format,onLoad:!0,cell:t,rowIndex:h,colIndex:p};this.parent.notify(ot,c),i=c.formattedText}l+=">",l+=i,n+=i,l+="</td>"}n+=p===a[3]?"":"\t"}l+="</tr>",n+=h===a[2]?"":"\n"}l+="</tbody></table></body></html>",f.AR.isIE?(window.clipboardData.setData("text",n),r&&window.clipboardData.setData("isInternalCut",n)):(e.clipboardData.setData("text/html",l),e.clipboardData.setData("text/plain",n),r&&e.clipboardData.setData("isInternalCut",n),e.preventDefault())},s.prototype.getExternalCells=function(e){var t,i,r=this,n=[],a=this.parent.createElement("span");if(f.AR.isIE?i=window.clipboardData.getData("text"):(t=e.clipboardData.getData("text/html"),i=e.clipboardData.getData("text/plain"),a.innerHTML=t),a.querySelector("table")){var o=!1;if(this.copiedInfo&&!this.copiedInfo.isCut){var l=this.parent.filterCollection;if(l)for(var h=0;h<l.length;h++){var p=A(l[h].filterRange),c=this.copiedInfo.range;if(p[0]===c[0]&&p[1]===c[1]&&p[2]===c[2]&&p[3]===c[3]){o=!0;break}}}a.querySelector(".e-spreadsheet")&&this.copiedInfo&&!o?n={internal:!0}:this.generateCells(a,n)}else if(a.querySelector("img")){var d=a.querySelector("img");this.parent.notify(Mt,{options:{src:d.src,height:d.height,width:d.width},isPublic:!0})}else if(i){var v,g,m,u=[];t&&(g=[].slice.call(a.children)),i.split("\n").forEach(function(y){v=null,t&&(m=g.filter(function(C){return C.textContent&&C.textContent.replace(/(\r\n|\n|\r|\s)/gm," ").trim()===y.trim()})[0])&&(v=r.getStyle(m,a),g.splice(g.indexOf(m),1)),y.split("\t").forEach(function(C,b){(C||v)&&(u[b]={},v&&(v.whiteSpace&&"nowrap"!==v.whiteSpace?(u[b].wrap=!0,delete v.whiteSpace,Object.keys(v).length&&(u[b].style=v)):u[b].style=v),C&&(pe(C)?u[b].formula=C:u[b].value=Pr(C.trim())))}),n.push({cells:u}),u=[]})}else if(1===e.clipboardData.types.length&&"Files"===e.clipboardData.types[0]&&e.clipboardData.files[0]&&e.clipboardData.files[0].type.includes("image"))return{file:e.clipboardData.files[0]};return setTimeout(function(){r.getClipboardEle().innerHTML=""},0),n},s.prototype.generateCells=function(e,r){var a,l,t=this,i=e.querySelector("table"),n=[],o=0;[].slice.call(i.rows||[]).forEach(function(h){r[o]||(r[o]={cells:[]}),n=r[o].cells,l=0,[].slice.call(h.cells||[]).forEach(function(p){if(n[l]&&(l=t.getNewIndex(n,l)),n[l]={},a=t.getStyle(p,e),p.textContent=p.textContent.replace(/(\r\n|\n|\r)/gm,""),p.textContent=p.textContent.replace(/\s+/g," "),a.whiteSpace&&"nowrap"!==a.whiteSpace&&(n[l].wrap=!0,delete a.whiteSpace),Object.keys(a).length&&(a.border&&(["borderBottom","borderTop","borderLeft","borderRight"].forEach(function(m){a[m]=a.border}),delete a.border),n[l].style=a),p.textContent&&(n[l].value=Pr(p.textContent.trim())),p.getAttribute("number-format")&&(n[l].format=p.getAttribute("number-format"),n[l].value&&p.getAttribute("cell-value")&&(n[l].value=Pr(p.getAttribute("cell-value").trim()))),p.getAttribute("colspan")&&parseInt(p.getAttribute("colspan"),10)>1&&(n[l].colSpan=parseInt(p.getAttribute("colspan"),10)),p.getAttribute("rowspan")&&parseInt(p.getAttribute("rowspan"),10)>1&&(n[l].rowSpan=parseInt(p.getAttribute("rowspan"),10)),n[l].colSpan>1&&n[l].rowSpan>1)for(var c=void 0,d=o,u=o+n[l].rowSpan;d<u;d++)for(var v=l,g=l+n[l].colSpan;v<g;v++)d===o&&v===l||(c=n[l].style?{style:(0,f.l7)({},n[l].style)}:{},d!==o&&(c.rowSpan=o-d),v!==l&&(c.colSpan=l-v),r[d]||(r[d]={cells:[]}),r[d].cells[v]=c);else if(n[l].colSpan>1)for(d=l+1,u=l+n[l].colSpan;d<u;d++)n[d]={colSpan:l-d,style:(0,f.l7)({},a)};else if(n[l].rowSpan>1)for(d=o+1,u=o+n[l].rowSpan;d<u;d++)r[d]||(r[d]={cells:[]}),r[d].cells[l]={rowSpan:o-d,style:(0,f.l7)({},a)};l++}),o++})},s.prototype.getNewIndex=function(e,r){return e[r]&&(r++,r=this.getNewIndex(e,r)),r},s.prototype.getStyle=function(e,r){var t=[],i={},n=Object.keys(this.parent.commonCellStyle);if(r.querySelector("style")&&e.classList.length&&r.querySelector("style").innerHTML.indexOf(e.classList[0])>-1){var a=r.querySelector("style").innerHTML.split(e.classList[0]);t.push(a[a.length-1].split("{")[1].split("}")[0])}var o=[].slice.call(e.querySelectorAll("*"));if(o.unshift(e),o.forEach(function(w){w.getAttribute("style")&&t.push(w.getAttribute("style")),"B"===w.tagName&&t.push("font-weight:bold"),"I"===w.tagName&&t.push("font-style:italic"),"U"===w.tagName&&t.push("text-decoration:underline")}),n.length&&r.querySelector("style")){var l=r.querySelector("style").innerHTML.includes("td")?r.querySelector("style").innerHTML.split("td")[1]:r.querySelector("style").innerHTML;l=l.includes("{")?l.split("{")[1].split("}")[0]:l.split("}")[0];for(var h=0;h<n.length;h++){var p=n[h],c=p.match(/[A-Z]/);c&&(p=p.replace(c[0],"-"+c[0].toLowerCase())),l.indexOf(p)>-1&&(i[n[h]]=l.split(p+":")[1].split(";")[0].trim())}}if(t.length){var d,u,v,g,m,y=["font-family","vertical-align","text-align","text-indent","color","white-space","font-weight","font-style","font-size","text-decoration","background"],C=["fontFamily","verticalAlign","textAlign","textIndent","color","whiteSpace","fontWeight","fontStyle","fontSize","textDecoration","backgroundColor"],b=["border-bottom","border-top","border-right","border-left","border"],S=["borderBottom","borderTop","borderRight","borderLeft","border"];t.forEach(function(w){w.split(";").forEach(function(x){if(u=x.split(":")[0].trim(),(d=y.indexOf(u))>-1)u=x.split(":")[1].trim(),i[C[d]]=u;else if((d=b.indexOf(u))>-1){if("none"===(u=x.split(":")[1].trim()))u=void 0;else if(u.includes("pt")){v=u.split("pt"),g=v[0].split(" ");for(var I=0;I<g.length;I++)if(m=parseFloat(g[I])){g.splice(I,1),g.unshift((m/.75).toFixed(2)+"px"),v[0]=g.join(" ");break}u=v.join("")}i[S[d]]=u}})})}return e.querySelector("S")&&(i.textDecoration=i.textDecoration?"underline line-through":"line-through"),i.textDecoration&&-1===["underline","line-through","underline line-through","none"].indexOf(i.textDecoration)&&(i.textDecoration="none"),i.textAlign&&-1===["left","center","right"].indexOf(i.textAlign)&&(i.textAlign="left"),i.verticalAlign&&-1===["bottom","middle","top"].indexOf(i.verticalAlign)&&(i.verticalAlign="bottom"),i.fontSize&&(i.fontSize=Math.round(parseFloat(i.fontSize.indexOf("px")>-1?(.75*parseFloat(i.fontSize)).toString():i.fontSize))+"pt"),i.fontWeight&&-1===["bold","normal"].indexOf(i.fontWeight)&&(i.fontWeight=i.fontWeight>"599"?"bold":"normal"),i},s.prototype.refreshOnInsertDelete=function(e){if(this.copiedInfo){if(e.model.id!==this.copiedInfo.sId)return;var r=this.copiedInfo.range;if(e.isInsert){if("Column"===e.modelType)e.start<=r[3]&&(e.start<=r[1]?(r[1]+=t=e.end-e.start+1,r[3]+=t):r[3]=r[1]+(e.start-r[1]-1),this.performAction());else if(e.start<=r[2]){var t;e.start<=r[0]?(r[0]+=t=e.end-e.start+1,r[2]+=t):r[2]=r[1]+(e.start-r[1]-1),this.performAction()}}else this.clearCopiedInfo()}},s.prototype.performAction=function(){var e=this.getCopyIndicator();e&&ft(this.parent,e,this.copiedInfo.range,"e-copy-indicator")},s.prototype.getClipboardEle=function(){return this.parent.element.getElementsByClassName("e-clipboard")[0]},s.prototype.getCopyIndicator=function(){return this.parent.element.getElementsByClassName("e-copy-indicator")[0]},s.prototype.getModuleName=function(){return"clipboard"},s.prototype.destroy=function(){this.removeEventListener();var e=this.getClipboardEle();(0,f.og)(e),this.parent=null},s}(),Ta=function(){function s(e){this.editorElem=null,this.editCellData={},this.isEdit=!1,this.isCellEdit=!0,this.isNewValueEdit=!0,this.isAltEnter=!1,this.validCharacters=["+","-","*","/",",","(","=","&",":"],this.formulaBarCurStartPos=null,this.curEndPos=null,this.curStartPos=null,this.selectionStart=null,this.selectionEnd=null,this.uniqueColl="",this.uniqueActCell="",this.isSpill=!1,this.keyCodes={BACKSPACE:8,SPACE:32,TAB:9,DELETE:46,ESC:27,ENTER:13,FIRSTALPHABET:65,LASTALPHABET:90,FIRSTNUMBER:48,LASTNUMBER:59,FIRSTNUMPAD:96,LASTNUMPAD:111,SYMBOLSETONESTART:186,SYMBOLSETONEEND:192,SYMBOLSETTWOSTART:219,SYMBOLSETTWOEND:222,FIREFOXEQUALPLUS:61,FIREFOXMINUS:173,F2:113},this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.isEdit&&this.cancelEdit(!0,!1),this.removeEventListener(),this.parent=null,this.editorElem=null},s.prototype.addEventListener=function(){f.bi.add(this.parent.element,"dblclick",this.dblClickHandler,this),this.parent.on(er,this.mouseDownHandler,this),this.parent.on(lt,this.keyUpHandler,this),this.parent.on(Dt,this.keyDownHandler,this),this.parent.on(fe,this.performEditOperation,this),this.parent.on(Jo,this.initiateCurPosition,this),this.parent.on(ha,this.updateFormulaBarValue,this),this.parent.on(oi,this.addressHandler,this),this.parent.on(ts,this.initiateRefSelection,this),this.parent.on(si,this.refSelectionRender,this),this.parent.on(At,this.checkUniqueRange,this),this.parent.on(vn,this.reApplyFormula,this),this.parent.on(Hi,this.sheetChangeHandler,this)},s.prototype.removeEventListener=function(){f.bi.remove(this.parent.element,"dblclick",this.dblClickHandler),this.parent.isDestroyed||(this.parent.off(er,this.mouseDownHandler),this.parent.off(lt,this.keyUpHandler),this.parent.off(Dt,this.keyDownHandler),this.parent.off(fe,this.performEditOperation),this.parent.off(Jo,this.initiateCurPosition),this.parent.off(ha,this.updateFormulaBarValue),this.parent.off(oi,this.addressHandler),this.parent.off(ts,this.initiateRefSelection),this.parent.off(si,this.refSelectionRender),this.parent.off(At,this.checkUniqueRange),this.parent.off(vn,this.reApplyFormula),this.parent.off(Hi,this.sheetChangeHandler))},s.prototype.getModuleName=function(){return"edit"},s.prototype.performEditOperation=function(e){switch(e.action){case"renderEditor":this.renderEditor();break;case"refreshEditor":this.refreshEditor(e.value,e.refreshFormulaBar,e.refreshEditorElem,e.isAppend,e.trigEvent),e.refreshCurPos&&this.setCursorPosition();break;case"startEdit":if(this.isEdit){var i={isEdit:!1};this.parent.notify(ei,i),i.isEdit&&(this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos))}else this.isNewValueEdit=e.isNewValueEdit,this.startEdit(e.address,e.value,e.refreshCurPos);break;case"endEdit":this.isEdit&&this.endEdit(e.refreshFormulaBar);break;case"cancelEdit":this.isEdit&&this.cancelEdit(e.refreshFormulaBar);break;case"getCurrentEditValue":e.editedValue=this.editCellData.value,void 0!==e.endFormulaRef&&(e.endFormulaRef=this.endFormulaRef);break;case"refreshDependentCellValue":this.refreshDependentCellValue(e.rowIdx,e.colIdx,e.sheetIdx);break;case"getElement":e.element=this.getEditElement(this.parent.getActiveSheet());break;case"focusEditorElem":this.editorElem.focus();break;case"getCurrentEditSheetIdx":e.sheetIndex=this.editCellData.sheetIndex}},s.prototype.keyUpHandler=function(e){if(this.isEdit){var r=this.getEditElement(this.parent.getActiveSheet());if(e.altKey&&13===e.keyCode?(r.focus(),this.altEnter(),this.isAltEnter=!0):this.isCellEdit&&this.editCellData.value!==r.textContent&&16!==e.keyCode&&this.refreshEditor(r.textContent,this.isCellEdit),pe(this.editCellData.value,!0)&&(!e||16!==e.keyCode)&&(this.updateFormulaReference(r),this.endFormulaRef)){var i=this.getCurPosition();i.end&&this.validCharacters.indexOf(this.editCellData.value[i.end-1])>-1&&(this.endFormulaRef=!1)}}},s.prototype.updateFormulaReference=function(e){var r=this.parent.element.querySelector(".e-formularef-indicator");r&&r.parentElement.removeChild(r),this.editCellData.value!==e.textContent&&this.refreshEditor(e.textContent,!0),this.parent.notify(Ar,{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex})},s.prototype.keyDownHandler=function(e){var r=e.target,t=e.keyCode,i=this.parent.getActiveSheet(),n=B(i.activeCell),a=E(n[0],n[1],i,!1,!0);if(!(0,f.oq)(r,".e-dialog"))if(i.isProtected&&!r.classList.contains("e-sheet-rename")&&ur(a,Fe(i,n[1]))){if((t>=this.keyCodes.FIRSTALPHABET&&t<=this.keyCodes.LASTALPHABET||t>=this.keyCodes.FIRSTNUMBER&&t<=this.keyCodes.LASTNUMBER||t===this.keyCodes.DELETE||t===this.keyCodes.BACKSPACE||t===this.keyCodes.SPACE||t>=this.keyCodes.FIRSTNUMPAD&&t<=this.keyCodes.LASTNUMPAD||t>=this.keyCodes.SYMBOLSETONESTART&&t<=this.keyCodes.SYMBOLSETONEEND||t>=219&&t<=222||!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&t===this.keyCodes.F2)&&67!==t&&89!==t&&90!==t){if(i.protectSettings.insertLink&&75===t)return;!e.ctrlKey&&70!==e.keyCode&&!this.parent.element.querySelector(".e-editAlert-dlg")&&!r.parentElement.classList.contains("e-unprotectpwd-content")&&!r.parentElement.classList.contains("e-password-content")&&!r.parentElement.classList.contains("e-sheet-password-content")&&!r.parentElement.classList.contains("e-unprotectsheetpwd-content")&&!r.parentElement.classList.contains("e-reenterpwd-content")&&this.parent.notify(Nt,null)}}else if(this.isEdit){var o=this.getEditElement(i),l=pe(this.editCellData.value,!0);if((this.isCellEdit||l&&this.editCellData.value!==o.textContent&&16!==e.keyCode)&&(n[1]<this.parent.frozenColCount(i)&&(!i.frozenRows||n[0]>=this.parent.frozenRowCount(i))&&o&&"auto"!==o.style.height&&vt(o.textContent,a.style,this.parent.cellStyle)>parseInt(o.style.maxWidth,10)&&(o.style.height="auto"),vt(o.textContent,a.style,this.parent.cellStyle)>parseInt(o.style.maxWidth,10)-5&&(o.style.height="auto"),n[0]<this.parent.frozenRowCount(i)&&o&&!o.style.overflow&&vt(o.textContent,a.style,this.parent.cellStyle)>parseInt(o.style.maxWidth,10)&&(o.style.overflow="auto"),this.refreshEditor(o.textContent,this.isCellEdit,!1,!1,!1)),!e.altKey)switch(t){case this.keyCodes.ENTER:if(f.AR.isWindows&&e.preventDefault(),this.isAltEnter){var h=o.textContent;h&&h.indexOf("\n")>-1&&(di(this.parent.getActiveSheet().selectedRange,!0,this.parent,!0),this.refreshEditor(o.textContent,this.isCellEdit,!1,!1,!1),this.isAltEnter=!1)}if(l){var p=this.parent.element.querySelector(".e-formularef-indicator");p&&p.parentElement.removeChild(p),_(this.parent,this.editCellData.sheetIndex).id===i.id||this.parent.goTo(this.editCellData.fullAddr),this.endEdit(!1,e)}else this.endEdit(!1,e);break;case this.keyCodes.TAB:this.hasFormulaSuggSelected()||this.endEdit(!1,e);break;case this.keyCodes.ESC:this.cancelEdit(!0,!0,e)}}else if(r.classList.contains("e-spreadsheet")||(0,f.oq)(r,".e-sheet-panel")){13===t&&"true"===r.contentEditable&&e.preventDefault();var c=String.fromCharCode(t),d=t>=this.keyCodes.FIRSTALPHABET&&t<=this.keyCodes.LASTALPHABET||c.toLowerCase()!==c.toUpperCase(),g=t>=this.keyCodes.SYMBOLSETONESTART&&t<=this.keyCodes.SYMBOLSETONEEND;g||(g=t>=this.keyCodes.SYMBOLSETTWOSTART&&t<=this.keyCodes.SYMBOLSETTWOEND);var y=!e.shiftKey&&!e.ctrlKey&&!e.metaKey&&t===this.keyCodes.F2;if(!e.ctrlKey&&!e.metaKey&&!e.altKey&&(!e.shiftKey&&t===this.keyCodes.SPACE||d||t>=this.keyCodes.FIRSTNUMBER&&t<=this.keyCodes.LASTNUMBER||t>=this.keyCodes.FIRSTNUMPAD&&t<=this.keyCodes.LASTNUMPAD||g||"mozilla"===f.AR.info.name&&(t===this.keyCodes.FIREFOXEQUALPLUS||t===this.keyCodes.FIREFOXMINUS))||y||t===this.keyCodes.BACKSPACE){y&&(this.isNewValueEdit=!1);var b=document.getElementsByClassName("e-ss-overlay-active");b.length?t===this.keyCodes.DELETE&&this.parent.notify(It,{id:b[0].id,sheetIdx:this.parent.activeSheetIndex+1}):(this.startEdit(null,null,!0,!0),this.getEditElement(i).focus())}t===this.keyCodes.DELETE&&(i.isProtected&&Qt(this.parent)?this.parent.notify(Nt,null):(this.editingHandler("delete"),this.parent.notify(St,null)))}},s.prototype.renderEditor=function(){if(!this.editorElem||!(0,f.Ys)("#"+this.parent.element.id+"_edit",this.parent.element)){var e=this.parent.createElement("div",{id:this.parent.element.id+"_edit",className:"e-spreadsheet-edit",attrs:{contentEditable:"true",role:"textbox",spellcheck:"false","aria-multiline":"true"}});this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0]&&this.parent.element.getElementsByClassName("e-spreadsheet-edit")[0].remove();var r=this.parent.element.querySelector(".e-sheet-content");if(!r)return;r.appendChild(e),this.editorElem=e}this.parent.notify(tr,{action:"renderAutoComplete"})},s.prototype.refreshEditor=function(e,r,t,i,n){void 0===n&&(n=!0),i?e=this.editCellData.value=this.editCellData.value+e:this.editCellData.value=e;var a=this.getEditElement(this.parent.getActiveSheet());t&&a&&(a.textContent=e),r&&this.parent.notify(cr,{action:"refreshFormulabar",value:e}),this.parent.isEdit&&a&&n&&this.editCellData.value===a.textContent&&this.triggerEvent("cellEditing").cancel&&this.cancelEdit()},s.prototype.startEdit=function(e,r,t,i){void 0===t&&(t=!0),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true");var n=this.parent.getActiveSheet(),a=B(n.activeCell),o=E(a[0],a[1],n,!1,!0);if(lh(this.parent,a[0],a[1],this.parent.activeSheetIndex)){var l=this.parent.getCell(a[0],a[1]),h=!1,p=l.innerHTML;if(l&&p.indexOf("<")>-1&&p.indexOf(">")>-1&&p.indexOf("input")>-1&&(h=!0),h)return}this.updateEditCellDetail(e,r),this.initiateEditor(t),this.positionEditor(),this.parent.isEdit=this.isEdit=!0,this.parent.notify(ti,null),this.parent.notify(dr,[{enable:!1}]),o.formula&&!i&&this.parent.notify(Ar,{range:o.formula,formulaSheetIdx:this.editCellData.sheetIndex})},s.prototype.setCursorPosition=function(){var e=this.getEditElement(this.parent.getActiveSheet()),r=e.textContent.length;if(r){var t=document.getSelection(),i=document.createRange();i.setStart(e.firstChild,r),i.collapse(!0),t.removeAllRanges(),t.addRange(i)}e.focus()},s.prototype.hasFormulaSuggSelected=function(){var e=document.getElementById(this.parent.element.id+"_ac_popup");return e&&"visible"===e.style.visibility&&e.querySelectorAll(".e-item-focus").length>0},s.prototype.editingHandler=function(e){var i,r=document.getElementsByClassName("e-ss-overlay-active");if("delete"===e)if(r.length>0)r[0].classList.contains("e-datavisualization-chart")?this.parent.notify(Dr,{id:r[0].id,sheetIdx:this.parent.activeSheetIndex+1}):this.parent.notify(It,{id:r[0].id,sheetIdx:this.parent.activeSheetIndex+1});else{var n=this.parent.getActiveSheet(),a=n.selectedRange,o=De(a);a=z(o=o[0]>o[2]?Q(o):o);var l={address:n.name+"!"+a,cancel:!1};if(this.parent.notify(ue,{action:"cellDelete",eventArgs:l}),l.cancel)return;o=A(a=Cr(l.address)),ph(this.parent,o,this.parent.activeSheetIndex),this.parent.notify(Wt,{}),0===o[0]&&0===o[1]&&o[2]>=n.usedRange.rowIndex&&o[3]>=n.usedRange.colIndex&&this.parent.setUsedRange(0,0,n,!1,!0);var h={cellIdx:o,isUnique:!1};if(this.checkUniqueRange(h),h.isUnique){var p=A(this.uniqueColl);(c=E(p[0],p[1],this.parent.getActiveSheet()))&&(i=c.value.toString().indexOf("#SPILL!")>-1)}if(h.isUnique&&this.uniqueColl.split(":")[0]===a.split(":")[0]){for(var d=A(this.uniqueColl),u=d[0];u<=d[2];u++)for(var v=d[1];v<=d[3];v++)this.parent.updateCell({value:"",formula:""},z([u,v]));this.parent.notify(Ur,null),this.uniqueColl=""}else if(h.isUnique){var g=A(this.uniqueColl);if("#SPILL!"===E(g[0],g[1],n).value){var m=!1;for(v=g[0];v<=g[2];v++)for(var y=g[1];y<=g[3];y++){var c=E(v,y,n);v===g[0]&&y===g[1]?m=!1:!(0,f.le)(c.value)&&""!==c.value&&(m=!0)}m||this.reApplyFormula()}}this.parent.notify(Z,h.isUnique?{action:"cellDelete",eventArgs:{address:n.name+"!"+a,isSpill:i}}:{action:"cellDelete",eventArgs:{address:n.name+"!"+a}})}},s.prototype.getCurPosition=function(){var e={},r=window.getSelection();if(this.editorElem.textContent===this.editCellData.value&&(e.start=r.anchorOffset,e.end=r.focusOffset,e.start>e.end)){var t=e.start;e.start=e.end,e.end=t}if(r&&r.focusNode&&r.focusNode.classList&&r.focusNode.classList.contains("e-formula-bar-panel")&&this.editorElem.textContent===this.editCellData.value){var i=r.focusNode.getElementsByClassName("e-formula-bar e-css")[0];e.start=i.selectionStart,e.end=i.selectionEnd}return e},s.prototype.mouseDownHandler=function(e){if(!(0,f.oq)(e.target,".e-findtool-dlg")&&!(0,f.oq)(e.target,".e-validationerror-dlg")&&this.isEdit){var r=this.getCurPosition();r.start&&(this.curStartPos=this.selectionStart=r.start),r.end&&(this.curEndPos=this.selectionEnd=r.end);var t=e.target,i=this.parent.getActiveSheet(),n=this.parent.element.querySelector(".e-formularef-indicator");this.isCellEdit=t.classList.contains("e-spreadsheet-edit");var a=pe(this.editCellData.value,!0),o=this.getEditElement(i);if(t.classList.contains("e-cell")||t.classList.contains("e-header-cell")||t.classList.contains("e-selectall")||(0,f.oq)(t,".e-toolbar-item.e-active")||(0,f.oq)(t,".e-table")){if(this.isAltEnter){var l=o.textContent;l&&l.indexOf("\n")>-1&&(this.isAltEnter=!1,di(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(o.textContent,this.isCellEdit))}if(!a||this.endFormulaRef)this.endFormulaRef=!1,this.endEdit(!1,e);else{var h=this.selectionEnd,p=B(i.activeCell),c=E(p[0],p[1],i);if(this.selectionStart!==this.selectionEnd&&this.editCellData.value===o.textContent&&-1!==this.validCharacters.indexOf(o.textContent.substring(this.selectionStart-1,this.selectionStart))&&nt(o.textContent.substring(this.selectionStart,this.selectionEnd))&&o.textContent.indexOf(":")!==this.selectionEnd&&(this.editCellData.value=o.textContent.substring(0,this.selectionStart)+o.textContent.substring(this.selectionEnd,o.textContent.length)),this.editCellData.value===o.textContent&&o.textContent.indexOf("(")!==o.textContent.length-1&&-1!==o.textContent.indexOf("(")&&this.selectionStart===this.selectionEnd)if(this.editCellData.sheetIndex!==ee(this.parent,i.name)){var d=this.parent.element.querySelector(".e-formula-bar");if(","!==o.textContent.substring(d.selectionEnd-1,d.selectionEnd)&&!e.shiftKey)return n&&n.parentElement.removeChild(n),this.parent.goTo(this.editCellData.fullAddr),void this.endEdit(!1,e)}else if(-1===this.validCharacters.indexOf(o.textContent.substring(h-1,h)))return n&&n.parentElement.removeChild(n),void this.endEdit(!1,e);if(!c)return;if((a=!!c.formula&&(pe(E(p[0],p[1],i).formula)||this.editCellData.value&&0===this.editCellData.value.toString().indexOf("=")))&&this.parent.isEdit){var u=this.selectionEnd;this.editCellData.value.length===u?(")"===this.editCellData.value.substring(this.editCellData.value.length-1)||te(this.editCellData.value.substring(this.editCellData.value.length-1)))&&(n&&n.parentElement.removeChild(n),this.endEdit(!1,e)):this.editCellData.value===o.textContent&&(-1===this.validCharacters.indexOf((this.editCellData.value+i.selectedRange).substring(u-1,u))||-1===this.validCharacters.indexOf(o.textContent.substring(u-1,u))||")"!==o.textContent.substring(u,u+1)&&-1===this.validCharacters.indexOf(o.textContent.substring(u,u+1)))&&(n&&n.parentElement.removeChild(n),this.endEdit(!1,e))}}}else if(a&&this.editCellData.value===o.textContent&&o.textContent.indexOf("(")!==o.textContent.length-1&&!this.isCellEdit&&-1===this.validCharacters.indexOf(this.editCellData.value.substring(this.selectionStart-1,this.selectionStart))&&_(this.parent,this.editCellData.sheetIndex).id===i.id&&(h=window.getSelection().focusOffset,-1===this.validCharacters.indexOf(o.textContent.substring(h-1,h))))return n&&n.parentElement.removeChild(n),this.parent.goTo(this.editCellData.fullAddr),void(this.isEdit&&this.endEdit(!1,e))}},s.prototype.dblClickHandler=function(e){var r=e.target,t=this.parent.getActiveSheet(),i=B(t.activeCell),n=E(i[0],i[1],t)||{};if(!(0,f.oq)(r,".e-datavisualization-chart"))if(t.isProtected&&ur(n,Fe(t,i[1])))(r.classList.contains("e-active-cell")||r.classList.contains("e-cell"))&&this.parent.notify(Nt,null);else if(r.className.indexOf("e-ss-overlay")<0&&(r.classList.contains("e-active-cell")||r.classList.contains("e-cell")||(0,f.oq)(r,".e-sheet-content")||r.classList.contains("e-table")))if(this.isEdit)if(pe(this.editCellData.value)){var a=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name===a&&this.endEdit()}else r.className.indexOf("e-spreadsheet-edit")<0&&this.endEdit();else this.isNewValueEdit=!1,this.startEdit()},s.prototype.updateEditCellDetail=function(e,r){var t,i;if(t=(0,f.le)(this.editCellData.sheetIndex)?e&&e.split("!").length>1?ee(this.parent,Et(e)):this.parent.activeSheetIndex:this.editCellData.sheetIndex,this.editCellData.addr?pe(this.editCellData.value,!0)&&(i=_(this.parent,t),this.isNewValueEdit=!1):(i=_(this.parent,t),e=e?Cr(e):i.activeCell),e){var n=A(e),a=n[0],o=n[1],l=this.parent.getCell(a,o),h=xa(i,n,this.parent.frozenRowCount(i),this.parent.frozenColCount(i),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);this.editCellData={addr:e,fullAddr:pt(this.parent,t)+"!"+e,rowIndex:a,colIndex:o,sheetIndex:t,element:l,value:r||"",position:h}}},s.prototype.initiateEditor=function(e){var r=this;this.parent.getData(this.editCellData.fullAddr).then(function(i){!r.parent||i.forEach(function(n){var a={cell:n,value:n?n.value:""};r.parent.notify(Ya,a);var o=n?a.value:"";n&&n.formula&&(o=n.formula),r.editCellData.oldValue=o,r.editCellData.value?o=r.editCellData.value:r.editCellData.value=o,r.isNewValueEdit?o="":r.isNewValueEdit=!0,(0,f.o8)(o)||r.refreshEditor(o,!1,!0,!1,!1),e&&r.setCursorPosition(),r.triggerEvent("cellEdit").cancel&&r.cancelEdit(!0,!1)})})},s.prototype.positionEditor=function(e){var i,r=this.editCellData.element,n={isEdit:!1};if(this.parent.notify(ei,n),n.isEdit&&(0,f.le)(r)&&(r=i=this.parent.getCell(this.editCellData.rowIndex,this.editCellData.colIndex),this.editCellData.element=i),r){r.classList.add("e-ss-edited");var a=this.parent.getActiveSheet(),o=E(this.editCellData.rowIndex,this.editCellData.colIndex,a,!1,!0),l=this.editCellData.position.left+1,h=this.editCellData.position.top+1,p={range:[this.editCellData.rowIndex,this.editCellData.colIndex,this.editCellData.rowIndex,this.editCellData.colIndex]};this.parent.notify(Ne,p);var c=Ce(a,p.range[0],p.range[2])-3,d=ge(a,p.range[1],p.range[3])-3,u=this.parent.getMainContent(),v=u.parentElement,g=void 0,m=this.parent.frozenColCount(a),y=void 0,C=void 0,b=this.parent.frozenRowCount(a),S=void 0;if(this.editCellData.colIndex<m)g=Math.abs(this.parent.getRowHeaderContent().getBoundingClientRect()[this.parent.enableRtl?"left":"right"]-r.getBoundingClientRect()[this.parent.enableRtl?"right":"left"])-1,this.editCellData.rowIndex<b?"2"===this.parent.getRowHeaderContent().style.zIndex&&(y="3"):vt(o.value,o.style,this.parent.cellStyle)>g&&(S=!0);else{g=v.offsetWidth-(l-u.scrollLeft)-28-this.parent.sheetModule.getRowHeaderWidth(a);var w=r.getBoundingClientRect(),x=v.getBoundingClientRect().width,I=this.parent.enableRtl?w.left:w.right,F=this.parent.getScrollElement();x<I&&(F.scrollLeft+=I-x+this.parent.sheetModule.getScrollSize())}this.editCellData.rowIndex<b&&(C=!0);var k="display:block;top:"+h+"px;"+(this.parent.enableRtl?"right:":"left:")+l+"px;min-width:"+d+"px;max-width:"+(o&&o.wrap?d:g)+"px;height:"+(!C&&(o&&o.wrap||r&&e||S)?"auto;":c+"px;")+(o&&o.wrap?"width:"+d+"px;":"")+"min-height:"+c+"px;"+(y?"z-index: "+y+";":"")+(C&&(o&&!o.wrap||r&&e)&&(vt(o.value,o.style,this.parent.cellStyle)>g||r&&e)?"overflow: auto;":"");k+=r.style.cssText;var R=this.getEditElement(a,!0);R.setAttribute("style",k),vt(R.textContent,o.style,this.parent.cellStyle)>g&&(R.style.height="auto");var D=this.parent.element.querySelector(".e-active-cell");D&&(D.style.height=c+4+"px"),r.classList.contains("e-right-align")?R.classList.add("e-right-align"):r.classList.contains("e-center-align")&&R.classList.add("e-center-align")}},s.prototype.updateEditedValue=function(e,r){void 0===e&&(e=!0);var t=this.editCellData.oldValue,i=t?t.toString().toUpperCase():"",n=!0,a=this.editCellData.addr,o=A(this.parent.getActiveSheet().activeCell),l=this.parent.getActiveSheet(),h=E(o[0],o[1],l),p=Fe(l,o[1]);r&&(this.editCellData.value=r);var c=this.editCellData.value;if(this.parent.notify(ea,{args:{action:"beforeCellSave",eventArgs:{address:this.editCellData.addr}}}),this.parent.allowDataValidation&&(h&&h.validation||Ql(p,o[0],o[1]))){var d=c||this.getEditElement(l).innerText,v=this.parent.activeSheetIndex,m={value:d,range:"string"==typeof a?A(a):a,sheetIdx:v,isCell:!0,td:null,isValid:!0};this.parent.notify(Ti,m),(n=m.isValid)?this.editCellData.value=d:this.isCellEdit=!0}if((t!==this.editCellData.value||i.indexOf("=RAND()")>-1||i.indexOf("RAND()")>-1||i.indexOf("=RANDBETWEEN(")>-1||i.indexOf("RANDBETWEEN(")>-1)&&n){var y=this.parent.getActiveSheet(),C=A(y.activeCell);t&&t.toString().indexOf("=UNIQUE(")>-1&&""===this.editCellData.value&&this.parent.notify(Ur,null);var b={cellIdx:C,isUnique:!1};this.checkUniqueRange(b);var S=b.isUnique;if(S&&""!==t&&""===this.editCellData.value&&-1===E((w=A(this.uniqueColl))[0],w[1],y).value.toString().indexOf("#SPILL!"))return n;t&&t.toString().indexOf("UNIQUE")>-1&&this.editCellData.value&&this.editCellData.value.toString().indexOf("UNIQUE")>-1&&S&&this.updateUniqueRange("");var x={action:"updateCellValue",address:this.editCellData.addr,value:this.editCellData.value};this.parent.notify(Sr,x),y.conditionalFormats&&y.conditionalFormats.length&&this.parent.notify(We,{indexes:[this.editCellData.rowIndex,this.editCellData.colIndex],isAction:!0,refreshAll:x.isFormulaDependent,isEdit:!0});var w,I=E(C[0],C[1],y,!0),F=this.getRefreshNodeArgs(I);if(this.editCellData.value=F.value,I&&I.formula&&(this.editCellData.formula=I.formula),I&&I.wrap&&this.parent.notify(or,{range:C,wrap:!0,sheet:y}),e&&this.parent.refreshNode(this.editCellData.element,F),I&&I.hyperlink&&this.parent.serviceLocator.getService("cell").refreshRange(C),S)if(E((w=A(this.uniqueColl))[0],w[1],y).value.toString().indexOf("#SPILL!")>-1&&(this.isSpill=!0),""!==t&&""===this.editCellData.value||this.editCellData.formula&&this.editCellData.formula.length>1&&t!==this.editCellData.formula){for(var T=!1,k=w[0];k<=w[2];k++)for(var R=w[1];R<=w[3];R++){var D=E(k,R,y);k===w[0]&&R===w[1]?T=!1:D&&!(0,f.le)(D.value)&&""!==D.value&&(T=!0)}T||this.reApplyFormula()}else this.updateUniqueRange(c)}return n},s.prototype.checkUniqueRange=function(e){var r={range:[]};this.parent.notify(Za,r);var t=r.range;e.sheetName||(e.sheetName=this.parent.getActiveSheet().name);for(var i=0;i<t.length;i++)if(t[i].split("!")[0]===e.sheetName)for(var n=A(t[i]),a=n[0];a<=n[2];a++)for(var o=n[1];o<=n[3];o++)if(e.cellIdx[0]===a&&e.cellIdx[1]===o){e.isUnique=!0,this.uniqueCell=!0;var l=""!==this.uniqueColl?A(this.uniqueColl):[0,0,0,0],h=A(t[i]);if(l[0]===h[0]&&l[1]===h[1]){var p=[l[0],h[1],l[0],h[1]];p[2]=l[2]>h[2]?l[2]:h[2],p[3]=l[3]>h[3]?l[3]:h[3],this.uniqueColl=z(p),e.uniqueRange=z(p)}else this.uniqueColl=t[i],e.uniqueRange=t[i]}},s.prototype.updateUniqueRange=function(e){var r=A(this.uniqueColl),t=!1;"#SPILL!"!==E(r[0],r[1],this.parent.getActiveSheet()).value&&(t=!0);for(var i=r[0];i<=r[2];i++)for(var n=r[1];n<=r[3];n++)t&&(i===r[0]&&n===r[1]?this.parent.updateCell({value:"#SPILL!"},z([i,n])):z([i,n]).split(":")[0]===this.editCellData.addr?this.parent.updateCell({value:e},z([i,n])):this.parent.updateCell({value:""},z([i,n])))},s.prototype.reApplyFormula=function(){var e=A(this.uniqueColl),r=E(e[0],e[1],this.parent.getActiveSheet());this.parent.updateCell({value:""},z([e[0],e[1]]));for(var t=this.parent.sheets,i=r.formula,n=0;n<t.length;n++)i.indexOf(t[n].name)>-1&&(i=i.replace(t[n].name,"!"+n));this.parent.computeExpression(i),this.uniqueCell=!1,""!==this.uniqueActCell&&(this.editCellData.value=this.uniqueActCell,this.uniqueActCell="")},s.prototype.refreshDependentCellValue=function(e,r,t){if(e&&r&&(e--,r--,(this.editCellData.rowIndex!==e||this.editCellData.colIndex!==r)&&this.parent.activeSheetIndex===t||this.uniqueCell&&this.parent.activeSheetIndex===t)){var i=_(this.parent,t),n=void 0;if(!ne(i,e)&&!we(i,r)&&(n=this.parent.getCell(e,r)),n){if(n.parentElement){var a=n.parentElement.getAttribute("aria-rowindex");if(a&&Number(a)-1!==e)return}var o=E(e,r,i),l=A(i.activeCell);l[0]===e&&l[1]===r&&(this.uniqueActCell=o.value);var h=this.getRefreshNodeArgs(o,e,r);this.parent.refreshNode(n,h)}}},s.prototype.getRefreshNodeArgs=function(e,r,t){var i={value:(e=e||{}).value,format:e.format,onLoad:!0,formattedText:"",isRightAlign:!1,type:"General",cell:e,rowIndex:void 0===r?this.editCellData.rowIndex:r,colIndex:void 0===t?this.editCellData.colIndex:t,isRowFill:!1};return this.parent.notify(ot,i),i.formattedText=this.parent.allowNumberFormatting?i.formattedText:i.value,{isRightAlign:i.isRightAlign,result:i.formattedText,type:i.type,value:i.value,curSymbol:i.curSymbol,isRowFill:i.isRowFill}},s.prototype.endEdit=function(e,r){void 0===e&&(e=!1),e&&this.refreshEditor(this.editCellData.oldValue,!1,!0,!1,!1);var t=this.triggerEvent("beforeCellSave");t.cancel?this.parent.isEdit&&r&&r.preventDefault():(t.value&&t.value.toString().indexOf("\n")>-1&&(di(this.parent.getActiveSheet().selectedRange,!0,this.parent),this.refreshEditor(t.value,this.isCellEdit,!1,!1,!1)),this.updateEditedValue(!0,t.value)?(this.triggerEvent("cellSave",r,t.value),this.resetEditState(),this.focusElement()):r&&r.preventDefault(),this.parent.showSheetTabs&&!this.parent.isProtected&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"))},s.prototype.cancelEdit=function(e,r,t){void 0===e&&(e=!0),void 0===r&&(r=!0),this.refreshEditor(this.editCellData.oldValue,e,!1,!1,!1),r&&this.triggerEvent("cellSave",t),this.resetEditState(),this.focusElement()},s.prototype.focusElement=function(){K(this.parent.element),this.parent.notify(dr,[{enable:!0}])},s.prototype.triggerEvent=function(e,r,t){var i=this.parent.getActiveSheet(),n=E(this.editCellData.rowIndex,this.editCellData.colIndex,i),a={element:this.editCellData.element,value:t||this.editCellData.value,oldValue:this.editCellData.oldValue,address:this.editCellData.fullAddr,displayText:this.parent.getDisplayText(n)};if(a.address){var l={cellIdx:A(a.address),isUnique:!1};this.checkUniqueRange(l),l.isUnique&&(a.isSpill=this.isSpill)}if(a.value!==a.oldValue){if("cellSave"!==e&&(a.cancel=!1),"beforeCellSave"===e&&(this.parent.notify(ue,{eventArgs:a,action:"cellSave",preventAction:!0}),n=pe(a.value)?{formula:a.value}:{value:a.value},Je(this.parent,i,{cell:n,rowIdx:this.editCellData.rowIndex,colIdx:this.editCellData.colIndex,eventOnly:!0})))return this.cancelEdit(!1,!1),a.cancel=!0,a;this.parent.trigger(e,a),"cellSave"===e&&(this.editCellData.formula&&(a.formula=this.editCellData.formula),a.originalEvent=r,this.parent.notify(Z,{eventArgs:a,action:"cellSave"}))}else"cellSave"!==e&&"beforeCellSave"!==e&&this.parent.trigger(e,a);return{value:a.value,oldValue:null,element:null,address:null,cancel:a.cancel}},s.prototype.altEnter=function(){this.positionEditor(!0);var t,e=window.getSelection(),r=e.anchorNode,i=document.createRange();0===(t=3===r.nodeType?e.anchorOffset:r.textContent.length)&&r.textContent.length>0&&(t=r.textContent.length);var n=r.textContent,a=n.slice(0,t),o=n.slice(t)||" ";r.textContent=a+"\n"+o,i=document.createRange(),3===r.nodeType?(i.setStart(r,t+1),i.setEnd(r,t+1)):1===r.nodeType&&(i.setStart(r.firstChild,t+1),i.setEnd(r.firstChild,t+1)),e.removeAllRanges(),e.addRange(i)},s.prototype.resetEditState=function(e){if(void 0===e&&(e=!0),e){var r=this.getEditElement(this.parent.getActiveSheet());(pe(r.textContent)||""===r.textContent)&&this.parent.notify(es,null),this.editCellData.element&&(this.editCellData.element.classList.remove("e-ss-edited"),this.editorElem.textContent="",r===this.editorElem?(this.editorElem.removeAttribute("style"),this.editorElem.classList.remove("e-right-align")):(0,f.og)(r))}this.editCellData={},this.parent.isEdit=this.isEdit=!1,this.isCellEdit=!0,this.parent.notify(tr,{action:"endEdit"})},s.prototype.refSelectionRender=function(){var e=this.getEditElement(this.parent.getActiveSheet());e&&pe(e.textContent)&&this.parent.notify(Ar,{range:e.textContent,formulaSheetIdx:this.editCellData.sheetIndex})},s.prototype.initiateRefSelection=function(){var e=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),r=this.editCellData.value;this.parent.getActiveSheet().name===e&&pe(this.editCellData.value,!0)?(this.startEdit(this.editCellData.addr,r,!1),this.parent.notify(Ar,{range:this.editCellData.value,formulaSheetIdx:this.editCellData.sheetIndex}),this.getEditElement(this.parent.getActiveSheet()).innerHTML=r,this.initiateCurPosition()):this.initiateCurPosition()},s.prototype.addressHandler=function(e){var r=window.getSelection();if(this.selectionStart=r.anchorOffset,this.selectionEnd=r.focusOffset,this.selectionStart>this.selectionEnd){var t=this.selectionStart;this.selectionStart=this.selectionEnd,this.selectionEnd=t}if(r&&r.focusNode&&r.focusNode.classList&&r.focusNode.classList.contains("e-formula-bar-panel")){var i=r.focusNode.getElementsByClassName("e-formula-bar e-css")[0];this.selectionStart=i.selectionStart,this.selectionEnd=i.selectionEnd}var n={action:"getCurrentEditValue",editedValue:""};this.parent.notify(fe,n);var a=e.range,o=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!")),l=this.editCellData.sheetIndex,h=this.getEditElement(this.parent.getActiveSheet());if(this.parent.getActiveSheet().name!==o&&(a="'"+this.parent.getActiveSheet().name+"'!"+a),e.isSelect)this.parent.notify(Ar,{range:n.editedValue+a,formulaSheetIdx:l});else{var p=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));if(this.parent.getActiveSheet().name===p){var c=n.editedValue;this.selectionStart!==this.selectionEnd?(this.formulaBarCurStartPos=this.selectionStart,this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+a.length,h.textContent=c.substring(0,this.selectionStart)+a+c.substring(this.selectionStart)):c.indexOf(")")===c.length-1&&this.selectionEnd===c.length?(h.textContent=c.substring(0,c.length-1)+a+c.substring(c.length-1),this.curEndPos=h.textContent.length-1):c.indexOf(")")!==c.length-1?(h.textContent=c+a,this.curEndPos=h.textContent.length):h.textContent!==c?(h.textContent=c.substring(0,this.curStartPos)+a+c.substring(this.curStartPos),this.curEndPos=this.curStartPos+a.length):this.selectionStart===this.selectionEnd&&-1!==this.validCharacters.indexOf(c.substring(this.selectionStart-1,this.selectionEnd))&&(-1!==this.validCharacters.indexOf(c.substring(this.selectionStart,this.selectionEnd+1))||")"===c.substring(this.selectionStart,this.selectionEnd+1))&&(h.textContent=c.substring(0,this.selectionStart)+a+c.substring(this.selectionEnd),this.curStartPos=this.selectionStart,this.curEndPos=this.selectionStart+a.length,this.formulaBarCurStartPos=this.curStartPos)}}},s.prototype.updateFormulaBarValue=function(){var e=window.getSelection(),r=this.editCellData.value,t=this.parent.getActiveSheet().selectedRange;t=yi(De(t))?t.split(":")[0]:t;var i=this.parent.element.querySelector(".e-formula-bar");if(r&&pe(r,!0)){var n=this.editCellData.fullAddr.substring(0,this.editCellData.fullAddr.indexOf("!"));this.parent.getActiveSheet().name!==n&&(t="'"+this.parent.getActiveSheet().name+"'!"+t),(0,f.le)(this.formulaBarCurStartPos)?r.indexOf(")")===r.length-1&&e.focusOffset===r.length?i.value=r.substring(0,r.length-1)+t+r.substring(r.length-1):r.indexOf(")")!==r.length-1?i.value=r+t:i.value!==r&&(i.value=r.substring(0,this.curStartPos)+t+r.substring(this.curStartPos)):i.value=r.substring(0,this.formulaBarCurStartPos)+t+r.substring(this.formulaBarCurStartPos),this.curEndPos=this.curStartPos+t.length}},s.prototype.setFormulaBarCurPosition=function(e,r,t){e.setSelectionRange&&(e.focus(),e.selectionStart=r,e.selectionEnd=r,e.setSelectionRange(r,t))},s.prototype.initiateCurPosition=function(e){void 0===e&&(e={isCellEdit:!1});var r=this.getEditElement(this.parent.getActiveSheet(),!0);if(e.isCellEdit){var t=this.getCurPosition();!this.endFormulaRef&&t.start===t.end&&(this.updateFormulaReference(r),t.end&&-1===this.validCharacters.indexOf(this.editCellData.value[t.end-1])&&(this.endFormulaRef=!0))}else{var i=r.innerText,n=window.getSelection();if(n&&n.focusNode&&n.focusNode.classList&&n.focusNode.classList.contains("e-formula-bar-panel")){var a=this.parent.element.querySelector(".e-formula-bar");this.setFormulaBarCurPosition(a,this.curEndPos,this.curEndPos)}else{if(i){var o=document.createRange();i.indexOf(")"),o.setStart(r.childNodes[0],this.curEndPos),o.setEnd(r.childNodes[0],this.curEndPos),n.removeAllRanges(),n.addRange(o)}if(this.editCellData.sheetIndex!==this.parent.getActiveSheet().id-1){var h=this.parent.element.querySelector(".e-formula-bar");if(h.value){var p=h.value.length;h.value.indexOf(")")===p-1?this.setFormulaBarCurPosition(h,p-1,p-1):this.setFormulaBarCurPosition(h,p,p)}}}}},s.prototype.getEditElement=function(e,r){if((this.isEdit||r)&&(e.frozenRows||e.frozenColumns)){var t=this.parent.frozenRowCount(e),i=this.parent.frozenColCount(e),n=B(e.activeCell),a=void 0;if(n[0]<t&&n[1]<i)a=this.parent.getSelectAllContent();else if(n[0]<t)a=this.parent.getColumnHeaderContent();else{if(!(n[1]<i))return this.editorElem;a=this.parent.getRowHeaderContent()}var o=a.getElementsByClassName("e-spreadsheet-edit")[0];return!o&&r&&(o=a.appendChild(this.editorElem.cloneNode())),o}return this.editorElem},s.prototype.sheetChangeHandler=function(){this.isEdit||(this.editCellData.value=null)},s}(),Aa=function(){function s(e){this.uniqueOBracket=String.fromCharCode(129),this.uniqueCBracket=String.fromCharCode(130),this.uniqueCSeparator=String.fromCharCode(131),this.uniqueCOperator=String.fromCharCode(132),this.uniquePOperator=String.fromCharCode(133),this.uniqueSOperator=String.fromCharCode(134),this.uniqueMOperator=String.fromCharCode(135),this.uniqueDOperator=String.fromCharCode(136),this.uniqueModOperator=String.fromCharCode(137),this.uniqueConcateOperator=String.fromCharCode(138),this.uniqueEqualOperator=String.fromCharCode(139),this.uniqueExpOperator=String.fromCharCode(140),this.uniqueGTOperator=String.fromCharCode(141),this.uniqueLTOperator=String.fromCharCode(142),this.invalidOperators=["%"],this.formulaRange=[],this.tableRangesFormula={},this.parent=e,this.addEventListener(),this.mouseMoveEvt=this.mouseMoveHandler.bind(this)}return s.prototype.addEventListener=function(){this.parent.on(Ye,this.init,this),this.parent.on(er,this.mouseDownHandler,this),this.parent.on(Lt,this.virtualContentLoadedHandler,this),this.parent.on(Yn,this.cellNavigateHandler,this),this.parent.on(Er,this.selectRange,this),this.parent.on(Xe,this.rowHeightChanged,this),this.parent.on($e,this.colWidthChanged,this),this.parent.on(aa,this.protectHandler,this),this.parent.on(Ar,this.initiateFormulaSelection,this),this.parent.on(es,this.clearBorder,this),this.parent.on(Yt,this.getRowIdxFromClientY,this),this.parent.on(Xt,this.getColIdxFromClientX,this),this.parent.on(pi,this.chartBorderHandler,this),this.parent.on(ps,this.isTouchSelectionStarted,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ye,this.init),this.parent.off(er,this.mouseDownHandler),this.parent.off(Lt,this.virtualContentLoadedHandler),this.parent.off(Yn,this.cellNavigateHandler),this.parent.off(Er,this.selectRange),this.parent.off(Xe,this.rowHeightChanged),this.parent.off($e,this.colWidthChanged),this.parent.off(aa,this.protectHandler),this.parent.off(Ar,this.initiateFormulaSelection),this.parent.off(es,this.clearBorder),this.parent.off(Yt,this.getRowIdxFromClientY),this.parent.off(Xt,this.getColIdxFromClientX),this.parent.off(pi,this.chartBorderHandler),this.parent.off(ps,this.isTouchSelectionStarted))},s.prototype.isTouchSelectionStarted=function(e){e.touchSelectionStarted=this.touchSelectionStarted},s.prototype.rowHeightChanged=function(e){var r=this;!e.threshold||Pe(function(){if(r.parent){var t=r.parent.getActiveSheet(),i=r.getActiveCell();if(i&&(t.frozenRows||t.frozenColumns||t.selectedRange.includes(" ")))return void r.selectRange({address:t.selectedRange});var o,n=Q(A(t.selectedRange)),a={range:n,isActiveCell:!1,skipChecking:!0};if(i){var l=B(t.activeCell)[0];r.parent.notify(Yr,a),a.isActiveCell&&(o=E(n[0],n[1],t,!1,!0).rowSpan>1&&n[0]<=e.rowIdx&&n[2]>=e.rowIdx),l===e.rowIdx||o?i.style.height=parseFloat(i.style.height)+e.threshold+"px":l>e.rowIdx&&(i.style.top=parseFloat(i.style.top)+e.threshold+"px")}if(i=r.getSelectionElement()){if(o||n[0]===n[2]&&n[1]===n[3])return;var p=n[0];p<=e.rowIdx&&n[2]>=e.rowIdx&&i?i.style.height=parseFloat(i.style.height)+e.threshold+"px":p>e.rowIdx&&i&&(i.style.top=parseFloat(i.style.top)+e.threshold+"px")}}})},s.prototype.colWidthChanged=function(e){var r=this;!e.threshold||Pe(function(){if(r.parent){var t=r.parent.getActiveSheet(),i=r.getActiveCell();if(i&&(t.frozenRows||t.frozenColumns||t.selectedRange.includes(" ")))return void r.selectRange({address:t.selectedRange});var o,n=Q(A(t.selectedRange)),a={range:n,isActiveCell:!1,skipChecking:!0};if(i){r.parent.notify(Yr,a);var l=B(t.activeCell)[1];if(a.isActiveCell){var h=E(n[0],n[1],t,!1,!0);o=h.rowSpan>1||h.colSpan>1}l===e.colIdx||o?i.style.width=parseFloat(i.style.width)+e.threshold+"px":l>e.colIdx&&(i.style.left=parseFloat(i.style.left)+e.threshold+"px")}if((i=r.getSelectionElement())&&!o&&(n[0]!==n[2]||n[1]!==n[3])){var p=n[1];p<=e.colIdx&&n[3]>=e.colIdx&&i?i.style.width=parseFloat(i.style.width)+e.threshold+"px":p>e.colIdx&&i&&(i.style.left=parseFloat(i.style.left)+e.threshold+"px")}}})},s.prototype.selectRange=function(e){e.address="Single"===this.parent.selectionSettings.mode?z(B(e.address)):e.address,this.selectMultiRange(e.address,null,null,e.skipChecking)},s.prototype.init=function(){this.createSelectionElement();var e=this.parent.getActiveSheet(),r=Q(A(e.selectedRange)),t=B(e.activeCell);this.selectMultiRange(e.selectedRange,!0,r[0]<=t[0]&&r[2]>=t[0]&&r[1]<=t[1]&&r[3]>=t[1])},s.prototype.selectMultiRange=function(e,r,t,i){var n=this,a=this.parent.activeSheetIndex;e.indexOf("!")>-1&&(a=ee(this.parent,Et(e)),e=e.split("!")[1]),this.parent.activeSheetIndex===a?e.split(" ").forEach(function(o,l){n.selectRangeByIdx(A(o),{type:"mousedown",ctrlKey:0!==l},null,t,r,i)}):$i(this.parent,e,this.parent.sheets[a])},s.prototype.createSelectionElement=function(){var e=this.parent.getMainContent(),r=this.parent.createElement("div",{className:"e-selection"});e.appendChild(r),r=this.parent.createElement("div",{className:"e-active-cell"}),e.appendChild(r)},s.prototype.mouseDownHandler=function(e){if(!((0,f.oq)(e.target,".e-scrollbar")||e.target.classList.contains("e-main-panel")||e.target.classList.contains("e-sheet"))){var r={action:"getCurrentEditValue",editedValue:""},t=this.parent.getActiveSheet();this.parent.notify(fe,r);var i=pe(r.editedValue,!0);if(!this.parent.isEdit||i){var n=document.getElementById(this.parent.element.id+"_overlay");if("string"==typeof e.target.className){if(e.target.className.indexOf("e-ss-overlay")>-1)return}else n&&n.classList.remove("e-ss-overlay-active");if((0,f.oq)(e.target,".e-datavisualization-chart")||t.isProtected&&!t.protectSettings.selectCells&&!t.protectSettings.selectUnLockedCells)return;if(!(0,f.oq)(e.target,".e-findtool-dlg")&&this.getSheetElement().contains(e.target)&&!e.target.classList.contains("e-colresize")&&!e.target.classList.contains("e-rowresize")){var a=this.parent.getActiveSheet(),o=this.parent.selectionSettings.mode,l=this.getRowIdxFromClientY({clientY:mi(e),target:e.target}),h=this.getColIdxFromClientX({clientX:vi(e),target:e.target}),p=B(a.activeCell),c=E(l,h,a),d=void 0,u=void 0;if(a.isProtected&&a.protectSettings.selectUnLockedCells&&!a.protectSettings.selectCells)if((0,f.le)(c)){if(!a.protectSettings.selectCells)return}else{if(!0===c.isLocked||(0,f.le)(c.isLocked))return;var v=this.parent.element.getElementsByClassName("e-sheet-panel")[0];v&&v.classList.contains("e-protected")&&v.classList.remove("e-protected")}if(a.showHeaders){var g=e.target;if(a.frozenColumns||a.frozenRows){var m=this.parent.getSelectAllContent().querySelector("thead");u=m?(this.parent.getColumnHeaderContent().contains(g)||m.contains(g))&&g.classList.contains("e-header-cell"):this.parent.getColumnHeaderContent().contains(g)&&g.classList.contains("e-header-cell"),d=(m=this.parent.getSelectAllContent().querySelector("tbody"))?(this.parent.getRowHeaderContent().contains(g)||m.contains(g))&&g.classList.contains("e-header-cell"):this.parent.getRowHeaderContent().contains(g)&&g.classList.contains("e-header-cell")}else d=this.parent.getRowHeaderContent().contains(e.target),u=this.parent.getColumnHeaderContent().contains(e.target)}if(3===e.which&&this.isSelected(l,h))return;if(e.target.classList.contains("e-autofill")){this.isautoFillClicked=!0;var y=e.target.parentElement.querySelector(".e-dragfill-ddb");(!y||y.classList.contains("e-hide"))&&(this.dAutoFillCell=a.selectedRange)}var C=A(a.topLeftCell),b=void 0;d?(this.isRowSelected=!0,(!e.shiftKey||"Single"===o)&&(this.startCell=[l,0]),b=[this.startCell[0],a.frozenColumns?C[1]:0,l,a.colCount-1]):u?(this.isColSelected=!0,(!e.shiftKey||"Single"===o)&&(this.startCell=[0,h]),b=[a.frozenRows?C[0]:0,this.startCell[1],a.rowCount-1,h]):(0,f.oq)(e.target,".e-select-all-cell")?(this.startCell=[a.frozenRows?C[0]:0,a.frozenColumns?C[1]:0],b=[].concat(this.startCell,[a.rowCount-1,a.colCount-1])):e.target.classList.contains("e-sheet-content")||((!e.shiftKey||"Single"===o)&&(this.startCell=[l,h]),!this.isautoFillClicked&&!(0,f.oq)(e.target,".e-filloption")&&(b=[].concat(this.startCell?this.startCell:B(a.activeCell),[l,h])));var S=e.ctrlKey&&b&&a.selectedRange.includes(z(b));if(!S&&"Multiple"===o&&(!Ns(e)&&(!Os(e)||Os(e)&&p[0]===l&&p[1]===h)||u||d)?(document.addEventListener(Ea().split(" ")[0],this.mouseMoveEvt),f.AR.isPointer||document.addEventListener(Ea().split(" ")[1],this.mouseMoveEvt,{passive:!1}),this.touchSelectionStarted=!0):this.touchSelectionStarted=!1,!S&&!Ns(e)&&f.bi.add(document,nh(),this.mouseUpHandler,this),Os(e)&&!u&&!d)return void(this.touchEvt=e);b&&this.selectRangeByIdx(b,e),this.parent.isMobileView()&&(this.parent.element.classList.add("e-mobile-focused"),this.parent.renderModule.setSheetPanelSize())}}i&&(e.target.classList.contains("e-cell")||e.target.classList.contains("e-wrap-content")||e.target.classList.contains("e-header-cell"))&&this.parent.isEdit&&(b=yi(De(b=this.parent.getActiveSheet().selectedRange))?b.split(":")[0]:b,this.parent.notify(oi,{range:b,isSelect:!1}))}},s.prototype.mouseMoveHandler=function(e){var r=this,t=this.parent.getActiveSheet();ah(e)&&e.preventDefault();var i={action:"getCurrentEditValue",editedValue:""};this.parent.notify(fe,i);var C,n=pe(i.editedValue,!0),a=this.parent.getMainContent().parentElement,o=this.parent.element.getElementsByClassName("e-scroller")[0],l=a.getBoundingClientRect(),h=this.parent.frozenColCount(t),p=l.left+this.parent.sheetModule.getRowHeaderWidth(t),c=l.top,d=l.right,u=l.bottom,v=vi(e),g=mi(e),m=this.isRowSelected?t.colCount-1:this.getColIdxFromClientX({clientX:Math.min(v,d),target:e.target}),y=this.isColSelected?t.rowCount-1:this.getRowIdxFromClientY({clientY:Math.min(g,u),target:e.target});if(e.ctrlKey){var b=t.selectedRange.split(" ");C=A(b[b.length-1])}else C=A(t.selectedRange);var S={range:[y,m,y,m]};if(this.parent.notify(Ne,S),S.range[2]!==C[2]||S.range[3]!==C[3]){var w=this.parent.frozenRowCount(t),x=g>u&&(!h||v<p)&&y<t.rowCount,I=g<c&&y>=0&&!this.isColSelected&&!!a.scrollTop;w>y&&(x=!1,I=!1);var k,R,F=v>d&&m<t.colCount,T=v<p&&m>=0&&!this.isRowSelected&&!!o.scrollLeft;if(h>m&&(F=!1,T=!1),this.clearInterval(),!n&&!this.isColSelected&&!this.isRowSelected&&(C=B(t.activeCell)),x||I||F||T)(I||T)&&(k=y,R=m),this.scrollInterval=setInterval(function(){if((x||I)&&!r.isColSelected){if((y=r.getRowIdxFromClientY({clientY:x?u:c}))>=t.rowCount)return void r.clearInterval();a.scrollTop+=(x?1:-1)*le(t,y)}if((F||T)&&!r.isRowSelected){if((m=r.getColIdxFromClientX({clientX:F?d:p}))>=t.colCount)return void r.clearInterval();o.scrollLeft+=(F?1:-1)*Te(t,m)}if(I&&!a.scrollTop||T&&!o.scrollLeft)return r.selectRangeByIdx([].concat(C[0],C[1],[k,R]),e),void r.clearInterval();r.selectRangeByIdx([].concat(C[0],C[1],[y,m]),e)},100);else{var D=[].concat(C[0],C[1],[y,m]);if(w&&D[0]<w&&D[2]>=w&&a.scrollTop&&(a.scrollTop=0,D[2]=w),h&&D[1]<h&&D[3]>=h&&o.scrollLeft&&(o.scrollLeft=0,D[3]=h),this.isautoFillClicked){e.target.classList.contains("e-autofill")&&(this.dAutoFillCell=t.selectedRange);var N={e,indexes:null};this.parent.notify(fs,N),D=N.indexes}this.selectRangeByIdx(D,e)}if(n&&this.parent.isEdit&&!(0,f.oq)(e.target,"#"+this.parent.element.id+"_edit")){var P=this.parent.getActiveSheet().selectedRange;this.parent.notify(oi,{range:P,isSelect:!1})}}},s.prototype.mouseUpHandler=function(e){var r=this.getRowIdxFromClientY({clientY:mi(e),target:e.target}),t=this.getColIdxFromClientX({clientX:vi(e),target:e.target});this.clearInterval(),Ns(e)&&!(this.isColSelected||this.isRowSelected)&&this.getRowIdxFromClientY({clientY:mi(this.touchEvt),target:e.target})===r&&this.getColIdxFromClientX({clientX:vi(this.touchEvt),target:e.target})===t&&this.mouseDownHandler(e),document.removeEventListener(Ea().split(" ")[0],this.mouseMoveEvt),f.AR.isPointer||document.removeEventListener(Ea().split(" ")[1],this.mouseMoveEvt),f.bi.remove(document,nh(),this.mouseUpHandler);var i=this.parent.getActiveSheet();if((i.frozenRows||i.frozenColumns)&&xe(this.parent.element,null,"e-cur-selection",!0,!0),this.parent.notify(bo,e),this.isautoFillClicked){var a=A(this.parent.getActiveSheet().selectedRange);!(this.isColSelected&&a[1]===t)&&!(this.isRowSelected&&a[0]===r)&&this.parent.notify(ds,{event:e,dAutoFillCell:this.dAutoFillCell}),this.isautoFillClicked=!1}else e.ctrlKey||Vs(Yl(this.parent.getActiveSheet()))?this.parent.notify(fr,null):this.parent.notify(Bt,null);var o={action:"getCurrentEditValue",editedValue:""};this.parent.notify(fe,o),(pe(o.editedValue)||o.editedValue&&0===o.editedValue.toString().indexOf("="))&&this.parent.isEdit&&this.parent.notify(Jo,{isCellEdit:e.target.classList.contains("e-spreadsheet-edit")})},s.prototype.isSelected=function(e,r){for(var i,t=!1,n=this.parent.getActiveSheet().selectedRange.split(" "),a=0;a<n.length;a++)if((i=Q(A(n[a])))[0]<=e&&e<=i[2]&&i[1]<=r&&r<=i[3]){t=!0;break}return t},s.prototype.virtualContentLoadedHandler=function(e){var i,n,a,r=this,t=this.parent.getActiveSheet();t.selectedRange.split(" ").forEach(function(o,l){if(i=A(o),n=0===i[0]&&i[2]===e.prevRowColCnt.rowCount-1,(a=0===i[1]&&i[3]===e.prevRowColCnt.colCount-1)||n)i=n&&a?[0,0,t.rowCount-1,t.colCount-1]:n?[0,i[1],t.rowCount-1,i[3]]:[i[0],0,i[2],t.colCount-1],t.frozenRows||t.frozenColumns?r.selectRangeByIdx(i,{type:"mousedown",ctrlKey:0!==l},!1,!1,!1,!1,void 0,!0):r.selectRangeByIdx(i,null,!0,null,null,null,l);else{i=A(o);var h=r.parent.viewport.topIndex+r.parent.frozenRowCount(t),p=r.parent.viewport.leftIndex+r.parent.frozenColCount(t);r.highlightHdr(i,0!==l,i[0]>=h||i[2]>=h,i[1]>=p||i[3]>=p)}})},s.prototype.clearInterval=function(){clearInterval(this.scrollInterval),this.scrollInterval=null},s.prototype.getScrollLeft=function(){return this.parent.scrollModule?this.parent.scrollModule.prevScroll.scrollLeft:0},s.prototype.cellNavigateHandler=function(e){var r=this.parent.getActiveSheet();r.isProtected&&!r.protectSettings.selectCells&&!r.protectSettings.selectUnLockedCells||this.selectRangeByIdx(e.range.concat(e.range),void 0,!1,!1,!1,!1,void 0,e.preventAnimation)},s.prototype.getColIdxFromClientX=function(e){var r=0,t=this.parent.getActiveSheet(),i=0;if(e.isImage)i=Number(this.addDPRValue(e.clientX).toFixed(2));else{var n=document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect();if(i=this.parent.enableRtl?n.right-this.parent.sheetModule.getRowHeaderWidth(t,!0)-1-e.clientX:e.clientX-(n.left+this.parent.sheetModule.getRowHeaderWidth(t,!0)+1),i+=this.parent.viewport.beforeFreezeWidth,!e.target||!(0,f.oq)(e.target,".e-row-header")&&!(0,f.oq)(e.target,".e-selectall-container")||this.isScrollableArea(e.clientX,e.target,!0))if(this.parent.frozenColCount(t)){var a=this.parent.element.querySelector(".e-frozen-column");i=parseInt(a.style.left)>i?i:i+this.getScrollLeft()}else i+=this.getScrollLeft()}for(var o,l=0;;l++)if(o=r+=Te(t,l,null,!0),e.isImage&&(o=Number(o.toFixed(2))),i<o||this.parent.scrollSettings.isFinite&&l===t.colCount-1)return e.isImage||(e.size=i),e.clientX=l,l},s.prototype.isScrollableArea=function(e,r,t){return!!r.classList.contains("e-table")&&(t?e>this.parent.getMainContent().getBoundingClientRect().left:e>this.parent.getMainContent().parentElement.getBoundingClientRect().top)},s.prototype.addDPRValue=function(e){if(window.devicePixelRatio%1>0){var r=e*window.devicePixelRatio%1;return e+(r?(r>.5?1-r:-1*r)/window.devicePixelRatio:0)}return e},s.prototype.getRowIdxFromClientY=function(e){var r=0,t=this.parent.getActiveSheet(),i=0;if(e.isImage)i=Number(this.addDPRValue(e.clientY).toFixed(2));else{var n=document.getElementById(this.parent.element.id+"_sheet");i=e.clientY+this.parent.viewport.beforeFreezeHeight-(n.getBoundingClientRect().top+(t.showHeaders?31:0)),(!e.target||!(0,f.oq)(e.target,".e-header-panel")||this.isScrollableArea(e.clientY,e.target))&&(i+=this.parent.getMainContent().parentElement.scrollTop)}for(var a,o=0;;o++)if(a=r+=le(t,o,!0),e.isImage&&(a=Number(a.toFixed(2))),i<a||this.parent.scrollSettings.isFinite&&o===t.rowCount-1)return e.isImage||(e.size=i),e.clientY=o,o},s.prototype.initFormulaReferenceIndicator=function(e){if(this.parent.isEdit){var r=this.parent.createElement("div",{className:"e-formularef-indicator"});r.appendChild(this.parent.createElement("div",{className:"e-top"})),r.appendChild(this.parent.createElement("div",{className:"e-bottom"})),r.appendChild(this.parent.createElement("div",{className:"e-left"})),r.appendChild(this.parent.createElement("div",{className:"e-right"})),this.parent.getMainContent().appendChild(r),ft(this.parent,r,e,"e-formularef-indicator")}},s.prototype.selectRangeByIdx=function(e,r,t,i,n,a,o,l){var h=this;if(!(r&&r.target&&(0,f.oq)(r.target,"#"+this.parent.element.id+"_edit"))){var p={action:"getCurrentEditValue",editedValue:"",endFormulaRef:!1};this.parent.notify(fe,p);var u,c=!!this.parent.isEdit&&pe(p.editedValue,!0)&&!p.endFormulaRef,d=r&&r.ctrlKey&&oh(r);d||(u=this.getSelectionElement(r,o));var C,v=this.parent.getActiveSheet(),g=A(v.topLeftCell),m=this.parent.element.querySelector(".e-formularef-indicator"),y={range:[].slice.call(e),isActiveCell:!1,skipChecking:a},b=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");!this.isColSelected&&!this.isRowSelected&&this.parent.notify(Yr,y),e!==y.range&&(C=!0),e=y.range;var S=new Promise(function(N){N(void 0)}),w={range:z(e),cancel:!1};if(this.parent.trigger("beforeSelect",w),!w.cancel){if(c&&m&&m.parentElement.removeChild(m),this.parent.notify(ma,null),!yi(e)&&!y.isActiveCell||d){if(d)if(void 0===o){var I=z(e);if(v.selectedRange.includes(I))return(F=v.selectedRange.split(" ")).length>1?(F.splice(F.indexOf(I),1),I=F.join(" ")):I=v.activeCell+":"+v.activeCell,void this.selectRange({address:I});u=this.getSelectionElement(r,o)}else u=this.getSelectionElement(r,o);if(c&&this.parent.isEdit)r&&r.target&&!r.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify(oi,{range:z(e),isSelect:!0}),this.initFormulaReferenceIndicator(e));else{x=void 0,u&&(u.classList.remove("e-hide"),(v.frozenRows||v.frozenColumns)&&((r&&r.target||d)&&(x="e-cur-selection",ka(r)&&u.classList.contains("e-cur-selection")?u.classList.add("e-hide"):u.classList.add(x)),!d&&(this.isColSelected||this.isRowSelected)&&oh(r)&&(xe(this.parent.getSelectAllContent(),null,"e-selection"),xe(this.parent.getColumnHeaderContent(),null,"e-selection"),xe(this.parent.getRowHeaderContent(),null,"e-selection"))));var T=this.isColSelected&&this.isRowSelected?void 0:this.getOffset(e[2],e[3]);C&&T&&(T.left={idx:0,size:0}),S=ft(this.parent,u,e,x,l,d,d&&!r.target)||S}}else{if(u&&(u.classList.contains("e-multi-range")||u.classList.add("e-hide"),v.frozenRows||v.frozenColumns)){var x=ka(r)?"e-cur-selection":"e-selection";xe(this.parent.getSelectAllContent(),null,x,!0),xe(this.parent.getColumnHeaderContent(),null,x,!0),xe(this.parent.getRowHeaderContent(),null,x,!0)}!v.frozenColumns&&!v.frozenRows&&u&&ft(this.parent,u,e),c&&r&&r.target&&!r.target.classList.contains("e-spreadsheet-edit")&&this.parent.isEdit&&(this.parent.notify(oi,{range:z(e).split(":")[0],isSelect:!0}),this.initFormulaReferenceIndicator(e))}var k={action:"getCurrentEditSheetIdx",sheetIndex:null};this.parent.notify(fe,k),v.frozenColumns&&e[1]>0&&e[1]===g[1]&&e[3]===v.colCount-1&&(e[1]=0),v.frozenRows&&e[0]>0&&e[0]===g[0]&&e[2]===v.rowCount-1&&(e[0]=0);var R=z(e);if(r&&r.ctrlKey&&(ka(r)||sh(r)))R=v.selectedRange.slice(0,v.selectedRange.lastIndexOf(" "))+" "+R;else if(o>-1){var F;(F=v.selectedRange.split(" "))[o]=R,R=F.join(" ")}if(c||this.isautoFillClicked)!n&&!this.isautoFillClicked&&$i(this.parent,R,v,d);else{var D=!1;v.selectedRange!==R&&(D=!0),$i(this.parent,R,v,d),D&&S.then(function(){h.parent.trigger("select",{range:h.parent.getActiveSheet().selectedRange})})}this.UpdateRowColSelected(e),this.highlightHdr(e,r&&r.ctrlKey),!t&&!(r&&("mousemove"===r.type||ah(r)))&&(c?k.sheetIndex===this.parent.getActiveSheet().id-1&&n?this.updateActiveCell((i=!0)?A(v.activeCell):e,n,l):this.parent.isEdit||this.updateActiveCell(i?A(v.activeCell):e,n,l):this.updateActiveCell(i?A(v.activeCell):e,n,l)),(0,f.le)(r)&&(r={type:"mousedown"}),c&&n||this.parent.notify(Wt,r),d||Vs(Yl(this.parent.getActiveSheet()))?this.parent.notify(fr,null):this.parent.notify(Bt,{preventAnimation:l}),this.parent.showAggregate&&this.parent.notify(ai,{}),this.parent.notify(Dl,{}),b&&this.parent.notify(Lr,{}),this.parent.notify(ns,{})}}},s.prototype.UpdateRowColSelected=function(e){var r=this.parent.getActiveSheet();this.isRowSelected=0===e[1]&&e[3]===r.colCount-1,this.isColSelected=0===e[0]&&e[2]===r.rowCount-1},s.prototype.updateActiveCell=function(e,r,t){var a,o,l,i=this.parent.getActiveSheet(),n=A(i.topLeftCell);this.isColSelected?(a=n[0],o=e[1],this.isRowSelected&&(o=n[1])):(a=e[0],o=e[1],this.isRowSelected&&(o=n[1]));var h={range:[a,o].concat([a,o])};if(this.parent.notify(Ne,h),e!==h.range&&(l=!0),i.activeCell!==j((e=h.range)[0],e[1])||r){if(this.parent.setSheetPropertyOnMute(i,"activeCell",j(e[0],e[1])),i.isProtected){var p=this.parent.element.querySelector(".e-formula-bar"),d=ur(E(e[0],e[1],i),Fe(i,e[1]));d&&p&&!p.disabled?p.disabled=!0:!d&&p&&p.disabled&&(p.disabled=!1)}if(this.getActiveCell()){var u=this.getOffset(e[2],e[3]);l&&(u.left={idx:0,size:0}),ft(this.parent,this.getActiveCell(),e,"e-active-cell",t)}this.parent.notify(St,null)}else ft(this.parent,this.getActiveCell(),e,"e-active-cell",t)},s.prototype.getOffset=function(e,r){var t={left:{idx:0,size:0},top:{idx:0,size:0}};return this.parent.scrollModule&&(r>=this.parent.scrollModule.offset.left.idx&&(t.left=this.parent.scrollModule.offset.left),e>=this.parent.scrollModule.offset.top.idx&&(t.top=this.parent.scrollModule.offset.top)),t},s.prototype.getSelectionElement=function(e,r){var t=this.parent.getActiveSheet();if(e&&e.ctrlKey){if(sh(e)||ka(e))return t.frozenColumns||t.frozenRows?(i=this.parent.getMainContent().querySelector(".e-cur-selection"))||(i=this.parent.element.querySelector(".e-multi-range"))&&i.cloneNode():this.parent.getMainContent().querySelector(".e-selection:last-child");var i,n=this.parent.getMainContent().getElementsByClassName("e-selection")[0];return(i=n.cloneNode()).classList.add("e-multi-range"),t.frozenColumns||t.frozenRows?(t.selectedRange.includes(" ")||(n.classList.remove("e-hide"),ft(this.parent,n,Q(A(t.selectedRange)),void 0,!1,!0)),!this.parent.getMainContent().querySelector(".e-multi-range")&&n.classList.contains("e-hide")?n:i):(n.classList.remove("e-hide"),this.parent.getMainContent().appendChild(i))}return r>-1?t.frozenRows||t.frozenColumns?this.parent.element.querySelector(".e-sheet").getElementsByClassName("e-selection")[r]:this.parent.getMainContent().getElementsByClassName("e-selection")[r]:([].slice.call(this.parent.element.getElementsByClassName("e-multi-range")).forEach(function(o){(0,f.Od)(o)}),this.parent.getMainContent().getElementsByClassName("e-selection")[0])},s.prototype.getActiveCell=function(){return this.parent.getMainContent().getElementsByClassName("e-active-cell")[0]},s.prototype.getSheetElement=function(){return document.getElementById(this.parent.element.id+"_sheet")},s.prototype.highlightHdr=function(e,r,t,i){var n=this;void 0===t&&(t=!0),void 0===i&&(i=!0);var a=this.parent.getActiveSheet();if(a.showHeaders){r||((0,f.IV)(this.getSheetElement().querySelectorAll(".e-highlight"),"e-highlight"),(0,f.IV)(this.getSheetElement().querySelectorAll(".e-prev-highlight"),"e-prev-highlight"));var o=this.parent.element.getElementsByClassName("e-select-all-cell")[0];o&&(0,f.IV)([o],["e-prev-highlight-right","e-prev-highlight-bottom"]);var l=[],h=[],p=Q(e);this.isRowSelected&&(p[1]=U(a,p[1],!0,"columns")),this.isColSelected&&(p[0]=U(a,p[0],!0));var v,g,c=[0,0,0,0],d=[0,0,0,0],u=B(a.topLeftCell),m=function(S,w,x){var I,F;S&&p[v]<S?(F=n.parent.hiddenCount(u[v],p[v],w,a),c[v]=p[v]-F-u[v],c[g]=(I=p[g]<S?p[g]:S-1)-n.parent.hiddenCount(p[v],I,w,a)-F-u[v]+1,p[g]>=(I=n.parent.viewport[x]+S)&&(d[v]=0,d[v]-=n.parent.hiddenCount(I,I,w,a),d[g]=p[g]-n.parent.hiddenCount(I,p[g],w,a)-I+1)):(F=n.parent.hiddenCount(I=n.parent.viewport[x]+S,p[v],w,a),d[v]=p[v]-F-I,d[g]=p[g]-n.parent.hiddenCount(p[v],p[g],w,a)-F-I+1)},y=function(S,w,x){for(var I=[].slice.call(w.getElementsByClassName("e-header-cell")),F=S[v];F<S[g];F++)I[F]&&x.push(I[F])};if(t){if(v=0,g=2,m(this.parent.frozenRowCount(a),"rows","topIndex"),a.frozenRows){var C=this.parent.getSelectAllContent().querySelector("tbody");C&&y(c,C,l)}y(d,this.parent.getRowHeaderContent(),l)}if(i){if(v=1,g=3,m(this.parent.frozenColCount(a),"columns","leftIndex"),a.frozenColumns){var b=this.parent.getSelectAllContent().querySelector("thead");b&&y(c,b,h)}y(d,this.parent.getColumnHeaderContent(),h)}a.isProtected&&!a.protectSettings.selectCells?(0,f.IV)([].concat(l,h),"e-highlight"):(0,f.cn)([].concat(l,h),"e-highlight"),l.length&&l[0].parentElement.previousElementSibling&&l[0].parentElement.previousElementSibling.classList.add("e-prev-highlight"),h.length&&h[0].previousElementSibling&&h[0].previousElementSibling.classList.add("e-prev-highlight"),this.isRowSelected&&this.isColSelected&&(a.isProtected&&!a.protectSettings.selectCells?document.getElementById(this.parent.element.id+"_select_all").classList.remove("e-highlight"):document.getElementById(this.parent.element.id+"_select_all").classList.add("e-highlight")),o&&(0===p[0]&&o.classList.add("e-prev-highlight-bottom"),0===p[1]&&o.classList.add("e-prev-highlight-right"))}},s.prototype.protectHandler=function(){var e=A(this.parent.getActiveSheet().selectedRange),r=Q(e),t=B(this.parent.getActiveSheet().activeCell);this.selectRangeByIdx(e,null,null,r[0]<=t[0]&&r[2]>=t[0]&&r[1]<=t[1]&&r[3]>=t[1])},s.prototype.initiateFormulaSelection=function(e){this.processFormulaEditRange(e.range,e.formulaSheetIdx)},s.prototype.processFormulaEditRange=function(e,r){var t,i=r,n=0,a=this.parseFormula(e),o=a.length,l=0,h=[["e-vborderright","e-vborderbottom"],["e-pborderright","e-pborderbottom"],["e-cborderright","e-cborderbottom"],["e-gborderright","e-gborderbottom"],["e-oborderright","e-oborderbottom"],["e-bborderright","e-bborderbottom"]];this.clearBorder();for(var p=this.parent.getActiveSheet().id-1;n<o&&!(this.invalidOperators.indexOf(t=a[n])>-1);){if(nt(t.toUpperCase())){if(t=t.replace(/\$/g,""),n>0&&a[n-1].indexOf("!")===a[n-1].length-1){var c=a[n-1].split("!");i=ee(this.parent,c[0].substring(1,c[0].length-1))}":"===a[n+1]&&a[1+ ++n]&&nt(a[n+1].toUpperCase())&&(t=t+":"+a[n+1],n++),p===i&&this.updateFormulaEditRange(t,l,h),i=r,l++}n++}},s.prototype.updateFormulaEditRange=function(e,r,t){var i=A(e);this.formulaRange[r]=e,this.dStartCell={rowIndex:i[0],colIndex:i[1]},this.dEndCell={rowIndex:i[2],colIndex:i[3]},this.focusBorder(this.dStartCell,this.dEndCell,t[r%6])},s.prototype.chartBorderHandler=function(e){this.focusBorder(e.startcell,e.endcell,e.classes,!0)},s.prototype.focusBorder=function(e,r,t,i){i=!(0,f.le)(i)&&i;var n=Q([e.rowIndex,e.colIndex,r.rowIndex,r.colIndex]),a=this.parent.getActiveSheet();if(a.frozenRows||a.frozenColumns){var o=this.parent.createElement("div",{className:i?"e-range-indicator e-chart-range":"e-range-indicator e-formuala-range"});return o.appendChild(this.parent.createElement("div",{className:"e-top"})),o.appendChild(this.parent.createElement("div",{className:"e-bottom"})),o.appendChild(this.parent.createElement("div",{className:"e-left"})),o.appendChild(this.parent.createElement("div",{className:"e-right"})),void ft(this.parent,o,n,"e-range-indicator")}var l=n[0],h=n[1],p=n[2],c=n[3];l&&this.getEleFromRange([l-1,h,l-1,c]).forEach(function(d){d&&(d.classList.add(t[1]),i||d.classList.add("e-formularef-selection"))}),this.getEleFromRange([l,c,p,c]).forEach(function(d){d&&(d.classList.add(t[0]),i||d.classList.add("e-formularef-selection"))}),this.getEleFromRange([p,h,p,c]).forEach(function(d){d&&(d.classList.add(t[1]),i||d.classList.add("e-formularef-selection"))}),h&&this.getEleFromRange([l,h-1,p,h-1]).forEach(function(d){d&&(d.classList.add(t[0]),i||d.classList.add("e-formularef-selection"))})},s.prototype.getEleFromRange=function(e){var a,o,l,p,r=e[0],t=e[1],i=e[2],n=e[3],h=[],c=[];if(r>i&&(l=r,r=i,i=l),t>n&&(l=t,t=n,n=l),this.parent.scrollSettings.enableVirtualization)for(a=r;a<=i;a++)if((o=a)>-1){var d=this.parent.getRow(o,null);d&&(p=d.getElementsByClassName("e-cell"),h=n===t?[p[n]]:this.getRowCells(p,t,n+1),this.merge(c,h))}return c},s.prototype.getRowCells=function(e,r,t){for(var i=[];r<t;r++)e[r]&&i.push(e[r]);return i},s.prototype.merge=function(e,r){!e||!r||Array.prototype.push.apply(e,r)},s.prototype.clearBorder=function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows)[].slice.call(this.parent.element.getElementsByClassName("e-formuala-range")).forEach(function(l){(0,f.og)(l)});else for(var t=this.parent.element.getElementsByClassName("e-formularef-selection"),i=0;i<t.length;i++)for(var n=t[i],a=["e-vborderright","e-vborderbottom","e-pborderright","e-pborderbottom","e-cborderright","e-cborderbottom","e-gborderright","e-gborderbottom","e-oborderright","e-oborderbottom","e-bborderright","e-bborderbottom"],o=0;o<a.length;o++)n.classList.remove(a[o])},s.prototype.parseFormula=function(e){for(var r,t,i=0,n=[],a=(e=this.markSpecialChar(e.replace("=",""))).split(/\(|\)|=|\^|>|<|,|:|\+|-|\*|\/|%|&/g),o=a.length;i<o;)if(r=a[i]){if(1===r.length)n.push(this.isUniqueChar(r)?this.getUniqueCharVal(r):r);else if(t=r[0],r.indexOf("!")>0){this.isUniqueChar(t)&&(n.push(this.getUniqueCharVal(t)),r=r.substr(1));var l=r.indexOf("!")+1;n.push(r.substr(0,l)),n.push(r.substr(l))}else this.isUniqueChar(t)?(n.push(this.getUniqueCharVal(t)),n.push(r.substr(1))):n.push(r);i++}else i++;return n},s.prototype.isUniqueChar=function(e){var r=e.charCodeAt(e.charAt[0]);return r>=129&&r<=142},s.prototype.getUniqueCharVal=function(e){switch(e){case this.uniqueOBracket:return"(";case this.uniqueCBracket:return")";case this.uniqueCOperator:return":";case this.uniqueSOperator:return"-";case this.uniquePOperator:return"+";case this.uniqueMOperator:return"*";case this.uniqueDOperator:return"/";case this.uniqueModOperator:return"%";case this.uniqueCSeparator:return",";case this.uniqueConcateOperator:return"&";case this.uniqueEqualOperator:return"=";case this.uniqueExpOperator:return"^";case this.uniqueLTOperator:return"<";case this.uniqueGTOperator:return">"}return""},s.prototype.markSpecialChar=function(e){return(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\(/g,"("+this.uniqueOBracket).replace(/\)/g,")"+this.uniqueCBracket)).replace(/,/g,","+this.uniqueCSeparator).replace(/:/g,":"+this.uniqueCOperator)).replace(/\+/g,"+"+this.uniquePOperator).replace(/-/g,"-"+this.uniqueSOperator)).replace(/\*/g,"*"+this.uniqueMOperator).replace(/\//g,"/"+this.uniqueDOperator)).replace(/&/g,"&"+this.uniqueConcateOperator)).replace(/=/g,"="+this.uniqueEqualOperator)).replace(/\^/g,"^"+this.uniqueExpOperator)).replace(/>/g,">"+this.uniqueGTOperator).replace(/</g,"<"+this.uniqueLTOperator)).replace(/%/g,"%"+this.uniqueModOperator)},s.prototype.getModuleName=function(){return"selection"},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s}(),wp=function(){function s(e){this.clientX=0,this.isKeyScroll=!0,this.parent=e,this.addEventListener(),this.initProps()}return s.prototype.onContentScroll=function(e){if(this.parent){var a,o,r=this.parent.getMainContent().parentElement,t=e.scrollLeft,i=e.scrollTop||r.scrollTop,n=t&&this.parent.enableRtl?this.initScrollValue-t:t;if(this.parent.allowAutoFill){var l=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn-popup"),h=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");l&&(0,f.Xr)(h,Oe.uw).toggle()}if(!(0,f.le)(t)&&this.prevScroll.scrollLeft!==n){var c=n>this.prevScroll.scrollLeft;o=this.offset.left.size,this.offset.left=this.getColOffset(n,c,e.skipHidden),e.preventScroll||(this.parent.getColumnHeaderContent().scrollLeft=t,this.parent.getMainContent().scrollLeft=t,e.scrollLeft=t),a={cur:this.offset.left,prev:{idx:this.leftIndex,size:o},increase:c,preventScroll:e.preventScroll},this.updateTopLeftCell(c,!0),this.parent.notify(Mi,a),!this.parent.scrollSettings.enableVirtualization&&c&&!this.parent.scrollSettings.isFinite&&this.updateNonVirtualCols(),this.leftIndex=a.prev.idx,this.prevScroll.scrollLeft=n}if(Math.round(this.prevScroll.scrollTop)!==Math.round(i)){e.skipRowVirualScroll&&(this.prevScroll.scrollTop=0,this.offset.top={idx:0,size:0});var d=i>this.prevScroll.scrollTop;o=this.offset.top.size,this.offset.top=this.getRowOffset(i,d),a={cur:this.offset.top,prev:{idx:this.topIndex,size:o},increase:d,preventScroll:e.preventScroll},this.updateTopLeftCell(d),e.preventScroll&&this.offset.top.idx<=this.parent.getThreshold("row")?this.offset.top={idx:0,size:0}:e.skipRowVirualScroll?a.prev.idx=a.cur.idx:this.parent.notify(Ni,a),!this.parent.scrollSettings.enableVirtualization&&d&&!this.parent.scrollSettings.isFinite&&this.updateNonVirtualRows(),this.topIndex=a.prev.idx,this.prevScroll.scrollTop=i}var v={isEdit:!1};this.parent.notify(ei,v),v.isEdit&&this.parent.element.querySelector(".e-formula-bar").focus(),this.isKeyScroll=!0}},s.prototype.updateScrollValue=function(e){void 0!==e.scrollLeft&&(this.prevScroll.scrollLeft=e.scrollLeft+(this.prevScroll.scrollLeft-this.offset.left.size),this.offset.left.size=e.scrollLeft),void 0!==e.scrollTop&&(this.prevScroll.scrollTop=e.scrollTop+(this.prevScroll.scrollTop-this.offset.top.size),this.offset.top.size=e.scrollTop)},s.prototype.updateNonVirtualRows=function(){var e=this.parent.getActiveSheet(),r=this.parent.getThreshold("row");this.offset.top.idx>e.rowCount-(this.parent.viewport.rowCount+r)&&(this.parent.renderModule.refreshUI({rowIndex:e.rowCount,colIndex:0,direction:"first",refresh:"RowPart"},j(e.rowCount,0)+":"+j(e.rowCount+r-1,e.colCount-1)),this.parent.setSheetPropertyOnMute(e,"rowCount",e.rowCount+r),this.parent.viewport.bottomIndex=e.rowCount-1)},s.prototype.updateNonVirtualCols=function(){var e=this.parent.getActiveSheet(),r=this.parent.getThreshold("col");this.offset.left.idx>e.colCount-(this.parent.viewport.colCount+r)&&(this.parent.renderModule.refreshUI({rowIndex:0,colIndex:e.colCount,direction:"first",refresh:"ColumnPart"},j(0,e.colCount)+":"+j(e.rowCount-1,e.colCount+r-1)),this.parent.setSheetPropertyOnMute(e,"colCount",e.colCount+r),this.parent.viewport.rightIndex=e.colCount-1)},s.prototype.updateTopLeftCell=function(e,r){var t=this.parent.getActiveSheet(),i=this.offset.top.idx,n=this.offset.left.idx;if(!e){var a=this.parent.frozenRowCount(t);i=U(t,i+a,!0)-a;var o=this.parent.frozenColCount(t);n=U(t,n+o,!0,"columns")-o}r?this.parent.updateTopLeftCell(null,n,"row"):this.parent.updateTopLeftCell(i,null,"col")},s.prototype.getRowOffset=function(e,r){var t=this.offset.top.size,i=this.parent.getActiveSheet(),n=r?this.offset.top.idx+1:this.offset.top.idx?this.offset.top.idx-1:0,a=this.parent.frozenRowCount(i),o=this.parent.scrollSettings.isFinite?i.rowCount:1/0;for(e=Math.round(e);n<o;)if(r){if(t+=le(i,n-1+a,!0),Math.abs(Math.round(t)-e)<=1)return{idx:U(i,n+a,!0)-a,size:t};if(Math.round(t)>e)return{idx:n-1,size:t-le(i,n-1+a,!0)};n++}else{if((t-=le(i,n+a,!0))<=0)return{idx:0,size:0};if(Math.abs(Math.round(t)-e)<=1)return{idx:n,size:t};if(Math.round(t)<e)return t+=le(i,n+a,!0),Math.round(t)>e?{idx:n,size:t-le(i,n+a,!0)<0?0:t-le(i,n+a,!0)}:{idx:U(i,n+1+a,!0)-a,size:t};n--}return{idx:this.offset.top.idx,size:this.offset.top.size}},s.prototype.getColOffset=function(e,r,t){for(var i=this.offset.left.size,n=this.parent.getActiveSheet(),a=r?this.offset.left.idx+1:this.offset.left.idx?this.offset.left.idx-1:0,o=this.parent.frozenColCount(n),l=this.parent.scrollSettings.isFinite?n.colCount:1/0;a<l;)if(r){if(i+=Te(n,a-1+o,t,!0),Math.abs(Math.round(i)-e)<=1)return{idx:U(n,a+o,!0,"columns")-o,size:i};if(Math.round(i)>e)return{idx:a-1,size:i-Te(n,a-1+o,t,!0)};a++}else{if((i-=Te(n,a+o,t,!0))<=0)return{idx:0,size:0};if(Math.abs(Math.round(i)-e)<=1)return{idx:a,size:i};if(Math.round(i)<e)return i+=Te(n,a+o,t,!0),Math.round(i)>e?{idx:a,size:(i-=Te(n,a+o,t,!0))<0?0:i}:{idx:U(n,a+1+o,!0,"columns")-o,size:i};a--}return{idx:this.offset.left.idx,size:this.offset.left.size}},s.prototype.contentLoaded=function(e){if(!this.parent.scrollSettings.enableVirtualization){var r=this.parent.createElement("div",{className:"e-virtualtrack"});this.updateNonVirualScrollWidth({scrollTrack:r}),this.parent.getScrollElement().appendChild(r)}e.left&&(this.parent.getScrollElement().scrollLeft=e.left),this.setScrollEvent(),this.parent.enableRtl&&(this.initScrollValue=this.parent.getScrollElement().scrollLeft)},s.prototype.updateNonVirualScrollWidth=function(e){e.scrollTrack||(e.scrollTrack=this.parent.getScrollElement().getElementsByClassName("e-virtualtrack")[0]),e.scrollTrack.style.width=Math.abs(this.parent.getContentTable().getBoundingClientRect().width)+"px"},s.prototype.onHeaderWheel=function(e){e.preventDefault(),this.parent.getMainContent().parentElement.scrollTop+=e.deltaY,this.parent.getScrollElement().scrollLeft+=e.deltaX},s.prototype.onContentWheel=function(e){0!==e.deltaX&&(e.preventDefault(),this.parent.getScrollElement().scrollLeft+=e.deltaX)},s.prototype.scrollHandler=function(e){this.onContentScroll({scrollLeft:e.target.scrollLeft})},s.prototype.updateScroll=function(e){(0,f.le)(e.left)?this.parent.sheetModule.contentPanel.scrollTop=e.top:this.parent.getScrollElement().scrollLeft=e.left},s.prototype.setScrollEvent=function(e){void 0===e&&(e={set:!0}),e.set?(f.bi.add(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll,this),f.bi.add(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel,this),f.bi.add(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel,this),f.bi.add(this.parent.getMainContent(),"wheel",this.onContentWheel,this),f.bi.add(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel,this),f.bi.add(this.parent.getScrollElement(),"scroll",this.scrollHandler,this)):(f.bi.remove(this.parent.sheetModule.contentPanel,"scroll",this.onContentScroll),f.bi.remove(this.parent.getColumnHeaderContent(),"wheel",this.onHeaderWheel),f.bi.remove(this.parent.getSelectAllContent(),"wheel",this.onHeaderWheel),f.bi.remove(this.parent.getMainContent(),"wheel",this.onContentWheel),f.bi.remove(this.parent.getRowHeaderContent(),"wheel",this.onContentWheel),f.bi.remove(this.parent.getScrollElement(),"scroll",this.scrollHandler))},s.prototype.initProps=function(){this.topIndex=0,this.leftIndex=0,this.prevScroll={scrollLeft:0,scrollTop:0},this.offset={left:{idx:0,size:0},top:{idx:0,size:0}}},s.prototype.setPadding=function(){this.parent.sheetModule.contentPanel.style.overflowY="scroll";var e=Ds();if(e>0){var r=this.parent.getColumnHeaderContent(),t=this.parent.enableRtl?{margin:"marginLeft",border:"borderLeftWidth"}:{margin:"marginRight",border:"borderRightWidth"};r.parentElement.style[t.margin]=e+"px",r.style[t.border]="1px"}},s.prototype.setClientX=function(e){if("mousedown"!==e.type&&"mouse"!==e.pointerType){var r={touchSelectionStarted:!1};if(this.parent.notify(ps,r),!r.touchSelectionStarted){this.clientX=this.getPointX(e);var t=document.getElementById(this.parent.element.id+"_sheet");f.bi.add(t,f.AR.isPointer?"pointermove":"touchmove",this.onTouchScroll,this),f.bi.add(t,f.AR.isPointer?"pointerup":"touchend",this.pointerUpHandler,this)}}},s.prototype.getPointX=function(e){return e.touches&&e.touches.length?e.touches[0].clientX:e.clientX},s.prototype.onTouchScroll=function(e){if("mouse"!==e.pointerType){var r=this.getPointX(e),t=this.clientX-r,i=this.parent.element.getElementsByClassName("e-scroller")[0];(t>10||t<-10)&&i.scrollLeft+t>=0&&(e.preventDefault(),this.clientX=r,Pe(function(){i.scrollLeft+=t}))}},s.prototype.pointerUpHandler=function(){var e=document.getElementById(this.parent.element.id+"_sheet");f.bi.remove(e,f.AR.isPointer?"pointermove":"touchmove",this.onTouchScroll),f.bi.remove(e,f.AR.isPointer?"pointerup":"touchend",this.pointerUpHandler)},s.prototype.addEventListener=function(){this.parent.on(Ye,this.contentLoaded,this),this.parent.on(Bo,this.onContentScroll,this),this.parent.on(va,this.updateScroll,this),this.parent.on(Zn,this.initProps,this),this.parent.on(rt,this.destroy,this),this.parent.on(Al,this.setScrollEvent,this),this.parent.on(er,this.setClientX,this),this.parent.on(ga,this.updateScrollValue,this),this.parent.scrollSettings.enableVirtualization||(this.parent.on(Lt,this.updateNonVirualScrollWidth,this),this.parent.on($e,this.updateNonVirualScrollWidth,this))},s.prototype.destroy=function(){this.removeEventListener();var e=document.querySelector("#"+this.parent.element.id+"_autofilloptionbtn");if(e){var r=(0,f.Xr)(e,Oe.uw);r&&r.destroy()}this.parent=null},s.prototype.removeEventListener=function(){this.parent.off(Ye,this.contentLoaded),this.parent.off(Bo,this.onContentScroll),this.parent.off(va,this.updateScroll),this.parent.off(Zn,this.initProps),this.parent.off(rt,this.destroy),this.parent.off(Al,this.setScrollEvent),this.parent.off(er,this.setClientX),this.parent.off(ga,this.updateScrollValue),this.parent.scrollSettings.enableVirtualization||(this.parent.off(Lt,this.updateNonVirualScrollWidth),this.parent.off($e,this.updateNonVirualScrollWidth))},s}(),xp=function(){function s(e){this.scroll=[],this.parent=e,this.addEventListener()}return s.prototype.createVirtualElement=function(e){var r=this.parent.getActiveSheet(),t=this.parent.getMainContent();this.content=this.parent.createElement("div",{className:"e-virtualable"}),this.content.appendChild(t.querySelector(".e-table")),t.appendChild(this.content);var a,i=t.appendChild(this.parent.createElement("div",{className:"e-virtualtrack"})),n=0;this.parent.sheets.length>this.scroll.length&&this.initScroll();var o=this.parent.viewport.bottomIndex;r.rowCount>o+1||r.usedRange.rowIndex>o?(!this.parent.scrollSettings.isFinite&&r.rowCount<=r.usedRange.rowIndex&&this.parent.setSheetPropertyOnMute(r,"rowCount",r.usedRange.rowIndex+1),this.setScrollCount(r.rowCount,"row")):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(r,"rowCount",o+1),this.scroll[this.parent.activeSheetIndex].rowCount=r.rowCount);var l=this.parent.frozenRowCount(r),h=B(r.topLeftCell);e.top&&(n=e.top,r.frozenRows&&(n+=Ce(r,h[0],l-1,!0)),l=B(r.paneTopLeftCell)[0]),n+=Ce(r,l,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0),o=this.parent.viewport.rightIndex;var p=0,c=this.parent.frozenColCount(r);e.left?(p=e.left,c&&(p+=ge(r,h[1],c-1,!0)),l=B(r.paneTopLeftCell)[1]):l=c,r.colCount>o+1||r.usedRange.colIndex>o?(!this.parent.scrollSettings.isFinite&&r.colCount<=r.usedRange.colIndex&&this.parent.setSheetPropertyOnMute(r,"colCount",r.usedRange.colIndex+1),p+=ge(r,l,o,!0),this.setScrollCount(r.colCount,"col"),a=p+ge(r,o+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0)):(this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(r,"colCount",o+1),p+=ge(r,l,r.colCount-1,!0),this.scroll[this.parent.activeSheetIndex].colCount=r.colCount,a=p),(0,f.le)(this.parent.viewport.leftIndex)&&(this.parent.viewport.leftIndex=0),(0,f.le)(this.parent.viewport.topIndex)&&(this.parent.viewport.topIndex=0),e.left&&(p=ge(r,this.parent.viewport.leftIndex+c,o,!0)),(0,f.le)(this.translateX)&&(this.translateX=0),(0,f.le)(this.translateY)&&(this.translateY=0),t=this.parent.getRowHeaderContent(),this.rowHeader=this.content.cloneNode(),this.rowHeader.appendChild(t.querySelector(".e-table")),t.appendChild(this.rowHeader);var d=t.appendChild(i.cloneNode());this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)",t=this.parent.getColumnHeaderContent(),this.colHeader=this.content.cloneNode(),this.colHeader.appendChild(t.querySelector(".e-table")),t.appendChild(this.colHeader);var u=t.appendChild(i.cloneNode());this.colHeader.style.width=p+"px",d.style.height=n+"px",u.style.width=a+"px",this.colHeader.style.transform="translate("+this.translateX+"px, 0px)",this.content.style.transform="translate("+this.translateX+"px, "+this.translateY+"px)",this.content.style.width=p+"px",i.style.height=n+"px",i.style.width=a+"px",this.parent.allowScrolling&&this.parent.getScrollElement().appendChild(u.cloneNode(!0))},s.prototype.initScroll=function(){for(var e=0;e<this.parent.sheets.length;)this.scroll[e]||this.scroll.push({rowCount:0,colCount:0}),e++},s.prototype.setScrollCount=function(e,r){var t=this.parent.activeSheetIndex;(!this.scroll[t][r+"Count"]||this.scroll[t][r+"Count"]!==e)&&(this.scroll[t][r+"Count"]=e)},s.prototype.getRowAddress=function(e){var r=this.parent.getActiveSheet();return z([e[0],r.frozenColumns?B(r.topLeftCell)[1]:this.parent.viewport.leftIndex,e[1],this.parent.viewport.rightIndex])},s.prototype.getColAddress=function(e){var r=this.parent.getActiveSheet();return z([r.frozenRows?B(r.topLeftCell)[0]:this.parent.viewport.topIndex,e[0],this.parent.viewport.bottomIndex,e[1]])},s.prototype.updateScrollCount=function(e,r,t){void 0===t&&(t=e);var i=this.parent.getActiveSheet(),n=e+this.parent.viewport[r+"Count"]+1+t,a=this.scroll[this.parent.activeSheetIndex][r+"Count"];if(n<a){if(i[r+"Count"]===a)return;n=a}this.parent.scrollSettings.isFinite||this.parent.setSheetPropertyOnMute(i,r+"Count",n)},s.prototype.onVerticalScroll=function(e){var r=e.cur.idx,t=e.cur.size,i=e.prev.idx,n=Math.abs(r-i),a=this.parent.getThreshold("row");if(n>Math.round(a/2)){var o=void 0,l=void 0,h=void 0,p=this.parent.getActiveSheet();if(r<=a&&!e.increase){if(this.translateY&&i>a){this.translateY=0;var c=this.parent.frozenColCount(p),d=this.parent.frozenRowCount(p);if(e.preventScroll)this.parent.viewport.topIndex=i-(a-d);else{var u=c?B(p.topLeftCell)[1]:this.parent.viewport.leftIndex,v=c?[d,this.parent.viewport.leftIndex+c]:[];if(n<this.parent.viewport.rowCount+a){o=U(p,d,!0),l=U(p,this.parent.viewport.topIndex+d-1,!1),this.parent.viewport.topIndex=o-d;var g=this.skipHiddenLastIdx(this.parent.viewport.bottomIndex-(l-o+1-this.hiddenCount(o,l)),this.parent.viewport.bottomIndex);this.parent.viewport.bottomIndex=U(p,g,!1),this.parent.renderModule.refreshUI({colIndex:u,rowIndex:o,direction:"last",refresh:"RowPart",skipUpdateOnFirst:!0,frozenIndexes:v},this.getRowAddress([o,U(p,l,!1)]))}else{var m=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:0,colIndex:u,refresh:"Row",skipUpdateOnFirst:!0,frozenIndexes:v,skipTranslate:!0}),c&&(this.parent.viewport.leftIndex=m),this.translate({refresh:"Row"})}K(this.parent.element),r=0}}this.updateScrollCount(a,"row")}if(i<a&&(n=Math.abs(r-a)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===U(p,p.rowCount-1,!1)){d=this.parent.frozenRowCount(p);var y=this.parent.viewport.topIndex+d+A(p.paneTopLeftCell)[0]-1;if(r+d>y)return void(e.prev.idx=r);n=y-(r+d)}if(r>a){if(h=this.parent.viewport.topIndex,this.parent.viewport.topIndex=r-a,e.increase&&h>this.parent.viewport.topIndex)return void(this.parent.viewport.topIndex=h);if(d=this.parent.frozenRowCount(p),e.preventScroll)this.setThresholdHeight(t,a,d),this.translate({refresh:"Row"});else{u=void 0;var C=[];if((c=this.parent.frozenColCount(p))?(u=B(p.topLeftCell)[1],C.push(d),C.push(this.parent.viewport.leftIndex+c)):u=this.parent.viewport.leftIndex,n<this.parent.viewport.rowCount+a)if(e.increase){if(o=this.parent.viewport.bottomIndex+1,l=this.parent.viewport.bottomIndex+(this.parent.viewport.topIndex-h),(l-=this.hiddenCount(h+d,this.parent.viewport.topIndex-1+d))<=this.parent.viewport.bottomIndex)return void(this.parent.viewport.topIndex=h);var b=this.parent.skipHidden(o,l,"rows",!1),S=this.checkLastIdx(b[1],"row");o=b[0],l=S.index,this.parent.viewport.topIndex=U(p,this.parent.viewport.topIndex-S.diff+d,!this.parent.scrollSettings.isFinite)-d,this.setThresholdHeight(t,r-this.parent.viewport.topIndex,d,!!S.diff,h===U(p,d,!0)),this.parent.viewport.bottomIndex=l,this.parent.renderModule.refreshUI({colIndex:u,rowIndex:o,direction:"first",refresh:"RowPart",frozenIndexes:C},this.getRowAddress([o,l]))}else{if((o=U(p,this.parent.viewport.topIndex+d,!1))<d&&(o=U(p,o=d,!0)),this.parent.viewport.topIndex=o-d,(l=U(p,h+d-1,!1))<d||l<o)return void(this.parent.viewport.topIndex=h);g=this.skipHiddenLastIdx(this.parent.viewport.bottomIndex-(l-o+1-this.hiddenCount(o,l)),this.parent.viewport.bottomIndex),this.parent.viewport.bottomIndex=U(p,g,!1),this.setThresholdHeight(t,r-this.parent.viewport.topIndex,d),this.parent.renderModule.refreshUI({colIndex:u,rowIndex:o,direction:"last",refresh:"RowPart",frozenIndexes:C},this.getRowAddress([o,l]))}else h=this.parent.viewport.leftIndex,this.parent.viewport.topIndex=U(p,this.parent.viewport.topIndex+d,!1)-d,this.parent.viewport.topIndex<0&&(this.parent.viewport.topIndex=U(p,d,!0)-d),this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:u,refresh:"Row",frozenIndexes:C,skipTranslate:!0}),c&&(this.parent.viewport.leftIndex=h),this.setThresholdHeight(t,r-this.parent.viewport.topIndex,d,this.parent.scrollSettings.isFinite&&this.parent.viewport.bottomIndex===U(p,p.rowCount-1,!1)),this.translate({refresh:"Row"});this.updateScrollCount(r,"row",a),this.focusSheet()}}e.prev.idx=r}},s.prototype.skipHiddenLastIdx=function(e,r,t){void 0===t&&(t="rows");for(var i=this.parent.getActiveSheet(),n=0,a=e;a<=r;a++)i[t][a]&&i[t][a].hidden&&n++;return n&&(e=this.skipHiddenLastIdx(e-n,e-1,t)),e},s.prototype.hiddenCount=function(e,r,t){void 0===t&&(t="rows");for(var i=0,n=this.parent.getActiveSheet(),a=e;a<=r;a++)n[t][a]&&n[t][a].hidden&&i++;return i},s.prototype.checkLastIdx=function(e,r){var t=0;if(this.parent.scrollSettings.isFinite){var i=this.parent.getActiveSheet(),n=i[r+"Count"]-1;e>n&&(t=e-n,e=U(i,n,!1))}return{index:e,diff:t}},s.prototype.onHorizontalScroll=function(e){var r=e.cur.idx,t=e.cur.size,i=e.prev.idx,n=Math.abs(r-i),a=this.parent.getThreshold("col");if(n>Math.round(a/2)){var o=void 0,l=void 0,h=void 0,p=this.parent.getActiveSheet();if(r<=a&&!e.increase){if(this.translateX&&i>a){this.translateX=0;var c=this.parent.frozenColCount(p),d=this.parent.frozenRowCount(p);if(e.preventScroll)this.parent.viewport.leftIndex=i-(a-c);else{var u=d?B(p.topLeftCell)[0]:this.parent.viewport.topIndex,v=d?[this.parent.viewport.topIndex+d,c]:[];if(n<this.parent.viewport.colCount+a){o=U(p,c,!0,"columns"),l=U(p,this.parent.viewport.leftIndex+c-1,!1,"columns"),this.parent.viewport.leftIndex=o-c;var g=this.skipHiddenLastIdx(this.parent.viewport.rightIndex-(l-o+1-this.hiddenCount(o,l,"columns")),this.parent.viewport.rightIndex,"columns");this.parent.viewport.rightIndex=U(p,g,!1,"columns"),this.parent.renderModule.refreshUI({rowIndex:u,colIndex:o,direction:"last",refresh:"ColumnPart",skipUpdateOnFirst:!0,frozenIndexes:v},this.getColAddress([o,U(p,l,!1,"columns")]))}else{var m=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({rowIndex:u,colIndex:0,refresh:"Column",skipUpdateOnFirst:!0,frozenIndexes:v,skipTranslate:!0}),d&&(this.parent.viewport.topIndex=m),this.translate({refresh:"Column"})}K(this.parent.element),r=0}}this.updateScrollCount(a,"col")}if(i<a&&(n=Math.abs(r-a)),!e.increase&&this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===U(p,p.colCount-1,!1,"columns")){c=this.parent.frozenColCount(p);var y=this.parent.viewport.leftIndex+c+A(p.paneTopLeftCell)[1]-1;if(r+c>(y+=this.hiddenCount(this.parent.viewport.leftIndex+c,y)))return void(e.prev.idx=r);n=y-(r+c)}if(r>a){if(h=this.parent.viewport.leftIndex,this.parent.viewport.leftIndex=r-a,e.increase&&h>this.parent.viewport.leftIndex)return void(this.parent.viewport.leftIndex=h);if(c=this.parent.frozenColCount(p),e.preventScroll)this.setThresholdWidth(t,a,c),this.translate({refresh:"Column"});else{u=(d=this.parent.frozenRowCount(p))?B(p.topLeftCell)[0]:this.parent.viewport.topIndex;var C=[];if(d&&(C=[d+this.parent.viewport.topIndex,c]),n<this.parent.viewport.colCount+a)if(e.increase){if(o=this.parent.viewport.rightIndex+1,l=this.parent.viewport.rightIndex+(this.parent.viewport.leftIndex-h),(l-=this.hiddenCount(h+c,this.parent.viewport.leftIndex-1+c,"columns"))<=this.parent.viewport.rightIndex)return void(this.parent.viewport.leftIndex=h);var b=this.parent.skipHidden(o,l,"columns",!1),S=this.checkLastIdx(b[1],"col");o=b[0],l=S.index,this.parent.viewport.leftIndex=U(p,this.parent.viewport.leftIndex-S.diff+c,!this.parent.scrollSettings.isFinite,"columns")-c,this.setThresholdWidth(t,r-this.parent.viewport.leftIndex,c,!!S.diff,h===U(p,c,!0,"columns")),this.parent.viewport.rightIndex=l,this.parent.renderModule.refreshUI({rowIndex:u,colIndex:o,direction:"first",refresh:"ColumnPart",frozenIndexes:C},this.getColAddress([o,l]))}else{if((o=U(p,this.parent.viewport.leftIndex+c,!1,"columns"))<c&&(o=U(p,o=c,!0,"columns")),this.parent.viewport.leftIndex=o-c,(l=U(p,h+c-1,!1,"columns"))<c||l<o)return void(this.parent.viewport.leftIndex=h);g=this.skipHiddenLastIdx(this.parent.viewport.rightIndex-(l-o+1-this.hiddenCount(o,l,"columns")),this.parent.viewport.rightIndex,"columns"),this.parent.viewport.rightIndex=U(p,g,!1,"columns"),this.setThresholdWidth(t,r-this.parent.viewport.leftIndex,c),this.parent.renderModule.refreshUI({rowIndex:u,colIndex:o,direction:"last",refresh:"ColumnPart",frozenIndexes:C},this.getColAddress([o,l]))}else h=this.parent.viewport.topIndex,this.parent.viewport.leftIndex=U(p,this.parent.viewport.leftIndex+c,!1,"columns")-c,this.parent.viewport.leftIndex<0&&(this.parent.viewport.leftIndex=U(p,c,!0,"columns")-c),this.parent.renderModule.refreshUI({rowIndex:u,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:C,skipTranslate:!0}),d&&(this.parent.viewport.topIndex=h),this.setThresholdWidth(t,r-this.parent.viewport.leftIndex,c,this.parent.scrollSettings.isFinite&&this.parent.viewport.rightIndex===U(p,p.colCount-1,!1,"columns")),this.translate({refresh:"Column"});this.updateScrollCount(r,"col",a),this.focusSheet()}}e.prev.idx=r}},s.prototype.focusSheet=function(){(!document.activeElement.classList.contains("e-text-findNext-short")||!(0,f.oq)(document.activeElement,"#"+this.parent.element.id))&&K(this.parent.element)},s.prototype.setThresholdHeight=function(e,r,t,i,n){var a=this.parent.getActiveSheet(),o=this.parent.viewport.topIndex+t,l=o+r-1;this.translateY=i||n||l<o?o<=t?0:Ce(a,t,o-1,!0):e-Ce(a,o,l,!0)},s.prototype.setThresholdWidth=function(e,r,t,i,n){var a=this.parent.getActiveSheet(),o=this.parent.viewport.leftIndex+t,l=o+r-1;this.translateX=i||n||l<o?o<=t?0:ge(a,t,o-1,!0):e-ge(a,o,l,!0)},s.prototype.translate=function(e){if(!e.skipTranslate&&this.content){var r=this.translateX||0;r=this.parent.enableRtl?-r:r,("Row"===e.refresh||"RowPart"===e.refresh)&&(this.content.style.transform="translate("+r+"px, "+this.translateY+"px)",this.rowHeader.style.transform="translate(0px, "+this.translateY+"px)"),("Column"===e.refresh||"ColumnPart"===e.refresh)&&(this.content.style.transform="translate("+r+"px, "+this.translateY+"px)",this.colHeader.style.transform="translate("+r+"px, 0px)")}},s.prototype.updateColumnWidth=function(e){if("Column"===e.refresh){this.content.style.width="";var r=this.parent.getActiveSheet(),t=ge(r,this.parent.viewport.leftIndex+this.parent.frozenColCount(r),this.parent.viewport.rightIndex,!0);if(this.colHeader.style.width=t+"px",this.content.style.width=t+"px",!this.parent.scrollSettings.isFinite||e.isUpdate){var i=this.parent.element.querySelector(".e-scroller .e-virtualtrack");if(!i)return;var n=parseInt(i.style.width,10),a=t+this.translateX+this.parent.viewport.beforeFreezeWidth;if(a>n)i.style.width=n+(o=a-n)+"px";else{var o=n-a,l=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];n-o<parseInt(l.style.width,10)&&(i.style.width=l.style.width)}}}else if(!this.parent.scrollSettings.isFinite){l=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];var h=parseInt(l.style.height,10),c=this.content.getBoundingClientRect().height+this.translateY+this.parent.viewport.beforeFreezeHeight;if(c>h)l.style.height=h+(o=c-h)+"px";else{o=h-c;var d=this.parent.getRowHeaderContent().getElementsByClassName("e-virtualtrack")[0];h-o<parseInt(d.style.height,10)&&(l.style.height=d.style.height)}}},s.prototype.updateRowColCount=function(e){if(this.scroll.length){var r=this.parent.getActiveSheet();if("row"===e.update){if(e.index!==this.scroll[this.parent.activeSheetIndex].rowCount-1){var t=this.getVTrackHeight("height"),i=t;if(e.index>=this.scroll[this.parent.activeSheetIndex].rowCount?i+=void 0===e.start?Ce(r,this.scroll[this.parent.activeSheetIndex].rowCount,e.index,!0):Ce(r,e.start,e.end,!0):i-=void 0===e.start?Ce(r,e.index+1,this.scroll[this.parent.activeSheetIndex].rowCount-1,!0):Ce(r,e.start,e.end,!0),!e.isDelete&&i<t)return;this.scroll[this.parent.activeSheetIndex].rowCount=e.index+1,this.updateVTrack(this.rowHeader,i,"height"),this.scroll[this.parent.activeSheetIndex].rowCount>r.rowCount&&this.parent.setSheetPropertyOnMute(r,"rowCount",this.scroll[this.parent.activeSheetIndex].rowCount)}}else if(e.index!==this.scroll[this.parent.activeSheetIndex].colCount-1){var n=this.getVTrackHeight("width"),a=n;if(e.index>=this.scroll[this.parent.activeSheetIndex].colCount?a+=void 0===e.start?ge(r,this.scroll[this.parent.activeSheetIndex].colCount,e.index,!0):ge(r,e.start,e.end,!0):a-=void 0===e.start?ge(r,e.index+1,this.scroll[this.parent.activeSheetIndex].colCount-1,!0):ge(r,e.start,e.end,!0),!e.isDelete&&a<n)return;this.scroll[this.parent.activeSheetIndex].colCount=e.index+1,this.updateVTrack(this.colHeader,a,"width"),this.scroll[this.parent.activeSheetIndex].colCount>r.colCount&&this.parent.setSheetPropertyOnMute(r,"colCount",this.scroll[this.parent.activeSheetIndex].colCount)}}},s.prototype.getVTrackHeight=function(e){var r=this.content.nextElementSibling.style[e];if(r.includes("e+")){var t=(r=r.split("px")[0]).split("e+");return Number(t[0])*Math.pow(10,Number(t[1]))}return parseFloat(r)},s.prototype.updateVTrackHeight=function(e){e.rowIdx<this.scroll[this.parent.activeSheetIndex].rowCount&&this.updateVTrack(this.rowHeader,this.getVTrackHeight("height")+e.threshold,"height"),(e.rowIdx<this.parent.viewport.topIndex||e.rowIdx>this.parent.viewport.bottomIndex)&&(this.translateY+=e.threshold,this.translate({refresh:"Row"}))},s.prototype.updateVTrackWidth=function(e){var r=this.parent.frozenColCount(this.parent.getActiveSheet());if(e.colIdx>=this.parent.viewport.leftIndex+r&&e.colIdx<=this.parent.viewport.rightIndex){var t=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualtrack")[0];t.style.width=parseFloat(t.style.width)+e.threshold+"px";var i=this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0];i.style.width=parseFloat(i.style.width)+e.threshold+"px";var n=this.parent.getColumnHeaderContent().getElementsByClassName("e-virtualable")[0];n.style.width=parseFloat(n.style.width)+e.threshold+"px";var a=this.parent.getMainContent().getElementsByClassName("e-virtualable")[0];a.style.width=parseFloat(a.style.width)+e.threshold+"px"}else e.colIdx>=r&&e.colIdx<this.parent.viewport.leftIndex+r&&(this.parent.scrollModule.offset.left.size+=e.threshold,this.translateX+=e.threshold,this.translate({refresh:"Column"}))},s.prototype.updateVTrack=function(e,r,t){e.nextElementSibling.style[t]=r+"px",this.content.nextElementSibling.style[t]=r+"px","width"===t&&this.parent.allowScrolling&&(this.parent.getScrollElement().firstElementChild.style.width=r+"px")},s.prototype.deInitProps=function(){this.parent.viewport.leftIndex=null,this.parent.viewport.topIndex=null,this.parent.viewport.bottomIndex=null,this.translateX=null,this.translateY=null},s.prototype.updateScrollProps=function(e){var r=this;void 0===e&&(e={sheetIndex:0,sheets:this.parent.sheets}),0===this.scroll.length?this.initScroll():e.sheets.forEach(function(){r.scroll.splice(e.sheetIndex,0,{rowCount:0,colCount:0})})},s.prototype.sliceScrollProps=function(e){(0,f.le)(e.sheetIndex)?this.scroll.length=0:this.scroll.splice(e.sheetIndex,1)},s.prototype.updateTranslate=function(e){if(e.height){if(e.isRender)this.translateY-=e.height;else{var r=parseInt(this.parent.getMainContent().getElementsByClassName("e-virtualtrack")[0].style.height,10);e.isHide?(this.updateVTrack(this.rowHeader,r-e.height,"height"),this.setThresholdHeight(this.translateY,e.prevSize-1-this.parent.viewport.topIndex+1,this.parent.frozenRowCount(this.parent.getActiveSheet()))):(this.updateVTrack(this.rowHeader,r+e.height,"height"),this.translateY=this.translateY+e.size)}this.translate({refresh:"Row"})}e.width&&(this.translateX-=e.width,this.translate({refresh:"Column"}))},s.prototype.addEventListener=function(){this.parent.on(yo,this.createVirtualElement,this),this.parent.on(Co,this.translate,this),this.parent.on(Lt,this.updateColumnWidth,this),this.parent.on(is,this.updateColumnWidth,this),this.parent.on(Ni,this.onVerticalScroll,this),this.parent.on(Mi,this.onHorizontalScroll,this),this.parent.on(qr,this.updateRowColCount,this),this.parent.on(Xe,this.updateVTrackHeight,this),this.parent.on($e,this.updateVTrackWidth,this),this.parent.on(Zn,this.deInitProps,this),this.parent.on(ar,this.sliceScrollProps,this),this.parent.on(Ii,this.updateScrollProps,this),this.parent.on(Nr,this.updateTranslate,this),this.parent.on(rt,this.destroy,this)},s.prototype.destroy=function(){this.removeEventListener(),this.rowHeader=null,this.colHeader=null,this.content=null,this.parent=null,this.scroll.length=0,this.translateX=null,this.translateY=null},s.prototype.removeEventListener=function(){this.parent.off(yo,this.createVirtualElement),this.parent.off(Co,this.translate),this.parent.off(Lt,this.updateColumnWidth),this.parent.off(is,this.updateColumnWidth),this.parent.off(Ni,this.onVerticalScroll),this.parent.off(Mi,this.onHorizontalScroll),this.parent.off(qr,this.updateRowColCount),this.parent.off(Xe,this.updateVTrackHeight),this.parent.off($e,this.updateVTrackWidth),this.parent.off(ar,this.sliceScrollProps),this.parent.off(Ii,this.updateScrollProps),this.parent.off(Nr,this.updateTranslate),this.parent.off(rt,this.destroy)},s}(),Da=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.addEventListener=function(){this.parent.on(Dt,this.keyDownHandler,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Dt,this.keyDownHandler)},s.prototype.keyDownHandler=function(e){var r=this,t=e.target;if(!(this.parent.isEdit||this.parent.serviceLocator.getService(ae).dialogInstance||t.id===this.parent.element.id+"_name_box"||t.id===this.parent.element.id+"_SearchBox"||t.classList.contains("e-ddl")&&t.classList.contains("e-input-focus"))){if(e.altKey&&38===e.keyCode&&this.parent.element.lastElementChild.classList.contains("e-filter-popup"))return void this.parent.notify(ia,{closePopup:!0});if(!e.altKey||40!==e.keyCode||!(0,f.oq)(t,".e-dropdown-btn")&&!(0,f.oq)(t,".e-split-btn")){if(t.classList.contains("e-sheet-rename"))return void(32===e.keyCode?e.stopPropagation():(13===e.keyCode||27===e.keyCode)&&this.parent.notify(Ho,e));if(t.id===this.parent.element.id+"_File"&&K(this.parent.element),"None"!==this.parent.selectionSettings.mode){var i,a,o=this.parent.enableRtl,l=this.parent.getActiveSheet(),h=A(l.selectedRange),p=B(l.activeCell),c=this.parent.element.querySelector(".e-main-panel"),d=this.parent.getScrollElement();if([9,37,38,39,40,33,34].indexOf(e.keyCode)>-1&&e.preventDefault(),36===e.keyCode&&((e.ctrlKey||e.metaKey)&&e.shiftKey?(e.preventDefault(),this.parent.selectRange(_e(p[1]+1)+(p[0]+1)+":A1"),c.scrollTop&&(c.scrollTop=0),d.scrollLeft&&(d.scrollLeft=0)):p[1]>=0&&(e.ctrlKey?(p[0]=0,p[1]=0):(e.preventDefault(),p[1]=0),i=!0)),(e.ctrlKey||e.metaKey)&&35===e.keyCode&&(e.preventDefault(),p[0]=l.usedRange.rowIndex,p[1]=l.usedRange.colIndex,a=i=!0),e.shiftKey&&32===e.keyCode&&(e.preventDefault(),h[1]=0,this.parent.selectRange(z([h[0],h[1],h[2],h[3]+l.colCount]))),(e.ctrlKey||e.metaKey)&&32===e.keyCode&&(h[0]=0,this.parent.selectRange(z([h[0],h[1],h[2]+l.rowCount,h[3]]))),(e.ctrlKey||e.metaKey)&&e.shiftKey){var u=A(l.selectedRange);if(40===e.keyCode){var v=this.getNextNonEmptyCell(u[2],u[3],"down");u[2]=v[0],u[3]=v[1],this.parent.selectRange(z(u)),this.scrollNavigation(v,null,!0)}else 39===e.keyCode?(v=this.getNextNonEmptyCell(u[2],u[3],"right"),u[2]=v[0],u[3]=v[1],this.parent.selectRange(z(u)),this.scrollNavigation(v,null,!0)):38===e.keyCode?(v=this.getNextNonEmptyCell(u[2],u[3],"top"),u[2]=v[0]-1,u[3]=v[1],-1===u[2]&&(u[2]=0),this.parent.selectRange(z(u)),this.scrollNavigation(v,null,!0)):37===e.keyCode&&(v=this.getNextNonEmptyCell(u[2],u[3],"left"),u[2]=v[0],u[3]=v[1]-1,-1===u[3]&&(u[3]=0),this.parent.selectRange(z(u)),this.scrollNavigation(v,null,!0))}if((e.ctrlKey||e.metaKey)&&!e.shiftKey&&(37===e.keyCode?(p[1]=this.getNextNonEmptyCell(p[0],p[1],"left")[1],i=a=!0):38===e.keyCode?(p[0]=this.getNextNonEmptyCell(p[0],p[1],"top")[0],i=a=!0):39===e.keyCode?(p[1]=this.getNextNonEmptyCell(p[0],p[1],"right")[1],i=a=!0):40===e.keyCode&&(p[0]=this.getNextNonEmptyCell(p[0],p[1],"down")[0],i=a=!0)),e.shiftKey&&(34===e.keyCode||33===e.keyCode)){var g=0;if(34===e.keyCode)g=c.getBoundingClientRect().height+c.scrollTop;else if((g=c.scrollTop-c.getBoundingClientRect().height)<0)return;var m=A(this.parent.getActiveSheet().selectedRange)[2],y=B(this.parent.getActiveSheet().paneTopLeftCell)[0],C=m-y;this.parent.scrollModule&&(this.parent.scrollModule.isKeyScroll=!1),c.scrollTop=g,Pe(function(){y=B(r.parent.getActiveSheet().paneTopLeftCell)[0],r.parent.selectRange(z([p[0],p[1],y+C,p[1]]))})}var b={e,isFilterCell:!1};if(e.shiftKey&&!e.ctrlKey?this.shiftSelection(e):e.altKey&&40===e.keyCode&&this.parent.notify(ia,b),!e.shiftKey&&(!o&&37===e.keyCode||o&&39===e.keyCode)||e.shiftKey&&9===e.keyCode)if(p[1]>0){if(l.isProtected&&!l.protectSettings.selectUnLockedCells||!l.isProtected)p[1]-=1;else{var S=this.getNextUnlockedCell(e.keyCode,p);p[1]=S[1],p[0]=S[0]}i=!0}else{var w=this.parent.getMainContent();0===p[1]&&w.scrollLeft&&!o&&(w.scrollLeft=0)}else if(e.shiftKey&&13===e.keyCode)this.parent.element.querySelector(".e-find-toolbar")||(p[0]>0?(l.isProtected&&!l.protectSettings.selectUnLockedCells||!l.isProtected?p[0]-=1:(S=this.getNextUnlockedCell(e.keyCode,p),p[1]=S[1],p[0]=S[0]),i=!0):(w=this.parent.getMainContent().parentElement,0===p[0]&&w.scrollTop&&(w.scrollTop=0)));else if(b.isFilterCell||e.shiftKey||38!==e.keyCode)if(!e.shiftKey&&!e.ctrlKey&&(!o&&39===e.keyCode||o&&37===e.keyCode)||9===e.keyCode)(F=E(p[0],p[1],l))&&F.colSpan>1&&(p[1]+=F.colSpan-1),p[1]<l.colCount-1&&(l.isProtected&&!l.protectSettings.selectUnLockedCells||!l.isProtected?p[1]+=1:(S=this.getNextUnlockedCell(e.keyCode,p),p[1]=S[1],p[0]=S[0]),i=!0);else if((b.isFilterCell||e.shiftKey||e.ctrlKey||40!==e.keyCode)&&13!==e.keyCode){if(!e.shiftKey&&(34===e.keyCode||33===e.keyCode)&&(!this.parent.scrollModule||this.parent.scrollModule.isKeyScroll)){var T=this.parent.element.querySelector(".e-main-panel");if(g=0,34===e.keyCode)g=T.getBoundingClientRect().height+T.scrollTop;else if((g=T.scrollTop-T.getBoundingClientRect().height)<0)return;m=B(this.parent.getActiveSheet().activeCell)[0];var k=B(this.parent.getActiveSheet().paneTopLeftCell)[0],R=m-k;this.parent.scrollModule&&(this.parent.scrollModule.isKeyScroll=!1),T.scrollTop=g,Pe(function(){k=B(r.parent.getActiveSheet().paneTopLeftCell)[0],r.parent.notify(Yn,{range:[k+R,p[1]],preventAnimation:!0})})}}else{var F;(F=E(p[0],p[1],l))&&F.rowSpan>1&&(p[0]+=F.rowSpan-1),p[0]<l.rowCount-1&&(l.isProtected&&!l.protectSettings.selectUnLockedCells||!l.isProtected?p[0]+=1:(S=this.getNextUnlockedCell(e.keyCode,p),p[1]=S[1],p[0]=S[0]),i=!0)}else if(p[0]>0){if(l.isProtected&&!l.protectSettings.selectUnLockedCells||!l.isProtected)p[0]-=1;else{var x=this.getNextUnlockedCell(e.keyCode,p);p[1]=x[1],p[0]=x[0]}i=!0}else{var I=this.parent.getMainContent().parentElement;0===p[0]&&I.scrollTop&&(I.scrollTop=0)}if(i&&(!this.parent.scrollModule||this.parent.scrollModule.isKeyScroll)&&!(0,f.oq)(document.activeElement,".e-ribbon")){if(40===e.keyCode||38===e.keyCode||13===e.keyCode)for(;ne(l,p[0]);)if((40===e.keyCode||!e.shiftKey&&13===e.keyCode)&&(p[0]=p[0]+1),(38===e.keyCode||e.shiftKey&&13===e.keyCode)&&(p[0]=p[0]-1,p[0]<0))return;if(37===e.keyCode||39===e.keyCode||9===e.keyCode)for(;we(l,p[1]);)if((39===e.keyCode||!e.shiftKey&&9===e.keyCode)&&(p[1]=p[1]+1),(37===e.keyCode||e.shiftKey&&9===e.keyCode)&&(p[1]=p[1]-1,p[1]<0))return;this.scrollNavigation(p,!1,a);var D=z(p),N=function(P){if(D!==l.selectedRange){r.parent.setSheetPropertyOnMute(l,"activeCell",D),r.parent.notify(Yn,{range:p,preventAnimation:P});var M=r.parent.getCell(p[0],p[1]);M&&K(M)}};if(this.parent.scrollModule&&this.parent.scrollModule.isKeyScroll){if(D===l.selectedRange)return;Pe(N.bind(this,!0))}else N()}}}}},s.prototype.getNextNonEmptyCell=function(e,r,t){var a,i=[e,r],n=this.parent.getActiveSheet();if("down"===t){a=!(0,f.o8)(E(e,r,n,null,!0).value)&&!(0,f.o8)(E(e+1,r,n,null,!0).value);for(var o=e;o<n.rowCount;o++){if(a){if((0,f.o8)(E(o,r,n,null,!0).value))return[o-1,r]}else if(!(0,f.o8)(E(o+1,r,n,null,!0).value))return[o+1,r];if(o===n.rowCount-1)return[o,r]}}if("top"===t)for(a=!(0,f.o8)(E(e,r,n,null,!0).value)&&!(0,f.o8)(E(e-1,r,n,null,!0).value),o=e;o>=0;o--){if(a){if((0,f.o8)(E(o,r,n,null,!0).value))return[o-1,r]}else if(!(0,f.o8)(E(o-1,r,n,null,!0).value))return[o,r];if(0===o)return[o,r]}if("right"===t)for(a=!(0,f.o8)(E(e,r,n,null,!0).value)&&!(0,f.o8)(E(e,r+1,n,null,!0).value),o=r;o<n.colCount;o++){if(a){if((0,f.o8)(E(e,o,n,null,!0).value))return[e,o-1]}else if(!(0,f.o8)(E(e,o+1,n,null,!0).value))return[e,o+1];if(o===n.colCount-1)return[e,o]}if("left"===t)for(a=!(0,f.o8)(E(e,r,n,null,!0).value)&&!(0,f.o8)(E(e,r-1,n,null,!0).value),o=r;o>=0;o--){if(a){if((0,f.o8)(E(e,o,n,null,!0).value))return[e,o-1]}else if(!(0,f.o8)(E(e,o-1,n,null,!0).value))return[e,o];if(0===o)return[e,o]}return i},s.prototype.getNextUnlockedCell=function(e,r){var i,t=this.parent.getActiveSheet();if(39===e){var n=r[1]+1,a=r[0];r[1]===t.usedRange.colIndex&&(n=0,a+=1,r[0]===t.usedRange.rowIndex&&(a=0)),r[1]===t.usedRange.colIndex&&r[0]===t.usedRange.rowIndex&&(a=n=0);for(var o=a;o<=t.usedRange.rowIndex+1;o++){o>t.usedRange.rowIndex&&(o=0);for(var l=n;l<=t.usedRange.colIndex;l++){if(!Qt(this.parent,[o,l,o,l]))return[o,l];n=l}a=o,n===t.usedRange.colIndex&&(n=0,a===t.usedRange.rowIndex?a=0:a++)}}if(37===e)for(n=r[1]-1,a=r[0],0===r[1]&&(n=t.usedRange.colIndex,a-=1,0===r[0]&&(a=t.usedRange.rowIndex)),o=a;o>=-1;o--){for(o<0&&(o=t.usedRange.rowIndex),l=n;l>=0;l--){if(!Qt(this.parent,[o,l,o,l]))return[o,l];n=l}a=o,0===n&&(n=t.usedRange.colIndex,0===a?a=t.usedRange.rowIndex:a--)}if(40===e)for(n=r[1],a=r[0]+1,r[0]===t.usedRange.rowIndex&&(n+=1,a=0,r[1]===t.usedRange.colIndex&&(a=0)),r[1]===t.usedRange.colIndex&&r[0]===t.usedRange.rowIndex&&(a=n=0),o=n;o<=t.usedRange.colIndex+1;o++){for(o>t.usedRange.colIndex&&(o=0),l=a;l<=t.usedRange.rowIndex;l++){if(!Qt(this.parent,[l,o,l,o]))return[l,o];a=l}n=o,a===t.usedRange.rowIndex&&(n++,a=0)}if(38===e)for(n=r[1],a=r[0]-1,0===r[0]&&(n-=1,a=t.usedRange.rowIndex,0===r[1]&&(n=t.usedRange.colIndex)),o=n;o>=-1;o--){for(o<0&&(o=t.usedRange.colIndex),l=a;l>=0;l--){if(!Qt(this.parent,[l,o,l,o]))return[l,o];a=l}n=o,0===a&&(a=t.usedRange.rowIndex,0===n?n=t.usedRange.colIndex:n--)}return i},s.prototype.shiftSelection=function(e){var r=this.parent.getActiveSheet(),t=A(r.selectedRange),i=Q(t),n=!0;if(38===e.keyCode){for(var a=i[1];a<=i[3];a++){var o=E(t[2],a,this.parent.getActiveSheet());if(!(0,f.le)(o)&&o.rowSpan&&o.rowSpan<0){t[2]=t[2]-(Math.abs(o.rowSpan)+1),n=!1;break}}n&&(t[2]=t[2]-1),t[2]<0&&(t[2]=0)}if(40===e.keyCode){for(a=i[1];a<=i[3];a++)if(o=E(t[2],a,this.parent.getActiveSheet()),!(0,f.le)(o)&&o.rowSpan&&o.rowSpan>0){t[2]=t[2]+Math.abs(o.rowSpan),n=!1;break}n&&(t[2]=t[2]+1),r.rowCount<=t[2]&&(t[2]=r.rowCount-1)}if(39===e.keyCode){for(a=i[0];a<=i[2];a++)if(o=E(a,t[3],this.parent.getActiveSheet()),!(0,f.le)(o)&&o.colSpan&&o.colSpan>0){t[3]=t[3]+Math.abs(o.colSpan),n=!1;break}n&&(t[3]=t[3]+1),r.colCount<=t[3]&&(t[3]=r.colCount-1)}if(37===e.keyCode){for(a=i[0];a<=i[2];a++)if(o=E(a,t[3],this.parent.getActiveSheet()),!(0,f.le)(o)&&o.colSpan&&o.colSpan<0){t[3]=t[3]-(Math.abs(o.colSpan)+1),n=!1;break}n&&(t[3]=t[3]-1),t[3]<0&&(t[3]=0)}if(e.shiftKey&&e.ctrlKey&&!this.parent.scrollSettings.enableVirtualization){var l=[r.usedRange.rowIndex,r.usedRange.colIndex];37===e.keyCode&&(t[3]=t[3]<=l[1]?0:l[1]),38===e.keyCode&&(t[2]=t[2]<=l[0]?0:l[0]),39===e.keyCode&&(t[3]=t[3]<=l[1]?l[1]:this.parent.getActiveSheet().colCount),40===e.keyCode&&(t[2]=t[2]<=l[0]?l[0]:this.parent.getActiveSheet().rowCount)}if(37===e.keyCode||39===e.keyCode||38===e.keyCode||40===e.keyCode){for(var h=B(r.activeCell);ne(this.parent.getActiveSheet(),t[2]);)40===e.keyCode&&(t[2]=t[2]+1),38===e.keyCode&&(t[2]=t[2]-1);this.parent.selectRange(z(t)),this.scrollNavigation([Jh(r,t)?h[0]:t[2],Ul(r,t)?h[1]:t[3]],!1)}},s.prototype.scrollNavigation=function(e,r,t){if(this.parent.allowScrolling){var i=this.parent.enableRtl?-1:1,n=this.parent.getMainContent().parentElement,a=this.parent.getScrollElement(),o=this.parent.getActiveSheet(),l=Q(A(o.selectedRange)),h=B(o.topLeftCell),p=this.parent.frozenRowCount(o),c=this.parent.frozenColCount(o),d=B(o.paneTopLeftCell),u=U(o,e[0]<p?h[0]:d[0],!0),v=e[1]<c?h[1]:d[1],g=this.parent.scrollModule.offset.top.size;if(n.scrollTop)if(p&&e[0]!==l[2]){if(e[0]===p)return void(n.scrollTop=0);e[0]===p-1&&(n.scrollTop=0)}else if(e[0]===U(o,0,!0))return void(n.scrollTop=0);if(a&&a.scrollLeft)if(c&&e[1]!==l[3]){if(e[1]===c)return void(a.scrollLeft=0);e[1]===c-1&&(a.scrollLeft=0)}else if(e[1]===U(o,0,!0,"columns"))return void(a.scrollLeft=0);this.getBottomIdx(u)<=e[0]||r?n.scrollTop=t?g+Ce(o,d[0],e[0],!0)-n.getBoundingClientRect().height:g+le(o,U(o,d[0],!0),!0):u>e[0]&&(t?n.scrollTop=g-Math.ceil(Ce(o,d[0],e[0],!0)+n.getBoundingClientRect().height):(n.scrollTop=g-Math.ceil(le(o,e[0],!0)),this.parent.scrollModule.isKeyScroll=!1));var m=this.getRightIdx(v);(m<=e[1]||r)&&a?a.scrollLeft+=t?ge(o,d[1],e[1],!0)+a.getBoundingClientRect().width:Te(o,m,null,!0)*i:v>e[1]&&a&&(t?a.scrollLeft-=ge(o,d[1],e[1],!0)+a.getBoundingClientRect().width:(a.scrollLeft-=Te(o,e[1],null,!0)*i,this.parent.scrollModule.isKeyScroll=!1))}},s.prototype.getBottomIdx=function(e){for(var r=0,t=this.parent.getActiveSheet(),i=(t.frozenRows?this.parent.viewport.height-this.parent.sheetModule.getColHeaderHeight(t,!0):this.parent.viewport.height)-17||20,n=e;;n++)if((r+=le(t,n,!0))>=i)return n},s.prototype.getRightIdx=function(e){for(var r=0,t=this.parent.getActiveSheet(),i=this.parent.getMainContent().parentElement.offsetWidth-this.parent.sheetModule.getRowHeaderWidth(t)-this.parent.sheetModule.getScrollSize(),n=e;;n++)if((r+=Te(t,n,null,!0))>=i)return n},s.prototype.getModuleName=function(){return"keyboardNavigation"},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s}(),La=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.addEventListener=function(){this.parent.on(Dt,this.keyDownHandler,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Dt,this.keyDownHandler)},s.prototype.isTrgtNotInput=function(e){var r=e.target;return!((0,f.oq)(r,".e-filter-popup")||(0,f.oq)(r,".e-find-dlg")||(0,f.oq)(r,".e-hyperlink-dlg")||(0,f.oq)(r,".e-sheet-tab")||(0,f.oq)(r,".e-name-box")||(0,f.oq)(r,".e-link-dialog"))},s.prototype.ribbonShortCuts=function(e){if(e.altKey&&!e.ctrlKey&&!e.shiftKey){var r=this.parent.ribbonModule.ribbon.tabObj;if(72==e.keyCode)e.preventDefault(),r.select(1);else if(78===e.keyCode)r.select(2);else if(65===e.keyCode)r.select(4);else if(87===e.keyCode)r.select(5);else if(77===e.keyCode)r.select(3);else if(70===e.keyCode)e.preventDefault(),(0,f.Ys)("#"+this.parent.element.id+"_File",this.parent.element).click();else if(18===e.keyCode){e.preventDefault();var t=B(this.parent.getActiveSheet().activeCell),i={sheetIdx:this.parent.activeSheetIndex};if(this.parent.notify(ii,i),!(i.hasFilter&&i.filterRange&&i.filterRange[0]===t[0]&&i.filterRange[1]<=t[1]&&i.filterRange[3]>=t[1]||(0,f.oq)(document.activeElement,".e-dropdown-btn")||(0,f.oq)(document.activeElement,".e-split-btn")||(0,f.oq)(document.activeElement,".e-popup-open")))for(var n=0;n<=this.parent.ribbonModule.ribbon.items.length;n++)if(n===this.parent.ribbonModule.ribbon.selectedTab){var a=this.parent.element.querySelector(".e-toolbar-items").children[n+2].children[0];return a.setAttribute("tabindex","0"),void a.focus()}}}if((9===e.keyCode||e.shiftKey&&9===e.keyCode)&&(0,f.oq)(document.activeElement,".e-ribbon")||(0,f.oq)(document.activeElement,".e-chart")){var o=void 0,l=this.parent.ribbonModule.ribbon.selectedTab,h=this.parent.ribbonModule.ribbon.items,p=e.shiftKey?h[l].content.slice().reverse():h[l].content,c=void 0;if((0,f.oq)(document.activeElement,".e-tab-header"))c=0;else{var d=(0,f.oq)(document.activeElement,".e-toolbar-item");if(d){var u=[].slice.call(d.parentElement.children);c=(e.shiftKey?u.reverse().indexOf(d):u.indexOf(d))+1}}for(n=c;n<=p.length;n++)if(n!==p.length){if((o=5===l&&""===p[n].id?p[n].type.toLowerCase():p[n].id).indexOf("separator")<0){o.includes("find")?o=o.replace("find","findbtn"):5!==l&&o.includes("chart")&&(o=o.replace("chart","chart-btn")),5===l&&(o.includes("chart_type")?o=o.replace("chart_type","chart-type-btn"):o.includes("add_chart_ element_chart")&&(o=o.replace("add_chart_ element_chart","_addchart")));var v=this.parent.element.querySelector("#"+o);if(!p[n].disabled)return v.classList.contains("e-colorpicker-wrapper")&&(v=v.querySelector(".e-split-btn")),void v.focus()}}else n=-1}},s.prototype.keyDownHandler=function(e){var r="None"===this.parent.selectionSettings.mode;if(this.ribbonShortCuts(e),(e.ctrlKey||e.metaKey)&&this.isTrgtNotInput(e)){if(!(0,f.oq)(e.target,".e-find-dlg")&&!r&&([79,83].indexOf(e.keyCode)>-1||65===e.keyCode&&!this.parent.isEdit)&&e.preventDefault(),79===e.keyCode)(0,f.Ys)("#"+this.parent.element.id+"_fileUpload",this.parent.element).click();else if(83===e.keyCode)this.parent.saveUrl&&this.parent.allowSave&&this.parent.notify(fn,null);else if(67!==e.keyCode||r)if(75!==e.keyCode||r)90!==e.keyCode||r?89!==e.keyCode||r?(82===e.keyCode||68===e.keyCode)&&!r&&(e.preventDefault(),this.parent.notify(us,{verticalFill:68===e.keyCode})):this.parent.isEdit||(e.preventDefault(),this.parent.notify(Gt,{isUndo:!1})):this.parent.isEdit||(e.preventDefault(),this.parent.notify(Gt,{isUndo:!0}));else{var i=B(this.parent.getActiveSheet().activeCell),n=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[i[0]],a=void 0;e.preventDefault(),(0,f.le)(n)||(a=n.cells[i[1]]),(0,f.le)(a)&&ce(i[0],i[1],this.parent.getActiveSheet(),a,!1),this.parent.notify(a&&a.hyperlink?Vi:Pi,null)}else this.parent.notify(Rr,{promise:Promise});var o=this.parent.sheets[this.parent.getActiveSheet().id-1],l=void 0;if(o){var p=B(o.activeCell),c=E(p[0],p[1],o);l=o.isProtected&&ur(c,Fe(o,p[1]))}if(70===e.keyCode&&!r&&(e.preventDefault(),this.parent.notify(Wa,null)),!(l&&o.isProtected&&86!==e.keyCode||70===e.keyCode||r)){if(71===e.keyCode)e.preventDefault(),this.parent.notify(Yo,null);else if(72===e.keyCode)e.preventDefault(),this.parent.notify(na,null);else if(88===e.keyCode)this.parent.notify(kr,{promise:Promise});else if(86===e.keyCode)this.parent.notify(Ot,{isAction:!0});else if(66===e.keyCode){e.preventDefault();var d=this.parent.getCellStyleValue(["fontWeight"],B(this.parent.getActiveSheet().activeCell)).fontWeight;this.parent.notify(ye,{style:{fontWeight:d="bold"===d?"normal":"bold"},onActionUpdate:!0,refreshRibbon:!0})}else 73===e.keyCode?(e.preventDefault(),d=this.parent.getCellStyleValue(["fontStyle"],B(this.parent.getActiveSheet().activeCell)).fontStyle,this.parent.notify(ye,{style:{fontStyle:d="italic"===d?"normal":"italic"},onActionUpdate:!0,refreshRibbon:!0})):e.ctrlKey&&85===e.keyCode&&!e.shiftKey?(e.preventDefault(),this.parent.notify(Vr,{style:{textDecoration:"underline"},refreshRibbon:!0})):e.ctrlKey&&53===e.keyCode&&!e.shiftKey&&(e.preventDefault(),this.parent.notify(Vr,{style:{textDecoration:"line-through"},refreshRibbon:!0}));e.shiftKey&&76===e.keyCode&&(this.parent.isEdit||(e.preventDefault(),this.parent.notify(jt,{})))}}if(27===e.keyCode&&this.parent.notify(ti,null),(e.ctrlKey||e.metaKey)&&119===e.keyCode&&(e.preventDefault(),this.parent.ribbonModule.ribbon.ribbonExpandCollapse()),!e.ctrlKey&&!e.metaKey||r||(i=A(this.parent.getActiveSheet().selectedRange),57===e.keyCode?(e.preventDefault(),this.parent.notify(je,{startIndex:i[0],endIndex:i[2],hide:!e.shiftKey,isCol:!1,actionUpdate:!0})):48===e.keyCode?this.parent.notify(je,{startIndex:i[1],endIndex:i[3],hide:!e.shiftKey,isCol:!0,actionUpdate:!0}):55===e.keyCode&&(e.preventDefault(),this.parent.notify(ye,{style:{border:"1px solid #000000"},onActionUpdate:!0,borderType:"Outer"}))),e.shiftKey&&114===e.keyCode&&!r&&(e.preventDefault(),this.parent.notify(gs,null)),(e.ctrlKey||e.metaKey)&&e.altKey&&78===e.keyCode&&!r&&(e.preventDefault(),this.parent.refresh(!0)),(e.ctrlKey||e.metaKey)&&e.shiftKey&&!r){var v=this.parent.getActiveSheet().selectedRange,g=void 0;192===e.keyCode?g=Ee("General"):52===e.keyCode?g="$#,##0.00;[Red]($#,##0.00)":53===e.keyCode?g="0%":54===e.keyCode?g=Ee("Scientific"):51===e.keyCode?g="dd-mmm-yy":50===e.keyCode?g="h:mm AM/PM":49===e.keyCode?g="#,###.00":85===e.keyCode?(e.preventDefault(),this.parent.notify(ys,null)):55===e.keyCode&&(e.preventDefault(),this.parent.notify(ye,{style:{border:""},onActionUpdate:!0})),g&&this.parent.notify(xi,{format:g,range:v})}e.shiftKey&&122==e.keyCode&&this.parent.notify(wt,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1}),e.shiftKey&&e.altKey&&75===e.keyCode&&this.parent.element.querySelector(".e-sheets-list").click()},s.prototype.getModuleName=function(){return"keyboardShortcut"},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s}(),Oa=function(){function s(e){this.checkHeight=!1,this.parent=e,this.addEventListener()}return s.prototype.applyCellFormat=function(e){if(e.checkHeight)return this.checkHeight||(this.checkHeight=!0),void this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate,e.outsideViewport);var r=Object.keys(e.style),t=this.parent.getActiveSheet();if(!(e.lastCell&&$t(t,e.rowIdx)<=20)||r.length){var i=e.cell||this.parent.getCell(e.rowIdx,e.colIdx);if(i){if(this.updateMergeBorder(e,t),void 0!==e.style.border||void 0!==e.style.borderTop||void 0!==e.style.borderLeft){var n={};Object.keys(e.style).forEach(function(p){n[p]=e.style[p]}),void 0!==n.border&&(Object.assign(i.style,{borderRight:e.style.border,borderBottom:e.style.border}),this.setLeftBorder(e.style.border,i,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,t),this.setTopBorder(e.style.border,i,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,t),delete n.border),void 0!==n.borderTop&&(this.setTopBorder(e.style.borderTop,i,e.rowIdx,e.colIdx,e.pRow,e.pHRow,e.onActionUpdate,e.first,e.lastCell,e.manualUpdate,t),delete n.borderTop),void 0!==n.borderLeft&&(this.setLeftBorder(e.style.borderLeft,i,e.rowIdx,e.colIdx,e.row,e.onActionUpdate,e.first,t),delete n.borderLeft),Object.keys(n).length&&(void 0!==n.borderBottom&&this.setThickBorderHeight(n.borderBottom,e.rowIdx,e.colIdx,i,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(i.style,n))}else{void 0!==e.style.borderBottom&&this.setThickBorderHeight(e.style.borderBottom,e.rowIdx,e.colIdx,i,e.row,e.hRow,e.onActionUpdate,e.lastCell,e.manualUpdate),Object.assign(i.style,e.style);var a=E(e.rowIdx,e.colIdx,t);a&&(a.rowSpan||a.colSpan)&&i.offsetHeight>0&&(o=Hs(this.parent,a.style||this.parent.cellStyle))>i.offsetHeight&&Kt(this.parent,t,i.offsetHeight,e.rowIdx)}var l=E(e.rowIdx,e.colIdx,t,null,!0);if(t.rows[e.rowIdx]&&t.rows[e.rowIdx].customHeight){if(!l.wrap&&e.style.fontSize){var h=le(t,e.rowIdx,!0)-hh(e.rowIdx,e.colIdx,t);h<Hs(this.parent,l.style)?i.style.lineHeight=h+"px":i.style.lineHeight&&(i.style.lineHeight="")}}else if(e.isHeightCheckNeeded)if(e.manualUpdate)this.checkHeight||(this.checkHeight=ws(e.style,e.onActionUpdate)),i&&i.children[0]&&"e-cf-databar"===i.children[0].className&&e.style.fontSize&&(i.children[0].querySelector(".e-databar-value").style.fontSize=e.style.fontSize),this.updateRowHeight(e.rowIdx,e.colIdx,e.lastCell,e.onActionUpdate),l.wrap&&(e.style.fontSize||e.style.fontFamily)&&(i.style.lineHeight=parseFloat(l.style&&l.style.fontSize||this.parent.cellStyle.fontSize)*Ps(l.style&&l.style.fontFamily?l.style:this.parent.cellStyle)+"pt");else if(!l.wrap&&ws(e.style)&&mr(t,e.rowIdx,e.colIdx,gi(this.parent,e.rowIdx,e.colIdx,t,e.style)),e.lastCell){var o;(o=$t(t,e.rowIdx))>20&&o>le(t,e.rowIdx)&&Kt(this.parent,t,o,e.rowIdx,e.row,e.hRow,this.parent.scrollSettings.isFinite)}}else this.updateRowHeight(e.rowIdx,e.colIdx,!0,e.onActionUpdate)}},s.prototype.updateRowHeight=function(e,r,t,i,n){if(this.checkHeight){var a=this.parent.getActiveSheet(),o=E(e,r,a,null,!0);if(!o.rowSpan){var l=0;l=gi(this.parent,e,r,a,o.style||this.parent.cellStyle,o.wrap?tn(this.parent.getDisplayText(o),Ra(a,e,r),o.style,this.parent.cellStyle):1);var h=o.value&&o.value.toString();if(h&&h.indexOf("\n")>-1){var p=void 0,c=h.split("\n"),d=0,u=c.length;for(p=0;p<u;p++){var v=tn(c[p],Ra(a,e,r),o.style,this.parent.cellStyle);0===v&&(v=1),d+=v}l=gi(this.parent,e,r,a,o.style||this.parent.cellStyle,d)}if(l<20&&(l=20),mr(a,e,r,l),!n){var g=this.parent.getCell(e,r);g&&g.children[0]&&"e-cf-databar"===g.children[0].className&&(g.children[0].style.height="100%",g.children[0].firstElementChild.nextElementSibling.style.height="100%")}if(t){this.checkHeight=!1;var m=$t(a,e),y=le(a,e);(i?m!==y:m>y)&&(n?(y=Ve(y),ui(a,e,m),this.parent.setProperties({sheets:this.parent.sheets},!0),this.parent.notify(Xe,{rowIdx:e,threshold:Ve(m)-y})):Kt(this.parent,a,m,e,null,null,!0))}}}},s.prototype.updateMergeBorder=function(e,r){var t=E(e.rowIdx,e.colIdx,r,null,!0),i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};if(this.parent.notify(Ne,i),t.rowSpan>1&&!e.style.borderBottom){var n=E(i.range[2],i.range[1],r,null,!0);n.style&&n.style.borderBottom&&(e.style.borderBottom=n.style.borderBottom)}if(t.colSpan>1&&!e.style.borderRight){var a=E(i.range[0],i.range[3],r,null,!0);a.style&&a.style.borderRight&&(e.style.borderRight=a.style.borderRight)}},s.prototype.setLeftBorder=function(e,r,t,i,n,a,o,l){if(!o||!o.includes("Column")){var h=this.parent.getCell(t,i-1,n);if(h){var p=E(t,i-1,l,!1,!0);if(p.rowSpan&&1!==p.rowSpan||p.colSpan&&1!==p.colSpan){var c={range:[t,i-1,t,i-1]};if(this.parent.notify(Ne,c),(p=E(c.range[0],c.range[1],l,!1,!0)).style&&p.style.borderRight&&"none"!==p.style.borderRight)return;if((p=E(c.range[0],c.range[3],l,null,!0)).style&&p.style.borderRight&&"none"!==p.style.borderRight)return;r.style.borderLeft=e}else a&&""!==e&&i===this.parent.viewport.leftIndex&&(this.parent.getMainContent().scrollLeft-=this.getBorderSize(e)),h.style.borderRight="none"===e?h.style.borderRight:e}else r.style.borderLeft=e}},s.prototype.setTopBorder=function(e,r,t,i,n,a,o,l,h,p,c){if(!l||!l.includes("Row")){var d=this.parent.getCell(t-1,i,n);if(d){var u=E(t-1,i,c,!1,!0);if(u.rowSpan&&1!==u.rowSpan||u.colSpan&&1!==u.colSpan){var v={range:[t-1,i,t-1,i]};if(this.parent.notify(Ne,v),(u=E(v.range[0],v.range[1],c,!1,!0)).style&&u.style.borderBottom&&"none"!==u.style.borderBottom)return;if((u=E(v.range[2],v.range[1],c,null,!0)).style&&u.style.borderBottom&&"none"!==u.style.borderBottom)return;r.style.borderTop=e}else{if(ne(c,t-1)){var g=[Number(d.parentElement.getAttribute("aria-rowindex"))-1,i];if(this.parent.getCellStyleValue(["bottomPriority"],g).bottomPriority)return}o&&""!==e&&c.topLeftCell.includes(""+(t+1))&&(this.parent.getMainContent().parentElement.scrollTop-=this.getBorderSize(e)),this.setThickBorderHeight(e,t-1,i,d,n,a,o,h,p),d.style.borderBottom="none"===e?d.style.borderBottom:e}}else r.style.borderTop=e}},s.prototype.setThickBorderHeight=function(e,r,t,i,n,a,o,l,h){var p=e?this.getBorderSize(e):1,c=this.parent.getActiveSheet();if(p>2&&(!c.rows[r]||!c.rows[r].customHeight))if(h)this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(r,t,l,o);else{var d=le(c,r),u=Math.ceil(this.parent.calculateHeight(this.parent.getCellStyleValue(["fontFamily","fontSize"],[r,t]),1,3));u>d&&(Kt(this.parent,c,u,r,n,a,!1),this.parent.notify(Xe,{rowIdx:r,threshold:u-20}))}o&&(l||!this.checkHeight)&&p<3&&(!c.rows[r]||!c.rows[r].customHeight)&&(this.checkHeight||(this.checkHeight=!0),this.updateRowHeight(r,t,l,o))},s.prototype.getBorderSize=function(e){var r=e.split(" ")[0];return"thin"===r?1:"medium"===r?2:"thick"===r?3:parseInt(r,10)?parseInt(r,10):1},s.prototype.clearObj=function(e){var p,c,v,r=this,t=e.options,i=t.range?t.range.indexOf("!")>0?t.range.split("!")[1]:t.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,n=t.range&&t.range.indexOf("!")>0?ee(this.parent,t.range.split("!")[0]):this.parent.activeSheetIndex,a=Q(A(i)),o=this.parent.sheets[n],l=a[0],h=a[2],d=this.parent.element.getElementsByClassName("e-ss-overlay-active"),g={range:i,type:t.type,requestType:"clear",sheetIndex:n},m=function(){e.isAction&&r.parent.notify(ue,{action:"beforeClear",eventArgs:g})},y=function(){e.isAction&&(g={range:o.name+"!"+i,type:t.type,sheetIndex:n},v&&(g.cfClearActionArgs=v.cfClearActionArgs),r.parent.notify(Z,{eventArgs:g,action:"clear"}))};if(d.length>0)d[0].classList.contains("e-datavisualization-chart")?("Clear Contents"===t.type||"Clear All"===t.type)&&(m(),this.parent.notify(Dr,{id:d[0].id,sheetIdx:this.parent.activeSheetIndex+1}),y()):"Clear All"===t.type&&(m(),this.parent.notify(It,{id:d[0].id,sheetIdx:this.parent.activeSheetIndex+1}),y());else{if(m(),"Clear Formats"===t.type||"Clear All"===t.type)for(this.parent.notify(_t,v={range:i,sheetIdx:n,isClear:!0}),e.cfClearActionArgs=v.cfClearActionArgs,"Clear All"===t.type&&(this.parent.notify(sr,{range:i,isRemoveValidation:!0}),0===l&&0===a[1]&&h>=o.usedRange.rowIndex&&a[3]>=o.usedRange.colIndex&&this.parent.setUsedRange(l,a[1],o,!1,!0));l<=h;l++)for(p=a[1],c=a[3];p<=c;p++){var C=E(l,p,o),b=this.parent.getCell(l,p);C&&(C.formula&&this.parent.notify(zr,{cellRef:z([l,p,l,p])}),C.wrap&&this.parent.notify(or,{range:[l,p,l,p],wrap:!1,sheet:o}),C.hyperlink&&(b&&(0,f.IV)(b.querySelectorAll(".e-hyperlink"),"e-hyperlink-style"),"Clear All"===t.type&&this.parent.removeHyperlink(o.name+"!"+z([l,p,l,p]))))}"Clear Hyperlinks"===t.type&&this.parent.removeHyperlink(o.name+"!"+i),this.parent.notify(wr,{range:o.name+"!"+i,type:t.type}),this.parent.serviceLocator.getService("cell").refreshRange(A(i)),this.parent.notify(wr,{range:o.name+"!"+i,type:t.type}),this.parent.serviceLocator.getService("cell").refreshRange(Q(A(i))),this.parent.notify(Wr,{range:i,isclearFormat:!0}),e.isFromUpdateAction||this.parent.notify(Er,{address:i}),this.parent.notify(St,null),y()}},s.prototype.addEventListener=function(){this.parent.on(He,this.applyCellFormat,this),this.parent.on(Yi,this.clearObj,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(He,this.applyCellFormat),this.parent.off(Yi,this.clearObj))},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null,this.checkHeight=null},s.prototype.getModuleName=function(){return"cellformat"},s}(),qs=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.addEventListener=function(){this.parent.on(Ye,this.wireEvents,this),this.parent.on(Po,this.autoFit,this),this.parent.on(_o,this.setAutoFitHandler,this)},s.prototype.autoFit=function(e){for(var r=e.isRow?this.parent.getRowHeaderTable():this.parent.getColHeaderTable().rows[0],t=e.startIndex;t<=e.endIndex;t++)this.trgtEle=e.isRow?this.parent.getRow(t,r):this.parent.getCell(null,t,r),this.setAutofit(t,!e.isRow)},s.prototype.wireEvents=function(){var e=this.parent.getRowHeaderContent(),r=this.parent.element.getElementsByClassName("e-header-panel")[0];!r||(f.bi.add(r,"dblclick",this.dblClickHandler,this),f.bi.add(e,"dblclick",this.dblClickHandler,this),f.bi.add(r,"mousedown",this.mouseDownHandler,this),f.bi.add(e,"mousedown",this.mouseDownHandler,this),this.wireResizeCursorEvent(e,r))},s.prototype.wireResizeCursorEvent=function(e,r){f.bi.add(e,"mousemove",this.setTarget,this),f.bi.add(r,"mousemove",this.setTarget,this)},s.prototype.unWireResizeCursorEvent=function(){f.bi.remove(this.parent.getRowHeaderContent(),"mousemove",this.setTarget);var e=this.parent.element.getElementsByClassName("e-header-panel")[0];e&&f.bi.remove(e,"mousemove",this.setTarget)},s.prototype.unwireEvents=function(){f.bi.remove(this.parent.getColumnHeaderContent(),"dblclick",this.dblClickHandler),f.bi.remove(this.parent.getRowHeaderContent(),"dblclick",this.dblClickHandler),f.bi.remove(this.parent.getColumnHeaderContent(),"mousedown",this.mouseDownHandler),f.bi.remove(this.parent.getRowHeaderContent(),"mousedown",this.mouseDownHandler),this.unWireResizeCursorEvent()},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ye,this.wireEvents),this.parent.off(Po,this.autoFit),this.parent.off(_o,this.setAutoFitHandler))},s.prototype.mouseMoveHandler=function(e){var r=this.parent.element.getElementsByClassName("e-colresize-handler")[0],t=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];this.resizeTooltip(null,!0,e),(r||t)&&(this.isMouseMoved=!0,r?e.x>this.trgtEle.parentElement.firstChild.getBoundingClientRect().left&&(r.style.left=e.clientX-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().left+"px"):t&&e.y>=this.trgtEle.parentElement.parentElement.firstChild.getBoundingClientRect().top&&(t.style.top=e.clientY-document.getElementById(this.parent.element.id+"_sheet").getBoundingClientRect().top+"px"))},s.prototype.mouseDownHandler=function(e){if((0,f.oq)(e.target,".e-header-cell")){if(this.event=e,this.trgtEle=e.target,this.trgtEle.parentElement.classList.contains("e-hide-end")||this.trgtEle.classList.contains("e-hide-end")){var r=this.trgtEle.offsetHeight,t=e.offsetY;(r>=10&&t<5||r-2<8&&t<Math.ceil((t-2)/2))&&this.trgtEle.classList.add("e-skip-resize")}this.updateTarget(e,this.trgtEle);var i=this.trgtEle,n=i.classList.contains("e-colresize")?"e-colresize-handler":i.classList.contains("e-rowresize")?"e-rowresize-handler":"";this.createResizeHandler(i,n),this.unWireResizeCursorEvent(),f.bi.add(this.parent.element,"mousemove",this.mouseMoveHandler,this),f.bi.add(document,"mouseup",this.mouseUpHandler,this)}},s.prototype.mouseUpHandler=function(e){var r=this.parent.element.getElementsByClassName("e-resize-handle")[0];this.resizeOn(e),this.isMouseMoved=null;var t=document.querySelector(".e-header-tooltip");r&&((0,f.og)(r),this.updateCursor()),t&&t.remove(),f.bi.remove(document,"mouseup",this.mouseUpHandler),f.bi.remove(this.parent.element,"mousemove",this.mouseMoveHandler);var i=this.parent.element.getElementsByClassName("e-header-panel")[0];i&&this.wireResizeCursorEvent(this.parent.getRowHeaderContent(),i),this.parent.notify(Bt,null),this.parent.notify(ma,null)},s.prototype.dblClickHandler=function(e){if((0,f.oq)(e.target,".e-header-cell")){if(this.trgtEle=e.target,this.updateTarget(e,this.trgtEle),this.trgtEle.classList.contains("e-colresize")){var r=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1,t=Te(this.parent.getActiveSheet(),r)+"px";this.trgtEle.classList.contains("e-unhide-column")?this.showHiddenColumns(r-1):this.setAutofit(r,!0,t)}else if(this.trgtEle.classList.contains("e-rowresize")){var i=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,n=le(this.parent.getActiveSheet(),i)+"px";this.setAutofit(i,!1,n)}this.parent.notify(Bt,null)}},s.prototype.setTarget=function(e){if((0,f.oq)(e.target,".e-header-cell")){var r=e.target,t=this.parent.getActiveSheet();if(!t.isProtected||t.protectSettings.formatColumns&&t.protectSettings.formatRows||!(!t.protectSettings.formatRows&&!t.protectSettings.formatColumns||t.protectSettings.formatRows&&(0,f.oq)(r,".e-colhdr-table")||t.protectSettings.formatColumns&&(0,f.oq)(r,".e-rowhdr-table"))){var i,n,a,o;if((0,f.oq)(r,".e-header-row"))a=e.offsetX,n=r.offsetWidth,o="e-colresize",(l=this.getColPrevSibling(r))&&!l.classList.contains("e-select-all-cell")?i=l:Number(r.getAttribute("aria-colindex"))>1&&(i=r);else if((0,f.oq)(r,".e-row")){var l;a=e.offsetY,n=r.offsetHeight,o="e-rowresize",(l=this.getRowPrevSibling(r))?i=l.firstElementChild:Number(r.parentElement.getAttribute("aria-rowindex"))>1&&(i=r)}if(n-2<8&&a!==Math.ceil((n-2)/2))a<Math.ceil((n-2)/2)?(r.classList.add(o),i.classList.add(o)):a>Math.ceil((n-2)/2)&&r.classList.add(o);else if(n-5<a&&a<=n&&n>=10)r.classList.add(o);else if(a<5&&i&&n>=10)r.classList.add(o),i.classList.add(o);else for(var h=this.parent.element.getElementsByClassName(o),p=0;p<h.length;p++)h[p].classList.remove(o)}}},s.prototype.getColPrevSibling=function(e){var r=this.parent.frozenColCount(this.parent.getActiveSheet());return e.previousElementSibling||(r&&(0,f.oq)(e,".e-column-header")?this.parent.getSelectAllContent().querySelector(".e-header-row").lastElementChild:null)},s.prototype.getRowPrevSibling=function(e){var r=this.parent.frozenRowCount(this.parent.getActiveSheet());return e.parentElement.previousElementSibling||(r&&(0,f.oq)(e,".e-row-header")?this.parent.getSelectAllContent().querySelector("tbody").lastElementChild:null)},s.prototype.updateTarget=function(e,r){if((0,f.oq)(r,".e-header-row")){if(r.offsetWidth<10&&e.offsetX<Math.ceil((r.offsetWidth-2)/2)||e.offsetX<5&&r.offsetWidth>=10&&r.classList.contains("e-colresize")){var t=this.parent.getActiveSheet(),i=Number(this.trgtEle.getAttribute("aria-colindex"))-2;(n=this.getColPrevSibling(r))&&!we(t,i)?this.trgtEle=n:i>-1&&this.trgtEle.classList.add("e-unhide-column")}}else if(r.offsetHeight<10&&e.offsetY<Math.ceil((r.offsetHeight-2)/2)||e.offsetY<5&&r.offsetHeight>=10&&r.classList.contains("e-rowresize")){var n;if(t=this.parent.getActiveSheet(),i=Number(r.parentElement.getAttribute("aria-rowindex"))-2,(n=this.getRowPrevSibling(r))||ne(t,i))if("dblclick"===e.type&&ne(t,i)){var o,a=Q(A(t.selectedRange));o=i<=a[2]&&i>a[0]&&Ul(t,a)?{startIndex:a[0],endIndex:a[2],hide:!1,autoFit:!0}:{startIndex:i,endIndex:i,hide:!1,autoFit:!0},this.parent.notify(je,o)}else ne(t,i)||(this.trgtEle=n.getElementsByClassName("e-header-cell")[0])}},s.prototype.setAutoFitHandler=function(e){e.isCol&&we(this.parent.getActiveSheet(),e.idx)?this.showHiddenColumns(e.idx):this.setAutofit(e.idx,e.isCol)},s.prototype.setAutofit=function(e,r,t){var i=0,n=this.parent.getActiveSheet(),a=this.parent.getMainContent(),o=r?Te(this.parent.getActiveSheet(),e)+"px":le(this.parent.getActiveSheet(),e)+"px",l=[],h=0,p=a.getElementsByClassName("e-content-table")[0],c=!1,d=0;if(r)for(var u=n.rows.length,v=0;v<u;v++)n.rows[v]&&n.rows[v].cells&&n.rows[v].cells[e]&&(E(v,e,n).wrap&&(c=!0,d++),(g=this.parent.createElement("td",{className:"e-cell"})).textContent=this.parent.getDisplayText(n.rows[v].cells[e]),n.rows[v].cells[e].style&&((m=n.rows[v].cells[e].style).fontFamily&&(g.style.fontFamily=m.fontFamily),m.fontSize&&(g.style.fontSize=m.fontSize)),l[i]=g,i++);else for(var y=n.rows[e]&&n.rows[e].cells?n.rows[e].cells.length:0,C=0;C<y;C++)if(n.rows[e]&&n.rows[e].cells[C]){var g,m;E(e,C,n).wrap&&(c=!0,d++),(g=this.parent.createElement("td")).textContent=this.parent.getDisplayText(n.rows[e].cells[C]),n.rows[e].cells[C].style&&((m=n.rows[e].cells[C].style).fontFamily&&(g.style.fontFamily=m.fontFamily),m.fontSize&&(g.style.fontSize=m.fontSize)),l[i]=g,i++}if(0===d){var b=Bs(p,l,r,this.parent,t,c);r&&(b=this.getFloatingElementWidth(b,e));var S=0===b?parseInt(o,10):b,w=parseInt(o,10)>S?-(parseInt(o,10)-S):S-parseInt(o,10);if(r)if(e>=this.parent.viewport.leftIndex&&e<=this.parent.viewport.rightIndex)Fe(n,e).width=S>0?S:0,this.resizeStart(e,this.parent.getViewportIndex(e,!0),S+"px",r,!0,t),this.parent.notify($e,{threshold:w,colIdx:e});else{var x=Te(n,e);this.parent.notify($e,{threshold:S>0?-(x-S):-x,colIdx:e}),Fe(n,e).width=S>0?S:0}else r||(e>=this.parent.viewport.topIndex&&e<=this.parent.viewport.bottomIndex?(S=S>20?S:20,h=le(n,e),w=S>0?-(h-S):-h,ui(n,e,S>0?S:0),dt(n,e,{customHeight:!1}),this.resizeStart(e,this.parent.getViewportIndex(e),S+"px",r,!0,t),this.parent.notify(Xe,{threshold:w,rowIdx:e})):(h=le(n,e),this.parent.notify(Xe,{threshold:S>0?-(h-S):-h,rowIdx:e}),ui(n,e,S>0?S:0)))}this.parent.selectRange(this.parent.getActiveSheet().selectedRange)},s.prototype.createResizeHandler=function(e,r){var t=this.parent.createElement("div",{className:r});t.classList.add("e-resize-handle");var i=document.getElementById(this.parent.element.id+"_sheet");e.classList.contains("e-colresize")?(t.style.height=this.parent.getMainContent().parentElement.clientHeight+this.parent.getColumnHeaderContent().offsetHeight+"px",t.style.left=this.event.clientX-i.getBoundingClientRect().left+"px",t.style.top="0px"):e.classList.contains("e-rowresize")&&(t.style.width=this.parent.getMainContent().parentElement.clientWidth+"px",t.style.left="0px",t.style.top=this.event.clientY-i.getBoundingClientRect().top+"px"),i.appendChild(t),this.resizeTooltip(e,!1),this.updateCursor()},s.prototype.resizeTooltip=function(e,r,t){if(r){var i=document.querySelector(".e-header-tooltip"),n=this.parent.element.getElementsByClassName("e-colresize-handler")[0],a=this.parent.element.getElementsByClassName("e-rowresize-handler")[0];if(n){var o=t.clientX-Math.round(this.trgtEle.getBoundingClientRect().left);i&&(i.firstChild.textContent=o>0?"Width:("+o.toString()+" pixels)":"Width: 0.00")}else if(a){var l=t.clientY-Math.round(this.trgtEle.getBoundingClientRect().top);i&&(i.firstChild.textContent=l>0?"Height:("+l.toString()+" pixels)":"Height: 0.00")}}else{var h=e.classList.contains("e-colresize"),p=e.classList.contains("e-rowresize");if(h||p){var c=h?"e-colresize-handler":"e-rowresize-handler",d=new Pt.u({cssClass:"e-header-tooltip",showTipPointer:!1});h?d.content="Width:("+Math.round(e.getBoundingClientRect().width).toString()+" pixels)":p&&(d.content="Height:("+Math.round(e.getBoundingClientRect().height).toString()+" pixels)",d.offsetX=-(this.parent.getMainContent().parentElement.clientWidth/2-Math.round(e.getBoundingClientRect().width))),d.appendTo("."+c),d.open(),d.refresh()}}},s.prototype.setColWidth=function(e,r,t,i){var n=this.parent.getActiveSheet(),a=Ve(t)-i;if(a<0&&i<-a&&(a=-i),t>0){if(this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column"))return this.showHiddenColumns(e,t),void this.parent.notify(Z,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIndex:this.parent.activeSheetIndex,oldWidth:i+"px",hide:!1},action:"resize"});this.resizeStart(e,r,t+"px",!0,!1,i+"px"),en(n,e,{width:t,customWidth:!0}),this.parent.notify($e,{threshold:a,colIdx:e,checkWrapCell:!0})}else this.isMouseMoved&&(this.parent.hideColumn(e),this.showHideCopyIndicator(),this.parent.notify(Z,{eventArgs:{index:e,width:"0px",isCol:!0,sheetIndex:this.parent.activeSheetIndex,oldWidth:i+"px",hide:!0},action:"resize"}))},s.prototype.showHideCopyIndicator=function(){var e=this.parent.element.getElementsByClassName("e-copy-indicator")[0],r=!1;e&&((0,f.og)(e),this.parent.notify(fr,null),r=!0),r&&this.parent.notify(Ye,{})},s.prototype.showHiddenColumns=function(e,r){var a,o,l,t=this,i=this.parent.getActiveSheet(),n=A(i.selectedRange);if(e>=n[1]&&e<=n[3]&&n[2]===i.rowCount-1&&B(i.activeCell)[0]===B(i.topLeftCell)[0]?(a=n[1],o=n[3],l=this.parent.getMainContent().querySelector("colgroup")):a=o=e,void 0!==r)for(var h=a;h<=o;h++)en(i,h,{width:r,customWidth:!0}),h>=this.parent.viewport.leftIndex&&h<=this.parent.viewport.rightIndex&&!we(i,h)&&(l.children[this.parent.getViewportIndex(h,!0)].style.width=r+"px");this.trgtEle&&this.trgtEle.classList.remove("e-unhide-column");var p={startIndex:a,endIndex:o,hide:!1,isCol:!0,autoFit:!0};if(this.parent.notify(je,p),this.showHideCopyIndicator(),void 0===r)if(p.autoFit)this.autoFit({isRow:!1,startIndex:a,endIndex:o});else{var c=function(){t.parent.off(Ye,c),t.autoFit({isRow:!1,startIndex:a,endIndex:o})};this.parent.on(Ye,c,this)}},s.prototype.setRowHeight=function(e,r,t,i){var n=this.parent.getActiveSheet(),a=this.parent.frozenColCount(n),o=parseInt(this.parent.getRow(e,null,a).style.height,10),l=t,h=Ve(parseInt(l,10))-o;h<0&&o<-h&&(h=-o),this.resizeStart(e,r,l,!1,!1,i),dt(n,e,{height:parseInt(l,10)>0?parseInt(l,10):0,customHeight:!0}),this.parent.notify(Xe,{threshold:h,rowIdx:e,isCustomHgt:!0})},s.prototype.resizeOn=function(e){var t,i,r=this,n=this.parent.getActiveSheet(),a=A(n.activeCell),o=E(a[0],a[1],n);if(this.trgtEle.classList.contains("e-rowresize")){var l=Number(this.trgtEle.parentElement.getAttribute("aria-rowindex"))-2;if(this.isMouseMoved&&ne(n,l)&&this.trgtEle.classList.contains("e-skip-resize")&&e.clientY>this.trgtEle.getBoundingClientRect().top){this.trgtEle.classList.remove("e-skip-resize");var h={startIndex:l,endIndex:l,hide:!1,skipAppend:!0};this.parent.notify(je,h);var p=this.parent.getRowHeaderTable().tBodies[0],c=this.parent.getContentTable().tBodies[0];h.hdrRow.style.display="none",h.row.style.display="none",p.insertBefore(h.hdrRow,p.children[h.insertIdx]),c.insertBefore(h.row,c.children[h.insertIdx]),this.trgtEle=h.hdrRow.firstElementChild,h.hdrRow.nextElementSibling.classList.remove("e-hide-end"),h.mergeCollection.forEach(function(S){r.parent.notify(tt,S)})}else if(this.trgtEle.classList.contains("e-skip-resize")){if(this.trgtEle.classList.remove("e-skip-resize"),!this.isMouseMoved&&ne(n,l)||!this.trgtEle.parentElement.previousElementSibling)return;this.trgtEle=this.trgtEle.parentElement.previousElementSibling.getElementsByClassName("e-header-cell")[0]}i=t=parseInt(this.trgtEle.parentElement.getAttribute("aria-rowindex"),10)-1,t=this.parent.getViewportIndex(i);var d=this.parent.frozenColCount(n),u=this.parent.getRow(i,null,d).style.height,v=e.clientY-this.event.clientY+parseInt(u,10);if(v<=0)return this.parent.hideRow(i),this.showHideCopyIndicator(),dt(n,i,{height:0,customHeight:!0}),void this.parent.notify(Z,{eventArgs:{index:i,height:"0px",isCol:!1,sheetIndex:this.parent.activeSheetIndex,oldHeight:u},action:"resize"});if(this.setRowHeight(i,t,v+"px",u),"none"===this.trgtEle.parentElement.style.display){var g=this.parent.getActiveSheet(),m=Q(A(g.selectedRange));if(i<=m[2]&&i>m[0]){v=le(g,i);for(var y=void 0,C=m[0];C<=m[2];C++)C!==i&&(u=le(g,C)+"px",dt(g,C,{customHeight:!0,height:v}),ne(g,C)?y||(y=C):(this.parent.getRow(C).style.height=v+"px",g.showHeaders&&(this.parent.getRow(C,this.parent.getRowHeaderTable()).style.height=v+"px")),this.parent.notify(Z,{eventArgs:{index:C,height:v+"px",isCol:!1,sheetIndex:this.parent.activeSheetIndex,oldHeight:u},action:"resize"}));this.parent.hideRow(m[0],i-1,!1),this.showHideCopyIndicator(),t+=Math.abs(i-y)}else 0===t||ne(g,i-1)?0!==t&&this.trgtEle.parentElement.classList.add("e-hide-end"):this.trgtEle.parentElement.previousElementSibling.classList.remove("e-hide-start"),this.parent.selectRange(g.selectedRange);this.trgtEle.parentElement.style.display="",this.parent.getContentTable().rows[t].style.display=""}}else if(this.trgtEle.classList.contains("e-colresize")){this.isMouseMoved&&this.trgtEle.classList.contains("e-unhide-column")&&e.clientX<this.trgtEle.getBoundingClientRect().left&&(this.trgtEle.classList.remove("e-unhide-column"),this.trgtEle.previousElementSibling&&(this.trgtEle=this.trgtEle.previousElementSibling)),t=parseInt(this.trgtEle.getAttribute("aria-colindex"),10)-1;var b=void 0;this.trgtEle.classList.contains("e-unhide-column")?(t-=1,b=0):b=Te(this.parent.getActiveSheet(),t),this.setColWidth(t,this.parent.getViewportIndex(t,!0),e.clientX-this.event.clientX+b,b)}o&&o.format&&o.format.indexOf("*")>-1&&this.parent.notify(Rn,{cell:o,value:o.format[o.format.indexOf("*")+1].toString(),rowIdx:a[0],colIdx:a[1]})},s.prototype.resizeStart=function(e,r,t,i,n,a){var l,h;Ms(e,r,t,i,this.parent),i?(l={index:e,width:t,isCol:i,sheetIndex:this.parent.activeSheetIndex,oldWidth:a},h=a!==t):(l={index:e,height:t,isCol:i,sheetIndex:this.parent.activeSheetIndex,oldHeight:a},h=a!==t),h&&this.parent.notify(Z,{eventArgs:l,action:n?"resizeToFit":"resize"})},s.prototype.updateCursor=function(){this.parent.element.getElementsByClassName("e-colresize-handler")[0]?this.parent.element.classList.add("e-col-resizing"):this.parent.element.classList.contains("e-col-resizing")&&this.parent.element.classList.remove("e-col-resizing"),this.parent.element.getElementsByClassName("e-rowresize-handler")[0]?this.parent.element.classList.add("e-row-resizing"):this.parent.element.classList.contains("e-row-resizing")&&this.parent.element.classList.remove("e-row-resizing")},s.prototype.getFloatingElementWidth=function(e,r){var t=e,i={filterRange:[],hasFilter:!1};return this.parent.notify(ii,i),i.hasFilter&&i.filterRange&&i.filterRange[1]<=r&&i.filterRange[3]>=r&&(t=e+22),t},s.prototype.destroy=function(){this.unwireEvents(),this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"resize"},s}(),Ip=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.hideShow=function(e){var a,r=this,t=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,i=_(this.parent,t);if(e.startIndex>e.endIndex){var n=e.startIndex;e.startIndex=e.endIndex,e.endIndex=n}if(e.actionUpdate){if(e.sheetIndex=t,this.parent.notify(ue,a={eventArgs:e,action:"hideShow"}),e.cancel)return;delete e.cancel}var o=function(c){e.isCol?(r.hideCol(e),c&&r.parent.sheetModule.colWidthChanged({colIdx:e.startIndex,isHideShow:!0})):(r.hideRow(e),c&&r.parent.sheetModule.rowHeightChanged({rowIdx:e.startIndex,isHideShow:!0}))},l=e.isCol?this.parent.frozenColCount(i):this.parent.frozenRowCount(i);if(l&&e.startIndex<l){var h=void 0;if(e.freezePane=!0,e.endIndex>=l&&(h=e.endIndex,e.endIndex=l-1),o(!0),delete e.freezePane,void 0!==h){var p=e.startIndex;e.endIndex=h,e.startIndex=l,o(),e.startIndex=p}}else o();e.actionUpdate&&(this.updateIndexOnlyForHiddenColumnsAndRows(e,i),this.parent.notify(Z,a))},s.prototype.updateIndexOnlyForHiddenColumnsAndRows=function(e,r){for(var t=e.startIndex,i=e.endIndex,a=e.startIndex;a<=i;a++)if(0==(e.isCol?Fe(r,a):vr(r,a)||{}).hidden){e.startIndex=a;break}for(var o=e.endIndex;o>=t;o--)if(0==(e.isCol?Fe(r,o):vr(r,o)||{}).hidden){e.endIndex=o;break}},s.prototype.hideRow=function(e){var n,o,l,h,p,u,r=this,t=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,i=_(this.parent,t),a=0,c=Object.assign({},e),d=this.parent.scrollSettings.isFinite&&!c.freezePane;if(d){if(c.startIndex>=i.rowCount)return;c.endIndex>=i.rowCount&&(c.endIndex=i.rowCount-1),u=0}var v=this.parent.frozenRowCount(i);if(c.hide){for(var m,g=void 0,y=void 0,C=d&&c.endIndex===U(i,i.rowCount-1,!1),b=c.startIndex;b<=c.endIndex;b++)if(!ne(i,b)&&(void 0===o&&(c.freezePane?(m=this.parent.sheetModule.getSelectAllTable(),g=this.parent.getColHeaderTable()):(m=this.parent.getRowHeaderTable(),g=this.parent.getContentTable()),o=this.parent.getViewportIndex(b),a=0),p={hidden:!0},c.isFiltering&&(p.isFiltered=!0),dt(i,b,p),t===this.parent.activeSheetIndex))if(d&&(u+=le(i,b,!0,!0)),this.refreshChart(b,"rows"),y=g&&g.rows[o]){if(!h)for(var S=0;S<=i.usedRange.colIndex;S++)if(((n=E(b,S,i)||{}).colSpan||n.rowSpan)&&(c.startIndex>=this.parent.viewport.topIndex||this.parent.scrollSettings.enableVirtualization)){h=!0;break}if(h)continue;if(m.rows[o]&&(0,f.og)(m.rows[o]),(0,f.og)(y),a++,(y=g.rows[o])&&b===c.endIndex){var x=(l=U(i,b+1,!0))!==U(i,0,!0)&&l===(this.parent.viewport.topIndex>=c.startIndex?c.endIndex+1:this.parent.viewport.topIndex)?"Row":"";for(S=this.parent.viewport.leftIndex;S<=this.parent.viewport.rightIndex;S++)""!==(I=this.parent.getCellStyleValue(["borderTop"],[l,S]).borderTop)&&this.parent.notify(He,{onActionUpdate:!1,rowIdx:l,colIdx:S,style:{borderTop:I},row:y,pRow:y.previousElementSibling,first:x,cell:y.cells[S]})}}else b<=this.parent.viewport.bottomIndex?a++:a--;if(c.refreshUI)return;if(h&&(c.startIndex>=this.parent.viewport.topIndex||!this.parent.scrollSettings.enableVirtualization))return void(c.isFiltering?e.refreshUI=!0:(this.parent.selectRange(i.selectedRange),i.frozenRows||i.frozenColumns?(this.parent.renderModule.refreshSheet(!1,!1,!0),e.refreshUI=!0):this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:this.parent.viewport.leftIndex,refresh:"Row"})));if(!a)return;this.parent.selectRange(i.selectedRange);var F=function(){if(i.showHeaders){var ir=c.freezePane?1:0;o===ir?m.rows[ir]&&m.rows[ir].classList.add("e-hide-end"):(m&&m.rows[o-1]&&m.rows[o-1].classList.add("e-hide-start"),m&&m.rows[o]&&m.rows[o].classList.add("e-hide-end"))}};if(!c.freezePane&&this.parent.scrollSettings.enableVirtualization){var T=c.startIndex,k=c.startIndex;if(c.startIndex<B(i.paneTopLeftCell)[0]||a>this.parent.viewport.rowCount){if(c.isFiltering)return void(e.refreshUI=!0);this.parent.updateTopLeftCell(U(i,c.startIndex-1<v?v:c.startIndex-1,!0)-v,null,"col"),this.parent.renderModule.refreshSheet(!1,!1,!0)}else{var R=this.parent.skipHidden(T=this.parent.viewport.bottomIndex+1,k=T+a-1,"rows",!1);if(T=R[0],k=R[1],d){if(T>=i.rowCount)return void(this.parent.viewport.topIndex+v===U(i,v,!0)?(F(),this.parent.notify(Nr,{isHide:!0,height:u}),C&&(this.parent.viewport.bottomIndex=U(i,i.rowCount-1,!1))):this.parent.renderModule.refreshSheet(!1,!1,!0));if(k>=i.rowCount)return void this.parent.renderModule.refreshSheet(!1,!1,!0);this.parent.notify(Nr,{isHide:!0,height:u})}this.parent.viewport.bottomIndex=k;var D=void 0,N=this.parent.frozenColCount(i),P=[];N?(P.push(v),P.push(this.parent.viewport.leftIndex+N),D=B(i.topLeftCell)[1]):D=this.parent.viewport.leftIndex,this.parent.renderModule.refreshUI({colIndex:D,rowIndex:T,direction:"",refresh:"RowPart",frozenIndexes:P},j(T,D)+":"+j(k,this.parent.viewport.rightIndex))}}F()}else{var M=void 0,V=void 0,Y=void 0,X=void(y=void 0),G=void 0,$=void(g=void 0),J=void 0,de=c.startIndex-1,oe=[],Le=c.freezePane,be="lastElementChild",Ae=0;if(d){var Ie=U(i,i.rowCount-1,!1);if(this.parent.viewport.bottomIndex===Ie)if(this.parent.viewport.topIndex+v===U(i,v,!0))Le=!0;else{var ve=A(i.paneTopLeftCell)[0];i.rowCount-1-ve+1-this.parent.hiddenCount(ve,i.rowCount-1)<this.parent.viewport.rowCount+Math.round(this.parent.getThreshold("row")/2)&&(be="firstElementChild")}}b=c.startIndex;for(var kt=c.endIndex;b<=kt;b++)if(ne(i,b))if(void 0===X){if(p={hidden:!1},c.isFiltering&&(p.isFiltered=!1),!Le&&b>this.parent.viewport.bottomIndex){if(dt(i,b,p),void 0===J)return}else if(void 0===J&&(J=b),dt(i,b,p),t===this.parent.activeSheetIndex)for(d&&(u+=le(i,b,!0,!0)),this.refreshChart(b,"rows"),void 0===o&&(M=document.createDocumentFragment(),V=document.createDocumentFragment(),G=this.parent.serviceLocator.getService("row"),c.freezePane?($=this.parent.sheetModule.getSelectAllTable(),g=this.parent.getColHeaderTable()):($=this.parent.getRowHeaderTable(),g=this.parent.getContentTable(),b<this.parent.viewport.topIndex+v&&(this.parent.viewport.topIndex=b-v)),o=this.parent.getViewportIndex(b)),de++,Y=G.refresh(b,null,null,!0,!0),M.appendChild(Y),$&&$.rows.length&&!Le&&(0,f.og)($.tBodies[0][be]),y=V.appendChild(G.refresh(b,y,Y)),g&&g.rows.length&&!Le&&((0,f.og)(g.tBodies[0][be]),"firstElementChild"===be&&(void 0!==o&&o-1>-1&&(o-=1),Ae+=le(i,this.parent.viewport.topIndex,!0),this.parent.viewport.topIndex=U(i,this.parent.viewport.topIndex+1,!0))),S=this.parent.viewport.leftIndex;S<=this.parent.viewport.rightIndex;S++)if(void 0!==(n=E(b,S,i)||{}).rowSpan){var gr={range:[b,S,b,S],isAction:!1,merge:!0,type:"All",skipChecking:!0};this.parent.notify(Ne,gr),(!oe.length||gr.range[1]!==oe[oe.length-1].range[1])&&oe.push(gr)}}else kt=b;else{if(c.startIndex===c.endIndex)return;void 0===o?de++:X=b}if(void 0===o)return;if(!c.freezePane){if(c.isFiltering&&c.startIndex<B(i.paneTopLeftCell)[0]&&(e.refreshUI=!0,void 0===X||X===c.endIndex))return;this.parent.viewport.bottomIndex=this.parent.viewport.topIndex+v+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),a=this.parent.hiddenCount(this.parent.viewport.topIndex+v,c.startIndex)+this.parent.hiddenCount(c.endIndex+1,this.parent.viewport.bottomIndex),this.parent.viewport.bottomIndex+=a,d&&this.parent.viewport.bottomIndex>=i.rowCount&&(this.parent.viewport.bottomIndex=U(i,i.rowCount-1,!1))}if(c.insertIdx=e.insertIdx=o,c.row=e.row=V.querySelector(".e-row"),c.mergeCollection=e.mergeCollection=oe,i.showHeaders&&(e.hdrRow=c.hdrRow=M.querySelector(".e-row"),0!==o&&!ne(i,de-1)&&$.rows[o-1]&&$.rows[o-1].classList.remove("e-hide-start"),0!==c.startIndex&&ne(i,c.startIndex-1)&&c.hdrRow.classList.add("e-hide-end"),ne(i,de+1)?M.lastElementChild.classList.add("e-hide-start"):$.rows[o]&&$.rows[o].classList.remove("e-hide-end")),y&&g&&g.rows[o])for(l=U(i,de+1,!0),b=this.parent.viewport.leftIndex;b<=this.parent.viewport.rightIndex;b++){var I;if(""!==(I=this.parent.getCellStyleValue(["borderTop"],[l,b]).borderTop)){this.parent.notify(He,{onActionUpdate:!1,rowIdx:l,colIdx:b,style:{borderTop:I},pRow:y,cell:g.rows[o].cells[b],first:""});var yr=U(i,J-1,!1);yr>-1?g.rows[o-1]&&!this.parent.getCellStyleValue(["borderBottom"],[yr,b]).borderBottom&&!this.parent.getCellStyleValue(["borderTop"],[J,b]).borderTop&&(g.rows[o-1].cells[b].style.borderBottom=""):g.rows[o].cells[b].style.borderTop=""}}if(c.skipAppend)return;d&&this.parent.notify(Nr,{height:u,size:Ae}),Math.abs(de-J)>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")?this.parent.renderModule.refreshSheet(!1,!1,!0):($&&($.tBodies[0].rows.length?$.tBodies[0].insertBefore(M,$.rows[o]):$.tBodies[0].appendChild(M)),g&&g.tBodies[0]&&(g.tBodies[0].rows.length?g.tBodies[0].insertBefore(V,g.rows[o]):g.tBodies[0].appendChild(V)),this.parent.selectRange(i.selectedRange),c.autoFit&&i.showHeaders&&this.parent.notify(Po,{startIndex:c.startIndex,endIndex:c.endIndex,isRow:!0}),oe.forEach(function(yt){r.parent.notify(tt,yt)}),void 0!==X&&X!==c.endIndex&&(c.startIndex=X,this.hideRow(c)))}},s.prototype.hideCol=function(e){for(var c,r=this,t=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,i=_(this.parent,t),n=[],a=[],o=B(i.paneTopLeftCell),l=this.parent.frozenColCount(i),h=this.parent.frozenRowCount(i),p=this.parent.viewport.leftIndex+l,d=e.startIndex;d<=e.endIndex;d++)if(!(e.hide?we(i,d):!we(i,d))){if(en(i,d,{hidden:e.hide}),this.refreshChart(d,"columns"),this.parent.scrollSettings.enableVirtualization&&!e.freezePane&&(d<p||d>this.parent.viewport.rightIndex)){d<p&&a.push(d);continue}n.push(d),e.hide&&d<=o[1]&&(c=!0)}if((a.length||n.length)&&t===this.parent.activeSheetIndex){var v,g,u=B(i.topLeftCell),m=function(){var k;return k=r.parent.scrollSettings.enableVirtualization?[h?u[0]:r.parent.viewport.topIndex,r.parent.viewport.bottomIndex]:[0,i.rowCount-1],e.freezePane?(v=r.parent.getRowHeaderTable(),g=r.parent.sheetModule.getSelectAllTable()):(v=r.parent.getContentTable(),g=r.parent.getColHeaderTable()),k};if(e.hide){if(!n.length)return;if((n.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization||e.freezePane)&&this.removeCell(i,n,m(),v,g),!e.freezePane&&this.parent.scrollSettings.enableVirtualization){if(c)return this.parent.updateTopLeftCell(null,U(i,n[0]-1<l?l:n[0]-1,!0,"columns")-l,"row"),void this.parent.renderModule.refreshSheet(!1,!1,!0);var y=[],C=this.parent.viewport.topIndex,b=h?u[0]:C;if(h&&(y=[h+C,l]),this.parent.scrollSettings.isFinite){var S=U(i,i.colCount-1,!1,"columns"),w=this.parent.viewport.leftIndex+l,x=this.parent.viewport.rightIndex;if(x+n.length>=S){var I=U(i,w-(x+n.length-S),!1,"columns");return I>=l&&(this.parent.viewport.leftIndex=I,this.parent.viewport.leftIndex-=this.parent.hiddenCount(x,S)),this.parent.viewport.rightIndex=S,w!==this.parent.viewport.leftIndex+l||x!==this.parent.viewport.rightIndex?(this.parent.renderModule.refreshUI({colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:y,rowIndex:b,skipUpdateOnFirst:this.parent.viewport.leftIndex+l===U(i,l,!0,"columns")}),h&&(this.parent.viewport.topIndex=C)):this.parent.notify(is,{refresh:"Column",isUpdate:!0}),void this.parent.selectRange(i.selectedRange)}}if(n.length<=this.parent.getThreshold("col")){var F=this.parent.skipHidden(this.parent.viewport.rightIndex+1,this.parent.viewport.rightIndex+n.length,"columns");this.parent.viewport.rightIndex=F[1],this.parent.renderModule.refreshUI({rowIndex:b,colIndex:F[0],direction:"",refresh:"ColumnPart",frozenIndexes:y},""+z([b,F[0],this.parent.viewport.bottomIndex,F[1]]))}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+l===U(i,l,!0,"columns"),rowIndex:b,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:y}),h&&(this.parent.viewport.topIndex=C)}this.parent.selectRange(i.selectedRange)}else{if(a.length&&this.parent.scrollSettings.enableVirtualization)return a.sort(function(k,R){return k-R}),this.parent.updateTopLeftCell(null,U(i,a[0]-1<l?l:a[0]-1,!0,"columns")-l,"row"),this.parent.renderModule.refreshSheet(!1,!1,!0),void(e.autoFit&&(e.autoFit=!1));n.length<=this.parent.getThreshold("col")||!this.parent.scrollSettings.enableVirtualization||e.freezePane?(this.appendCell(i,n,m(),v,g,e.freezePane),this.parent.scrollSettings.enableVirtualization&&!e.freezePane&&this.parent.notify(Lt,{refresh:"Column",prevRowColCnt:{rowCount:i.rowCount,colCount:i.colCount}})):(C=this.parent.viewport.topIndex,b=h?u[0]:C,this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+l===U(i,l,!0,"columns"),rowIndex:b,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:h?[h+C,l]:[]}),h&&(this.parent.viewport.topIndex=C),e.autoFit&&(e.autoFit=!1)),this.parent.selectRange(i.selectedRange)}}},s.prototype.removeCell=function(e,r,t,i,n){var g,m,y,C,b,a=this,o=t[0],l=t[1],h=0,p=r.length-1,c=this.parent.frozenRowCount(e),d=i.getElementsByTagName("colgroup")[0],u=this.parent.getViewportIndex(r[0],!0)+1,v=U(e,c-1,!1);for(e.showHeaders&&(y=n.getElementsByTagName("colgroup")[0],g=n.rows[0]);o<=l;)ne(e,o)?o++:(m=c&&o<c?n.rows[h+1]:i.rows[h],r.forEach(function(S,w){if(0===h&&o>=c&&(e.showHeaders&&((0,f.og)(y.children[u]),(0,f.og)(g.cells[u])),(0,f.og)(d.children[u])),(0,f.og)(m.cells[u]),0===w&&void 0!==(C=E(o,S,e,!1,!0)).colSpan&&(void 0===C.rowSpan||C.colSpan>1)&&a.parent.notify(oa,{rowIdx:o,colIdx:S,model:"col",start:r[0],end:r[p]}),w===p){b=U(e,S+1,!0,"columns");var x=a.parent.getCellStyleValue(["borderLeft"],[h,b]).borderLeft;""!==x&&a.parent.notify(He,{onActionUpdate:!1,rowIdx:h,colIdx:b,style:{borderLeft:x},row:m,first:""}),void 0!==(C=E(o,S,e)||{}).colSpan&&(void 0===C.rowSpan||C.colSpan>1)&&a.parent.notify(oa,{rowIdx:o,colIdx:S,model:"col",start:r[0],end:r[p],isEnd:!0})}}),c&&o===v?(h=0,o=this.parent.viewport.topIndex+c):(h++,o++));u-1>-1&&e.showHeaders&&g.cells[u-1]&&g.cells[u-1].classList.add("e-hide-start"),e.showHeaders&&g.cells[u]&&g.cells[u].classList.add("e-hide-end")},s.prototype.appendCell=function(e,r,t,i,n,a){var d,u,v,g,o=this,l=t[0],h=t[1],p=0,c=r.length-1,m=this.parent.frozenRowCount(e),y=i.getElementsByTagName("colgroup")[0];e.showHeaders&&(v=n.getElementsByTagName("colgroup")[0],d=n.rows[0]);var C=this.parent.serviceLocator.getService("cell");r.sort(function(k,R){return k-R});for(var w,x,I,T,b=[],S=[],F=U(e,m-1,!1);l<=h;)ne(e,l)?l++:(u=m&&l<m?n.rows[p+1]:i.rows[p],r.forEach(function(k,R){if(0===p&&(S[R]=o.parent.getViewportIndex(k,!0),e.showHeaders&&(x=d.cells[S[R]])&&(0===R&&r[R]&&!we(e,r[R]-1)&&x.previousSibling&&x.previousElementSibling.classList.remove("e-hide-start"),R===c&&x.classList.remove("e-hide-end")),l>=m&&(y.children[S[R]]?(y.insertBefore(o.parent.sheetModule.updateCol(e,k),y.children[S[R]]),e.showHeaders&&C.renderColHeader(k,d,x)):(y.appendChild(o.parent.sheetModule.updateCol(e,k)),e.showHeaders&&C.renderColHeader(k,d)),a||((0,f.og)(y.lastChild),e.showHeaders&&(0,f.og)(d.lastChild)),e.showHeaders&&R===c&&((0,f.og)(v),n.insertBefore(y.cloneNode(!0),n.tHead)))),a||(0,f.og)(u.lastChild),x=u.cells[S[R]],T={rowIdx:l,colIdx:k,cell:E(l,k,e),row:u,address:j(l,k),lastCell:k===c,isHeightCheckNeeded:!0,first:k!==U(e,0,!0,"columns")&&k===o.parent.viewport.leftIndex?"Column":"",checkNextBorder:R===c?"Column":""},x&&(T.refChild=x),w=C.render(T),0===R&&w.previousSibling&&""!==o.parent.getCellStyleValue(["borderLeft"],[p,U(e,r[r.length-1]+1,!0,"columns")]).borderLeft&&(g=U(e,r[0]-1,!1,"columns"))>-1&&!o.parent.getCellStyleValue(["borderRight"],[p,g]).borderRight&&!o.parent.getCellStyleValue(["borderLeft"],[p,r[0]]).borderLeft&&(w.previousSibling.style.borderRight=""),void 0!==(I=E(p,k,e)||{}).colSpan&&(void 0===I.rowSpan||I.colSpan>1)){var N={range:[p,k,p,k],isAction:!1,merge:!0,type:"All",skipChecking:!0};o.parent.notify(Ne,N),(!b.length||N.range[1]!==b[b.length-1].range[1])&&b.push(N)}}),m&&l===F?(l=this.parent.viewport.topIndex+m,p=0):(l++,p++));b.forEach(function(k){o.parent.notify(tt,k)}),this.parent.viewport.rightIndex=U(e,this.parent.viewport.rightIndex-r.length,!1,"columns")},s.prototype.refreshChart=function(e,r){this.parent.notify(Kr,{rIdx:e,showHide:r})},s.prototype.addEventListener=function(){this.parent.on(je,this.hideShow,this),this.parent.on(rt,this.destroy,this)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.removeEventListener=function(){this.parent.off(je,this.hideShow),this.parent.off(rt,this.destroy)},s}(),zs=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(Pi,this.initiateHyperlinkHandler,this),this.parent.on(Vi,this.editHyperlinkHandler,this),this.parent.on(Vo,this.openHyperlinkHandler,this),this.parent.on(xr,this.hyperlinkClickHandler,this),this.parent.on(qo,this.createHyperlinkEle,this),this.parent.on(lt,this.keyUpHandler,this),this.parent.on(In,this.removeHyperlink,this),this.parent.on(qi,this.removeHyperlinkHandler,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Pi,this.initiateHyperlinkHandler),this.parent.off(Vi,this.editHyperlinkHandler),this.parent.off(Vo,this.openHyperlinkHandler),this.parent.off(xr,this.hyperlinkClickHandler),this.parent.off(qo,this.createHyperlinkEle),this.parent.off(lt,this.keyUpHandler),this.parent.off(In,this.removeHyperlink),this.parent.off(qi,this.removeHyperlinkHandler))},s.prototype.getModuleName=function(){return"spreadsheetHyperlink"},s.prototype.keyUpHandler=function(e){var r=e.target;if((0,f.oq)(r,".e-document")){var t=document.querySelector(".e-hyp-text"),i=this.parent.element.querySelector(".e-hyperlink-alert-span"),o=((0,f.oq)(r,".e-hyperlink-dlg")||(0,f.oq)(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild;t&&t.value&&(nt(t.value.toUpperCase())?i&&(i.remove(),o.removeAttribute("disabled")):(this.showDialog(),o.setAttribute("disabled","true")))}r.classList.contains("e-text")&&(0,f.oq)(r,".e-cont")&&(0,f.oq)(r,".e-webpage")&&(0,f.oq)(r,".e-webpage").getElementsByClassName("e-cont")[1]===r.parentElement&&(o=((0,f.oq)(r,".e-hyperlink-dlg")||(0,f.oq)(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild,""!==r.value?o.removeAttribute("disabled"):(0,f.oq)(r,".e-link-dialog").querySelector(".e-webpage").querySelectorAll(".e-cont")[1].querySelector(".e-text").value||o.setAttribute("disabled","true"))},s.prototype.initiateHyperlinkHandler=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.getActiveSheet();if(!t.isProtected||t.protectSettings.insertLink){if(!this.parent.element.querySelector(".e-hyperlink-dlg")){var n,i=this.parent.serviceLocator.getService(ae);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-hyperlink-dlg",header:r.getConstant("InsertLink"),beforeOpen:function(a){var o={dialogName:"InsertLinkDialog",element:a.element,target:a.target,cancel:a.cancel};e.parent.trigger("dialogBeforeOpen",o),o.cancel&&(a.cancel=!0),i.dialogInstance.content=e.hyperlinkContent(),n=i.dialogInstance.content.querySelector(".e-text").value,i.dialogInstance.dataBind(),K(e.parent.element)},open:function(){setTimeout(function(){K(i.dialogInstance.element.querySelectorAll(".e-webpage input")[1])})},buttons:[{buttonModel:{content:r.getConstant("Insert"),isPrimary:!0,disabled:!0},click:function(){e.dlgClickHandler(n),i.hide()}}]})}}else this.parent.notify(Nt,null)},s.prototype.dlgClickHandler=function(e){var r,t,i=this.parent.getActiveSheet(),n=i.name+"!"+i.selectedRange,a=this.parent.element.querySelector(".e-link-dialog").getElementsByClassName("e-content")[0].querySelector(".e-item.e-active");if(a)if((r=a.getElementsByClassName("e-cont")[0].querySelector(".e-text").value)===e&&(r=null),a.querySelector(".e-webpage"))t=a.getElementsByClassName("e-cont")[1].querySelector(".e-text").value,this.parent.insertHyperlink({address:t},n,r,!1);else{t=a.getElementsByClassName("e-cont")[1].querySelector(".e-text").value;var l=a.getElementsByClassName("e-cont")[2];if(l.getElementsByClassName("e-list-item")[0].querySelector(".e-active"))t=a.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent+"!"+t.toUpperCase(),this.parent.insertHyperlink({address:t},n,r,!1);else if(l.querySelector(".e-active"))for(var p=a.getElementsByClassName("e-cont")[2].querySelector(".e-active").textContent,c=0;c<this.parent.definedNames.length;c++)this.parent.definedNames[c].name===p&&this.parent.insertHyperlink({address:this.parent.definedNames[c].name},n,r,!1)}},s.prototype.showDialog=function(){this.parent.element.querySelector(".e-hyperlink-alert-span")&&this.parent.element.querySelector(".e-hyperlink-alert-span").remove();var e=this.parent.serviceLocator.getService(O),r=this.parent.createElement("span",{className:"e-hyperlink-alert-span",innerHTML:e.getConstant("HyperlinkAlert")});(this.parent.element.querySelector(".e-hyperlink-dlg")||this.parent.element.querySelector(".e-edithyperlink-dlg")).querySelector(".e-dlg-content").appendChild(r)},s.prototype.editHyperlinkHandler=function(){var i,e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.serviceLocator.getService(ae);t.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-edithyperlink-dlg",header:r.getConstant("EditLink"),beforeOpen:function(n){var a={dialogName:"EditLinkDialog",element:n.element,target:n.target,cancel:n.cancel};e.parent.trigger("dialogBeforeOpen",a),a.cancel&&(n.cancel=!0),t.dialogInstance.content=e.hyperEditContent(),i=t.dialogInstance.content.querySelector(".e-text").value,t.dialogInstance.dataBind(),K(e.parent.element)},open:function(){setTimeout(function(){t.dialogInstance.element.querySelector(".e-webpage")?K(t.dialogInstance.element.querySelectorAll(".e-webpage input")[1]):K(t.dialogInstance.element.querySelectorAll(".e-document input")[1])})},buttons:[{buttonModel:{content:r.getConstant("Update"),isPrimary:!0},click:function(){e.dlgClickHandler(i),t.hide()}}]})},s.prototype.openHyperlinkHandler=function(){var e=B(this.parent.getActiveSheet().activeCell),r=this.parent.getCell(e[0],e[1]);r.getElementsByClassName("e-hyperlink")[0]&&(r=r.querySelector(".e-hyperlink")),this.hlOpenHandler(r)},s.prototype.hlOpenHandler=function(e){var r=this;if(e.classList.contains("e-hyperlink")){var t=(0,f.oq)(e,".e-cell");if(!t)return;var i=["",""],n=void 0,a=!0,o=this.parent.getActiveSheet(),l=parseInt(t.getAttribute("aria-colindex"),10)-1,h=parseInt(t.parentElement.getAttribute("aria-rowindex"),10)-1,p=E(h,l,o,!1,!0);p.style&&"#00e"===p.style.color&&(Je(this.parent,o,{rowIdx:h,colIdx:l,preventEvt:!0,cell:{style:{color:"#551a8b"}}}),t.style.color="#551a8b");var c=p.hyperlink,d=void 0,u={hyperlink:c,address:o.activeCell,target:"_blank",cancel:!1};if(this.parent.trigger("beforeHyperlinkClick",u),u.cancel)return;var v={hyperlink:c=u.hyperlink,address:o.activeCell};"string"==typeof c&&(d=c),"object"==typeof c&&(d=c.address);var g=d;if(-1===d.indexOf("http://")&&-1===d.indexOf("https://")&&-1===d.indexOf("ftp://")){if(!(0,f.le)(d)){if(this.parent.definedNames)for(var m=0;m<this.parent.definedNames.length;m++)if(this.parent.definedNames[m].name===d){d=(d=this.parent.definedNames[m].refersTo).slice(1);break}var y;for(-1!==d.indexOf("!")?-1!==(i=d.split("!"))[0].indexOf(" ")&&(i[0]=i[0].slice(1,i[0].length-1)):(i[0]=this.parent.getActiveSheet().name,i[1]=d),m=0;m<this.parent.sheets.length;m++)this.parent.sheets[m].name===i[0]&&(y=m);if(o=this.parent.sheets[y],-1!==i[1].indexOf(":")){var C=i[1].indexOf(":"),b=i[1].substr(0,C),S=i[1].substr(C+1,i[1].length);b=b.replace("$",""),(S=S.replace("$","")).match(/\D/g)&&!S.match(/[0-9]/g)&&b.match(/\D/g)&&!b.match(/[0-9]/g)?i[1]=(b+="1")+":"+(S+=o.rowCount):!S.match(/\D/g)&&S.match(/[0-9]/g)&&!b.match(/\D/g)&&b.match(/[0-9]/g)&&(n=[parseInt(b,10)-1,0,parseInt(S,10)-1,o.colCount-1],a=!1)}var w=void 0,x=this.parent.definedNames;if(!(0,f.le)(x))for(m=0;m<x.length;m++)if(x[m].name===g){w=!0;break}if(nt(i[1])||w){if(n=a?A(i[1]):n,this.parent.scrollSettings.enableVirtualization&&(n[0]=n[0]>=this.parent.viewport.topIndex?n[0]-this.parent.viewport.topIndex:n[0],n[1]=n[1]>=this.parent.viewport.leftIndex?n[1]-this.parent.viewport.leftIndex:n[1]),!(0,f.le)(o)){var I=z(n);if(o===this.parent.getActiveSheet())Pe(function(){r.parent.goTo(I)});else{if(I.indexOf(":")>=0){var F=I.split(":");I=F[0]===F[1]?F[0]:I}Pe(function(){r.parent.goTo(r.parent.sheets[y].name+"!"+I)})}}}else this.showInvalidHyperlinkDialog()}}else this.isValidUrl(d)?window.open(d,u.target):this.showInvalidHyperlinkDialog();this.parent.trigger("afterHyperlinkClick",v)}},s.prototype.isValidUrl=function(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},s.prototype.showInvalidHyperlinkDialog=function(){var e=this.parent.serviceLocator.getService(ae),r=this.parent.serviceLocator.getService(O);e.show({width:323,isModal:!0,showCloseIcon:!0,header:r.getConstant("Hyperlink"),content:r.getConstant("InvalidHyperlinkAlert"),buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){e.hide()}}]},!1)},s.prototype.hyperlinkClickHandler=function(e){var r=e.target;if((0,f.oq)(r,".e-link-dialog")&&(0,f.oq)(r,".e-toolbar-item")){var n=(t=(0,f.oq)(r,".e-hyperlink-dlg")||(0,f.oq)(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild,a=t.querySelector(".e-document"),o=t.querySelector(".e-webpage"),l=o?o.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value,h=a?a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value:l;if((0,f.oq)(r,".e-toolbar-items").getElementsByClassName("e-toolbar-item")[1].classList.contains("e-active")){var c=a.querySelectorAll(".e-cont")[2].querySelector(".e-active");a.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=l,(0,f.oq)(c,".e-list-item").classList.contains("e-level-2")&&n.hasAttribute("disabled")?n.removeAttribute("disabled"):(0,f.oq)(c,".e-list-item").classList.contains("e-level-1")&&!n.hasAttribute("disabled")&&n.setAttribute("disabled","true")}else{var d=!o.querySelectorAll(".e-cont")[1].querySelector(".e-text").value;o.querySelectorAll(".e-cont")[0].querySelector(".e-text").value=h,d&&!n.hasAttribute("disabled")?n.setAttribute("disabled","true"):!d&&n.hasAttribute("disabled")&&n.removeAttribute("disabled")}}if((0,f.oq)(r,".e-list-item")&&r.classList.contains("e-fullrow")){var u=this.parent.element.getElementsByClassName("e-link-dialog")[0];if(!u)return;var t,v=(u=u.getElementsByClassName("e-content")[0].getElementsByClassName("e-active")[0]).getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];n=(t=(0,f.oq)(r,".e-hyperlink-dlg")||(0,f.oq)(r,".e-edithyperlink-dlg")).getElementsByClassName("e-footer-content")[0].firstChild,(0,f.oq)(r,".e-list-item").classList.contains("e-level-2")?("defName"===(0,f.oq)(r,".e-list-item").getAttribute("data-uid")?!v.classList.contains("e-disabled")&&!v.hasAttribute("readonly")&&(v.setAttribute("readonly","true"),v.classList.add("e-disabled"),v.setAttribute("disabled","true")):"sheet"===(0,f.oq)(r,".e-list-item").getAttribute("data-uid")&&v.classList.contains("e-disabled")&&v.hasAttribute("readonly")&&(v.removeAttribute("readonly"),v.classList.remove("e-disabled"),v.removeAttribute("disabled")),n.hasAttribute("disabled")&&n.removeAttribute("disabled")):(0,f.oq)(r,".e-list-item").classList.contains("e-level-1")&&n.setAttribute("disabled","true")}else this.hlOpenHandler(r)},s.prototype.createHyperlinkEle=function(e){var r=e.cell;if(!(0,f.le)(r.hyperlink)){var t=e.td,i=this.parent.createElement("a",{className:"e-hyperlink e-hyperlink-style"}),n=void 0;if("string"==typeof r.hyperlink?(0===r.hyperlink.toLowerCase().indexOf("www.")&&(r.hyperlink="http://"+r.hyperlink),n=r.hyperlink):0===(n=r.hyperlink.address).toLowerCase().indexOf("www.")&&(r.hyperlink.address=n="http://"+n),0===n.indexOf("http://")||0===n.indexOf("https://")||0===n.indexOf("ftp://")?(i.setAttribute("href",n),i.setAttribute("target","_blank")):(n.includes("=")||n.includes("!"))&&i.setAttribute("ref",n),"Accounting"===Ft(r.format)?i.innerHTML=t.innerHTML:i.innerText=""!==t.innerText?t.innerText:n,t.textContent="",t.innerText="",t.appendChild(i),!e.style.color||!e.style.textDecoration){var a={};e.style.color||(e.style.color=a.color="#00e"),e.style.textDecoration||(e.style.textDecoration=a.textDecoration="underline"),Je(this.parent,this.parent.getActiveSheet(),{rowIdx:e.rowIdx,colIdx:e.colIdx,preventEvt:!0,cell:{style:a}})}}},s.prototype.hyperEditContent=function(){var e=!0,r=this.hyperlinkContent(),t=A(this.parent.getActiveSheet().activeCell),i=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[t[0]].cells[t[1]];this.parent.scrollSettings.enableVirtualization&&(t[0]=t[0]-this.parent.viewport.topIndex,t[1]=t[1]-this.parent.viewport.leftIndex);var a,n=this.parent.getDisplayText(i),o=i.hyperlink;"string"==typeof o?(a=o,n=n||a,-1===a.indexOf("http://")&&-1===a.indexOf("https://")&&-1===a.indexOf("ftp://")&&(e=!1)):"object"==typeof o&&(a=o.address,n=n||a,-1===a.indexOf("http://")&&-1===a.indexOf("https://")&&-1===a.indexOf("ftp://")&&(e=!1));for(var l=0,h=0,p=this.parent.definedNames,c=this.parent.sheets,d=0,u=p.length;d<u;d++)p[d].name===a&&l++;for(d=0,u=c.length;d<u;d++)a.includes(c[d].name)&&h++;0===l&&0===h&&(e=!0);var v=r.querySelector(".e-content");if(e){var g=v.querySelector(".e-webpage");g.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",n),"string"==typeof o?g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",o):g.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",o.address)}else{var y=void 0,C=v.querySelector(".e-document");C.getElementsByClassName("e-cont")[0].getElementsByClassName("e-text")[0].setAttribute("value",n);var b=void 0;if(this.parent.definedNames)for(d=0;d<this.parent.definedNames.length;d++)if(this.parent.definedNames[d].name===a){y=!0;break}if(y){var S=C.getElementsByClassName("e-cont")[1].getElementsByClassName("e-text")[0];S.setAttribute("readonly","true"),S.classList.add("e-disabled"),S.setAttribute("disabled","true");var x=C.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[1];for(d=0;d<x.getElementsByTagName("li").length;d++)x.getElementsByTagName("li")[d].innerText===a&&x.getElementsByTagName("li")[d].classList.add("e-active")}else{a&&-1!==a.indexOf("!")&&(b=a.split("!"));var I=b[0];for(C.getElementsByClassName("e-cont")[1].querySelector(".e-text").setAttribute("value",b[1]),x=C.getElementsByClassName("e-cont")[2].querySelectorAll(".e-list-item.e-level-1")[0],d=0;d<x.getElementsByTagName("li").length;d++)if(x.getElementsByTagName("li")[d].innerText===I){if(x.getElementsByTagName("li")[d].classList.contains("e-active"))break;x.getElementsByTagName("li")[d].classList.add("e-active")}else x.getElementsByTagName("li")[d].classList.contains("e-active")&&x.getElementsByTagName("li")[d].classList.remove("e-active")}}return r},s.prototype.hyperlinkContent=function(){var n,o,e=this.parent.serviceLocator.getService(O),r=0,t=0,i=!0,a=!0,l=A(this.parent.getActiveSheet().activeCell),h=this.parent.getActiveSheet(),p=E(l[0],l[1],h),c=!0;if(p){c=!!(p.value&&"string"==typeof p.value&&null!==p.value.match("[A-Za-z]+")||""===p.value||(0,f.le)(p.value));var d=p.hyperlink;if("string"==typeof d)-1===(u=d).indexOf("http://")&&-1===u.indexOf("https://")&&-1===u.indexOf("ftp://")&&(o=d,i=!1);else if("object"==typeof d){var u;-1===(u=d.address).indexOf("http://")&&-1===u.indexOf("https://")&&-1===u.indexOf("ftp://")&&(o=d.address,i=!1)}if(o){for(var v=0,g=0,m=this.parent.definedNames,y=this.parent.sheets,C=0,b=y.length;C<b;C++)o.includes(y[C].name)&&g++;var S=0;for(b=m.length;S<b;S++)m[S].name===o&&v++;0===v&&0===g&&(i=!0)}if(t=i?0:1,this.parent.definedNames)for(var w=0;w<this.parent.definedNames.length;w++)if(this.parent.definedNames[w].name===o){n=!0,a=!1;break}}var x=this.parent.createElement("div",{className:"e-link-dialog"}),I=this.parent.createElement("div",{className:"e-webpage"}),F=this.parent.createElement("div",{className:"e-document"});new ze.OK({selectedItem:t,items:[{header:{text:e.getConstant("WebPage")},content:I},{header:{text:e.getConstant("ThisDocument")},content:F}]}).appendTo(x),i?x.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 0; right: 136px"):x.querySelector(".e-toolbar-items").querySelector(".e-indicator").setAttribute("style","left: 136px; right: 0");var k=this.parent.createElement("div",{className:"e-cont"}),R=this.parent.createElement("div",{className:"e-cont"}),D=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("DisplayText")}),N=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Url")}),P=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});c||(P.classList.add("e-disabled"),P.setAttribute("readonly","true"),P.setAttribute("disabled","true")),p&&(0,f.le)(p.hyperlink)&&P.setAttribute("value",this.parent.getDisplayText(p));var M=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});P.setAttribute("placeholder",e.getConstant("EnterTheTextToDisplay")),M.setAttribute("placeholder",e.getConstant("EnterTheUrl")),k.appendChild(P),k.insertBefore(D,P),R.appendChild(M),R.insertBefore(N,M),I.appendChild(R),I.insertBefore(k,R);for(var V=[],Y=[],X=this.parent.sheets;r<this.parent.sheets.length;r++){var G=this.parent.sheets[r].name;"Visible"===this.parent.sheets[r].state&&(X[r]===this.parent.getActiveSheet()?V.push({nodeId:"sheet",nodeText:-1!==G.indexOf(" ")?"'"+G+"'":G,selected:!0}):V.push({nodeId:"sheet",nodeText:-1!==G.indexOf(" ")?"'"+G+"'":G}))}for(r=0;r<this.parent.definedNames.length;r++)Y.push({nodeId:"defName",nodeText:this.parent.definedNames[r].name});var $=[{nodeId:"01",nodeText:e.getConstant("CellReference"),expanded:a,nodeChild:V},{nodeId:"02",nodeText:e.getConstant("DefinedNames"),expanded:n,nodeChild:Y}],J=new ze.LQ({fields:{dataSource:$,id:"nodeId",text:"nodeText",child:"nodeChild"}}),de=this.parent.createElement("div",{className:"e-cont"}),oe=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("CellReference")}),Le=this.parent.createElement("input",{className:"e-input e-text e-hyp-text",attrs:{type:"Text"}});Le.setAttribute("value","A1"),de.appendChild(Le),de.insertBefore(oe,Le);var be=this.parent.createElement("div",{className:"e-cont"}),Ae=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("DisplayText")}),Ie=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"Text"}});c||(Ie.classList.add("e-disabled"),Ie.setAttribute("readonly","true"),Ie.setAttribute("disabled","true")),p&&(0,f.le)(p.hyperlink)&&Ie.setAttribute("value",this.parent.getDisplayText(p)),Ie.setAttribute("placeholder",e.getConstant("EnterTheTextToDisplay")),be.appendChild(Ie),be.insertBefore(Ae,Ie);var ve=this.parent.createElement("div",{className:"e-cont"}),et=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Sheet")}),kt=this.parent.createElement("div",{className:"e-refcont"});return ve.appendChild(kt),ve.insertBefore(et,kt),F.appendChild(de),F.insertBefore(be,de),J.appendTo(kt),F.appendChild(ve),x},s.prototype.removeHyperlink=function(e){var r=E(e.rowIdx,e.colIdx,e.sheet);r&&r.hyperlink&&(r.value="string"==typeof r.hyperlink?r.value?r.value:r.hyperlink:r.value?r.value:r.hyperlink.address,delete r.hyperlink,r.style&&(delete r.style.textDecoration,delete r.style.color),r.validation&&r.validation.isHighlighted&&r.style.backgroundColor&&(r.style.color="#ff0000"),e.sheet===this.parent.getActiveSheet()&&(r.style&&this.parent.notify(Jt,null),e.preventRefresh||this.parent.serviceLocator.getService("cell").refreshRange([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx])))},s.prototype.removeHyperlinkHandler=function(e){var t,n,r=e.range,i=this.parent.getActiveSheet();if(!e.preventEventTrigger){var a={address:-1===r.indexOf("!")?i.name+"!"+r:r,cancel:!1};if(this.parent.notify(ue,{action:"removeHyperlink",eventArgs:a}),a.cancel)return}if(r&&-1!==r.indexOf("!")){t=r.split("!");for(var o=this.parent.sheets,l=0;l<o.length;l++)o[l].name===t[0]&&(n=l);i=this.parent.sheets[n],r=t[1]}for(var p,c,h=A(r||i.activeCell),d=h[0];d<=h[2];d++)for(var u=h[1];u<=h[3];u++)if(i&&i.rows[d]&&i.rows[d].cells[u]){if(c=[],p=this.parent.getCell(d,u))for(var v=0;v<p.classList.length;v++)c.push(p.classList[v]);for(this.parent.notify(In,{sheet:i,rowIdx:d,colIdx:u}),v=0;v<c.length;v++)p.classList.contains(c[v])||p.classList.add(c[v])}e.preventEventTrigger||this.parent.notify(Z,{action:"removeHyperlink",eventArgs:{address:-1===r.indexOf("!")?i.name+"!"+r:r}})},s}(),_s=function(){return _s=Object.assign||function(s){for(var e,r=1,t=arguments.length;r<t;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},_s.apply(this,arguments)},Ws=function(){function s(e){this.undoCollection=[],this.redoCollection=[],this.isUndo=!1,this.undoRedoStep=100,this.parent=e,this.addEventListener()}return s.prototype.setActionData=function(e){var t,r=this.parent.getActiveSheet(),i=[],n=[],a=e.args,o=a.eventArgs,l={};switch(a.action){case"format":t=A(a.eventArgs.range);break;case"clipboard":l=o.copiedInfo,t=A(Cr(o.pastedRange)),l&&l.isCut&&(n=this.getCellDetails(l.range,_(this.parent,ht(this.parent,l.sId)),"clipboard"));break;case"beforeSort":(t=A(a.eventArgs.range))[0]===t[2]&&t[2]-t[0]==0&&(t[0]=0,t[1]=0,t[2]=r.usedRange.rowIndex,t[3]=r.usedRange.colIndex);break;case"beforeCellSave":case"cellDelete":case"cellSave":case"deleteImage":case"hyperlink":case"removeHyperlink":t=A(o.address);break;case"beforeWrap":case"beforeReplace":case"chartDesign":t=this.parent.getAddressInfo(o.address).indices;break;case"beforeClear":case"beforeInsertImage":case"beforeInsertChart":case"filter":case"removeValidation":t=A(o.range);break;case"autofill":t=A(o.fillRange)}"beforeSort"===a.action?(this.beforeActionData={cellDetails:o.cellDetails},this.beforeActionData.sortedCellDetails=o.sortedCellDetails):(i=this.getCellDetails(t,r,a.action),this.beforeActionData={cellDetails:i,cutCellDetails:n})},s.prototype.getBeforeActionData=function(e){e.beforeDetails=this.beforeActionData},s.prototype.performUndoRedo=function(e){var r,t;if(r=e.isFromUpdateAction?e:e.isUndo?this.undoCollection.pop():this.redoCollection.pop(),this.isUndo=e.isUndo,r){var i=void 0,n={};if(!e.isPublic){var a=r.eventArgs.beforeActionData;if(delete r.eventArgs.beforeActionData,(0,f.l7)((i={action:r.action,eventArgs:{}}).eventArgs,r.eventArgs,null,!0),r.eventArgs.beforeActionData=a,i.eventArgs.cancel=!1,r.preventAction=i.preventAction=!0,e.isUndo?i.isUndo=!0:i.isRedo=!0,e.isFromUpdateAction||this.parent.notify(ue,i),i.eventArgs.cancel)return void this.updateUndoRedoIcons();delete i.eventArgs.cancel}switch(r.action){case"cellSave":case"format":case"wrap":case"cellDelete":case"autofill":case"removeValidation":case"hyperlink":case"removeHyperlink":r=this.performOperation(r,e.preventEvt,e.preventReSelect,e.isPublic);break;case"sorting":this.undoForSorting(r,e.isUndo);break;case"clipboard":r=this.undoForClipboard(r,e.isUndo,i),t=!0;break;case"resize":case"resizeToFit":r=this.undoForResize(r);break;case"hideShow":case"delete":case"validation":case"addHighlight":case"removeHighlight":case"clearCF":case"insertImage":case"deleteImage":case"imageRefresh":case"insertChart":case"deleteChart":case"chartRefresh":case"addDefinedName":qe(r,this.parent,!e.isUndo);break;case"replace":r=this.performOperation(r);break;case"replaceAll":r.eventArgs.isAction=!1,e.isUndo&&(n.value=r.eventArgs.replaceValue,n.replaceValue=r.eventArgs.value),this.parent.notify(Gr,_s({},r.eventArgs,n));break;case"insert":case"filter":qe(r,this.parent,!e.isUndo,null,i),t="filter"===r.action;break;case"merge":r.eventArgs.merge=r.isFromUpdateAction?r.eventArgs.merge:!r.eventArgs.merge,qe(r,this.parent,!1);break;case"clear":r=this.performOperation(r),e.isUndo&&r.eventArgs.cfClearActionArgs&&qe({action:"clearCF",eventArgs:r.eventArgs.cfClearActionArgs},this.parent,!e.isUndo);break;case"conditionalFormat":qe(r,this.parent,!e.isUndo,this.undoCollection);break;case"chartDesign":r.eventArgs.isUndo=e.isUndo,this.parent.notify(os,r.eventArgs)}e.isFromUpdateAction||(e.isUndo?this.redoCollection.push(r):this.undoCollection.push(r),this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.redoCollection.length>this.undoRedoStep&&this.redoCollection.splice(0,1),this.updateUndoRedoIcons(),!e.isPublic&&!t&&this.parent.notify(Z,(0,f.l7)({isUndoRedo:!0,isUndo:e.isUndo},r))),this.parent.notify(Jt,null)}},s.prototype.undoForSorting=function(e,r){var t=this,i=qt(this.parent,e.eventArgs.range),n=A(e.eventArgs.range),a=function(h,p){if(i===t.parent.activeSheetIndex){var c=t.parent.getCell(n[0]-1,t.parent.sortCollection[h].columnIndex);c&&(c=(0,f.Ys)(".e-filter-icon",c))&&(p?c.classList.add("e-sort"+("Ascending"===t.parent.sortCollection[h].order?"asc":"desc")+"-filter"):c.classList.remove("e-sort"+("Ascending"===t.parent.sortCollection[h].order?"asc":"desc")+"-filter"))}};if(r){if(this.parent.notify(Ka,{result:e.eventArgs.beforeActionData.cellDetails,range:n,sheet:_(this.parent,i),jsonData:e.eventArgs.beforeActionData.sortedCellDetails,isUndo:!0}),this.parent.notify(Ri,{range:e.eventArgs.range}),this.parent.sortCollection&&e.eventArgs.previousSort)for(var o=0;o<this.parent.sortCollection.length;o++)if(this.parent.sortCollection[o].sheetIndex===i){a(o,!1),this.parent.sortCollection.splice(o,1),e.eventArgs.previousSort.order?(this.parent.sortCollection.splice(o,0,e.eventArgs.previousSort),a(o,!0)):this.parent.sortCollection.length||(this.parent.sortCollection=void 0);break}}else if(qe(e,this.parent,!0),e.eventArgs.previousSort){var l=void 0;if(this.parent.sortCollection){for(o=0;o<this.parent.sortCollection.length;o++)if(this.parent.sortCollection[o].sheetIndex===i){a(o,!1),l=o,this.parent.sortCollection.splice(o,1);break}}else this.parent.sortCollection=[],l=0;this.parent.sortCollection.splice(l,0,{sortRange:e.eventArgs.range.split("!")[1],sheetIndex:i,columnIndex:Vt(e.eventArgs.sortOptions.sortDescriptors.field),order:e.eventArgs.sortOptions.sortDescriptors.order}),a(l,!0)}},s.prototype.updateUndoRedoCollection=function(e){var r=["clipboard","format","sorting","cellSave","resize","resizeToFit","wrap","hideShow","replace","validation","merge","clear","conditionalFormat","clearCF","insertImage","imageRefresh","insertChart","deleteChart","chartRefresh","filter","cellDelete","autofill","addDefinedName","removeValidation","removeHighlight","addHighlight","hyperlink","removeHyperlink","deleteImage","chartDesign","replaceAll"];("insert"===e.args.action||"delete"===e.args.action)&&"Sheet"!==e.args.eventArgs.modelType&&r.push(e.args.action);var t=e.args.action;if(-1!==r.indexOf(t)||e.isPublic){var i=e.args.eventArgs;if("clipboard"===t||"sorting"===t||"format"===t||"cellSave"===t||"wrap"===t||"replace"===t||"validation"===t||"clear"===t||"conditionalFormat"===t||"clearCF"===t||"insertImage"===t||"imageRefresh"===t||"insertChart"===t||"chartRefresh"===t||"filter"===t||"cellDelete"===t||"autofill"===t||"removeValidation"===t||"addDefinedName"===t||"hyperlink"===t||"removeHyperlink"===t||"deleteImage"===t||"chartDesign"===t){var n={beforeDetails:{cellDetails:[]}};this.parent.notify(Uo,n),i.beforeActionData=n.beforeDetails}if("clipboard"===t&&i.copiedInfo&&i.copiedInfo.isExternal){var a=this.parent.getAddressInfo(i.pastedRange);i.copiedInfo.cellDetails=this.getCellDetails(a.indices,_(this.parent,a.sheetIndex),t)}this.undoCollection.push(e.args),this.redoCollection=[],this.undoCollection.length>this.undoRedoStep&&this.undoCollection.splice(0,1),this.updateUndoRedoIcons()}},s.prototype.clearUndoRedoCollection=function(){this.undoCollection=[],this.redoCollection=[],this.updateUndoRedoIcons()},s.prototype.updateUndoRedoIcons=function(){var e=this.parent.serviceLocator.getService(O);this.parent.notify(dr,[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_undo"],enable:this.undoCollection.length>0}]),this.parent.notify(dr,[{tab:e.getConstant("Home"),items:[this.parent.element.id+"_redo"],enable:this.redoCollection.length>0}])},s.prototype.undoForClipboard=function(e,r,t){var v,i=this,n=e.eventArgs,a=n.pastedRange.split("!"),o=A(a[1]),l=ee(this.parent,a[0]),h=_(this.parent,l),p=n.copiedInfo,c=n.beforeActionData,d=e.isFromUpdateAction,u=l===this.parent.activeSheetIndex;if(t&&(t.isUndoRedo=!0,t.eventArgs.beforeActionData=c),"imagePaste"===e.eventArgs.requestType){var g=n.copiedShapeInfo;r?(v=g.pictureElem,g.isCut?(this.parent.notify(It,{id:v.id,sheetIdx:n.pasteSheetIndex+1}),this.parent.notify(Mt,{options:{src:v.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:g.height,width:g.width,imageId:v.id},range:g.copiedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify(It,{id:n.pastedPictureElement.id,sheetIdx:n.pasteSheetIndex+1})):g.isCut?(this.parent.notify(It,{id:(v=g.pictureElem).id,sheetIdx:g.sId}),this.parent.notify(Mt,{options:{src:v.style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:g.height,width:g.width,imageId:v.id},range:g.pastedRange,isPublic:!1,isUndoRedo:!0})):this.parent.notify(Mt,{options:{src:(v=n.pastedPictureElement).style.backgroundImage.replace(/url\((['"])?(.*?)\1\)/gi,"$2"),height:v.offsetHeight,width:v.offsetWidth,imageId:v.id},range:g.pastedRange,isPublic:!1,isUndoRedo:!0})}else{if(r){p.isCut&&(this.updateCellDetails(c.cutCellDetails,_(this.parent,ht(this.parent,p.sId)),Q(p.range),u,e),n.cfClearActionArgs&&qe({action:"clearCF",eventArgs:n.cfClearActionArgs},this.parent,!1)),c&&this.updateCellDetails(c.cellDetails,h,o,u,e),n.cfActionArgs&&n.cfActionArgs.cfModel.forEach(function(S){qe({eventArgs:{range:S.range,type:S.type,cFColor:S.cFColor,value:S.value,sheetIdx:n.cfActionArgs.sheetIdx,cancel:!0},action:"conditionalFormat"},i.parent,!1)}),mr(h,o[0],o[1],le(h,o[0]));var y=$t(h,o[0]);Kt(this.parent,h,y,o[0]),n.mergeCollection.forEach(function(S){S.merge=!S.merge,i.parent.notify(tt,S),S.merge=!S.merge}),t&&!d&&this.parent.notify(Z,t)}else if(p.isExternal){var C=this.parent.getAddressInfo(n.pastedRange);this.updateCellDetails(p.cellDetails,_(this.parent,C.sheetIndex),C.indices,!0,e),t&&!d&&this.parent.notify(Z,t)}else{var b=new Promise(function(w){w(void 0)});C=this.parent.getAddressInfo(n.copiedRange),this.parent.notify(n.copiedInfo.isCut?kr:Rr,{range:C.indices,sId:_(this.parent,C.sheetIndex).id,promise:b,invokeCopy:!0,isPublic:!0,isFromUpdateAction:d}),b.then(function(){i.parent.notify(Ot,{range:a&&De(n.pastedRange),sIdx:a&&ee(i.parent,Et(n.pastedRange)),type:n.type,isAction:!1,isInternal:!0,isFromUpdateAction:d}),t&&!d&&i.parent.notify(Z,t)})}u&&!d?(this.parent.notify(Er,{address:a[1]}),this.parent.notify(Bt,{})):this.checkRefreshNeeded(l,d)}return e},s.prototype.undoForResize=function(e){var r=e.eventArgs;if(void 0===r.hide)if(r.isCol){var t=r.oldWidth;r.oldWidth=r.width,r.width=t}else t=r.oldHeight,r.oldHeight=r.height,r.height=t;else r.hide=!r.hide;qe(e,this.parent,!1);var i=this.parent.getActiveSheet(),n=A(i.activeCell),a=E(n[0],n[1],i);if(a&&a.rowSpan){var o=this.parent.getCell(n[0],n[1]);this.parent.element.querySelector(".e-active-cell").style.height=o.offsetHeight+"px"}else a&&a.colSpan&&(o=this.parent.getCell(n[0],n[1]),this.parent.element.querySelector(".e-active-cell").style.width=o.offsetWidth+"px");return e},s.prototype.performOperation=function(e,r,t,i){var n=e.eventArgs,a=[],o=Q(A((a="autofill"===e.action?n.fillRange.split("!"):"cellSave"===e.action||"wrap"===e.action||"replace"===e.action||"cellDelete"===e.action||"hyperlink"===e.action||"removeHyperlink"===e.action?n.address.split("!"):n.range.split("!"))[1])),l=o,h=ee(this.parent,a[0]),p=_(this.parent,h),c=n.beforeActionData,d=e.isFromUpdateAction,u=this.checkRefreshNeeded(h,d),v={cellIdx:[o[0],o[1]],isUnique:!1,uniqueRange:""};if(this.parent.notify(At,v),this.isUndo){if(v.isUnique&&n.formula&&n.formula.indexOf("UNIQUE")>-1&&"#SPILL!"!==E((g=A(v.uniqueRange))[0],g[1],this.parent.getActiveSheet()).value)for(var m=g[0];m<=g[2];m++)for(var y=g[1];y<=g[3];y++)m===g[0]&&y===g[1]&&(y+=1),this.parent.updateCell({value:""},z([m,y]));if(this.updateCellDetails(c.cellDetails,p,o,u,e,r),v.isUnique&&"cellDelete"===e.action&&n.isSpill){for(var g,C=E((g=A(v.uniqueRange))[0],g[1],this.parent.getActiveSheet()),b=g[0];b<=g[2];b++)for(m=g[1];m<=g[3];m++)for(y=o[0];y<=o[2];y++)for(var S=o[1];S<=o[3];S++)(b!==y||m!==S)&&this.parent.updateCell({value:""},j(b,m));C.value="#SPILL!",this.parent.updateCell(C,j(g[0],g[1]))}if(!n.isSpill&&""!==v.uniqueRange){var w=A(v.uniqueRange);for(m=w[0];m<=w[2];m++)for(y=w[1];y<=w[3];y++)m===w[0]&&y===w[1]&&(y+=1),this.parent.updateCell({value:""},z([m,y]));this.parent.notify(vn,null)}}else{var x=e.eventArgs,I=A(p.activeCell),F=this.parent.getCellStyleValue(["textDecoration"],I).textDecoration;if(x&&x.style&&x.style.textDecoration){var T=x.style.textDecoration,k=T,R=void 0,D=!1;for("underline"===F?k="underline"===T?"none":"underline line-through":"line-through"===F?k="line-through"===T?"none":"underline line-through":"underline line-through"===F&&(k="underline"===T?"line-through":"underline",D=!0),"none"===k&&(D=!0),x.style.textDecoration=k,e.eventArgs=x,this.parent.notify(ye,{style:{textDecoration:k},range:I,refreshRibbon:!0,onActionUpdate:!0}),b=l[0];b<=l[2];b++)for(m=l[1];m<=l[3];m++)if(b!==I[0]||m!==I[1]){if(R={},"none"===(F=this.parent.getCellStyleValue(["textDecoration"],[b,m]).textDecoration)){if(D)continue;R.textDecoration=T}else if("underline"===F||"line-through"===F)if(D){if(T!==F)continue;R.textDecoration="none"}else R.textDecoration=T!==F?"underline line-through":T;else if("underline line-through"===F){if(!D)continue;R.textDecoration="underline"===T?"line-through":"underline"}this.parent.notify(ye,{style:{textDecoration:R.textDecoration},range:[b,m,b,m],refreshRibbon:!0,onActionUpdate:!0})}x.style.textDecoration=T,e.eventArgs=x}else{if(!(0,f.le)(n.oldValue)&&n.oldValue!==n.value&&v.isUnique){var N=A(v.uniqueRange);if("#SPILL!"!==E(N[0],N[1],this.parent.getActiveSheet()).value)for(m=N[0];m<=N[2];m++)for(y=N[1];y<=N[3];y++)m===N[0]&&y===N[1]&&(this.parent.updateCell({value:"#SPILL!"},z([N[0],N[1]])),y+=1),this.parent.updateCell({value:""},z([m,y]))}if(qe(e,this.parent,!0),v.isUnique&&"cellDelete"===e.action&&n.isSpill){var P=A(v.uniqueRange),M=!1;for(b=P[0];b<=P[1];b++)for(m=P[1];m<=P[3];m++)b===P[0]&&m===P[1]&&m++,E(b,m,p)&&!(0,f.le)(E(b,m,p).value)&&""!==E(b,m,p).value&&(M=!0);M||((C=E(P[0],P[1],this.parent.getActiveSheet())).value="",this.parent.updateCell(C,j(P[0],P[1])),this.parent.notify(vn,null))}}}return"autofill"===e.action&&(a[1]=this.isUndo?e.eventArgs.dataRange:e.eventArgs.selectedRange),u&&!t&&!d&&this.parent.notify(Er,{address:a[1]}),this.parent.notify(ai,{}),e},s.prototype.getCellDetails=function(e,r,t){for(var n,i=[],a="cellDelete"===t,o=(e=Q(e))[0];o<=e[2];o++)if(!a||!rr(r,o))for(var l=e[1];l<=e[3];l++)n=E(o,l,r),i.push({rowIndex:o,colIndex:l,format:n?n.format:null,isLocked:n?n.isLocked:null,style:n&&n.style?Object.assign({},n.style):null,value:n?n.value:"",formula:n?n.formula:"",wrap:n&&n.wrap,rowSpan:n&&n.rowSpan,colSpan:n&&n.colSpan,hyperlink:n&&((0,f.Kn)(n.hyperlink)?(0,f.l7)({},n.hyperlink):n.hyperlink),image:n&&n.image,chart:n&&n.chart&&JSON.parse(JSON.stringify(n.chart)),validation:n&&n.validation});return i},s.prototype.updateCellDetails=function(e,r,t,i,n,a){for(var p,c,d,g,m,o=this,l=e.length,h=n&&!a&&("cellSave"===n.action||"cellDelete"===n.action||"autofill"===n.action||"clipboard"===n.action),u=n&&!n.eventArgs.cfClearActionArgs&&r.conditionalFormats&&r.conditionalFormats.length&&[].slice.call(r.conditionalFormats),v=[],y=0;y<l;y++)(c=E(e[y].rowIndex,e[y].colIndex,r,!1,!0)).style&&n&&("format"===n.action||"clipboard"===n.action)&&(c.style.borderTop&&(!e[y].style||!e[y].style.borderTop)&&this.parent.setBorder({borderTop:""},r.name+"!"+j(e[y].rowIndex,e[y].colIndex)),c.style.borderLeft&&(!e[y].style||!e[y].style.borderLeft)&&this.parent.setBorder({borderLeft:""},r.name+"!"+j(e[y].rowIndex,e[y].colIndex)),c.style.fontSize&&(!e[y].style||!e[y].style.fontSize)&&(c.style.fontSize="11pt",d=!0,this.parent.notify(He,{style:{fontSize:"11pt"},rowIdx:e[y].rowIndex,colIdx:e[y].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0})),c.style.fontFamily&&(!e[y].style||!e[y].style.fontFamily)&&(d=!0,c.style.fontFamily="Calibri",this.parent.notify(He,{style:{fontFamily:"Calibri"},rowIdx:e[y].rowIndex,colIdx:e[y].colIndex,lastCell:!0,isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0}))),ce(e[y].rowIndex,e[y].colIndex,r,{value:e[y].formula&&e[y].formula.toUpperCase().includes("UNIQUE")?null:e[y].value,format:e[y].format,isLocked:e[y].isLocked,style:e[y].style&&Object.assign({},e[y].style),formula:e[y].formula,wrap:e[y].wrap,rowSpan:e[y].rowSpan,colSpan:e[y].colSpan,hyperlink:e[y].hyperlink,validation:e[y]&&e[y].validation}),m={action:"updateCellValue",address:[e[y].rowIndex,e[y].colIndex,e[y].rowIndex,e[y].colIndex],value:e[y].formula?e[y].formula:e[y].value,sheetIndex:ee(this.parent,r.name)},this.parent.notify(Sr,m),u&&!g&&(g=m.isFormulaDependent),(n&&"wrap"===n.action&&n.eventArgs.wrap||c.wrap&&!e[y].wrap)&&this.parent.notify(or,{range:[e[y].rowIndex,e[y].colIndex,e[y].rowIndex,e[y].colIndex],wrap:!1,sheet:r}),n&&e[y].hyperlink&&"clear"===n.action&&(n.eventArgs.range=r.name+"!"+z([e[y].rowIndex,e[y].colIndex,e[y].rowIndex,e[y].colIndex]),p=this.parent.getCell(e[y].rowIndex,e[y].colIndex),"Clear All"===n.eventArgs.type||"Clear Hyperlinks"===n.eventArgs.type?this.parent.addHyperlink(e[y].hyperlink,n.eventArgs.range,e[y].value):"Clear Formats"===n.eventArgs.type&&(0,f.cn)(p.querySelectorAll(".e-hyperlink"),"e-hyperlink-style")),h&&e[y].value!==c.value&&this.parent.trigger("cellSave",{element:null,value:e[y].value,oldValue:c.value,formula:e[y].formula,cancel:!1,address:r.name+"!"+j(e[y].rowIndex,e[y].colIndex),displayText:this.parent.getDisplayText(e[y])}),u&&!g&&Ki(u,v,e[y].rowIndex,e[y].colIndex);i&&(this.parent.serviceLocator.getService("cell").refreshRange(t,!1,!1,!0),(v.length||g)&&this.parent.notify(We,{cfModel:!g&&v,refreshAll:g,isAction:!0}),d&&Pe(function(){return o.parent.selectRange(r.selectedRange)}))},s.prototype.checkRefreshNeeded=function(e,r){var t=!0;return e!==this.parent.activeSheetIndex&&(r||(this.parent.activeSheetIndex=e,this.parent.dataBind()),t=!1),t},s.prototype.addEventListener=function(){this.parent.on(Gt,this.performUndoRedo,this),this.parent.on(Jn,this.updateUndoRedoCollection,this),this.parent.on(ea,this.setActionData,this),this.parent.on(Uo,this.getBeforeActionData,this),this.parent.on(ri,this.clearUndoRedoCollection,this),this.parent.on(Xo,this.updateUndoRedoIcons,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Gt,this.performUndoRedo),this.parent.off(Jn,this.updateUndoRedoCollection),this.parent.off(ea,this.setActionData),this.parent.off(Uo,this.getBeforeActionData),this.parent.off(ri,this.clearUndoRedoCollection),this.parent.off(Xo,this.updateUndoRedoIcons))},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"undoredo"},s}(),Gs=function(){function s(e){this.parent=e,this.wrapCell=this.parent.createElement("span",{className:"e-wrap-content"}),this.addEventListener()}return s.prototype.addEventListener=function(){this.parent.on(Bi,this.ribbonClickHandler,this),this.parent.on(or,this.wrapTextHandler,this),this.parent.on(Xe,this.rowHeightChangedHandler,this),this.parent.on($e,this.colWidthChanged,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Bi,this.ribbonClickHandler),this.parent.off(or,this.wrapTextHandler),this.parent.off(Xe,this.rowHeightChangedHandler),this.parent.off($e,this.colWidthChanged))},s.prototype.wrapTextHandler=function(e){if(e.initial||ih(this.parent,e.range,!0)){for(var r=void 0,t=void 0,i=void 0,n=void 0,a=void 0,o=void 0,l=void 0,h=void 0,p=e.range[0];p<=e.range[2];p++){n=0,o=(l=vr(e.sheet,p).customHeight)||e.isCustomHgt;for(var c=e.range[1];c<=e.range[3];c++)if(!((t=E(p,c,e.sheet,null,!0)).rowSpan<0||t.colSpan<0)){var d=t.rowSpan>1||t.colSpan>1;if((r=e.initial?e.td:this.parent.getCell(p,c))?(e.wrap?(h=Ps(t.style&&t.style.fontFamily?t.style:this.parent.cellStyle),r.classList.add(fh)):(r.classList.remove(fh),h=null),(o||d)&&this.updateWrapCell(p,c,e.sheet,r)):h=null,f.AR.isIE&&r.classList.add("e-ie-wrap"),!o&&!d){if(i=Ra(e.sheet,p,c,t.colSpan>1?c+t.colSpan-1:c),(u=this.parent.getDisplayText(t).toString()).indexOf("\n")<0){var v=this.parent.element.querySelector(".e-spreadsheet-edit");v&&v.textContent.indexOf("\n")>-1&&(u=v.textContent)}if(u)if(e.wrap){r&&r.classList.contains("e-alt-unwrap")&&r.classList.remove("e-alt-unwrap");var g=void 0,m=0,y=void 0;if(u.indexOf("\n")>-1){var C=u.split("\n"),b=C.length;for(y=0;y<b;y++)0===(g=tn(C[y],i,t.style,this.parent.cellStyle))&&(g=1),m+=g;g=m}else g=tn(u,i,t.style,this.parent.cellStyle);if(a=gi(this.parent,p,c,e.sheet,t.style||this.parent.cellStyle,g,h),n=Math.max(n,a),t.rowSpan>1){var S=Ce(e.sheet,p,p+(t.rowSpan-1));if(S>=n)return;a=n=le(e.sheet,p)+(n-S)}mr(e.sheet,p,c,a)}else u.indexOf("\n")>-1&&r.classList.add("e-alt-unwrap"),a=gi(this.parent,p,c,e.sheet,t.style||this.parent.cellStyle,1,h),mr(e.sheet,p,c,a),n=Math.max($t(e.sheet,p),20);else(!e.wrap||!u)&&(mr(e.sheet,p,c,20),n=Math.max($t(e.sheet,p),20));c===e.range[3]&&(e.wrap&&n>20&&$t(e.sheet,p)<=n||(!e.wrap||!u)&&$t(e.sheet,p)<le(e.sheet,p)&&le(e.sheet,p)>20)&&Kt(this.parent,e.sheet,n,p,e.row,e.hRow)}if(o&&!d){var u=this.parent.getDisplayText(t);e.wrap?r&&r.classList.contains("e-alt-unwrap")&&r.classList.remove("e-alt-unwrap"):u.indexOf("\n")>-1&&r.classList.add("e-alt-unwrap")}e.wrap&&r?l?r.style.lineHeight&&(r.style.lineHeight=""):r.style.lineHeight=parseFloat(t.style&&t.style.fontSize||this.parent.cellStyle.fontSize)*h+"pt":r&&(r.style.lineHeight="")}}e.initial||this.parent.notify(Bt,null)}},s.prototype.ribbonClickHandler=function(e){var r=(0,f.oq)(e.originalEvent.target,".e-btn");if(r&&r.id===this.parent.element.id+"_wrap"){var t=r.classList.contains("e-active"),i=function(s){return s.name+"!"+s.selectedRange}(this.parent.getActiveSheet()),n={address:i,wrap:t,cancel:!1};this.parent.notify(ue,{action:"beforeWrap",eventArgs:n}),n.cancel||(di(this.parent.getActiveSheet().selectedRange,t,this.parent),this.parent.notify(Z,{action:"wrap",eventArgs:{address:i,wrap:t}}))}},s.prototype.rowHeightChangedHandler=function(e){if(e.isCustomHgt)for(var r=this.parent.getActiveSheet(),t=void 0,i=this.parent.viewport.leftIndex,n=this.parent.viewport.rightIndex;i<=n;i++)E(e.rowIdx,i,r,!1,!0).wrap&&(t=this.parent.getCell(e.rowIdx,i),this.updateWrapCell(e.rowIdx,i,r,t),t.style.lineHeight&&(t.style.lineHeight=""))},s.prototype.colWidthChanged=function(e){if(e.checkWrapCell)for(var r=this.parent.getActiveSheet(),t=this.parent.viewport.topIndex,i=this.parent.viewport.bottomIndex;t<=i;t++)E(t,e.colIdx,r,!1,!0).wrap&&this.updateWrapCell(t,e.colIdx,r,this.parent.getCell(t,e.colIdx))},s.prototype.updateWrapCell=function(e,r,t,i){if(i&&!i.querySelector(".e-wrap-content")){for(var n=this.wrapCell.cloneNode(),a=i.querySelector(".e-filter-btn");i.childElementCount;)n.appendChild(i.firstElementChild);if(a&&(i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a)),!E(e,r,t,!1,!0).hyperlink){var o=i.lastChild;o&&3===o.nodeType?(n.appendChild(document.createTextNode(o.textContent)),o.textContent=""):(n.appendChild(document.createTextNode(i.textContent)),i.textContent="")}i.appendChild(n)}},s.prototype.getModuleName=function(){return"wrapText"},s.prototype.destroy=function(){this.removeEventListener(),this.wrapCell=null,this.parent=null},s}(),js=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.insert=function(e){var r=e.eventArgs;this.parent.notify(Di,r);var t=_(this.parent,r.activeSheetIndex);switch(r.modelType){case"Sheet":this.parent.notify(So,{startIdx:r.index,endIdx:r.index+(r.model.length-1),preventUpdate:!r.isAction}),this.parent.renderModule.refreshSheet();break;case"Row":if(r.activeSheetIndex===this.parent.activeSheetIndex){var i=this.parent.frozenRowCount(t);if(!this.parent.scrollSettings.enableVirtualization||r.index<=this.parent.viewport.bottomIndex)if(r.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else if(this.parent.scrollSettings.enableVirtualization){var n=this.parent.frozenColCount(t);if(r.index>=this.parent.viewport.topIndex+i){var a=[],o=void 0;n?(o=B(t.topLeftCell)[1],a.push(i),a.push(this.parent.viewport.leftIndex+n)):o=this.parent.viewport.leftIndex;var l=this.parent.viewport.leftIndex;this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,colIndex:o,refresh:"Row",frozenIndexes:a,skipUpdateOnFirst:this.parent.viewport.topIndex+i===U(t,i,!0)}),n&&(this.parent.viewport.leftIndex=l)}var h=B(t.paneTopLeftCell)[0];r.index<h&&(this.parent.notify(ga,{scrollTop:Ce(t,i,h-1,!0)}),this.parent.goTo(j(r.index,U(t,n,!0,"columns")))),this.parent.selectRange(t.selectedRange)}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:this.parent.viewport.topIndex,colIndex:0,refresh:"Row"}),this.parent.selectRange(t.selectedRange);else this.parent.scrollSettings.isFinite&&(this.parent.viewport.topIndex+i===U(t,0,!0)||this.parent.viewport.bottomIndex===U(t,t.rowCount-r.model.length-1,!1))&&this.parent.renderModule.refreshSheet(!1,!1,!0)}break;case"Column":if(r.activeSheetIndex===this.parent.activeSheetIndex)if(n=this.parent.frozenColCount(t),!this.parent.scrollSettings.enableVirtualization||r.index<=this.parent.viewport.rightIndex)if(r.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else if(this.parent.scrollSettings.enableVirtualization){if(i=this.parent.frozenRowCount(t),r.index>=this.parent.viewport.leftIndex+n){a=[],i&&(a=[i+this.parent.viewport.topIndex,n]);var p=i?B(t.topLeftCell)[0]:this.parent.viewport.topIndex,c=this.parent.viewport.topIndex;this.parent.renderModule.refreshUI({skipUpdateOnFirst:this.parent.viewport.leftIndex+n===U(t,n,!0,"columns"),rowIndex:p,colIndex:this.parent.viewport.leftIndex,refresh:"Column",frozenIndexes:a}),i&&(this.parent.viewport.topIndex=c)}var d=B(t.paneTopLeftCell)[1];r.index<d&&(this.parent.notify(ga,{scrollLeft:ge(t,0,d-1,!0)}),this.parent.goTo(j(U(t,i,!0),r.index))),this.parent.selectRange(t.selectedRange)}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,rowIndex:0,colIndex:this.parent.viewport.leftIndex,refresh:"Column"}),this.parent.selectRange(t.selectedRange);else this.parent.scrollSettings.isFinite&&(this.parent.viewport.leftIndex+n===U(t,0,!0,"columns")||this.parent.viewport.rightIndex===U(t,t.colCount-r.model.length-1,!1,"columns"))&&this.parent.renderModule.refreshSheet(!1,!1,!0)}this.refreshImgElement(r.model.length,this.parent.activeSheetIndex,r.modelType,r.index),r.isAction?(delete r.isAction,this.parent.notify(Z,e)):r.isUndoRedo||(r.isMethod=!0,this.parent.notify(Ci,e))},s.prototype.refreshImgElement=function(e,r,t,i){for(var a,n=this.parent.sheets[r],o=[0,0,n.usedRange.rowIndex,n.usedRange.colIndex],l=0;l<=o[2];l++)for(var h=o[1];h<=o[3];h++)(a=E(l,h,n))&&a.image&&a.image.length>0&&("Row"===t&&l>=i||"Column"===t&&h>=i)&&this.parent.notify(pa,{rowIdx:l,colIdx:h,sheetIdx:r,type:t,count:e,status:"insert"})},s.prototype.addEventListener=function(){this.parent.on(Qa,this.insert,this)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Qa,this.insert)},s.prototype.getModuleName=function(){return"insert"},s}(),Ys=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.delete=function(e){var r=e.eventArgs;if("Sheet"===r.modelType){var t=r.activeSheetIndex>=r.startIndex&&r.activeSheetIndex<=r.endIndex;t&&this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(r.startIndex<this.parent.sheets.length?r.startIndex:r.startIndex?r.startIndex-1:0)},!0),this.parent.notify(pr,null),t&&this.parent.renderModule.refreshSheet(!1,!1,!0)}else if(r.activeSheetIndex===this.parent.activeSheetIndex){var i=this.parent.getActiveSheet();if("Row"===r.modelType){if(!this.parent.scrollSettings.enableVirtualization||r.startIndex<=this.parent.viewport.bottomIndex)if(this.parent.scrollSettings.enableVirtualization){var n=this.parent.frozenRowCount(i);if(r.startIndex<B(i.paneTopLeftCell)[0])this.parent.updateTopLeftCell(U(i,r.startIndex-1<n?n:r.startIndex-1,!0)-n,null,"col"),this.parent.renderModule.refreshSheet(!1,!1,!0);else if(r.freezePane)this.parent.renderModule.refreshSheet(!1,!1,!0);else{var a=[],o=this.parent.frozenColCount(i),l=void 0,h=this.parent.viewport.leftIndex;o?(a.push(n),a.push(h+o),l=B(i.topLeftCell)[1]):l=h,this.parent.renderModule.refreshUI({rowIndex:this.parent.viewport.topIndex,refresh:"Row",colIndex:l,skipUpdateOnFirst:this.parent.viewport.topIndex+n===U(i,n,!0),frozenIndexes:a}),o&&(this.parent.viewport.leftIndex=h),this.parent.selectRange(i.selectedRange)}}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Row",rowIndex:this.parent.viewport.topIndex,colIndex:0}),this.parent.selectRange(i.selectedRange)}else{if(!1!==r.refreshSheet&&(!this.parent.scrollSettings.enableVirtualization||r.startIndex<=this.parent.viewport.rightIndex))if(o=this.parent.frozenColCount(i),this.parent.scrollSettings.enableVirtualization)if(r.startIndex<B(i.paneTopLeftCell)[1])this.parent.updateTopLeftCell(null,U(i,r.startIndex-1<o?o:r.startIndex-1,!0,"columns")-o,"row"),this.parent.renderModule.refreshSheet(!1,!1,!0);else if(r.freezePane||!0===r.refreshSheet)this.parent.renderModule.refreshSheet(!1,!1,!0);else{n=this.parent.frozenRowCount(i),a=[];var p=this.parent.viewport.topIndex,c=n?B(i.topLeftCell)[0]:p;n&&(a=[n+p,o]),this.parent.renderModule.refreshUI({rowIndex:c,refresh:"Column",colIndex:this.parent.viewport.leftIndex,insertDelete:!0,skipUpdateOnFirst:this.parent.viewport.leftIndex+o===U(i,o,!0,"columns"),frozenIndexes:a}),n&&(this.parent.viewport.topIndex=p),this.parent.selectRange(i.selectedRange)}else this.parent.renderModule.refreshUI({skipUpdateOnFirst:!0,refresh:"Column",rowIndex:0,colIndex:this.parent.viewport.leftIndex,insertDelete:!0}),this.parent.selectRange(i.selectedRange);delete r.refreshSheet}}this.refreshImgElement(r.deletedModel.length,this.parent.activeSheetIndex,r.modelType,r.startIndex),r.isAction?(delete r.isAction,this.parent.notify(Z,e)):r.isUndoRedo||(r.isMethod=!0,this.parent.notify(Ci,e))},s.prototype.addEventListener=function(){this.parent.on(Ja,this.delete,this)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.removeEventListener=function(){this.parent.isDestroyed||this.parent.off(Ja,this.delete)},s.prototype.getModuleName=function(){return"delete"},s.prototype.refreshImgElement=function(e,r,t,i){for(var a,n=this.parent.sheets[r],o=[0,0,n.usedRange.rowIndex,n.usedRange.colIndex],l=0;l<=o[2];l++)for(var h=o[1];h<=o[3];h++)(a=E(l,h,n))&&a.image&&a.image.length>0&&("Row"===t&&l>=i||"Column"===t&&h>=i)&&this.parent.notify(pa,{rowIdx:l,colIdx:h,sheetIdx:r,type:t,count:e,status:"delete"})},s}(),Xs=function(){function s(e){this.data=[],this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener();var e=(0,f.Ys)("#"+this.parent.element.id+"_datavalidation-popup");e&&e.remove(),this.parent=null},s.prototype.addEventListener=function(){f.bi.add(this.parent.element,"dblclick",this.listOpen,this),this.parent.on(Go,this.initiateDataValidationHandler,this),this.parent.on(_i,this.invalidDataHandler,this),this.parent.on(Ti,this.checkDataValidation,this),this.parent.on(St,this.listHandler,this),this.parent.on(lt,this.keyUpHandler,this),this.parent.on(ji,this.removeValidationHandler,this),this.parent.on(po,this.InvalidElementHandler,this)},s.prototype.removeEventListener=function(){f.bi.remove(this.parent.element,"dblclick",this.listOpen),this.parent.isDestroyed||(this.parent.off(Go,this.initiateDataValidationHandler),this.parent.off(_i,this.invalidDataHandler),this.parent.off(Ti,this.checkDataValidation),this.parent.off(St,this.listHandler),this.parent.off(lt,this.keyUpHandler),this.parent.off(ji,this.removeValidationHandler),this.parent.off(po,this.InvalidElementHandler))},s.prototype.removeValidationHandler=function(e){var r,t;if(e.range&&e.range.includes("!")){if(!(r=_(this.parent,ee(this.parent,(t=e.range).split("!")[0]))))return}else t=(r=this.parent.getActiveSheet()).name+"!"+(e.range||this.getRange(r.selectedRange));var i={range:t,cancel:!1};if(e.isAction&&this.parent.notify(ue,{eventArgs:i,action:"removeValidation"}),!i.cancel){var n=void 0,a=void 0,o=A(r.activeCell);if(r.name===this.parent.getActiveSheet().name){var l=Q(A(t));o[0]>=l[0]&&o[1]>=l[1]&&o[0]<=l[2]&&o[1]<=l[3]&&(n=(a=E(o[0],o[1],r,!1,!0)).validation&&"List"===a.validation.type)}if(this.parent.notify(sr,{range:t,isRemoveValidation:!0}),n&&!a.validation){var h=this.parent.getCell(o[0],o[1]);h&&h.getElementsByClassName("e-validation-list")[0]&&(this.listObj.destroy(),h.removeChild(h.getElementsByClassName("e-validation-list")[0]))}e.isAction&&(delete i.cancel,this.parent.notify(Z,{eventArgs:i,action:"removeValidation"}))}},s.prototype.keyUpHandler=function(e){var r=e.target,t=this.parent.element.querySelector(".e-datavalidation-dlg");if((0,f.oq)(r,".e-values")&&t&&13!==e.keyCode){var i=t.querySelector(".e-values"),n=i.querySelector(".e-dlg-error"),o=t.querySelector(".e-footer-content").querySelector(".e-primary");o.hasAttribute("disabled")&&o.removeAttribute("disabled"),n&&i.removeChild(n)}},s.prototype.listOpen=function(e){var r=e.target;this.listObj&&r.classList.contains("e-cell")&&r.querySelector(".e-validation-list")&&this.listObj.showPopup()},s.prototype.invalidDataHandler=function(e){var t,r={range:e.range||this.parent.dataValidationRange,cancel:!1};r.range&&(!e.isPublic&&(this.parent.notify(ue,t={eventArgs:r,action:e.isRemoveHighlight?"removeHighlight":"addHighlight"}),r.cancel)||(e.isRemoveHighlight?this.parent.removeInvalidHighlight(r.range):this.parent.addInvalidHighlight(r.range),e.isPublic||this.parent.notify(Z,t)))},s.prototype.listHandler=function(){var e=this;if(this.parent.allowDataValidation){var r=this.parent.getActiveSheet(),t=B(r.activeCell),i=E(t[0],t[1],r),n=this.parent.getCell(t[0],t[1]);if(!n)return;document.getElementsByClassName("e-validation-list")[0]&&((0,f.Od)(document.getElementsByClassName("e-validation-list")[0]),this.data=[]);var a=i&&i.validation||r.columns&&r.columns[t[1]]&&r.columns[t[1]].validation;if(a&&"List"===a.type){if(a.address&&!zl(a.address,t[0],t[1]))return;if(a.ignoreBlank=!!(0,f.le)(a.ignoreBlank)||a.ignoreBlank,a.inCellDropDown=!!(0,f.le)(a.inCellDropDown)||a.inCellDropDown,a.inCellDropDown){var o=this.parent.createElement("div",{className:"e-validation-list"}),l=this.parent.createElement("input",{id:this.parent.element.id+"listValid"});o.appendChild(l),a.inCellDropDown||(o.style.display="none");var h=n.getElementsByClassName("e-wrap-content")[0]||n;h.insertBefore(o,h.firstChild);var p=this.updateDataSource(i,a);this.listObj=new Rt.NB({index:this.setDropDownListIndex(p,i),dataSource:p,fields:{text:"text",value:"id"},width:"0px",popupHeight:"200px",change:function(){return e.listValueChange(e.listObj.text)},open:function(c){if(c.popup.offsetX=4-(n.offsetWidth-20),c.popup.offsetY=-13,c.popup.element.style.width=n.offsetWidth-1+"px",f.AR.isDevice&&e.parent.scrollModule){var d=e.parent.scrollModule.offset,u=e.parent.viewport;c.popup.offsetY+=u.topIndex?d.top.size-Ce(r,u.topIndex+1,d.top.idx,!0):0,c.popup.offsetX+=u.leftIndex?d.left.size-ge(r,u.leftIndex+1,d.left.idx,!0):0,c.popup.refresh()}},close:function(){return K(e.parent.element)}}),this.listObj.appendTo("#"+this.parent.element.id+"listValid")}}i&&i.validation&&(i.validation=a)}},s.prototype.setDropDownListIndex=function(e,r){if(r&&r.value)for(var t=0,i=e.length;t<i;t++)if(e[t].text===r.value.toString())return t;return null},s.prototype.updateDataSource=function(e,r){var t=this;this.data=[];var i=0,n=this.parent.definedNames,a=r.value1,o=-1!==a.indexOf("=");if(n.length>0&&o)for(var l=a.split("=")[1],h=0,p=n.length;h<p;h++)if(n[h].name===l){for(var c=n[h].refersTo;c.includes("'");)c=c.replace("'","");a=c}if(o){var d=a.indexOf("!")>-1?_(this.parent,ee(this.parent,a.split("=")[1].split("!")[0])):this.parent.getActiveSheet(),u=a.indexOf("!")>-1?a.split("!")[1]:a.split("=")[1],v=this.parent.getActiveSheet();if(d.name!==v.name){var g,m=A(v.selectedRange);d.ranges.forEach(function(F){F.info&&F.info.loadedRange&&F.info.loadedRange.length||(g=!0)}),g&&(this.parent.showSpinner(),Zt(this.parent,d.name+"!"+u).then(function(){if(t.parent.hideSpinner(),v.name===t.parent.getActiveSheet().name){var F=A(t.parent.getActiveSheet().selectedRange);F[0]===m[0]&&F[1]===m[1]&&(t.listObj.dataSource=t.updateDataSource(e,r),t.listObj.dataBind())}}))}var y=void 0,C=u.split(":");if(C[0].match(/[a-z]+$/gi)&&C[1].match(/[a-z]+$/gi)||C[0].match(/^[0-9]/g)&&C[1].match(/^[0-9]/g)){var b=this.parent.getIndexes(u);y=b.isCol?[0,b.startIdx,d.usedRange.rowIndex,b.startIdx]:[b.startIdx,0,b.startIdx,d.usedRange.colIndex]}else y=A(u);for(var S=y[0];S<=y[2];S++){d.rows[S]||dt(d,S,{});for(var w=y[1];w<=y[3];w++){d.rows[S].cells||ce(S,w,d,{}),i+=1;var x=this.parent.getDisplayText(e=d.rows[S].cells[w])||"";this.data.push({text:x,id:"list-"+i})}}}else{var I=a.split(",");for(h=0;h<I.length;h++)this.data.push({text:I[h],id:"list-"+(i+=1)})}return this.data},s.prototype.listValueChange=function(e){this.parent.notify(cr,{action:"refreshFormulabar",value:e});var r=this.parent.getActiveSheet(),t=De(r.activeCell),i=Object.assign({},E(t[0],t[1],r));r.isProtected&&ur(i,Fe(r,t[1]))?this.parent.notify(Nt,null):(this.parent.isEdit&&this.parent.closeEdit(),Je(this.parent,r,{cell:{value:e},rowIdx:t[0],colIdx:t[1],valChange:!0,lastCell:!0,uiRefresh:!0,checkCF:!0}),this.parent.notify(Z,{action:"cellSave",eventArgs:{value:e,oldValue:i.value,address:r.name+"!"+r.activeCell}}))},s.prototype.getRange=function(e){var r=A(e),t=this.parent.getActiveSheet(),n=t.colCount;return r[2]===t.rowCount-1&&0===r[0]?e=e.replace(/[0-9]/g,""):r[3]===n-1&&0===r[2]&&(e=e.replace(/\D/g,"")),e},s.prototype.initiateDataValidationHandler=function(e,r){var n,a,o,l,u,t=this,i=this.parent.serviceLocator.getService(O),h=!0,p=!0,c=!0,d=this.parent.getActiveSheet(),v=d.selectedRange,g=Q(A(v));v=this.getRange(v);var m=this.validateRange(g,d);if(!m.extendValidation&&!m.moreValidation||e){for(var y=g[0];y<=g[2];y++)if(d.rows[y])for(var C=g[1];C<=g[3];C++)d.rows[y].cells&&d.rows[y].cells[C]&&(u=d.rows[y].cells[C]).validation&&(c=!1,n=u.validation.type,a=u.validation.operator,o=u.validation.value1,l=u.validation.value2,h=(0,f.le)(u.validation.ignoreBlank)?h:u.validation.ignoreBlank,p=(0,f.le)(u.validation.inCellDropDown)?p:u.validation.inCellDropDown);if(c)for(var b=g[1];b<=g[3];b++){var S=Fe(d,b);S&&S.validation&&(c=!1,n=S.validation.type,a=S.validation.operator,o=S.validation.value1,l=S.validation.value2,h=(0,f.le)(S.validation.ignoreBlank)?h:S.validation.ignoreBlank,p=(0,f.le)(S.validation.inCellDropDown)?p:S.validation.inCellDropDown)}if(!this.parent.element.querySelector(".e-datavalidation-dlg")){var w=this.parent.serviceLocator.getService(ae);w.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-datavalidation-dlg",header:i.getConstant("DataValidation"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(x){var I={dialogName:"ValidationDialog",element:x.element,target:x.target,cancel:x.cancel};t.parent.trigger("dialogBeforeOpen",I),I.cancel&&(x.cancel=!0),r&&(c=!0),w.dialogInstance.content=t.dataValidationContent(c,n,a,o,l,h,p,v),w.dialogInstance.dataBind(),K(t.parent.element)},buttons:[{buttonModel:{content:i.getConstant("CLEARALL"),cssClass:"e-btn e-clearall-btn e-flat"},click:function(){w.dialogInstance.content=t.dataValidationContent(!0,n,a,o,l,h,p,v),w.dialogInstance.dataBind(),K(t.parent.element)}},{buttonModel:{content:i.getConstant("APPLY"),isPrimary:!0},click:function(){t.dlgClickHandler(w)}}]}),w.dialogInstance.refresh()}}else m.moreValidation&&this.moreValidationDlg(),m.extendValidation&&this.extendValidationDlg()},s.prototype.dataValidationContent=function(e,r,t,i,n,a,o,l){var h=this,p=this.parent.serviceLocator.getService(O),c=e?"0":i,d=e?"0":n,u=this.parent.createElement("div",{className:"e-validation-dlg"}),v=this.parent.createElement("div",{className:"e-cellrange"}),g=this.parent.createElement("div",{className:"e-allowdata"}),m=this.parent.createElement("div",{className:"e-values"}),y=this.parent.createElement("div",{className:"e-ignoreblank"});u.appendChild(v),u.appendChild(g),u.appendChild(m),u.appendChild(y);var C=this.parent.createElement("span",{className:"e-header",innerHTML:p.getConstant("CellRange")}),b=this.parent.createElement("input",{className:"e-input",attrs:{value:l,"aria-label":p.getConstant("CellRange")}});v.appendChild(C),v.appendChild(b);var S=this.parent.createElement("div",{className:"e-allow"}),w=this.parent.createElement("div",{className:"e-data"});g.appendChild(S),g.appendChild(w);var x=this.parent.createElement("span",{className:"e-header",innerHTML:p.getConstant("Allow")});this.typeData=[{text:p.getConstant("WholeNumber"),id:"type-1"},{text:p.getConstant("Decimal"),id:"type-2"},{text:p.getConstant("Date"),id:"type-3"},{text:p.getConstant("Time"),id:"type-4"},{text:p.getConstant("TextLength"),id:"type-5"},{text:p.getConstant("List"),id:"type-6"}],this.operatorData=[{text:p.getConstant("Between"),id:"operator-1"},{text:p.getConstant("NotBetween"),id:"operator-2"},{text:p.getConstant("EqualTo"),id:"operator-3"},{text:p.getConstant("NotEqualTo"),id:"operator-4"},{text:p.getConstant("Greaterthan"),id:"operator-5"},{text:p.getConstant("Lessthan"),id:"operator-6"},{text:p.getConstant("GreaterThanOrEqualTo"),id:"operator-7"},{text:p.getConstant("LessThanOrEqualTo"),id:"operator-8"}];var I=this.parent.createElement("input",{className:"e-select"}),F=0;if(!e)for(var T=0;T<this.typeData.length;T++)if(r===this.typeData[T].text.replace(" ","")){F=T;break}if(e||"List"!==r){var k=0,R=this.parent.createElement("span",{className:"e-header",innerHTML:p.getConstant("Data")}),D=this.parent.createElement("input",{className:"e-select"});if(!e)for(T=0;T<this.operatorData.length;T++)if(t===this.FormattedValue(this.operatorData[T].text)){k=T;break}w.appendChild(R),w.appendChild(D),this.dataList=new Rt.NB({dataSource:this.operatorData,index:k,popupHeight:"200px",change:function(){h.userInput(M,h.dataList)}}),this.dataList.appendTo(D)}else{var N=this.parent.createElement("input",{className:"e-checkbox"});w.appendChild(N),new at.Jg({label:p.getConstant("InCellDropDown"),checked:o}).appendTo(N)}S.appendChild(x),S.appendChild(I);var M=new Rt.NB({dataSource:this.typeData,index:F,popupHeight:"200px",change:function(){h.userInput(M,h.dataList)}});if(M.appendTo(I),e||"List"!==M.value&&("Between"===this.dataList.value||"Not between"===this.dataList.value)){var V=this.parent.createElement("div",{className:"e-minimum"}),Y=this.parent.createElement("div",{className:"e-maximum"});m.appendChild(V),m.appendChild(Y);var X=this.parent.createElement("span",{className:"e-header",innerHTML:p.getConstant("Minimum")}),G=this.parent.createElement("span",{className:"e-header",innerHTML:p.getConstant("Maximum")}),$=this.parent.createElement("input",{id:"minvalue",className:"e-input",attrs:{value:c,"aria-label":p.getConstant("Minimum")}}),J=this.parent.createElement("input",{id:"maxvalue",className:"e-input",attrs:{value:d,"aria-label":p.getConstant("Maximum")}});V.appendChild(X),V.appendChild($),Y.appendChild(G),Y.appendChild(J),new bt.No({value:0}).appendTo("#minvalue"),new bt.No({value:0}).appendTo("#maxvalue")}else if(e||" List"!==r)Le=this.parent.createElement("span",{className:"e-header",innerHTML:p.getConstant("Value")}),be=this.parent.createElement("input",{className:"e-input",attrs:{value:c}}),m.appendChild(Le),m.appendChild(be);else{var Le=this.parent.createElement("span",{className:"e-header",innerHTML:p.getConstant("Sources")}),be=this.parent.createElement("input",{className:"e-input",attrs:{value:c}});m.appendChild(Le),m.appendChild(be)}var Ae=a,Ie=this.parent.createElement("input",{className:"e-checkbox"});return y.appendChild(Ie),new at.Jg({label:p.getConstant("IgnoreBlank"),checked:Ae}).appendTo(Ie),u},s.prototype.validateRange=function(e,r){for(var t=!1,i=!1,n=[],a=[],o=[],l=[],h=e[0];h<=e[2];h++)if(r.rows[h])for(var p=e[1];p<=e[3];p++)r.rows[h].cells&&r.rows[h].cells[p]&&(c=r.rows[h].cells[p]).validation&&(n.push(c.validation.type),a.push(c.validation.operator),o.push(c.validation.value1),l.push(c.validation.value2));for(var d=e[1];d<=e[3];d++)(u=Fe(r,d))&&u.validation&&(n.push(u.validation.type),a.push(u.validation.operator),o.push(u.validation.value1),l.push(u.validation.value2));var v=[];for(d=0;d<n.length;d++)-1===v.indexOf(n[d])&&v.push(n[d]);if(v.length>1&&(t=!0),!t){v=[];for(var g=0;g<a.length;g++)-1===v.indexOf(a[g])&&v.push(a[g]);v.length>1&&(t=!0)}if(!t){for(v=[],g=0;g<o.length;g++)-1===v.indexOf(o[g])&&v.push(o[g]);v.length>1&&(t=!0)}if(!t){for(v=[],g=0;g<l.length;g++)-1===v.indexOf(l[g])&&v.push(l[g]);v.length>1&&(t=!0)}if(!t){for(var m=0,y=0,C=e[0];C<=e[2];C++)if(r.rows[C])for(p=e[1];p<=e[3];p++)if(r.rows[C].cells&&r.rows[C].cells[p]){var c;y++,(c=r.rows[C].cells[p]).validation&&m++}if(0===m)for(d=e[1];d<=e[3];d++){var u;(u=Fe(r,d))&&u.validation&&m++}m>0&&y>1&&m!==y&&(i=!0)}return{moreValidation:t,extendValidation:i}},s.prototype.moreValidationDlg=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.serviceLocator.getService(ae),i=!1,n={width:350,isModal:!0,showCloseIcon:!0,cssClass:"e-goto-dlg",header:r.getConstant("Spreadsheet"),beforeOpen:function(a){var o={dialogName:"MoreValidation",element:a.element,target:a.target,cancel:a.cancel};e.parent.trigger("dialogBeforeOpen",o),o.cancel&&(a.cancel=!0),t.dialogInstance.content=r.getConstant("MoreValidation"),t.dialogInstance.dataBind(),K(e.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){t.hide(),i=!0}}],close:function(){i?(e.initiateDataValidationHandler(!0),i=!1):t.hide()}};t.show(n)},s.prototype.extendValidationDlg=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.serviceLocator.getService(ae),i=!1,n=!1,a={width:550,isModal:!0,showCloseIcon:!0,cssClass:"e-goto-dlg",header:r.getConstant("Spreadsheet"),beforeOpen:function(o){var l={dialogName:"ExtendValidation",element:o.element,target:o.target,cancel:o.cancel};e.parent.trigger("dialogBeforeOpen",l),l.cancel&&(o.cancel=!0),t.dialogInstance.content=r.getConstant("ExtendValidation"),t.dialogInstance.dataBind(),K(e.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Yes"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){t.hide(),i=!0}},{buttonModel:{content:r.getConstant("No"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){t.hide(),i=!0,n=!0}}],close:function(){i?(e.initiateDataValidationHandler(!0,n),i=!1):t.hide()}};t.show(a)},s.prototype.userInput=function(e,r){for(var i=this.parent.element.querySelector(".e-datavalidation-dlg").querySelector(".e-validation-dlg"),n=i.querySelector(".e-allowdata"),a=i.querySelector(".e-values"),o=this.parent.serviceLocator.getService(O),l=n.querySelector(".e-data");a.lastChild;)a.removeChild(a.lastChild);if("List"===e.value){for(;l.lastChild;)l.removeChild(l.lastChild);var h=this.parent.createElement("input",{className:"e-checkbox"});l.appendChild(h),new at.Jg({label:o.getConstant("InCellDropDown"),checked:!0}).appendTo(h)}else if(l.getElementsByClassName("e-checkbox-wrapper")[0]){for(;l.lastChild;)l.removeChild(l.lastChild);var c=this.parent.createElement("span",{className:"e-header",innerHTML:"Data"}),d=this.parent.createElement("input",{className:"e-select"});l.appendChild(c),l.appendChild(d),r.appendTo(d)}if("List"===e.value||"Between"!==r.value&&"Not between"!==r.value){var w=o.getConstant("List"===e.value?"Sources":"Value"),x=this.parent.createElement("span",{className:"e-header",innerHTML:w}),I=this.parent.createElement("input","List"===e.value?{className:"e-input",attrs:{placeholder:"Enter value"}}:{className:"e-input",attrs:{value:"0"}});a.appendChild(x),a.appendChild(I)}else{var u=this.parent.createElement("div",{className:"e-minimum"}),v=this.parent.createElement("div",{className:"e-maximum"});a.appendChild(u),a.appendChild(v);var g=this.parent.createElement("span",{className:"e-header",innerHTML:o.getConstant("Minimum")}),m=this.parent.createElement("span",{className:"e-header",innerHTML:o.getConstant("Maximum")}),y=this.parent.createElement("input",{id:"min",className:"e-input",attrs:{value:"0"}}),C=this.parent.createElement("input",{id:"max",className:"e-input",attrs:{value:"0"}});new bt.No({value:0}).appendTo("min"),new bt.No({value:0}).appendTo("max"),u.appendChild(g),u.appendChild(y),v.appendChild(m),v.appendChild(C)}},s.prototype.dlgClickHandler=function(e){var t,m,r=this.parent.serviceLocator.getService(O),i=this.parent.element.querySelector(".e-datavalidation-dlg"),n=i.querySelector(".e-footer-content"),a=i.getElementsByClassName("e-dlg-content")[0].getElementsByClassName("e-validation-dlg")[0],o=a.getElementsByClassName("e-allowdata")[0],l=o.getElementsByClassName("e-allow")[0].getElementsByTagName("input")[0],h=o.getElementsByClassName("e-data")[0].getElementsByTagName("input")[0],p=a.getElementsByClassName("e-values")[0],c=p.getElementsByTagName("input")[0].value,d=p.getElementsByTagName("input")[1]?p.getElementsByTagName("input")[1].value:"",u=a.querySelector(".e-ignoreblank .e-checkbox").checked,v=o.querySelector(".e-data").querySelector(".e-checkbox-wrapper")?!!o.querySelector(".e-data").querySelector(".e-checkbox-wrapper").querySelector(".e-check"):null,g=a.querySelector(".e-cellrange").getElementsByTagName("input")[0].value,y=l.value;h&&(m=this.FormattedValue(m=h.value)),y&&(y=y.replace(" ",""));var C=[],b=[];""!==c&&b.push(c),""!==d&&b.push(d);var S=!0;if("List"===y)if(-1!==c.indexOf("=")){if(-1!==c.indexOf(":")){var w=c.indexOf("!")>-1?c.split("!")[1]:c.split("=")[1],x=!(c.indexOf("!")>-1)||ee(this.parent,c.split("=")[1].split("!")[0])>-1;C=w.split(":");var I=!!w.match(/[a-z]/gi)&&C[0].replace(/[0-9]/g,"")===C[1].replace(/[0-9]/g,""),F=!!w.match(/\d/g)&&C[0].replace(/\D/g,"")===C[1].replace(/\D/g,"");(S=!(!x||!I&&!F))||(t=r.getConstant("DialogError"))}}else c.length>256&&(S=!1,t=r.getConstant("ListLengthError"));if(S){var T=this.parent.getActiveSheet(),R=this.isDialogValidator(b,y,m);if("Between"===m&&!isNaN(parseFloat(c))&&!isNaN(parseFloat(d))&&parseFloat(c)>parseFloat(d)&&(R.isValidate=!1,R.errorMsg=r.getConstant("MinMaxError")),t=R.errorMsg,S=R.isValidate){var D=B(T.activeCell),N=E(D[0],D[1],T,!1,!0),P=N.validation&&"List"===N.validation.type,M={range:T.name+"!"+g,value1:c,value2:d,ignoreBlank:u,type:y,operator:m,inCellDropDown:v,cancel:!1};if(this.parent.notify(ue,{eventArgs:M,action:"validation"}),!M.cancel){if(this.parent.notify(sr,{rules:{type:M.type,operator:M.operator,value1:M.value1,value2:d,ignoreBlank:M.ignoreBlank,inCellDropDown:M.inCellDropDown},range:M.range}),(N=E(D[0],D[1],T,!1,!0)).validation){if(P){var V=this.parent.getCell(D[0],D[1]);V&&V.getElementsByClassName("e-validation-list")[0]&&(this.listObj.destroy(),V.removeChild(V.getElementsByClassName("e-validation-list")[0]))}"List"===N.validation.type&&this.listHandler()}delete M.cancel,document.getElementsByClassName("e-validationerror-dlg")[0]||(e.dialogInstance?e.dialogInstance.hide():e.hide()),this.parent.notify(Z,{eventArgs:M,action:"validation"})}}}if(!S){var Y=this.parent.createElement("div",{className:"e-dlg-error",id:"e-invalid",innerHTML:t});p.appendChild(Y),n.querySelector(".e-primary").setAttribute("disabled","true")}},s.prototype.FormattedValue=function(e){switch(e){case"Between":default:e="Between";break;case"Not between":e="NotBetween";break;case"Equal to":e="EqualTo";break;case"Not equal to":e="NotEqualTo";break;case"Greater than":e="GreaterThan";break;case"Less than":e="LessThan";break;case"Greater than or equal to":e="GreaterThanOrEqualTo";break;case"Less than or equal to":e="LessThanOrEqualTo"}return e},s.prototype.isDialogValidator=function(e,r,t){var o,i=this.parent.serviceLocator.getService(O),n=0;if("List"===r?e.length>0:"Between"===t||"NotBetween"===t?2===e.length:e.length>0){for(var l=0;l<e.length;l++){var h=pe(e[l])?this.parent.computeExpression(e[l]).toString():e[l];if(!(o=this.formatValidation(h,r,!0)).isValidate)break;n+=1}o.isValidate=n===e.length}else o={isValidate:!1,errorMsg:i.getConstant("EmptyError")};return{isValidate:o.isValidate,errorMsg:o.errorMsg}},s.prototype.isValidationHandler=function(e){var r=this.parent.serviceLocator.getService(O);e.value=e.value?e.value:"";var t,i,o,n=e.value,a=this.parent.sheets[e.sheetIdx],l=E(e.range[0],e.range[1],a),h=Fe(a,e.range[1]);if(l&&l.validation?o=l.validation:Ql(h,e.range[0],e.range[1])&&(o=h.validation),o){var p=o.value1,c=o.value2;pe(p)&&"List"!==o.type&&(p=this.parent.computeExpression(p).toString()),pe(c)&&"List"!==o.type&&(c=this.parent.computeExpression(c).toString()),pe(e.value)&&"List"!==o.type&&(e.value=this.parent.computeExpression(e.value).toString());var d=e.value,u=o.operator||"Between",v=o.type||"WholeNumber",g=!!(0,f.le)(o.ignoreBlank)||o.ignoreBlank,m=this.formatValidation(e.value,v);if(i=m.errorMsg,t=m.isValidate){if(t=!1,"Date"===v||"Time"===v){e.value=e.value.toString().slice(e.value.toString().indexOf(" ")+1,e.value.length);for(var y=0;y<3;y++){e.value=0===y?e.value:1===y?p:c;var C={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""};""!==e.value&&this.parent.notify(Tt,C);var b=C.updatedVal;0===y&&""===b?d=e.value:0===y?d=b:1===y?p=b:c=b}}else"TextLength"===o.type&&(this.parent.notify(Tt,C={value:e.value,rowIndex:e.range[0],colIndex:e.range[1],sheetIndex:e.sheetIdx,updatedVal:""}),d=""!==(b=C.updatedVal)?b.toString().length.toString():e.value.toString().length.toString());if("List"===v){if(-1!==p.indexOf("="))for(y=0;y<this.data.length;y++)e.value.toString()===this.data[y].text&&(t=!0);else{var S=p.split(",");for(y=0;y<S.length;y++)e.value.toString()===S[y]&&(t=!0)}!t&&g&&""===e.value.toString()&&(t=!0)}else switch("Decimal"===v||"Time"===v?(d=parseFloat(d.toString()),p=parseFloat(p.toString()),c=c?parseFloat(c.toString()):null):(d=parseInt(d.toString(),10),p=parseInt(p.toString(),10),c=c?parseInt(c.toString(),10):null),u){case"EqualTo":t=!!(d===p||g&&""===n);break;case"NotEqualTo":t=!!(d!==p||g&&""===n);break;case"Between":t=!!(d>=p&&d<=c||g&&""===n);break;case"NotBetween":t=!(d>=p&&d<=c);break;case"GreaterThan":t=!!(d>p||g&&""===n);break;case"LessThan":t=!!(d<p||g&&""===n);break;case"GreaterThanOrEqualTo":t=!!(d>=p||g&&""===n);break;case"LessThanOrEqualTo":t=!!(d<=p||g&&""===n)}}}if(i=r.getConstant("ValidationError"),t&&l&&l.validation&&l.validation.isHighlighted){var w=this.parent.getCellStyleValue(["backgroundColor","color"],[e.range[0],e.range[1]]);ne(a,e.range[0])||this.parent.notify(He,{style:w,rowIdx:e.range[0],colIdx:e.range[1],isHeightCheckNeeded:!0,manualUpdate:!0,onActionUpdate:!0,cell:e.td})}return{isValidate:t,errorMsg:i}},s.prototype.checkDataValidation=function(e){var r=E(e.range[0],e.range[1],this.parent.getActiveSheet());e.td=e.td||this.parent.getCell(e.range[0],e.range[1]),e.sheetIdx=e.sheetIdx||this.parent.activeSheetIndex;var t={skip:!1,value:""};if(r&&r.validation){if(pe(r.validation.value1)&&!nt(r.validation.value1.substring(1,r.validation.value1.length))&&r.validation.value1.indexOf("(")>-1){var i=r.validation.value1;i=i.substring(i.indexOf("=")+1,i.indexOf("(")),t.value=i.toUpperCase(),this.parent.notify(mn,t)}if(!t.skip&&pe(r.validation.value2)&&!nt(r.validation.value2.substring(1,r.validation.value2.length))&&r.validation.value1.indexOf("(")>-1){var n=r.validation.value2;n=n.substring(n.indexOf("=")+1,n.indexOf("(")),t.value=n.toUpperCase(),this.parent.notify(mn,t)}}if(!t.skip){var a=this.isValidationHandler({value:e.value,range:e.range,sheetIdx:e.sheetIdx,td:e.td});!a.isValidate&&e.isCell&&this.validationErrorHandler(a.errorMsg),e.isValid=a.isValidate}},s.prototype.formatValidation=function(e,r,t){var n,l,i=this.parent.element.getElementsByClassName("e-sheet-panel")[0],a=this.parent.createElement("form",{id:"formId",className:"form-horizontal"}),o=this.parent.createElement("input",{id:"e-validation",innerHTML:e});switch(o.setAttribute("name","validation"),o.setAttribute("type","text"),o.setAttribute("value",e),a.appendChild(o),i.appendChild(a),r){case"Date":l={rules:{validation:{date:!0}},customPlacement:function(c,d){n=d.innerText}};break;case"Decimal":l={rules:{validation:{number:!0}},customPlacement:function(c,d){n=d.innerText}};break;case"WholeNumber":l={rules:{validation:{regex:/^-?\d*\.?[0]*$/}},customPlacement:function(c,d){n=d.innerText}};break;case"TextLength":t&&(l={rules:{validation:{regex:/^\d*\.?[0]*$/}},customPlacement:function(c,d){n=d.innerText}})}var p=new bt.Tl("#formId",l).validate();return i.removeChild(i.getElementsByClassName("form-horizontal")[0]),{isValidate:p,errorMsg:n}},s.prototype.InvalidElementHandler=function(e){var r=e.rowIdx,t=e.colIdx,i=e.isRemoveHighlightedData;if(i){if(i){var n=this.parent.getCellStyleValue(["backgroundColor","color"],[r,t]);this.parent.notify(He,{style:n,rowIdx:r,colIdx:t,cell:e.td})}}else this.parent.notify(He,{style:{backgroundColor:"#ffff00",color:"#ff0000"},rowIdx:r,colIdx:t,cell:e.td})},s.prototype.validationErrorHandler=function(e){var r=this,t=document.getElementsByClassName("e-spreadsheet-edit")[0],i=this.parent.serviceLocator.getService(O);if(!this.parent.element.querySelector(".e-validationerror-dlg")){var n=this.parent.serviceLocator.getService(ae),o={width:400,height:200,isModal:!0,showCloseIcon:!0,cssClass:"e-validationerror-dlg",target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(l){var h={dialogName:"ValidationErrorDialog",element:l.element,target:l.target,cancel:l.cancel,content:e};r.parent.trigger("dialogBeforeOpen",h),h.cancel&&(r.errorDlgHandler(n,"Cancel"),l.cancel=!0),t.focus(),n.dialogInstance.content=h.content,n.dialogInstance.dataBind()},buttons:[{buttonModel:{content:i.getConstant("Retry"),isPrimary:!0},click:function(){r.errorDlgHandler(n,"Retry")}},{buttonModel:{content:i.getConstant("Cancel")},click:function(){r.errorDlgHandler(n,"Cancel")}}]};n.show(o,!1)}},s.prototype.errorDlgHandler=function(e,r){if("Retry"===r){var t=document.getElementsByClassName("e-spreadsheet-edit")[0];e.hide(),t.innerText&&(window.getSelection().selectAllChildren(t),this.listObj&&this.listObj.showPopup())}else{var i=B(this.parent.getActiveSheet().activeCell),n=E(i[0],i[1],this.parent.getActiveSheet()),a=n?this.parent.getDisplayText(n):"";this.parent.notify(fe,{action:"cancelEdit",value:a,refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!1,trigEvent:!0}),e.hide()}},s.prototype.getModuleName=function(){return"dataValidation"},s}(),Zs=function(){function s(e){this.password="",this.parent=e,this.init()}return s.prototype.init=function(){this.addEventListener()},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(Wi,this.protect,this),this.parent.on(ni,this.protectSheetHandler,this),this.parent.on(Nt,this.editProtectedAlert,this),this.parent.on(fa,this.protectWorkbook,this),this.parent.on(lt,this.KeyUpHandler,this),this.parent.on(ua,this.unProtectWorkbook,this),this.parent.on(vs,this.unProtectSheetPassword,this),this.parent.on(Ml,this.getPassWord,this),this.parent.on(hs,this.importProtectWorkbook,this),this.parent.on(ss,this.protectWorkbookHandler,this),this.parent.on(ls,this.removeWorkbookProtection,this),this.parent.on(ya,this.toggleProtect,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Wi,this.protect),this.parent.off(ni,this.protectSheetHandler),this.parent.off(Nt,this.editProtectedAlert),this.parent.off(fa,this.protectWorkbook),this.parent.off(lt,this.KeyUpHandler),this.parent.off(ua,this.unProtectWorkbook),this.parent.off(vs,this.unProtectSheetPassword),this.parent.off(Ml,this.getPassWord),this.parent.off(hs,this.importProtectWorkbook),this.parent.off(ss,this.protectWorkbookHandler),this.parent.off(ls,this.removeWorkbookProtection),this.parent.off(ya,this.toggleProtect))},s.prototype.protect=function(e){this.parent.notify(ti,null),e.isActive?(this.parent.setSheetPropertyOnMute(_(this.parent,e.sheetIndex),"isProtected",!1),this.parent.notify(Tr,{props:"Protect"}),this.parent.notify(ni,e),this.parent.notify(aa,null)):this.createDialogue()},s.prototype.createDialogue=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=[{text:r.getConstant("SelectCells"),id:"1"},{text:r.getConstant("SelectUnLockedCells"),id:"6"},{text:r.getConstant("FormatCells"),id:"2"},{text:r.getConstant("FormatRows"),id:"3"},{text:r.getConstant("FormatColumns"),id:"4"},{text:r.getConstant("InsertLinks"),id:"5"}];this.optionList=new an.Bv({width:"250px",dataSource:t,showCheckBox:!0,select:this.dialogOpen.bind(this)});var i=this.parent.createElement("div",{className:"e-sheet-password-dialog"}),n=this.parent.createElement("div",{className:"e-sheet-password-content"}),a=this.parent.createElement("div",{className:"e-header",innerHTML:r.getConstant("SheetPassword")}),o=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});o.setAttribute("placeholder",r.getConstant("EnterThePassword")),n.appendChild(o),n.insertBefore(a,o),i.appendChild(n);var l=this.parent.createElement("div",{className:"e-protect-content",innerHTML:r.getConstant("ProtectAllowUser")});this.parent.setSheetPropertyOnMute(this.parent.getActiveSheet(),"isProtected",!1);var h=new at.Jg({checked:!0,label:r.getConstant("ProtectContent"),cssClass:"e-protect-checkbox"}),p=this.parent.createElement("div",{className:"e-protect-option-list",id:this.parent.element.id+"_option_list"}),c=this.parent.createElement("div",{className:"e-header-content",innerHTML:r.getConstant("ProtectSheet")}),d=this.parent.createElement("input",{id:this.parent.element.id+"_protect_check",attrs:{type:"checkbox"}});this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({header:c.outerHTML,content:i.outerHTML+d.outerHTML+l.outerHTML+p.outerHTML,showCloseIcon:!0,isModal:!0,cssClass:"e-protect-dlg",beforeOpen:function(u){var v={dialogName:"ProtectSheetDialog",element:u.element,target:u.target,cancel:u.cancel};e.parent.trigger("dialogBeforeOpen",v),v.cancel&&(u.cancel=!0),K(e.parent.element)},open:function(){e.okBtnFocus()},beforeClose:function(){var u=document.getElementById(e.parent.element.id+"_protect_check");f.bi.remove(u,"focus",e.okBtnFocus),f.bi.remove(h.element,"click",e.checkBoxClickHandler),K(e.parent.element)},buttons:[{click:this.selectOption.bind(this,this.dialog,this),buttonModel:{content:r.getConstant("Ok"),isPrimary:!0}},{click:function(){return e.dialog.hide()},buttonModel:{content:r.getConstant("Cancel")}}]},!1),h.appendTo("#"+this.parent.element.id+"_protect_check"),this.optionList.appendTo("#"+this.parent.element.id+"_option_list"),this.optionList.selectMultipleItems([{id:"1"},{id:"6"}]),f.bi.add(h.element,"click",this.checkBoxClickHandler,this)},s.prototype.okBtnFocus=function(){var e=this;document.getElementById(this.parent.element.id+"_protect_check").addEventListener("focus",function(){e.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()})},s.prototype.checkBoxClickHandler=function(){!1===document.getElementById(this.parent.element.id+"_protect_check").checked?this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!0:(this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").disabled=!1,this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus())},s.prototype.dialogOpen=function(e){var r=this.parent.serviceLocator.getService(O);e.text===r.getConstant("SelectCells")&&e.isChecked&&e.isInteracted&&this.optionList.checkItem({id:"6"}),e.text===r.getConstant("SelectUnLockedCells")&&!e.isChecked&&e.isInteracted&&this.optionList.uncheckItem({id:"1"}),this.dialog.dialogInstance.element.getElementsByClassName("e-footer-content")[0].querySelector("button").focus()},s.prototype.selectOption=function(){var e=this.parent.getActiveSheet(),r=this.parent.element.querySelector(".e-sheet-password-dialog").getElementsByClassName("e-sheet-password-content")[0].querySelector(".e-input");0===r.value.length?(this.parent.setSheetPropertyOnMute(e,"isProtected",!0),this.parent.setSheetPropertyOnMute(e,"password",r.value),this.updateProtectSheet(r.value),this.dialog.hide(),e.protectSettings.selectCells||e.protectSettings.selectUnLockedCells?e.protectSettings.selectUnLockedCells&&Qt(this.parent,A(e.selectedRange))&&this.parent.notify(fr,null):this.parent.notify(fr,null)):this.reEnterSheetPassword()},s.prototype.selectSheetPassword=function(){var e=this.parent.serviceLocator.getService(O),r=this.parent.getActiveSheet(),t=this.parent.element.querySelector(".e-sheet-password-dialog").getElementsByClassName("e-sheet-password-content")[0].querySelector(".e-input"),i=this.parent.element.querySelector(".e-reenterpwd-dialog").getElementsByClassName("e-reenterpwd-content")[0].querySelector(".e-input"),n=this.parent.createElement("span",{className:"e-reenterpwd-alert-span"});if(t.value===i.value){this.parent.setSheetPropertyOnMute(r,"isProtected",!0),this.parent.setSheetPropertyOnMute(r,"password",t.value),this.updateProtectSheet(t.value),this.dialog.hide();var a=document.querySelector(".e-protect-dlg.e-dialog");(0,f.Xr)(a,"dialog").destroy(),!r.protectSettings.selectCells&&!r.protectSettings.selectUnLockedCells&&this.parent.notify(fr,null)}else""===t.value?n.textContent=e.getConstant("PasswordAlertMsg"):""===i.value?n.textContent=e.getConstant("ConfirmPasswordAlertMsg"):t.value!==i.value&&(n.textContent=e.getConstant("PasswordAlert")),this.parent.element.querySelector(".e-reenterpwd-dlg").querySelector(".e-reenterpwd-dialog").appendChild(n)},s.prototype.updateProtectSheet=function(e){var r=this.parent.serviceLocator.getService(O),t=this.optionList.getSelectedItems(),i={selectCells:t.text.indexOf(r.getConstant("SelectCells"))>-1,formatCells:t.text.indexOf(r.getConstant("FormatCells"))>-1,formatRows:t.text.indexOf(r.getConstant("FormatRows"))>-1,formatColumns:t.text.indexOf(r.getConstant("FormatColumns"))>-1,insertLink:t.text.indexOf(r.getConstant("InsertLinks"))>-1,selectUnLockedCells:t.text.indexOf(r.getConstant("SelectUnLockedCells"))>-1};this.parent.notify(jr,{protectSettings:i,password:e,triggerEvent:!0}),this.parent.notify(aa,null),this.parent.notify(ri,null)},s.prototype.protectSheetHandler=function(e){var r=(0,f.le)(e&&e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,t=_(this.parent,r),i=this.parent.element.id,n=[i+"_undo",i+"_redo",i+"_cut",i+"_copy",i+"_paste",i+"_number_format",i+"_font_name",i+"_font_size",i+"_bold",i+"_italic",i+"_line-through",i+"_underline",i+"_font_color_picker",i+"_fill_color_picker",i+"_borders",i+"_merge_cells",i+"_text_align",i+"_vertical_align",i+"_wrap",i+"_sorting",i+"_clear",i+"_conditionalformatting"],a=[i+"_cut",i+"_copy",i+"_number_format",i+"_font_name",i+"_font_size",i+"_bold",i+"_italic",i+"_line-through",i+"_underline",i+"_font_color_picker",i+"_fill_color_picker",i+"_borders",i+"_text_align",i+"_vertical_align",i+"_wrap",i+"_sorting",i+"_clear",i+"_conditionalformatting"],o=[i+"_insert_function"],l=[i+"_hyperlink",i+"_",i+"_chart"],h=[i+"_image"],p=[i+"_find"],c=[i+"_datavalidation"],d=[i+"_chart"],u=document.getElementById(this.parent.element.id+"_sheet_panel");u&&(t.isProtected&&(t.protectSettings.selectCells||t.protectSettings.selectUnLockedCells&&!Qt(this.parent,A(t.selectedRange)))?u.classList.remove("e-protected"):u.classList.add("e-protected"),t.isProtected||u.classList.remove("e-protected")),this.parent.dataBind(),this.parent.notify(jo,{disableHomeBtnId:n,enableHomeBtnId:a,enableFrmlaBtnId:o,enableInsertBtnId:l,findBtnId:p,dataValidationBtnId:c,imageBtnId:h,chartBtnId:d}),this.parent.notify(Zo,null),t.isProtected&&this.parent.notify(Tr,{props:"Protect"}),e&&e.triggerEvent&&this.parent.notify(Z,{action:"protectSheet",eventArgs:{sheetIndex:r,isProtected:t.isProtected,password:t.password,protectSettings:t.protectSettings.properties||t.protectSettings}})},s.prototype.editProtectedAlert=function(){var e=this,r=this.parent.serviceLocator.getService(O);this.dialog=this.parent.serviceLocator.getService("dialog"),this.dialog.show({content:r.getConstant("EditAlert"),isModal:!0,closeOnEscape:!0,showCloseIcon:!0,width:"400px",cssClass:"e-editAlert-dlg",beforeOpen:function(t){var i={dialogName:"EditAlertDialog",content:r.getConstant("EditAlert"),element:t.element,target:t.target,cancel:t.cancel};e.parent.trigger("dialogBeforeOpen",i),i.cancel&&(t.cancel=!0,Pe(function(){return e.dialog.destroyDialog()})),e.dialog.dialogInstance.content=i.content,K(e.parent.element)},close:function(){return K(e.parent.element)}})},s.prototype.protectWorkbook=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.serviceLocator.getService(ae);t.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-protectworkbook-dlg",header:r.getConstant("ProtectWorkbook"),beforeOpen:function(i){var n={dialogName:"ProtectWorkbook",element:i.element,target:i.target,cancel:i.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(i.cancel=!0),t.dialogInstance.content=e.passwordProtectContent(),t.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){e.alertMessage(),e.dlgClickHandler(t)}}]})},s.prototype.passwordProtectContent=function(){var e=this.parent.serviceLocator.getService(O),r=this.parent.createElement("div",{className:"e-password-dialog"}),t=this.parent.createElement("div",{className:"e-password-content"}),i=this.parent.createElement("div",{className:"e-password-content"}),n=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("Password")}),a=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("ConfirmPassword")}),o=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}}),l=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return o.setAttribute("placeholder",e.getConstant("EnterThePassword")),l.setAttribute("placeholder",e.getConstant("EnterTheConfirmPassword")),t.appendChild(o),t.insertBefore(n,o),i.appendChild(l),i.insertBefore(a,l),r.appendChild(i),r.insertBefore(t,i),r},s.prototype.KeyUpHandler=function(e){var r=e.target;if(r.classList.contains("e-text")&&(0,f.oq)(r,".e-password-content")&&(0,f.oq)(r,".e-password-dialog")&&(0,f.oq)(r,".e-password-dialog").getElementsByClassName("e-password-content")[1]===r.parentElement){var n=(0,f.oq)(r,".e-protectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?n.removeAttribute("disabled"):n.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&(0,f.oq)(r,".e-unprotectpwd-content")&&(0,f.oq)(r,".e-unprotectpwd-dialog")&&(0,f.oq)(r,".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0]===r.parentElement){var l=(0,f.oq)(r,".e-unprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?l.removeAttribute("disabled"):l.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&(0,f.oq)(r,".e-reenterpwd-content")&&(0,f.oq)(r,".e-reenterpwd-dialog")&&(0,f.oq)(r,".e-reenterpwd-dialog").getElementsByClassName("e-reenterpwd-content")[0]===r.parentElement){var c=(0,f.oq)(r,".e-reenterpwd-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?c.removeAttribute("disabled"):c.setAttribute("disabled","true")}if(r.classList.contains("e-text")&&(0,f.oq)(r,".e-unprotectsheetpwd-content")&&(0,f.oq)(r,".e-unprotectsheetpwd-dialog")&&(0,f.oq)(r,".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0]===r.parentElement){var v=(0,f.oq)(r,".e-unprotectworksheet-dlg").getElementsByClassName("e-footer-content")[0].firstChild;""!==r.value?v.removeAttribute("disabled"):v.setAttribute("disabled","true")}r.classList.contains("e-text")&&(0,f.oq)(r,".e-importprotectpwd-content")&&(0,f.oq)(r,".e-importprotectpwd-dialog")&&(0,f.oq)(r,".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0]===r.parentElement&&(v=(0,f.oq)(r,".e-importprotectworkbook-dlg").getElementsByClassName("e-footer-content")[0].firstChild,""!==r.value?v.removeAttribute("disabled"):v.setAttribute("disabled","true"))},s.prototype.alertMessage=function(){var e=this.parent.element.querySelector(".e-pwd-alert-span"),r=this.parent.element.querySelector(".e-unprotectpwd-alert-span"),t=this.parent.element.querySelector(".e-importprotectpwd-alert-span"),i=this.parent.element.querySelector(".e-reenterpwd-alert-span"),n=this.parent.element.querySelector(".e-unprotectsheetpwd-alert-span");e&&e.remove(),r&&r.remove(),t&&t.remove(),i&&i.remove(),n&&n.remove()},s.prototype.dlgClickHandler=function(e){var r=this.parent.serviceLocator.getService(O),t=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[0].querySelector(".e-input"),i=this.parent.element.querySelector(".e-password-dialog").getElementsByClassName("e-password-content")[1].querySelector(".e-input"),n=this.parent.createElement("span",{className:"e-pwd-alert-span"});t.value===i.value?(e.hide(),this.parent.notify(Tr,{props:"Protectworkbook"}),this.protectWorkbookHandler({password:t.value}),this.parent.notify(Z,{action:"protectWorkbook",eventArgs:{isProtected:!0,password:t.value}})):""===t.value?n.textContent=r.getConstant("PasswordAlertMsg"):""===i.value?n.textContent=r.getConstant("ConfirmPasswordAlertMsg"):t.value!==i.value&&(n.textContent=r.getConstant("PasswordAlert")),e.dialogInstance&&this.parent.element.querySelector(".e-protectworkbook-dlg").querySelector(".e-dlg-content").appendChild(n)},s.prototype.protectWorkbookHandler=function(e){this.parent.password=e.password,this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled")),this.parent.notify(Tr,{props:"Protectworkbook"})},s.prototype.unProtectWorkbook=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.serviceLocator.getService(ae);t.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworkbook-dlg",header:r.getConstant("UnProtectWorkbook"),beforeOpen:function(i){var n={dialogName:"UnProtectWorkbook",element:i.element,target:i.target,cancel:i.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(i.cancel=!0),t.dialogInstance.content=e.unProtectPasswordContent(),t.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.unprotectdlgOkClick(t)}}]})},s.prototype.unProtectsheet=function(e){var r=this,t=this.parent.serviceLocator.getService(O),i=this.parent.serviceLocator.getService(ae);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-unprotectworksheet-dlg",header:t.getConstant("UnProtectWorksheet"),beforeOpen:function(n){var a={dialogName:"UnProtectSheet",element:n.element,target:n.target,cancel:n.cancel};r.parent.trigger("dialogBeforeOpen",a),a.cancel&&(n.cancel=!0),i.dialogInstance.content=r.unProtectSheetPasswordContent(),i.dialogInstance.dataBind(),r.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!(this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex))},click:function(){r.alertMessage(),r.unprotectSheetdlgOkClick(i,e)}}]})},s.prototype.reEnterSheetPassword=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.serviceLocator.getService(ae);t.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-reenterpwd-dlg",header:r.getConstant("ConfirmPassword"),beforeOpen:function(i){var n={dialogName:"Re-enterPassword",element:i.element,target:i.target,cancel:i.cancel};e.parent.trigger("dialogBeforeOpen",n),n.cancel&&(i.cancel=!0),t.dialogInstance.content=e.reEnterSheetPasswordContent(),t.dialogInstance.dataBind(),e.parent.element.focus()},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){e.alertMessage(),e.selectSheetPassword()}}]})},s.prototype.unProtectPasswordContent=function(){var e=this.parent.serviceLocator.getService(O),r=this.parent.createElement("div",{className:"e-unprotectpwd-dialog"}),t=this.parent.createElement("div",{className:"e-unprotectpwd-content"}),i=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("EnterThePassword")}),n=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return t.appendChild(n),t.insertBefore(i,n),r.appendChild(t),r},s.prototype.reEnterSheetPasswordContent=function(){var e=this.parent.serviceLocator.getService(O),r=this.parent.createElement("div",{className:"e-reenterpwd-dialog"}),t=this.parent.createElement("div",{className:"e-reenterpwd-content"}),i=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("ReEnterPassword")}),n=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return t.appendChild(n),t.insertBefore(i,n),r.appendChild(t),r},s.prototype.unProtectSheetPasswordContent=function(){var e=this.parent.serviceLocator.getService(O),r=this.parent.createElement("div",{className:"e-unprotectsheetpwd-dialog"}),t=this.parent.createElement("div",{className:"e-unprotectsheetpwd-content"}),i=this.parent.createElement("div",{className:"e-header",innerHTML:e.getConstant("EnterThePassword")}),n=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return t.appendChild(n),t.insertBefore(i,n),r.appendChild(t),r},s.prototype.unprotectdlgOkClick=function(e){var r=this.parent.serviceLocator.getService(O),t=this.parent.element.querySelector(".e-unprotectpwd-dialog").getElementsByClassName("e-unprotectpwd-content")[0].querySelector(".e-input");if(this.parent.password===t.value)e.hide(),this.removeWorkbookProtection(),this.parent.notify(Z,{action:"protectWorkbook",eventArgs:{isProtected:!1}});else{var i=this.parent.createElement("span",{className:"e-unprotectpwd-alert-span",innerHTML:r.getConstant("UnProtectPasswordAlert")});this.parent.element.querySelector(".e-unprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(i)}},s.prototype.removeWorkbookProtection=function(){this.parent.password="",this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled"));var e=document.getElementById(this.parent.element.id+"_protectworkbook");e&&e.classList.remove("e-active"),this.parent.notify(Tr,{props:"Protectworkbook"})},s.prototype.unprotectSheetdlgOkClick=function(e,r){var t=this.parent.serviceLocator.getService(O),i=this.parent.getActiveSheet(),n=this.parent.element.querySelector(".e-unprotectsheetpwd-dialog").getElementsByClassName("e-unprotectsheetpwd-content")[0].querySelector(".e-input");if(r&&0===i.password.length)this.parent.open({sheetPassword:n.value,sheetIndex:this.parent.activeSheetIndex});else if(i.password===n.value)e.hide(),this.unProtectSheetPassword();else{var o=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span",innerHTML:t.getConstant("UnProtectPasswordAlert")});this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(o)}},s.prototype.unProtectSheetPassword=function(){var e=this.parent.getActiveSheet(),r=this.parent.activeSheetIndex;this.parent.setSheetPropertyOnMute(e,"isProtected",!e.isProtected),this.parent.setSheetPropertyOnMute(e,"password",""),this.parent.notify(Wi,{isActive:!e.isProtected,id:this.parent.element.id+"_protect",sheetIndex:r,triggerEvent:!0}),this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(r)&&this.parent.openModule.unProtectSheetIdx.push(r)},s.prototype.getPassWord=function(e){e.passWord=this.password},s.prototype.importProtectWorkbook=function(e){var r=this,t=this.parent.serviceLocator.getService(O),i=this.parent.serviceLocator.getService(ae);i.show({width:323,isModal:!0,showCloseIcon:!0,cssClass:"e-importprotectworkbook-dlg",header:t.getConstant("UnProtectWorkbook"),beforeOpen:function(n){var a={dialogName:"ImportProtectWorkbook",element:n.element,target:n.target,cancel:n.cancel};r.parent.trigger("dialogBeforeOpen",a),a.cancel&&(n.cancel=!0),i.dialogInstance.content=r.importProtectPasswordContent(e),i.dialogInstance.dataBind(),r.parent.element.focus()},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0,disabled:!0},click:function(){r.alertMessage(),r.importOkClick(e)}}]})},s.prototype.importProtectPasswordContent=function(e){var r=this.parent.serviceLocator.getService(O),t=this.parent.createElement("div",{className:"e-importprotectpwd-dialog"}),i=this.parent.createElement("div",{className:"e-importprotectpwd-content"}),n=this.parent.createElement("span",{className:"e-header",innerHTML:'"'+e.file.name+'" '+r.getConstant("IsProtected")}),a=this.parent.createElement("input",{className:"e-input e-text",attrs:{type:"password"}});return a.setAttribute("placeholder",r.getConstant("EnterThePassword")),i.appendChild(n),i.appendChild(a),t.appendChild(i),t},s.prototype.importOkClick=function(e){var r=this.parent.element.querySelector(".e-importprotectpwd-dialog").getElementsByClassName("e-importprotectpwd-content")[0].querySelector(".e-input");this.parent.password=r.value,this.parent.open({file:e.file,password:r.value})},s.prototype.toggleProtect=function(e){var t=this.parent.element.id,i=this.parent.getActiveSheet();this.parent.openModule.isImportedFile&&-1===this.parent.openModule.unProtectSheetIdx.indexOf(this.parent.activeSheetIndex)?this.unProtectsheet(!0):i.password&&i.password.length>0?this.unProtectsheet():(this.parent.setSheetPropertyOnMute(i,"isProtected",!i.isProtected),this.parent.notify(Wi,{isActive:!i.isProtected,id:t+"_protect",sheetIndex:this.parent.activeSheetIndex,triggerEvent:!0}))},s.prototype.getModuleName=function(){return"protectSheet"},s}(),Ks=function(){function s(e){this.shortValue="",this.parent=e,this.addEventListener()}return s.prototype.addEventListener=function(){this.parent.on(na,this.renderFindDlg,this),this.parent.on(Yo,this.renderGotoDlg,this),this.parent.on(st,this.gotoHandler,this),this.parent.on(Gi,this.findHandler,this),this.parent.on(Ke,this.showDialog,this),this.parent.on(Cn,this.replaceAllDialog,this),this.parent.on(ro,this.findKeyUp,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(na,this.renderFindDlg),this.parent.off(Yo,this.renderGotoDlg),this.parent.off(st,this.gotoHandler),this.parent.off(Gi,this.findHandler),this.parent.off(Ke,this.showDialog),this.parent.off(Cn,this.replaceAllDialog),this.parent.off(ro,this.findKeyUp))},s.prototype.renderFindDlg=function(){var e=this,r=this.parent.serviceLocator.getService(ae);if(this.parent.element.querySelector(".e-find-dlg"))r.hide();else{var t=this.parent.serviceLocator.getService(O),i={isModal:!1,showCloseIcon:!0,cssClass:"e-find-dlg",allowDragging:!0,header:t.getConstant("FindAndReplace"),closeOnEscape:!1,beforeOpen:function(n){var a={dialogName:"FindAndReplaceDialog",element:n.element,target:n.target,cancel:n.cancel};e.parent.trigger("dialogBeforeOpen",a),a.cancel&&(n.cancel=!0),r.dialogInstance.content=e.findandreplaceContent(),r.dialogInstance.dataBind(),K(e.parent.element)},buttons:[{buttonModel:{content:t.getConstant("FindPreviousBtn"),isPrimary:!0,cssClass:"e-btn-findPrevious",disabled:!0},click:function(n){e.dialogMessage(),e.findHandler({findOption:n&&13===n.keyCode?"next":"prev"})}},{buttonModel:{content:t.getConstant("FindNextBtn"),isPrimary:!0,cssClass:"e-btn-findNext",disabled:!0},click:function(){e.dialogMessage(),e.findHandler({findOption:"next"})}},{buttonModel:{content:t.getConstant("ReplaceBtn"),isPrimary:!0,cssClass:"e-btn-replace",disabled:!0},click:function(){e.dialogMessage(),e.replaceHandler(Ai)}},{buttonModel:{content:t.getConstant("ReplaceAllBtn"),isPrimary:!0,cssClass:"e-btn-replaceAll",disabled:!0},click:function(){e.dialogMessage(),e.replaceHandler(Gr)}}],open:function(){var n=e.parent.element.querySelector(".e-text-findNext");if(n.value){var a=e.parent.element.querySelector(".e-btn-findPrevious");(0,f.Xr)(a,"btn").disabled=!1,(0,f.Xr)(e.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}Pe(function(){K(n)})},close:function(){return r.hide()}};r.show(i)}},s.prototype.dialogMessage=function(){this.parent.element.querySelector(".e-replace-alert-span")?this.parent.element.querySelector(".e-replace-alert-span").remove():this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove()},s.prototype.renderGotoDlg=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.serviceLocator.getService(ae);if((0,f.le)(this.parent.element.querySelector(".e-find-dlg"))){var n={width:300,isModal:!1,showCloseIcon:!0,cssClass:"e-goto-dlg",allowDragging:!0,header:r.getConstant("GotoHeader"),beforeOpen:function(a){var o={dialogName:"GoToDialog",element:a.element,target:a.target,cancel:a.cancel};e.parent.trigger("dialogBeforeOpen",o),o.cancel&&(a.cancel=!0),t.dialogInstance.content=e.GotoContent(),t.dialogInstance.dataBind(),K(e.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn-goto-ok"},click:function(){e.gotoHandler()}}],close:function(){t.hide()},open:function(){e.textFocus()}};t.show(n,!1)}else t.hide()},s.prototype.textFocus=function(){var e=this;this.parent.element.querySelector(".e-text-goto").addEventListener("focus",function(){e.parent.element.querySelector(".e-goto-alert-span")&&e.parent.element.querySelector(".e-goto-alert-span").remove()})},s.prototype.findHandler=function(e){var r=this.parent.element.querySelector(".e-text-findNext");r||(r=this.parent.element.querySelector(".e-text-findNext-short"))||this.gotoAlert();var t=r.value;if(""!==r.value){var i=this.parent.activeSheetIndex,n=this.parent.element.querySelector(".e-findnreplace-checkcase"),a=void 0;a=!!n&&(0,f.Xr)(n,"checkbox").checked;var l=this.parent.element.querySelector(".e-findnreplace-checkmatch"),h=void 0;h=!!l&&(0,f.Xr)(l,"checkbox").checked;var c=this.parent.element.querySelector(".e-findnreplace-searchby"),d=void 0;d=c?(0,f.Xr)(c,"dropdownlist").value.toString():"By Row";var v=this.parent.element.querySelector(".e-findnreplace-searchwithin"),g=void 0;g=v?(0,f.Xr)(v,"dropdownlist").value.toString():"Sheet",this.parent.find({value:t,sheetIndex:i,findOpt:e.findOption,mode:g,isCSen:a,isEMatch:h,searchBy:d,isAction:!0})}},s.prototype.replaceHandler=function(e){var t=this.parent.element.querySelector(".e-find-dlg").querySelector(".e-text-findNext").value,i=this.parent.element.querySelector(".e-text-replaceInp").value,n=this.parent.element.querySelector(".e-findnreplace-checkcase").checked,a=this.parent.element.querySelector(".e-findnreplace-checkmatch").checked,o=this.parent.element.querySelector(".e-search-within .e-ddl-hidden").value,l=this.parent.element.querySelector(".e-searchby .e-ddl-hidden").value;this.parent.notify(e,{value:t,mode:o,isCSen:n,isEMatch:a,searchBy:l,findOpt:"next",replaceValue:i,replaceBy:e,sheetIndex:this.parent.activeSheetIndex,isAction:!0})},s.prototype.gotoHandler=function(e){if(e)this.parent.goTo(e.address);else{var t=this.parent.element.querySelector(".e-text-goto").value,i=t.split("");if(""===t||isNaN(parseInt(i[1],10)))return void this.gotoAlert();var n=t.toString().toUpperCase();this.parent.goTo(n)}},s.prototype.gotoAlert=function(){var e=this.parent.serviceLocator.getService(O),r=this.parent.createElement("span",{className:"e-goto-alert-span",innerHTML:e.getConstant("InsertingEmptyValue")});this.parent.element.querySelector(".e-goto-alert-span")&&this.parent.element.querySelector(".e-goto-alert-span").remove(),this.parent.element.querySelector(".e-goto-dlg").querySelector(".e-dlg-content").appendChild(r)},s.prototype.showDialog=function(){this.parent.element.querySelector(".e-replace-alert-span")&&this.parent.element.querySelector(".e-replace-alert-span").remove();var e=this.parent.serviceLocator.getService(O),r=this.parent.createElement("span",{className:"e-find-alert-span",innerHTML:e.getConstant("NoElements")});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(r)},s.prototype.replaceAllDialog=function(e){this.parent.element.querySelector(".e-find-alert-span")&&this.parent.element.querySelector(".e-find-alert-span").remove();var r=this.parent.serviceLocator.getService(O),t=this.parent.createElement("span",{className:"e-replace-alert-span",innerHTML:e.count+r.getConstant("ReplaceAllEnd")+e.replaceValue});this.parent.element.querySelector(".e-find-dlg")&&this.parent.element.querySelector(".e-find-dlg").querySelector(".e-dlg-content").appendChild(t)},s.prototype.findKeyUp=function(e){if(e.target.classList.contains("e-text-findNext")){var r=this.parent.element.querySelector(".e-text-findNext").value;if((0,f.le)(r)||""===r)(0,f.Xr)(this.parent.element.querySelector(".e-btn-findPrevious"),"btn").disabled=!0,(0,f.Xr)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!0,this.dialogMessage();else{var t=this.parent.element.querySelector(".e-btn-findPrevious");(0,f.Xr)(t,"btn").disabled=!1,(0,f.Xr)(this.parent.element.querySelector(".e-btn-findNext"),"btn").disabled=!1}}var n=this.parent.element.querySelector(".e-text-findNext").value,a=this.parent.element.querySelector(".e-text-replaceInp").value;(0,f.le)(n)||(0,f.le)(a)||""===n||""===a?((0,f.Xr)(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!0,(0,f.Xr)(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!0):!1===this.parent.getActiveSheet().isProtected&&((0,f.Xr)(this.parent.element.querySelector(".e-btn-replace"),"btn").disabled=!1,(0,f.Xr)(this.parent.element.querySelector(".e-btn-replaceAll"),"btn").disabled=!1)},s.prototype.findandreplaceContent=function(){this.parent.element.querySelector(".e-text-findNext-short")&&(this.shortValue=this.parent.element.querySelector(".e-text-findNext-short").value);var e=this.parent.createElement("div",{className:"e-link-dialog"}),r=this.parent.createElement("div",{className:"e-find"}),t=this.parent.createElement("div",{className:"e-findCheck"}),i=this.parent.serviceLocator.getService(O);e.appendChild(r);var n=this.parent.createElement("div",{className:"e-cont"}),a=this.parent.createElement("p",{className:"e-header",innerHTML:i.getConstant("FindWhat")}),o=this.parent.createElement("input",{className:"e-input e-text-findNext",attrs:{type:"Text",placeholder:i.getConstant("FindValue"),value:this.shortValue}});n.appendChild(o),n.insertBefore(a,o),r.appendChild(n);var l=new bt.zC({width:"70%"});l.createElement=this.parent.createElement,l.appendTo(o);var h=this.parent.createElement("div",{className:"e-cont"}),p=this.parent.createElement("p",{className:"e-header",innerHTML:i.getConstant("ReplaceWith")}),c=this.parent.createElement("input",{className:"e-input e-text-replaceInp",attrs:{type:"Text",placeholder:i.getConstant("ReplaceValue")}});h.appendChild(c),h.insertBefore(p,c),r.appendChild(h);var d=new bt.zC({width:"70%"});d.createElement=this.parent.createElement,d.appendTo(c);var u=[{Id:"Sheet",Within:i.getConstant("Sheet")},{Id:"Workbook",Within:i.getConstant("Workbook")}],v=new Rt.NB({dataSource:u,cssClass:"e-search-within",fields:{value:"Id",text:"Within"},width:"50%",index:0}),g=this.parent.createElement("input",{className:"e-findnreplace-searchwithin",attrs:{type:"select",label:i.getConstant("SearchBy")}}),m=this.parent.createElement("p",{className:"e-header",innerHTML:i.getConstant("SearchWithin")});r.appendChild(m),r.appendChild(g),v.createElement=this.parent.createElement,v.appendTo(g);var y=[{Id:"By Row",Search:i.getConstant("ByRow")},{Id:"By Column",Search:i.getConstant("ByColumn")}],C=new Rt.NB({dataSource:y,cssClass:"e-searchby",fields:{value:"Id",text:"Search"},width:"50%",index:0}),b=this.parent.createElement("input",{className:"e-findnreplace-searchby",attrs:{type:"select",label:i.getConstant("SearchBy")}}),S=this.parent.createElement("p",{className:"e-header",innerHTML:i.getConstant("SearchBy")});r.appendChild(S),r.appendChild(b),C.createElement=this.parent.createElement,C.appendTo(b);var w=new at.Jg({label:i.getConstant("MatchCase"),checked:!1,cssClass:"e-findnreplace-casecheckbox"}),x=this.parent.createElement("input",{className:"e-findnreplace-checkcase",attrs:{type:"checkbox"}});t.appendChild(x),w.createElement=this.parent.createElement,w.appendTo(x);var I=new at.Jg({label:i.getConstant("MatchExactCellElements"),checked:!1,cssClass:"e-findnreplace-exactmatchcheckbox"}),F=this.parent.createElement("input",{className:"e-findnreplace-checkmatch",attrs:{type:"checkbox"}});return t.appendChild(F),I.createElement=this.parent.createElement,I.appendTo(F),r.appendChild(t),e},s.prototype.GotoContent=function(){var e=this.parent.serviceLocator.getService(O),r=this.parent.createElement("div",{className:"e-link-dialog"}),t=this.parent.createElement("div",{className:"e-goto"});r.appendChild(t);var i=this.parent.createElement("div",{className:"e-cont"}),n=this.parent.createElement("p",{className:"e-header",innerHTML:e.getConstant("Reference")}),a=new bt.zC({placeholder:e.getConstant("EntercellAddress")}),o=this.parent.createElement("input",{className:"e-text-goto",attrs:{type:"Text"}});return i.appendChild(o),i.insertBefore(n,o),t.appendChild(i),a.createElement=this.parent.createElement,a.appendTo(o),r},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"findAndReplace"},s}(),$s=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.merge=function(e){var r=this;e.showDialog?this.parent.serviceLocator.getService(ae).show({target:this.parent.element,height:180,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(O).getConstant("PasteMergeAlert"),beforeOpen:function(t){var i={dialogName:"MergeDialog",element:t.element,target:t.target,cancel:t.cancel};r.parent.trigger("dialogBeforeOpen",i),i.cancel&&(t.cancel=!0),K(r.parent.element)}}):this.parent.serviceLocator.getService("cell").refresh(e.rowIdx,e.colIdx,e.lastCell,e.element)},s.prototype.hideHandler=function(e){var r=this.parent.getActiveSheet(),t={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(Ne,t),t.range=t.range;var i=E(t.range[0],t.range[1],r)||{},n="row"===e.model?t.range[0]:t.range[1],a=n+((i[e.model+"Span"]||1)-1);if(!(!e.isEnd&&(e.start===n||we(r,n))||e.isEnd&&e.start>n&&!we(r,n))&&i[e.model+"Span"]>1&&a>=e.start)if("row"===e.model?ne(r,n):we(r,n)){if(e.end<a&&(a-e.end>1||i.rowSpan>1)){var o=this.parent.getCell(e.rowIdx,e.end+1);if(o&&(a-e.end>1&&(o.colSpan=a-e.end),o.style.display=""),i.rowSpan>1){var l=i.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(i.rowSpan-1));l>1&&(o.rowSpan=l)}}}else this.merge({rowIdx:t.range[0],colIdx:t.range[1]})},s.prototype.checkPrevMerge=function(e){var r,i,n,t=this.parent.getActiveSheet();e.isRow?e.rowIdx-1>-1&&ne(t,e.rowIdx-1)&&(void 0!==(r=E(e.rowIdx-1,e.colIdx,t)||{}).rowSpan||void 0!==r.colSpan)&&(void 0===r.colSpan||r.colSpan>1||e.colIdx-1>-1&&we(t,e.colIdx-1))&&(this.parent.notify(Ne,i={range:[e.rowIdx-1,e.colIdx,e.rowIdx-1,e.colIdx]}),i.range=i.range,ne(t,i.range[0])&&i.range[2]>=e.rowIdx&&(r=E(i.range[0],i.range[1],t)||{}).rowSpan>1&&((n=i.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(i.range[2]-e.rowIdx)))>1&&(e.td.rowSpan=n,e.td.style.display=""),r.colSpan>1&&!(e.colIdx-1>-1&&we(t,e.colIdx-1))&&(n=r.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(r.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display=""))):e.colIdx-1>-1&&we(t,e.colIdx-1)&&(void 0!==(r=E(e.rowIdx,e.colIdx-1,t)||{}).colSpan||void 0!==r.rowSpan)&&(void 0===r.rowSpan||r.rowSpan>1||e.rowIdx-1>-1&&ne(t,e.rowIdx-1))&&(this.parent.notify(Ne,i={range:[e.rowIdx,e.colIdx-1,e.rowIdx,e.colIdx-1]}),i.range=i.range,we(t,i.range[1])&&i.range[3]>=e.colIdx&&(r=E(i.range[0],i.range[1],t)||{}).colSpan>1&&((n=i.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,e.colIdx+(r.colSpan-1),"columns"))>1&&(e.td.colSpan=n,e.td.style.display=""),r.rowSpan>1&&!(e.rowIdx-1>-1&&ne(t,e.rowIdx-1))&&(n=r.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(r.rowSpan-1)))>1&&(e.td.rowSpan=n,e.td.style.display="")))},s.prototype.checkMerge=function(e){var r=this.parent.getActiveSheet(),t=E(e.rowIdx,e.colIdx,r)||{};if(e.isRow){if(void 0===t.colSpan||we(r,e.colIdx-1)){if((i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=i.range,this.parent.notify(Ne,i),we(r,e.colIdx-1)&&!we(r,i.range[1])||e.isFreezePane&&i.range[0]<this.parent.frozenRowCount(r))return void(e.insideFreezePane=i.range[0]<this.parent.frozenRowCount(r));t=E(i.range[0],i.range[1],r),(n=i.range[2]-e.rowIdx+1-this.parent.hiddenCount(e.rowIdx,i.range[2]))>1&&(this.merge({rowIdx:i.range[0],colIdx:i.range[1],element:e.td}),e.td.rowSpan=n,e.td.style.display="")}}else if(void 0===t.rowSpan||ne(r,e.rowIdx-1)){var i,n;if((i={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]}).range=i.range,this.parent.notify(Ne,i),ne(r,e.rowIdx-1)&&!ne(r,i.range[0])||e.isFreezePane&&i.range[1]<this.parent.frozenColCount(r))return void(e.insideFreezePane=i.range[1]<this.parent.frozenColCount(r));t=E(i.range[0],i.range[1],r),(n=i.range[3]-e.colIdx+1-this.parent.hiddenCount(e.colIdx,i.range[3],"columns"))>1&&(this.merge({rowIdx:i.range[0],colIdx:i.range[1],element:e.td}),e.td.colSpan=n,e.td.style.display="")}},s.prototype.addEventListener=function(){this.parent.on(zt,this.merge,this),this.parent.on(oa,this.hideHandler,this),this.parent.on(sa,this.checkPrevMerge,this),this.parent.on(la,this.checkMerge,this)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(zt,this.merge),this.parent.off(oa,this.hideHandler),this.parent.off(sa,this.checkPrevMerge),this.parent.off(la,this.checkMerge))},s.prototype.getModuleName=function(){return"merge"},s}(),Qs=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener()},s.prototype.addEventListener=function(){this.parent.on(We,this.applyCF,this),this.parent.on(Qo,this.renderCFDlg,this),this.parent.on(oo,this.clearCF,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(We,this.applyCF),this.parent.off(Qo,this.renderCFDlg),this.parent.off(oo,this.clearCF))},s.prototype.clearCF=function(e){var r=this,t=this.parent.getActiveSheet();this.updateRange(t,e.indexes,this.parent.frozenRowCount(t),this.parent.frozenColCount(t),B(t.topLeftCell),function(n,a,o,l){var h,p,c;(0,f.IV)([l],["e-redft","e-yellowft","e-greenft","e-redf","e-redt","e-iconset"]),["backgroundColor","color"].forEach(function(d){l.style[d]&&(l.style[d]="",(h=o&&o.style&&o.style[d]||r.parent.commonCellStyle[d])&&((p={})[d]=h,r.parent.notify(He,{style:p,rowIdx:n,colIdx:a,cell:l})))}),[".e-cf-databar",".e-iconsetspan"].forEach(function(d){(c=l.querySelector(d))&&(l.removeChild(c),l.textContent=r.parent.getDisplayText(o))})})},s.prototype.renderCFDlg=function(e){var r=this,t=this.parent.serviceLocator.getService(O),i=this.parent.serviceLocator.getService(ae);i.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-conditionalformatting-dlg",header:e.action.replace("...",""),target:this.parent.element,beforeOpen:function(){i.dialogInstance.content=r.cfDlgContent(e.action),i.dialogInstance.dataBind(),K(r.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){r.dlgClickHandler(e.action),i.hide()}}]})},s.prototype.dlgClickHandler=function(e){var a,r="",t="",i=this.parent.element.querySelector(".e-conditionalformatting-dlg").getElementsByClassName("e-dlg-content")[0].querySelector(".e-cf-dlg"),n=i.querySelector(".e-cfmain");if(n){(a=n.getElementsByTagName("input")[0])&&a.parentElement.classList.contains("e-cfmain")&&(r=n.getElementsByTagName("input")[0].value),t=n.getElementsByTagName("input")[1]?i.querySelector(".e-cfmain").getElementsByTagName("input")[1].value:"";var o=(0,f.o5)(this.parent.locale,"");r=r.split(o).join("").split(",").join(""),t=t.split(o).join("").split(",").join("")}var l={type:"Duplicate Values..."===e?a.value:this.getType(e),cFColor:this.getCFColor(i.querySelector(".e-cfsub").getElementsByTagName("input")[0].value),range:this.parent.getActiveSheet().selectedRange};l.value=""!==r?r+(""!==t?","+t:""):t,this.parent.notify(Xr,{cfModel:l,isAction:!0})},s.prototype.getType=function(e){var t,r=this.parent.serviceLocator.getService(O);switch(e){case r.getConstant("GreaterThan")+"...":t="GreaterThan";break;case r.getConstant("LessThan")+"...":t="LessThan";break;case r.getConstant("Between")+"...":t="Between";break;case r.getConstant("CFEqualTo")+"...":t="EqualTo";break;case r.getConstant("TextThatContains")+"...":t="ContainsText";break;case r.getConstant("ADateOccuring")+"...":t="DateOccur";break;case r.getConstant("Top10Items")+"...":t="Top10Items";break;case r.getConstant("Bottom10Items")+"...":t="Bottom10Items";break;case r.getConstant("Top10")+" %...":t="Top10Percentage";break;case r.getConstant("Bottom10")+" %...":t="Bottom10Percentage";break;case r.getConstant("AboveAverage")+"...":t="AboveAverage";break;case r.getConstant("BelowAverage")+"...":t="BelowAverage"}return t},s.prototype.getCFColor=function(e){var r=this.parent.serviceLocator.getService(O),t="RedFT";switch(e){case r.getConstant("LightRedFillWithDarkRedText"):t="RedFT";break;case r.getConstant("YellowFillWithDarkYellowText"):t="YellowFT";break;case r.getConstant("GreenFillWithDarkGreenText"):t="GreenFT";break;case r.getConstant("RedFill"):t="RedF";break;case r.getConstant("RedText"):t="RedT"}return t},s.prototype.cfDlgContent=function(e){var d,r=this.getDlgText(e),t=this.parent.serviceLocator.getService(O),i=this.parent.createElement("div",{className:"e-cf-dlg"}),n=this.parent.createElement("div",{className:"e-cfmain"}),a=this.parent.createElement("div",{className:"e-cfsub"}),o=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:r}),l=this.parent.createElement("input",{className:"e-input",id:"valueInput",attrs:{type:"text","aria-label":r}}),h=this.parent.createElement("input",{className:"e-select"}),p=this.parent.createElement("span",{className:"e-header",innerHTML:t.getConstant("With")}),c=this.parent.createElement("input",{className:"e-select"});if(i.appendChild(n),i.appendChild(a),n.appendChild(o),e!==t.getConstant("DuplicateValues")+"..."){if(e!==t.getConstant("AboveAverage")+"..."&&e!==t.getConstant("BelowAverage")+"..."){n.appendChild(l),d=!0;var u=e===t.getConstant("Top10")+" %..."||e===t.getConstant("Bottom10")+" %...";(e===t.getConstant("Top10Items")+"..."||e===t.getConstant("Bottom10Items")+"..."||u)&&(l.maxLength=u?3:4,new bt.No({value:10,min:1,max:u?100:1e3,format:"###"}).appendTo(l))}}else{n.appendChild(h);var g=[{text:t.getConstant("Duplicate"),id:"duplicate"},{text:t.getConstant("Unique"),id:"unique"}];new Rt.NB({dataSource:g,index:0,popupHeight:"200px"}).appendTo(h)}if(e===t.getConstant("Between")+"..."){var y=this.parent.createElement("span",{className:"e-header e-header-2",innerHTML:t.getConstant("And")}),C=this.parent.createElement("input",{className:"e-input e-between"});n.appendChild(y),n.appendChild(C),C.addEventListener("input",this.validateCFInput.bind(this))}d&&(this.validateCFInput({target:l}),l.addEventListener("input",this.validateCFInput.bind(this))),a.appendChild(p),a.appendChild(c);var b=[{text:t.getConstant("LightRedFillWithDarkRedText"),value:"redft",id:"redft"},{text:t.getConstant("YellowFillWithDarkYellowText"),id:"yellowft"},{text:t.getConstant("GreenFillWithDarkGreenText"),id:"greenft"},{text:t.getConstant("RedFill"),id:"redf"},{text:t.getConstant("RedText"),id:"redt"}];return new Rt.NB({dataSource:b,index:0,popupHeight:"200px"}).appendTo(c),i},s.prototype.validateCFInput=function(e){var r=this.parent.serviceLocator.getService(ae),t=e.target.value,i=r.dialogInstance.element.getElementsByClassName("e-primary")[0];t&&(e.target.classList.contains("e-between")||e.target.parentElement.querySelector(".e-between"))&&(t=e.target.parentElement.querySelector(e.target.classList.contains("e-between")?".e-input":".e-between").value),i.disabled=!t.trim()},s.prototype.checkCellHandler=function(e,r,t){for(var i=t.range.trim().split(","),n=0;n<i.length;n++){var a=A(i[n].includes(":")?i[n]:i[n]+":"+i[n]);if(e>=a[0]&&e<=a[2]&&r>=a[1]&&r<=a[3])return!0}return!1},s.prototype.getDlgText=function(e){var r=this.parent.serviceLocator.getService(O),t="";switch(e){case r.getConstant("GreaterThan")+"...":t=r.getConstant("FormatCellsGreaterThan");break;case r.getConstant("LessThan")+"...":t=r.getConstant("FormatCellsLessThan");break;case r.getConstant("Between")+"...":t=r.getConstant("FormatCellsBetween");break;case r.getConstant("CFEqualTo")+"...":t=r.getConstant("FormatCellsEqualTo");break;case r.getConstant("TextThatContains")+"...":t=r.getConstant("FormatCellsThatContainTheText");break;case r.getConstant("ADateOccuring")+"...":t=r.getConstant("FormatCellsThatContainADateOccurring");break;case r.getConstant("DuplicateValues")+"...":t=r.getConstant("FormatCellsDuplicate");break;case r.getConstant("Top10Items")+"...":case r.getConstant("Top10")+" %...":t=r.getConstant("FormatCellsTop");break;case r.getConstant("Bottom10Items")+"...":case r.getConstant("Bottom10")+" %...":t=r.getConstant("FormatCellsBottom");break;case r.getConstant("AboveAverage")+"...":t=r.getConstant("FormatCellsAbove");break;case r.getConstant("BelowAverage")+"...":t=r.getConstant("FormatCellsBelow")}return t},s.prototype.updateResult=function(e,r,t,i,n,a,o,l){var u,v,g,m,h={},p={},c=e.range.split(","),d=[];t?m=function(){if(te(v)){var x=parseInt(v,10);x>=0?(void 0===d[0]||x>d[0])&&(d[0]=x):(void 0===d[1]||x<d[1])&&(d[1]=x)}}:i?m=function(){if(te(v)){var x=parseFloat(v);d.push(Number(x))}}:n?(d=[0,0],m=function(){te(v)&&(d[0]+=parseFloat(v),d[1]++)}):a?(g=0,m=function(){te(v)&&d.push(parseFloat(v))}):m=o?function(){if(te(v)){var x=parseInt(v,10);(void 0===d[0]||x<d[0])&&(d[0]=x),(void 0===d[1]||x>d[1])&&(d[1]=x)}}:function(){h[v]?p[v]||(p[v]=!0,d.push(v)):h[v]=!0};for(var y,C=0;C<c.length;C++)for(var b=(u=A(c[C]))[0];b<=u[2];b++)for(var S=u[1];S<=u[3];S++)y=E(b,S,r,!1,!0),(0,f.le)(y.value)?y.formula&&(this.parent.notify("calculateFormula",{cell:y,rowIdx:b,colIdx:S,sheetIndex:this.parent.activeSheetIndex}),v=y.value.toString().toLowerCase(),m()):(v=y.value.toString().toLowerCase(),m()),g++;if(i||a){if(d=d.sort(function(x,I){return x-I}),e.type.includes("Bottom")||(d=d.reverse()),a){var w=parseFloat(l);e.type.includes("Percentage")&&(w=(w=Math.round(w/(100/g)))||1),d=d.slice(0,w)}}else n&&((d=[d[0]/d[1]])[0]||(d=[]));e.result=d},s.prototype.applyCF=function(e){var r=!e.cfModel,t=this.parent.getActiveSheet(),i=e.cfModel||t.conditionalFormats,n=[e.indexes],a=!1;if(e.refreshAll&&(n=[[this.parent.viewport.topIndex+this.parent.frozenRowCount(t),this.parent.viewport.leftIndex+this.parent.frozenColCount(t),this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex]],t.frozenRows||t.frozenColumns)){var o=this.parent.frozenRowCount(t),l=this.parent.frozenColCount(t),h=B(t.topLeftCell);if(o&&l){n.push([h[0],h[1],o-1,l-1]);var p=B(t.paneTopLeftCell);n.push([p[0],h[1],this.parent.viewport.bottomIndex,l-1])}o&&n.push([h[0],this.parent.viewport.leftIndex+l,o-1,this.parent.viewport.rightIndex]),l&&n.push([this.parent.viewport.topIndex+o,h[1],this.parent.viewport.bottomIndex,l-1])}for(var c=i.length-1;c>=0;c--)r&&(2===n[0].length?!this.checkCellHandler(e.indexes[0],e.indexes[1],i[c]):!Gl(n,i[c].range))||(a=this.updateCF(e,t,i[c],a))},s.prototype.updateCF=function(e,r,t,i){var a,o,c,n=this;if(t.value){var l=t.value.split(",").filter(function(I){return!!I.trim()});if(l.length>1)if(l[0].split("(").length>1){for(var h="",p=0;p<l.length;p++)(h+=l[p]+",").split("(").length===h.split(")").length&&void 0===a&&(a=h.substring(0,h.length-1),h="");o=h.substring(0,h.length-1)}else for(a=l[0],p=1;p<l.length;p++)o+=p+1===l.length?l[p]:l[p]+",";else a=l[0]||t.value}t.type||(t.type="GreaterThan"),t.format&&t.format.style?(c=ks(t.format.style,!0),!Object.keys(c).length&&!t.cFColor&&(t.cFColor="RedFT")):(c={},t.cFColor||(t.cFColor="RedFT"));var d,u,v,g=t.type.includes("DataBar"),m=t.type.includes("ColorScale");(!e.isRender||!t.result)&&("Duplicate"===t.type||"Unique"===t.type||g||m||(d=t.type.includes("Average"))||(u=t.type.includes("10")&&te(a))||(v=t.type.includes("Three")||t.type.includes("Four")||t.type.includes("Five")))&&this.updateResult(t,r,g,m,d,u,v,a);var y=function(I,F,T,k){var D,N,V,R=T&&!(0,f.le)(T.value)?T.value.toString():"",P=!0;switch(t.type){case"GreaterThan":case"LessThan":D=n.isGreaterThanLessThan(t,R,a);break;case"Between":D=te(R)&&n.isBetWeen(t,R,a,o);break;case"EqualTo":D=te(R)&&n.isEqualTo(t,R,a);break;case"ContainsText":D=R&&n.isContainsText(R,a);break;case"DateOccur":n.parent.notify(Tt,N={value:a,cell:{},updatedVal:""}),D=R===N.updatedVal;break;case"Unique":D=-1===t.result.indexOf(R.toLowerCase());break;case"Duplicate":D=t.result.indexOf(R.toLowerCase())>-1;break;case"Top10Items":case"Bottom10Items":case"Top10Percentage":case"Bottom10Percentage":if(t.result){var M=parseFloat(R);Hr(R)&&(M=Ut(R)),D=t.result.indexOf(M)>-1}break;case"AboveAverage":D=t.result.length&&parseFloat(R)>t.result[0];break;case"BelowAverage":D=t.result.length&&parseFloat(R)<t.result[0];break;default:P=!1,g?n.applyDataBars(R,t,k,I):m?n.applyColorScale(R,t,k,T,I,F):n.applyIconSet(R,t,k)}e.isAction&&P&&(n.parent.trigger("beforeConditionalFormat",{conditionalFormat:t,cell:T,element:k,apply:D,address:j(I,F)}),!D&&e.isEdit&&!i)&&(e.indexes[0]===I&&e.indexes[1]===F&&(i=!0),t.cFColor?k.className.includes("e-"+t.cFColor.toLowerCase())&&(k.classList.remove("e-"+t.cFColor.toLowerCase()),k.style.backgroundColor="",k.style.color="",((V=(0,f.l7)({},n.parent.commonCellStyle,T&&T.style)).backgroundColor||V.color)&&n.parent.notify(He,{rowIdx:I,colIdx:F,cell:k,style:{backgroundColor:V.backgroundColor,color:V.color}})):(k.removeAttribute("style"),V=(0,f.l7)({},n.parent.commonCellStyle,T&&T.style),Object.keys(V).length&&n.parent.notify(He,{style:V,rowIdx:I,colIdx:F,cell:k}))),D&&(e.isEdit&&e.indexes[0]===I&&e.indexes[1]===F&&(i=!0),(0,f.IV)([k],["e-redft","e-yellowft","e-greenft","e-redf","e-redt"]),t.cFColor&&(k.classList.add("e-"+t.cFColor.toLowerCase()),n.setCFStyle(c,t)),Object.assign(k.style,c))};if(e.ele)y(e.indexes[0],e.indexes[1],e.cell,e.ele);else for(var C=t.range.split(","),b=this.parent.frozenRowCount(r),S=this.parent.frozenColCount(r),w=B(r.topLeftCell),x=0;x<C.length;x++)this.updateRange(r,A(C[x]),b,S,w,y);return i},s.prototype.updateRange=function(e,r,t,i,n,a){r[0]=r[0]<t?r[0]<n[0]?n[0]:r[0]:r[0]<this.parent.viewport.topIndex+t?this.parent.viewport.topIndex+t:r[0],r[1]=r[1]<i?r[1]<n[1]?n[1]:r[1]:r[1]<this.parent.viewport.leftIndex+i?this.parent.viewport.leftIndex+i:r[1],r[2]=r[2]<t?r[2]<n[0]?n[0]-1:r[2]:r[2]>this.parent.viewport.bottomIndex?this.parent.viewport.bottomIndex:r[2],r[3]=r[3]<i?r[3]<n[1]?n[1]-1:r[3]:r[3]>this.parent.viewport.rightIndex?this.parent.viewport.rightIndex:r[3];for(var o,l=r[0];l<=r[2];l++)if(t&&l===t&&(l=this.parent.viewport.topIndex+t),!ne(e,l))for(var h=r[1];h<=r[3];h++)i&&h===i&&(h=this.parent.viewport.leftIndex+i),!we(e,h)&&(o=this.parent.getCell(l,h))&&a(l,h,E(l,h,e),o)},s.prototype.applyIconSet=function(e,r,t){if(t.classList.contains("e-iconset")){t.classList.remove("e-iconset");var i=t.querySelector(".e-iconsetspan");i&&t.removeChild(i)}var n=parseInt(e,10),a=r.result;if(!(isNaN(n)||void 0===a[0]&&void 0===a[1])){var p,o=a[0],l=a[1],h=this.getIconList(r.type).split(",");if(3===h.length){var d=o+.33*(l-o);p="e-"+(n>=o+.67*(l-o)?h[0].trim():n>=d?h[1].trim():h[2].trim())}else if(4===h.length){var u=o+.25*(l-o),v=o+.5*(l-o);p="e-"+(n>=(g=o+.75*(l-o))?h[0].trim():n>=v?h[1].trim():n>=u?h[2].trim():h[3].trim())}else if(5===h.length){u=o+.2*(l-o),v=o+.4*(l-o);var g=o+.6*(l-o);p="e-"+(n>=o+.8*(l-o)?h[0].trim():n>=g?h[1].trim():n>=v?h[2].trim():n>=u?h[3].trim():h[4].trim())}var y=this.parent.createElement("span",{className:"e-icon e-iconsetspan "+p});t.insertBefore(y,t.childNodes[0]),t.classList.add("e-iconset")}},s.prototype.getIconList=function(e){switch(e){case"ThreeArrows":return"3arrows-1,3arrows-2,3arrows-3";case"ThreeArrowsGray":return"3arrowsgray-1,3arrowsgray-2,3arrowsgray-3";case"FourArrowsGray":return"4arrowsgray-1,4arrowsgray-2,4arrowsgray-3,4arrowsgray-4";case"FourArrows":return"4arrows-1,4arrows-2,4arrows-3,4arrows-4";case"FiveArrowsGray":return"5arrowsgray-1,5arrowsgray-2,5arrowsgray-3,5arrowsgray-4,5arrowsgray-5";case"FiveArrows":return"5arrows-1,5arrows-2,5arrows-3,5arrows-4,5arrows-5";case"ThreeTrafficLights1":return"3trafficlights-1,3trafficlights-2,3trafficlights-3";case"ThreeTrafficLights2":return"3rafficlights2-1,3rafficlights2-2,3rafficlights2-3";case"ThreeSigns":return"3signs-1,3signs-2,3signs-3";case"FourTrafficLights":return"4trafficlights-1,4trafficlights-2,4trafficlights-3,4trafficlights-4";case"FourRedToBlack":return"4redtoblack-1,4redtoblack-2,4redtoblack-3,4redtoblack-4";case"ThreeSymbols":return"3symbols-1,3symbols-2,3symbols-3";case"ThreeSymbols2":return"3symbols2-1,3symbols2-2,3symbols2-3";case"ThreeFlags":return"3flags-1,3flags-2,3flags-3";case"FourRating":return"4rating-1,4rating-2,4rating-3,4rating-4";case"FiveQuarters":return"5quarters-1,5quarters-2,5quarters-3,5quarters-4,5quarters-5";case"FiveRating":return"5rating-1,5rating-2,5rating-3,5rating-4,5rating-5";case"ThreeTriangles":return"3triangles-1,3triangles-2,3triangles-3";case"ThreeStars":return"3stars-1,3stars-2,3stars-3";case"FiveBoxes":return"5boxes-1,5boxes-2,5boxes-3,5boxes-4,5boxes-5"}return"3arrows-1,3arrows-2,3arrows-3"},s.prototype.applyColorScale=function(e,r,t,i,n,a){var o=parseFloat(e);if(isNaN(o)){if(t.style.backgroundColor){t.style.backgroundColor="";var l=(0,f.l7)({},this.parent.commonCellStyle,i&&i.style);l.backgroundColor&&this.parent.notify(He,{style:{backgroundColor:l.backgroundColor},cell:t,rowIdx:n,colIdx:a})}}else{var h=r.result,p=h.indexOf(o),c=this.getColor(r.type);t.style.backgroundColor=0===p?c[0]:p===h.length-1?c[c.length-1]:3===h.length&&1===p?c[1]:this.getGradient(p,c[0],c[1],c[2],h.length)}},s.prototype.applyDataBars=function(e,r,t,i){var l,n=this.parent.getActiveSheet(),a=r.result,o=0,h=parseInt(e,10);if(void 0===a[0]&&void 0===a[1]||isNaN(h)){var p=t.getElementsByClassName("e-cf-databar")[0];p&&t.removeChild(p)}else{void 0!==a[0]&&void 0!==a[1]?(l=a[0]+Math.abs(a[1]),o=Math.abs(a[1]/l*100)):l=void 0!==a[0]?a[0]:a[1];var c=this.parent.createElement("div",{id:"spreadsheet-databar",className:"e-cf-databar"}),d=this.parent.createElement("span",{id:"spreadsheet-leftspan",className:"e-databar"}),u=this.parent.createElement("span",{id:"spreadsheet-rightspan",className:"e-databar"}),v=this.parent.createElement("span",{id:"spreadsheet-dataspan",className:"e-databar-value"}),g=t.querySelector(".e-iconsetspan");g&&t.insertBefore(g,t.firstElementChild);var m=le(n,i,!0);c.style.height=m-1+"px";var y=r.type[0];"L"===y&&(y+="B"),void 0===a[1]?(u.style.width=Math.ceil(Math.abs(h/l*100))+"%",u.style.height=m-3+"px",u.style.backgroundColor=this.getColor(y)[0],u.style.left="0px"):void 0===a[0]?(u.style.width=Math.ceil(Math.abs(h/l*100))+"%",u.style.height=m-3+"px",u.style.backgroundColor=this.getColor("R")[0],u.style.left="0px"):h>=0?(d.style.width=o+"%",d.style.height=m-3+"px",d.style.backgroundColor="transparent",d.style.left="0px",u.style.width=Math.ceil(Math.abs(h/l*100))+"%",u.style.height=m-3+"px",u.style.backgroundColor=this.getColor(y)[0],u.style.left=o+"%"):(d.style.width=Math.ceil(Math.abs(h/l*100))+"%",d.style.height=m-3+"px",d.style.backgroundColor=this.getColor("R")[0],d.style.width===o+"%"?d.style.left="0px":d.style.right=100-o+"%"),v.style.fontSize=t.style.fontSize||"11pt",v.innerHTML=t.textContent,c.appendChild(d),c.appendChild(u),c.appendChild(v),t.textContent="",t.appendChild(c)}},s.prototype.getColor=function(e){if("LB"===e)return["#008aef"];for(var r=e.split(""),t=[],i=0;i<r.length;i++)switch(r[i]){case"G":t.push("#63be7b");break;case"Y":t.push("#ffeb84");break;case"R":t.push("#f8696b");break;case"W":t.push("#ffffff");break;case"B":t.push("#5a8ac6");break;case"O":t.push("#ffb628");break;case"LB":t.push("#008aef");break;case"P":t.push("#d6007b")}return t},s.prototype.getGradient=function(e,r,t,i,n){if((0,f.le)(i))return this.getLinear(r,t,e/n);var a=n/2;return e>=a?this.getLinear(t,i,Math.abs((e-a)/a)):this.getLinear(r,t,e/a)},s.prototype.getLinear=function(e,r,t){return"#"+this.byteLinear(e[1]+e[2],r[1]+r[2],t)+this.byteLinear(e[3]+e[4],r[3]+r[4],t)+this.byteLinear(e[5]+e[6],r[5]+r[6],t)},s.prototype.byteLinear=function(e,r,t){var i=parseInt(e,16)*(1-t)+parseInt(r,16)*t|0;return Math.abs(i).toString(16)},s.prototype.isGreaterThanLessThan=function(e,r,t){if(te(r)){if(te(t)){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g);return"GreaterThan"===e.type?parseFloat(r)>parseFloat(t.replace(i,"")):parseFloat(r)<parseFloat(t.replace(i,""))}var n={value:t,rowIndex:0,colIndex:0,sheetIndex:0,isDate:!1,updatedVal:"",isTime:!1};return this.parent.notify(Tt,n),n.isDate||n.isTime?(e.value=n.updatedVal.toString(),"GreaterThan"===e.type?r>n.updatedVal:r<n.updatedVal):"GreaterThan"===e.type?r.toLowerCase()>t.toLowerCase():r.toLowerCase()<t.toLowerCase()}return""===r&&Number(t)>0&&"LessThan"===e.type},s.prototype.isBetWeen=function(e,r,t,i){var n=new RegExp(/[^.-a-zA-Z 0-9]+/g);if(t=t.replace(n,""),i=i.replace(n,""),te(t))return parseFloat(r)>=parseFloat(t)&&parseFloat(r)<=parseFloat(i);if(t&&i){var a={value:t,cell:{},updatedVal:""},o={value:i,cell:{},updatedVal:""};return this.parent.notify(Tt,a),this.parent.notify(Tt,o),(a.isDate||a.isTime)&&(o.isDate||o.isTime)?(e.value=a.updatedVal+","+o.updatedVal,r>=a.updatedVal&&r<=o.updatedVal):r.toLowerCase()>=t.toLowerCase()&&r.toLowerCase()<=i.toLowerCase()}return!1},s.prototype.isEqualTo=function(e,r,t){if(te(t)){var i=new RegExp(/[^.-a-zA-Z 0-9]+/g);return parseFloat(r)===parseFloat(t.replace(i,""))}var n={value:t,cell:{},updatedVal:""};return this.parent.notify(Tt,n),n.isTime||n.isDate?(e.value=n.updatedVal,r===n.updatedVal):r.toLowerCase()===t.toLowerCase()},s.prototype.isContainsText=function(e,r){var t=new RegExp(/[^.-a-zA-Z 0-9]+/g);return te(r.replace(t,""))?(r=r.replace(t,""),Hr(e)&&(e=Ut(e).toString()),e.indexOf(r)>-1):Hr(r)?(Hr(e)&&(e=Ut(e).toString()),e.indexOf(Ut(r).toString())>-1):e.toLowerCase().indexOf(r.toLowerCase())>-1},s.prototype.setCFStyle=function(e,r){switch(r.cFColor){case"RedFT":e.backgroundColor="#ffc7ce",e.color="#9c0055";break;case"YellowFT":e.backgroundColor="#ffeb9c",e.color="#9c6500";break;case"GreenFT":e.backgroundColor="#c6efce",e.color="#006100";break;case"RedF":e.backgroundColor="#ffc7ce";break;case"RedT":e.color="#9c0055"}return e},s.prototype.getModuleName=function(){return"conditionalFormatting"},s}(),Js=function(){function s(e){this.fillOptionIndex=0,this.parent=e,this.addEventListener()}return s.prototype.getfillItems=function(){var e=this.parent.serviceLocator.getService(O);return[{text:e.getConstant("CopyCells")},{text:e.getConstant("FillSeries")},{text:e.getConstant("FillFormattingOnly")},{text:e.getConstant("FillWithoutFormatting")}]},s.prototype.createAutoFillElement=function(){if(this.parent.allowAutoFill){var e=this.parent.getMainContent(),r=this.parent.createElement("div",{className:"e-autofill"});e.lastElementChild&&e.lastElementChild.classList.contains("e-ss-overlay")?e.insertBefore(r,e.getElementsByClassName("e-ss-overlay")[0]):e.appendChild(r),this.autoFillElement=r,this.getautofillDDB({id:this.parent.element.id+"_autofilloptionbtn",appendElem:e})}},s.prototype.getautofillDDB=function(e){var r=this,t=this.parent.createElement("button",{id:e.id,className:"e-filloption",attrs:{type:"button"}});return t.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"})),this.autoFillDropDown=new Oe.uw({cssClass:"e-dragfill-ddb",iconCss:"e-icons e-dragfill-icon",items:this.getfillItems(),createPopupOnClick:!0,select:function(i){r.autoFillOptionClick({type:r.getFillType(i.item.text)})},beforeOpen:function(){return r.autoFillClick()}}),this.autoFillDropDown.createElement=this.parent.createElement,this.autoFillDropDown.appendTo(t),e.appendElem.appendChild(t),this.autoFillDropDown},s.prototype.getFillType=function(e){var r=this.parent.serviceLocator.getService(O);return e===r.getConstant("CopyCells")?"CopyCells":e===r.getConstant("FillSeries")?"FillSeries":e===r.getConstant("FillFormattingOnly")?"FillFormattingOnly":"FillWithoutFormatting"},s.prototype.autoFillClick=function(){var e=this.parent.serviceLocator.getService(O),r={fillType:"FillSeries",disableItems:[""]};this.parent.notify(co,r),this.autoFillDropDown.setProperties({items:this.getfillItems()},!0),this.autoFillDropDown.removeItems(r.disableItems),this.refreshAutoFillOption(e.getConstant(r.fillType))},s.prototype.getFillRange=function(e,r,t,i){switch(i){case"Up":return[t.rowIndex,e.colIndex,e.rowIndex-1,r.colIndex];case"Right":return[e.rowIndex,r.colIndex+1,r.rowIndex,t.colIndex];case"Down":return[r.rowIndex+1,e.colIndex,t.rowIndex,r.colIndex];case"Left":return[e.rowIndex,t.colIndex,r.rowIndex,e.colIndex-1]}},s.prototype.autoFillOptionClick=function(e){var r=this.parent.serviceLocator.getService(O),t=this.parent.getActiveSheet(),i=Q(A(this.parent.selectionModule.dAutoFillCell)),n=A(t.selectedRange),a=i[0],o=i[1],l=i[2],h=i[3],p=this.getDirection({rowIndex:l,colIndex:h},{rowIndex:n[2],colIndex:n[3]}),c=[a,o,l,h],d=this.getFillRange({rowIndex:a,colIndex:o},{rowIndex:l,colIndex:h},{rowIndex:n[2],colIndex:n[3]},p);this.refreshAutoFillOption(r.getConstant(e.type)),this.parent.notify(Gt,{isUndo:!0,isPublic:!0,preventEvt:"FillWithoutFormatting"===e.type,preventReSelect:!0});var u={dataRange:t.name+"!"+z(c),fillRange:t.name+"!"+z(d),direction:p,fillType:e.type,isFillOptClick:!0};this.isVerticalFill="Down"===u.direction||"Up"===u.direction,this.parent.notify(Qr,u),this.positionAutoFillElement({isautofill:!0});var v={dataRange:u.dataRange,fillRange:u.fillRange,fillType:u.fillType,direction:u.direction,selectedRange:t.name+"!"+z(n)};this.parent.notify(Z,{eventArgs:v,action:"autofill"}),this.parent.notify(ai,{}),this.autoFillClick()},s.prototype.refreshAutoFillOption=function(e){for(var r=0;r<this.autoFillDropDown.items.length;r++)this.autoFillDropDown.items[r].iconCss="";for(r=0;r<this.autoFillDropDown.items.length;r++)this.autoFillDropDown.items[r].text===e&&(this.autoFillDropDown.items[r].iconCss="e-icons e-selected-icon");["Copy Cells","Fill Series","Fill Formatting Only","Fill Without Formatting"].indexOf(e)<0&&(this.autoFillDropDown.items[this.fillOptionIndex].iconCss=""),this.autoFillDropDown.dataBind()},s.prototype.positionAutoFillElement=function(e){var v,g,m,r=0,t=0,i=this.parent.getActiveSheet(),n=Q(A(i.selectedRange)),a=-5,o=-5,l=6,h=6,p=0===n[1]&&n[3]===i.colCount-1,c=0===n[0]&&n[2]===i.rowCount-1,d=n[2],u=n[3],y=this.parent.getCell(d,u);if(we(i,n[3])||ne(i,n[2])||y&&y.classList.contains("e-formularef-selection")||i.isProtected&&i.protectSettings.selectUnLockedCells&&Qt(this.parent,n))this.hideAutoFillElement();else if(i.isProtected&&(i.protectSettings.selectCells||i.protectSettings.selectUnLockedCells)||!i.isProtected)if(p?(a=-5,o=-1,l=6,h=2,d=n[2],u=n[1]):c&&(o=-5,a=0,l=1,h=6,d=n[0],u=n[3]),i.frozenColumns||i.frozenRows){if(c||p?(ft(this.parent,this.autoFillElement,n,"e-autofill",e&&e.preventAnimation),this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&ft(this.parent,this.autoFillDropDown.element,n,"e-filloption")):(ft(this.parent,this.autoFillElement,[d,u,d,u],"e-autofill",e&&e.preventAnimation),this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&ft(this.parent,this.autoFillDropDown.element,[d,u,d,u],"e-filloption")),this.autoFillElement){this.autoFillCell={rowIndex:d,colIndex:u};var C=this.parent.element.querySelectorAll(".e-autofill")[0];if(C){var b=C.getBoundingClientRect();this.autoFillElementPosition={left:b.left,top:b.top}}}}else m=xa(i,[d,u,d,u],this.parent.frozenRowCount(i),this.parent.frozenColCount(i),this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth),v=Ce(i,d,d,!0),g=ge(i,u,u,!0),c||(r+=v),p||(t+=g),r+=Math.round(m.top)+a,t+=Math.round(m.left)+o,this.autoFillElement&&((0,f.IV)([this.autoFillElement],"e-hide"),this.autoFillElement.style.top=r+"px",this.autoFillElement.style.left=t+"px",this.autoFillCell={rowIndex:d,colIndex:u},b=this.autoFillElement.getBoundingClientRect(),this.autoFillElementPosition={left:b.left,top:b.top},this.parent.autoFillSettings.showFillOptions&&e&&e.isautofill&&((0,f.IV)([this.autoFillDropDown.element],"e-hide"),this.autoFillDropDown.element.style.top=r+l+"px",this.autoFillDropDown.element.style.left=t+h+"px"))},s.prototype.hideAutoFillElement=function(){var e=this.parent.element;[].slice.call(e.querySelectorAll(".e-autofill")).forEach(function(r){e&&(0,f.cn)([r],"e-hide")})},s.prototype.hideAutoFillOptions=function(){var e=this.parent.element;[].slice.call(e.querySelectorAll(".e-filloption")).forEach(function(r){e&&(0,f.cn)([r],"e-hide")})},s.prototype.selectAutoFillRange=function(e){var r={clientY:mi(e.e),target:e.e.target},t={clientX:vi(e.e),target:e.e.target},i=this.parent.getActiveSheet();this.parent.notify(Yt,r),this.parent.notify(Xt,t);var n,a=this.getAutoFillRange({rowIndex:r.clientY,colIndex:t.clientX});return n=a&&a.fillRange?[a.startCell.rowIndex,a.startCell.colIndex,a.endCell.rowIndex,a.endCell.colIndex]:A(i.selectedRange),e.indexes=n,n},s.prototype.getAutoFillRange=function(e){var r=this.parent.getActiveSheet(),t=this.autoFillCell,i=Q(A(r.selectedRange)),n=i[0],a=i[1],o=i[2],l=i[3],h=Zi(i,[e.rowIndex,e.colIndex,e.rowIndex,e.colIndex],!0),p={rowIndex:n,colIndex:a},c={rowIndex:i[0],colIndex:i[1]},d={rowIndex:i[2],colIndex:i[3]},u={rowIndex:o,colIndex:l},v=this.modifyRangeForMerge(e.rowIndex,e.colIndex,t.rowIndex,t.colIndex,i);return e.rowIndex<t.rowIndex?n-e.rowIndex>e.colIndex-l&&n-e.rowIndex>a-e.colIndex?h?{startCell:p,endCell:{rowIndex:e.rowIndex,colIndex:l}}:{startCell:u,endCell:{rowIndex:v.rowIndex,colIndex:a},fillRange:[v.rowIndex,a,n-1,l],direction:"Up"}:e.colIndex>t.colIndex?{startCell:p,endCell:{rowIndex:o,colIndex:e.colIndex},fillRange:[n,l+1,o,e.colIndex],direction:"Right"}:e.colIndex<t.colIndex?h?{startCell:p,endCell:u}:{startCell:u,endCell:{rowIndex:n,colIndex:e.colIndex},fillRange:[n,e.colIndex,o,a-1],direction:"Left"}:{startCell:c,endCell:d}:e.colIndex>t.colIndex?e.rowIndex-o>e.colIndex-l?{startCell:p,endCell:{rowIndex:e.rowIndex,colIndex:l},fillRange:[o+1,a,e.rowIndex,l],direction:"Down"}:{startCell:p,endCell:{rowIndex:o,colIndex:v.colIndex},fillRange:[n,l+1,o,v.colIndex],direction:"Right"}:e.colIndex<t.colIndex?e.rowIndex-o>l-e.colIndex||e.rowIndex-n>l-e.colIndex&&e.rowIndex!==o?{startCell:p,endCell:{rowIndex:e.rowIndex,colIndex:l},fillRange:[o+1,a,e.rowIndex,l],direction:"Down"}:h?{startCell:p,endCell:u}:{startCell:u,endCell:{rowIndex:n,colIndex:v.colIndex},fillRange:[n,v.colIndex,o,a-1],direction:"Left"}:e.rowIndex>t.rowIndex?{startCell:p,endCell:{rowIndex:v.rowIndex,colIndex:l},fillRange:[o+1,a,v.rowIndex,l],direction:"Down"}:{startCell:c,endCell:d}},s.prototype.modifyRangeForMerge=function(e,r,t,i,n){var a={rowIndex:e,colIndex:r};if(this.isMergedRange(n)){var o=n[2]-n[0]+1,l=n[3]-n[1]+1,h=void 0;e<t?(h=(n[2]-e+1)%o)&&e-(o-h)>=0&&(a.rowIndex=e-(o-h)):r>i?(h=(r-n[1]+1)%l)&&(a.colIndex=r+(l-h)):r<i?(h=(n[3]-r+1)%l)&&r-(l-h)>=0&&(a.colIndex=r-(l-h)):e>t&&(h=(e-n[0]+1)%o)&&(a.rowIndex=e+(o-h))}return a},s.prototype.performAutoFill=function(e){if(e.event.clientX>this.autoFillElementPosition.left&&e.event.clientX<this.autoFillElementPosition.left+10&&e.event.clientY>this.autoFillElementPosition.top&&e.event.clientY<this.autoFillElementPosition.top+10)this.positionAutoFillElement({isautofill:!1});else{var r={clientY:mi(e.event),target:e.event.target},t={clientX:vi(e.event),target:e.event.target},i=this.parent.getActiveSheet();this.parent.notify(Yt,r),this.parent.notify(Xt,t);var n=this.getAutoFillRange({rowIndex:r.clientY,colIndex:t.clientX});if(n&&n.fillRange){var a={dataRange:i.name+"!"+e.dAutoFillCell,fillRange:i.name+"!"+z(n.fillRange),direction:n.direction,fillType:this.parent.autoFillSettings.fillType,cancel:!1};if(this.parent.notify(ue,{eventArgs:a,action:"autofill"}),a.cancel)return;var o=Qt(this.parent,n.fillRange);if(i.isProtected&&o)return void this.parent.notify(Nt,null);this.performAutoFillAction(a,n,o),this.isMergedRange(A(a.dataRange))&&this.parent.renderModule.refreshSheet(),this.positionAutoFillElement({isautofill:!this.isMergedRange(A(a.fillRange))})}}},s.prototype.refreshCell=function(e){this.parent.serviceLocator.getService("cell").refreshRange([e.rowIndex,e.colIndex,e.rowIndex,e.colIndex])},s.prototype.isRange=function(e){return e&&(e[0]!==e[2]||e[1]!==e[3])},s.prototype.fillRange=function(e){var r={dataRange:"",fillRange:"",direction:"Down",fillType:"CopyCells"},t=this.parent.getActiveSheet(),i=Q(A(t.selectedRange)),n=i[0],a=i[1],o=i[2],l=i[3],h=this.getDirection({rowIndex:n,colIndex:a},{rowIndex:o,colIndex:l},e.verticalFill),p=e.verticalFill?"Down"===h:"Right"===h;if(this.isRange(i)&&p)e.verticalFill?(r.dataRange=t.name+"!"+z([n,a,n,l]),r.fillRange=t.name+"!"+z([n+1,a,o,l])):(r.dataRange=t.name+"!"+z([n,a,o,a]),r.fillRange=t.name+"!"+z([n,a+1,o,l]));else{if(e.verticalFill){if(!n)return;r.dataRange=t.name+"!"+z([n-1,a,n-1,l])}else{if(!a)return;r.dataRange=t.name+"!"+z([n,a-1,o,a-1])}r.fillRange=t.name+"!"+z(i)}r.direction=e.verticalFill?"Down":"Right",r.fillType="CopyCells",!t.isProtected&&this.performAutoFillAction(r)},s.prototype.getDirection=function(e,r,t){if(t=(0,f.le)(t)?this.isVerticalFill:t){if(r.rowIndex<e.rowIndex)return"Up";if(r.rowIndex>e.rowIndex)return"Down";if(r.colIndex>e.colIndex)return"Right";if(r.colIndex<e.colIndex)return"Left"}else{if(r.colIndex>e.colIndex)return"Right";if(r.colIndex<e.colIndex)return"Left";if(r.rowIndex<e.rowIndex)return"Up";if(r.rowIndex>e.rowIndex)return"Down"}return null},s.prototype.performAutoFillAction=function(e,r,t){var i=this,n=this.parent.getActiveSheet(),a=this.parent.serviceLocator.getService(O);if(this.isMergedRange(A(e.fillRange))){var o=this.parent.serviceLocator.getService(ae);o.show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:a.getConstant("AutoFillMergeAlertMsg"),buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(O).getConstant("Ok"),isPrimary:!0},click:function(){o.hide(),i.parent.selectRange(e.dataRange)}}],close:function(){o.hide(),i.parent.selectRange(e.dataRange)}},!1)}else{this.isVerticalFill="Down"===e.direction||"Up"===e.direction,this.parent.notify(Qr,{dataRange:e.dataRange,fillRange:e.fillRange,direction:e.direction,fillType:e.fillType,isLockedCell:t});var l=r?z([r.startCell.rowIndex,r.startCell.colIndex,r.endCell.rowIndex,r.endCell.colIndex]):n.selectedRange;$i(this.parent,l,n),this.parent.notify(Z,{eventArgs:{dataRange:e.dataRange,fillRange:e.fillRange,fillType:e.fillType,direction:e.direction,selectedRange:l},action:"autofill"}),this.parent.notify(ai,{})}},s.prototype.getRangeData=function(e){for(var h,r=[],t=this.parent.getActiveSheet(),i=e.range[0],n=e.range[1],a=e.range[2],o=e.range[3],l=n;i<=a;)if(ne(t,i))i++;else{for(n=l;n<=o;)we(t,n)||(h=E(i,n,t),r.push(h)),n++;i++}return r},s.prototype.isMergedRange=function(e){var r=0,t=this.getRangeData({range:e,sheetIdx:this.parent.activeSheetIndex});for(r=0;r<t.length;r++)if(t[r]&&(t[r].rowSpan||t[r].colSpan))return!0;return!1},s.prototype.addEventListener=function(){this.parent.on(Ye,this.createAutoFillElement,this),this.parent.on(Bt,this.positionAutoFillElement,this),this.parent.on(ma,this.hideAutoFillOptions,this),this.parent.on(fr,this.hideAutoFillElement,this),this.parent.on(ds,this.performAutoFill,this),this.parent.on(us,this.fillRange,this),this.parent.on(fs,this.selectAutoFillRange,this),this.parent.on(wl,this.refreshCell,this),this.parent.on(kn,this.getautofillDDB,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ye,this.createAutoFillElement),this.parent.off(Bt,this.positionAutoFillElement),this.parent.off(ma,this.hideAutoFillOptions),this.parent.off(fr,this.hideAutoFillElement),this.parent.off(ds,this.performAutoFill),this.parent.off(us,this.fillRange),this.parent.off(fs,this.selectAutoFillRange),this.parent.off(wl,this.refreshCell),this.parent.off(kn,this.getautofillDDB))},s.prototype.destroy=function(){this.removeEventListener(),this.autoFillElement=null,this.autoFillElementPosition=null,this.autoFillCell=null,this.autoFillDropDown=null,this.isVerticalFill=null,this.fillOptionIndex=null,this.parent=null},s.prototype.getModuleName=function(){return"autofill"},s}(),el=function(){var s=function(e,r){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(e,r)};return function(e,r){function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),tl=function(){return tl=Object.assign||function(s){for(var e,r=1,t=arguments.length;r<t;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},tl.apply(this,arguments)},Me=function(s,e,r,t){var a,i=arguments.length,n=i<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(s,e,r,t);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);return i>3&&n&&Object.defineProperty(e,r,n),n},Ep=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return el(e,s),Me([(0,f.Z9)("")],e.prototype,"text",void 0),Me([(0,f.Z9)("")],e.prototype,"iconCss",void 0),Me([(0,f.Z9)("left")],e.prototype,"iconPosition",void 0),e}(f.rt),ch=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return el(e,s),Me([(0,f.Zz)({},Ep)],e.prototype,"header",void 0),Me([(0,f.FE)([],ze.ck)],e.prototype,"content",void 0),Me([(0,f.Z9)("")],e.prototype,"cssClass",void 0),Me([(0,f.Z9)(!1)],e.prototype,"disabled",void 0),e}(f.rt),kp=function(s){function e(r,t){return s.call(this,r)||this}return el(e,s),e.prototype.preRender=function(){},e.prototype.render=function(){this.element.id||(this.element.id=(0,f.QI)("ribbon")),this.renderRibbon()},e.prototype.destroy=function(){var r=this.element.querySelector(".e-drop-icon");if(r&&r.removeEventListener("click",this.ribbonExpandCollapse.bind(this)),this.menuItems.length){var t=document.getElementById(this.element.id+"_menu");t&&(0,f.Xr)(t,"menu").destroy()}this.toolbarObj.destroy(),this.tabObj.destroy(),this.element.innerHTML="",this.toolbarObj=null,this.tabObj=null,s.prototype.destroy.call(this)},e.prototype.getTabItems=function(){var r=this,t=[];return this.menuItems.length&&t.push({header:{text:this.initMenu(this.menuItems)},content:this.toolbarObj.element,cssClass:"e-menu-tab"}),this.items.forEach(function(i){t.push({header:i.header,content:r.toolbarObj.element})}),t},e.prototype.initMenu=function(r){var t=this,i=this.createElement("ul",{id:this.element.id+"_menu"});this.element.appendChild(i);var n=new ze.v2({cssClass:"e-file-menu",items:r,showItemOnClick:!0,beforeOpen:function(a){a.parentItem.text===r[0].text&&(n.showItemOnClick=!1),t.trigger("beforeOpen",a)},select:function(a){t.trigger("fileMenuItemSelect",a)},beforeClose:function(a){"mouseover"!==a.event.type||(0,f.oq)(a.event.target,".e-menu-popup")?(t.trigger("beforeClose",a),(!a.parentItem||a.parentItem.text===r[0].text)&&requestAnimationFrame(function(){return n.setProperties({showItemOnClick:!0},!0)})):a.cancel=!0},beforeItemRender:function(a){t.trigger("beforeFileMenuItemRender",a)}});return n.createElement=this.createElement,n.appendTo(i),i.parentElement},e.prototype.renderRibbon=function(){var r=this,t=this.createElement("div"),i=this.createElement("div");this.toolbarObj=new ze.o8({items:this.items[this.selectedTab].content,clicked:function(a){return r.trigger("clicked",a)}}),this.toolbarObj.createElement=this.createElement,this.toolbarObj.appendTo(i),this.tabObj=new ze.OK({selectedItem:this.getIndex(this.selectedTab),animation:{next:{duration:0},previous:{duration:0}},items:this.getTabItems(),selecting:function(a){if(r.menuItems.length&&0===a.selectingIndex)a.cancel=!0;else{if(a.selectingIndex===r.getIndex(r.selectedTab))return;r.updateToolbar(r.getIndex(a.selectingIndex,!0)),r.toolbarObj.dataBind(),r.element.classList.contains("e-collapsed")&&f.bi.remove(a.selectedItem,"click",r.ribbonExpandCollapse);var o=void 0;r.menuItems.length?((o=tl({},a)).selectingIndex-=1,o.selectedIndex-=1):o=a,r.trigger("selecting",o)}},selected:function(a){a.selectedIndex!==r.getIndex(r.selectedTab)&&(r.setProperties({selectedTab:r.getIndex(a.selectedIndex,!0)},!0),r.element.classList.contains("e-collapsed")&&(r.element.classList.remove("e-collapsed"),r.trigger("expandCollapse",{element:r.toolbarObj.element,expanded:!0})))},created:function(){r.toolbarObj.refreshOverflow()}}),this.element.appendChild(t),this.tabObj.createElement=this.createElement,this.tabObj.appendTo(t);var n=this.createElement("span",{className:"e-drop-icon e-icons"});n.addEventListener("click",this.ribbonExpandCollapse.bind(this)),this.element.appendChild(n)},e.prototype.ribbonExpandCollapse=function(r){var i,t={element:this.toolbarObj.element,expanded:!0};this.element.classList.contains("e-collapsed")?(i=this.tabObj.element.querySelector(".e-tab-header").getElementsByClassName("e-toolbar-item")[this.tabObj.selectedItem],this.element.classList.remove("e-collapsed"),i.classList.add("e-active"),f.bi.remove(i,"click",this.ribbonExpandCollapse),this.trigger("expandCollapse",t)):(i=this.tabObj.element.querySelector(".e-tab-header .e-toolbar-item.e-active"),this.element.classList.add("e-collapsed"),t.expanded=!1,i.classList.remove("e-active"),f.bi.add(i,"click",this.ribbonExpandCollapse,this),this.trigger("expandCollapse",t))},e.prototype.getIndex=function(r,t){return this.menuItems.length?t?r-1:r+1:r},e.prototype.updateToolbar=function(r){this.toolbarObj.items=this.items[r].content,this.toolbarObj.dataBind()},e.prototype.enableMenuItems=function(r,t,i){void 0===t&&(t=!0),this.menuItems.length&&(0,f.Xr)(document.getElementById(this.element.id+"_menu"),"menu").enableItems(r,t,i)},e.prototype.hideMenuItems=function(r,t,i){if(void 0===t&&(t=!0),this.menuItems.length){var n=(0,f.Xr)(document.getElementById(this.element.id+"_menu"),"menu");t?n.hideItems(r,i):n.showItems(r,i)}},e.prototype.addMenuItems=function(r,t,i,n){if(void 0===i&&(i=!0),this.menuItems.length){var a=(0,f.Xr)(document.getElementById(this.element.id+"_menu"),"menu");i?a.insertAfter(r.reverse(),t,n):a.insertBefore(r,t,n)}},e.prototype.hideTabs=function(r,t){var n,a,o,l,i=this;if(void 0===t&&(t=!0),t||(l=this.isAllHidden()),r.forEach(function(p){(n=i.getTabIndex(p,-1))>-1&&(t?i.items[n].cssClass.includes(" e-hide")||(i.items[n].cssClass=i.items[n].cssClass+" e-hide",i.tabObj.items[i.getIndex(n)].cssClass=i.items[n].cssClass,void 0===a&&n===i.selectedTab&&(a=!0),o=!0):i.items[n].cssClass.includes(" e-hide")&&(i.items[n].cssClass=i.items[n].cssClass.replace(" e-hide",""),i.tabObj.items[i.getIndex(n)].cssClass=i.items[n].cssClass,void 0===a&&n===i.selectedTab&&(a=!0),o=!0))}),this.setProperties({items:this.items},!0),this.tabObj.items=this.tabObj.items,this.tabObj.dataBind(),t&&(l=this.isAllHidden())&&(a=!1),!t&&l&&(a=!a),o&&l&&(this.element.classList.contains("e-collapsed")?(this.element.classList.remove("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.remove("e-hide")):(this.element.classList.add("e-collapsed"),this.element.querySelector(".e-drop-icon").classList.add("e-hide"))),a)for(var h=0;h<this.items.length;h++)if(!this.items[h].cssClass.includes(" e-hide")){this.tabObj.selectedItem=this.getIndex(h),this.tabObj.dataBind();break}},e.prototype.isAllHidden=function(){for(var r=!0,t=0;t<this.items.length;t++)if(!this.items[t].cssClass.includes(" e-hide")){r=!1;break}return r},e.prototype.enableTabs=function(r,t){var i=this;void 0===t&&(t=!0),r.forEach(function(n){var a=i.getTabIndex(n,-1);a>-1&&(i.items[a].disabled=!t,a=i.getIndex(a),i.tabObj.enableTab(a,t))}),this.setProperties({items:this.items},!0)},e.prototype.addTabs=function(r,t){var i=this,n=this.getTabIndex(t);r.forEach(function(a){a=new ch(i.items[0],"items",a,!0),i.items.splice(n,0,a),i.tabObj.addTab([{header:a.header,content:i.toolbarObj.element}],i.getIndex(n)),n++}),this.setProperties({items:this.items},!0),this.setProperties({selectedTab:this.getIndex(this.tabObj.selectedItem,!0)},!0)},e.prototype.getTabIndex=function(r,t){if(void 0===t&&(t=this.items.length),r)for(var i=0;i<this.items.length;i++)if(this.items[i].header.text===r){t=i;break}return t},e.prototype.addToolbarItems=function(r,t,i){var n=this,a=this.getTabIndex(r);(0,f.le)(i)&&(i=this.items[a].content.length),t.forEach(function(o){o=new ze.ck(n.items[a].content[0],"content",o,!0),n.items[a].content.splice(i,0,o),i++}),this.setProperties({items:this.items},!0),a===this.selectedTab&&t.length&&this.updateToolbar(a)},e.prototype.enableItems=function(r,t,i){if(void 0===i&&(i=!0),t){var n=this.getTabIndex(r,-1);if(n<0)return;for(var a=0;a<t.length;a++){if("string"==typeof t[a])for(var o=0;o<this.items[n].content.length;o++)if(this.items[n].content[o].id===t[a]){t[a]=o;break}if("string"==typeof t[a]){if(t.length-1>a)continue;return}this.items[n].content[t[a]].disabled=!i,this.setProperties({items:this.items},!0),n===this.selectedTab&&this.toolbarObj.enableItems(t[a],i)}}else this.toolbarObj.disable(!i)},e.prototype.hideToolbarItems=function(r,t,i){var n=this;void 0===i&&(i=!0);for(var a,o=0;o<this.items.length;o++)if(this.items[o].header.text===r){a=o,t.forEach(function(l){n.items[a].content[l]&&(i?n.items[a].content[l].cssClass.includes(" e-hide")||(n.items[a].content[l].cssClass=n.items[a].content[l].cssClass+" e-hide"):n.items[a].content[l].cssClass.includes(" e-hide")&&(n.items[a].content[l].cssClass=n.items[a].content[l].cssClass.replace(" e-hide","")))});break}this.setProperties({items:this.items},!0),void 0!==a&&a===this.selectedTab&&this.updateToolbar(a)},e.prototype.getModuleName=function(){return"ribbon"},e.prototype.getPersistData=function(){return this.addOnPersist([])},e.prototype.onPropertyChanged=function(r,t){for(var i=0,n=Object.keys(r);i<n.length;i++)"selectedTab"===n[i]&&(this.tabObj.selectedItem=this.getIndex(r.selectedTab),this.tabObj.dataBind())},Me([(0,f.Z9)("")],e.prototype,"cssClass",void 0),Me([(0,f.Z9)(!0)],e.prototype,"menuType",void 0),Me([(0,f.FE)([],ze.sN)],e.prototype,"menuItems",void 0),Me([(0,f.Z9)(0)],e.prototype,"selectedTab",void 0),Me([(0,f.FE)([],ch)],e.prototype,"items",void 0),Me([(0,f.ju)()],e.prototype,"selecting",void 0),Me([(0,f.ju)()],e.prototype,"fileMenuItemSelect",void 0),Me([(0,f.ju)()],e.prototype,"beforeFileMenuItemRender",void 0),Me([(0,f.ju)()],e.prototype,"beforeOpen",void 0),Me([(0,f.ju)()],e.prototype,"beforeClose",void 0),Me([(0,f.ju)()],e.prototype,"selectFormat",void 0),Me([(0,f.ju)()],e.prototype,"clicked",void 0),Me([(0,f.ju)()],e.prototype,"created",void 0),Me([(0,f.ju)()],e.prototype,"expandCollapse",void 0),Me([f.Zl],e)}(f.wA),Rp=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.render=function(){var e=this,r=this.parent.element.id,t=this.parent.createElement("input",{attrs:{type:"color"}});this.fontColorPicker=new bt.zH({value:"#000000ff",mode:"Palette",showButtons:!1,presetColors:Op,enableOpacity:!1,beforeClose:function(){return e.beforeCloseHandler(e.fontColorPicker)},open:this.openHandler.bind(this),beforeModeSwitch:function(i){return e.beforeModeSwitch(e.fontColorPicker,i)},change:function(i){var a={style:{color:e.fontColorPicker.getValue(i.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(ye,a),a.cancel?e.fontColorPicker.setProperties({value:e.fontColorPicker.getValue(i.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(a.style.color,e.fontColorPicker.element,"TextColor")},created:function(){return e.updateSelectedColor("#000000",e.fontColorPicker.element,"TextColor",!0)}}),this.fontColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(t),this.fontColorPicker.appendTo(t),t.parentElement.id=r+"_font_color_picker",(0,f.cn)([t.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-font-color"]),t=this.parent.createElement("input",{attrs:{type:"color"}}),this.filColorPicker=new bt.zH({value:"#ffff00ff",mode:"Palette",presetColors:Np,showButtons:!1,enableOpacity:!1,open:this.openHandler.bind(this),beforeClose:function(){return e.beforeCloseHandler(e.filColorPicker)},beforeModeSwitch:function(i){return e.beforeModeSwitch(e.filColorPicker,i)},change:function(i){var a={style:{backgroundColor:e.filColorPicker.getValue(i.currentValue.rgba)},onActionUpdate:!0};e.parent.notify(ye,a),a.cancel?e.filColorPicker.setProperties({value:e.filColorPicker.getValue(i.previousValue.rgba,"HEXA")},!0):e.updateSelectedColor(a.style.backgroundColor,e.filColorPicker.element,"FillColor")},created:function(){return e.updateSelectedColor("#ffff00",e.filColorPicker.element,"FillColor",!0)}}),this.filColorPicker.createElement=this.parent.createElement,this.parent.element.appendChild(t),this.filColorPicker.appendTo(t),t.parentElement.id=r+"_fill_color_picker",(0,f.cn)([t.nextElementSibling.getElementsByClassName("e-selected-color")[0]],["e-icons","e-fill-color"])},s.prototype.updateSelectedColor=function(e,r,t,i){var n=this.parent.serviceLocator.getService(O).getConstant(t);i&&r.parentElement.querySelector(".e-dropdown-btn").setAttribute("aria-label",n);var a=r.parentElement.querySelector(".e-split-colorpicker");a.setAttribute("aria-label",n+" "+e),a.firstElementChild.style.borderBottomColor=e},s.prototype.openHandler=function(e){e.element.querySelector(".e-mode-switch-btn").title=this.parent.serviceLocator.getService(O).getConstant("MoreColors")},s.prototype.beforeCloseHandler=function(e){e.modeSwitcher||e.setProperties({modeSwitcher:!0},!0),e.showButtons&&e.setProperties({showButtons:!1},!0),K(e.element.parentElement.querySelector(".e-split-colorpicker"))},s.prototype.beforeModeSwitch=function(e,r){var t=this.parent.serviceLocator.getService(O);"Picker"===r.mode?(e.showButtons=!0,e.dataBind(),r.element.querySelector(".e-apply").title=t.getConstant("Apply"),r.element.querySelector(".e-cancel").title=t.getConstant("Cancel"),r.element.querySelector(".e-mode-switch-btn").title=t.getConstant("StandardColors")):(e.showButtons=!1,e.dataBind(),r.element.querySelector(".e-mode-switch-btn").title=t.getConstant("MoreColors"))},s.prototype.destroy=function(){this.parent&&(this.removeEventListener(),this.fontColorPicker.destroy(),this.fontColorPicker=null,this.filColorPicker.destroy(),this.filColorPicker=null,this.parent=null)},s.prototype.addEventListener=function(){this.parent.on(Mo,this.render,this),this.parent.on("destroyRibbonComponents",this.destroy,this),this.parent.on(rt,this.destroy,this)},s.prototype.removeEventListener=function(){this.parent.off(Mo,this.render),this.parent.off("destroyRibbonComponents",this.destroy),this.parent.on(rt,this.destroy,this)},s}(),Na=function(){function s(e){this.border="1px solid #000000",this.fontNameIndex=5,this.numPopupWidth=0,this.findValue="",this.preTabIdx=1,this.parent=e,this.addEventListener(),new Rp(e)}return s.prototype.getModuleName=function(){return"ribbon"},s.prototype.ribbonOperation=function(e){e&&e.onPropertyChange?this.onPropertyChanged(e.prop):this.initialize()},s.prototype.initialize=function(e){if(this.parent.notify(Mo,{}),this.parent.isMobileView())this.createMobileView();else{var r=e&&(this.parent.element.querySelector(".e-formula-bar-panel")||document.getElementById(this.parent.element.id+"_sheet_panel"));this.createRibbon(r)}},s.prototype.getRibbonMenuItems=function(){var e=this.parent.serviceLocator.getService(O),r=this.parent.element.id;return[{text:this.parent.isMobileView()?"":e.getConstant("File"),iconCss:this.parent.isMobileView()?"e-icons e-file-menu-icon":null,id:r+"_File",items:[{text:e.getConstant("New"),id:r+"_New",iconCss:"e-new e-icons"},{text:e.getConstant("Open"),id:r+"_Open",iconCss:"e-open e-icons"},{text:e.getConstant("SaveAs"),iconCss:"e-save e-icons",id:r+"_Save_As",items:[{text:e.getConstant("ExcelXlsx"),id:r+"_Xlsx",iconCss:"e-xlsx e-icons"},{text:e.getConstant("ExcelXls"),id:r+"_Xls",iconCss:"e-xls e-icons"},{text:e.getConstant("CSV"),id:r+"_Csv",iconCss:"e-csv e-icons"},{text:e.getConstant("PDF"),id:r+"_Pdf",iconCss:"e-pdf e-icons"}]}]}]},s.prototype.getRibbonItems=function(){var e=this,r=this.parent.element.id,t=this.parent.serviceLocator.getService(O),i=[{header:{text:t.getConstant("Home")},content:[{prefixIcon:"e-undo-icon",tooltipText:t.getConstant("Undo")+" (Ctrl+Z)",htmlAttributes:{"aria-label":t.getConstant("Undo")},id:r+"_undo",disabled:!0},{prefixIcon:"e-redo-icon",tooltipText:t.getConstant("Redo")+" (Ctrl+Y)",htmlAttributes:{"aria-label":t.getConstant("Redo")},id:r+"_redo",disabled:!0},{type:"Separator",id:r+"_separator_1"},{prefixIcon:"e-cut-icon",tooltipText:t.getConstant("Cut")+" (Ctrl+X)",htmlAttributes:{"aria-label":t.getConstant("Cut")},id:r+"_cut"},{prefixIcon:"e-copy-icon",tooltipText:t.getConstant("Copy")+" (Ctrl+C)",htmlAttributes:{"aria-label":t.getConstant("Copy")},id:r+"_copy"},{tooltipText:t.getConstant("Paste")+" (Ctrl+V)",template:this.getPasteBtn(r),htmlAttributes:{"aria-label":t.getConstant("Paste")},id:r+"_paste",disabled:!0},{type:"Separator",id:r+"_separator_2"},{template:this.getNumFormatDDB(r),tooltipText:t.getConstant("NumberFormat"),id:r+"_number_format"},{type:"Separator",id:r+"_separator_3"},{template:this.getFontNameDDB(r),tooltipText:t.getConstant("Font"),id:r+"_font_name"},{type:"Separator",id:r+"_separator_4"},{template:this.getFontSizeDDB(r),tooltipText:t.getConstant("FontSize"),id:r+"_font_size"},{type:"Separator",id:r+"_separator_5"},{template:this.getBtn(r,"bold",t.getConstant("Bold")),tooltipText:t.getConstant("Bold")+" (Ctrl+B)",id:r+"_bold"},{template:this.getBtn(r,"italic",t.getConstant("Italic")),tooltipText:t.getConstant("Italic")+" (Ctrl+I)",id:r+"_italic"},{template:this.getBtn(r,"line-through",t.getConstant("Strikethrough")),tooltipText:t.getConstant("Strikethrough")+" (Ctrl+5)",id:r+"_line-through"},{template:this.getBtn(r,"underline",t.getConstant("Underline")),tooltipText:t.getConstant("Underline")+" (Ctrl+U)",id:r+"_underline"},{template:document.getElementById(r+"_font_color_picker"),tooltipText:t.getConstant("TextColor"),id:r+"_font_color_picker"},{type:"Separator",id:r+"_separator_6"},{template:document.getElementById(r+"_fill_color_picker"),tooltipText:t.getConstant("FillColor"),id:r+"_fill_color_picker"},{template:this.getBordersDBB(r),tooltipText:t.getConstant("Borders"),id:r+"_borders"},{template:this.getMergeSplitBtn(r),tooltipText:t.getConstant("MergeCells"),htmlAttributes:{"aria-label":t.getConstant("MergeCells")},id:r+"_merge_cells",disabled:!0},{type:"Separator",id:r+"_separator_7"},{template:this.getTextAlignDDB(r),tooltipText:t.getConstant("HorizontalAlignment"),id:r+"_text_align"},{template:this.getVerticalAlignDDB(r),tooltipText:t.getConstant("VerticalAlignment"),id:r+"_vertical_align"},{template:this.getBtn(r,"wrap",t.getConstant("WrapText"),!1),tooltipText:""+t.getConstant("WrapText"),id:r+"_wrap"}]},{header:{text:t.getConstant("Insert")},content:[{prefixIcon:"e-hyperlink-icon",text:t.getConstant("Link"),id:r+"_hyperlink",tooltipText:t.getConstant("Link"),click:function(){e.getHyperlinkDlg()}},{prefixIcon:"e-image-icon",text:t.getConstant("Image"),id:r+"_image",tooltipText:t.getConstant("Image"),click:function(){(0,f.Ys)("#"+r+"_imageUpload",e.parent.element).click()}}]},{header:{text:t.getConstant("Formulas")},content:[{prefixIcon:"e-insert-function",tooltipText:t.getConstant("InsertFunction"),text:t.getConstant("InsertFunction"),id:r+"_insert_function"}]},{header:{text:t.getConstant("Data")},content:[{prefixIcon:"e-protect-icon",text:t.getConstant("ProtectSheet"),id:r+"_protect",tooltipText:t.getConstant("ProtectSheet")},{prefixIcon:"e-password-protect-icon",text:t.getConstant("ProtectWorkbook"),id:r+"_protectworkbook",tooltipText:t.getConstant("ProtectWorkbook")},{type:"Separator",id:r+"_separator_8"},{template:this.datavalidationDDB(r),tooltipText:t.getConstant("DataValidation"),id:r+"_datavalidation"}]},{header:{text:t.getConstant("View")},content:[{prefixIcon:"e-hide-headers",text:this.getLocaleText("Headers"),id:r+"_headers",tooltipText:this.getLocaleText("Headers")},{type:"Separator",id:r+"_separator_9"},{prefixIcon:"e-hide-gridlines",text:this.getLocaleText("GridLines"),id:r+"_gridlines",tooltipText:this.getLocaleText("GridLines")},{type:"Separator",id:r+"_separator_13"},{prefixIcon:"e-freeze-pane",text:t.getConstant("FreezePanes"),id:r+"_freezepanes",tooltipText:t.getConstant("FreezePanes"),disabled:!this.parent.allowFreezePane},{prefixIcon:"e-freeze-row",text:t.getConstant("FreezeRows"),id:r+"_freezerows",tooltipText:t.getConstant("FreezeRows"),disabled:!this.parent.allowFreezePane},{prefixIcon:"e-freeze-column",text:t.getConstant("FreezeColumns"),id:r+"_freezecolumns",tooltipText:t.getConstant("FreezeColumns"),disabled:!this.parent.allowFreezePane}]}];return this.parent.allowConditionalFormat&&i.find(function(n){return n.header&&n.header.text===t.getConstant("Home")}).content.push({type:"Separator",id:r+"_separator_10"},{template:this.getCFDBB(r),tooltipText:t.getConstant("ConditionalFormatting"),id:r+"_conditionalformatting"}),this.parent.allowChart&&i.find(function(n){return n.header&&n.header.text===t.getConstant("Insert")}).content.push({type:"Separator",id:r+"_separator_11"},{template:this.getChartDDB(r,!0),text:t.getConstant("Chart"),tooltipText:t.getConstant("Chart"),id:r+"_chart"}),this.parent.allowCellFormatting&&i.find(function(n){return n.header&&n.header.text===t.getConstant("Home")}).content.push({type:"Separator",id:r+"_separator_12"},{template:this.getClearDDB(r),tooltipText:t.getConstant("Clear"),id:r+"_clear"}),(this.parent.allowSorting||this.parent.allowFiltering)&&i.find(function(n){return n.header&&n.header.text===t.getConstant("Home")}).content.push({template:this.getSortFilterDDB(r),tooltipText:t.getConstant("SortAndFilter"),id:r+"_sorting"}),this.parent.allowFindAndReplace&&i.find(function(n){return n.header&&n.header.text===t.getConstant("Home")}).content.push({template:this.getFindBtn(r),prefixIcon:"e-tbar-search-icon tb-icons",tooltipText:t.getConstant("FindReplaceTooltip"),id:r+"_find"}),i},s.prototype.getPasteBtn=function(e){var r=this,t=this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_paste",attrs:{type:"button"}})),i=this.parent.serviceLocator.getService(O);return this.pasteSplitBtn=new Oe.aW({iconCss:"e-icons e-paste-icon",items:[{text:i.getConstant("All"),id:"All"},{text:i.getConstant("Values"),id:"Values"},{text:i.getConstant("Formats"),id:"Formats"}],createPopupOnClick:!0,select:function(n){r.pasteSplitBtn.element.setAttribute("aria-label",i.getConstant("Paste")+" "+n.item.text),r.parent.notify(Ot,{type:n.item.id,isAction:!0,isInternal:!0})},click:function(){t.setAttribute("aria-label",i.getConstant("Paste")),r.parent.notify(Ot,{isAction:!0,isInternal:!0})},beforeOpen:function(n){n.element.setAttribute("aria-label",i.getConstant("Paste"))}}),this.pasteSplitBtn.createElement=this.parent.createElement,this.pasteSplitBtn.appendTo(t),t.parentElement},s.prototype.getHyperlinkDlg=function(){var t,e=A(this.parent.getActiveSheet().activeCell),r=this.parent.sheets[this.parent.getActiveSheet().id-1].rows[e[0]];(0,f.le)(r)||(t=r.cells[e[1]]),(0,f.le)(t)&&ce(e[0],e[1],this.parent.getActiveSheet(),t,!1),this.parent.notify(t&&t.hyperlink?Vi:Pi,null)},s.prototype.passwordProtectDlg=function(){this.parent.password.length>0?this.parent.notify(ua,null):document.getElementById(this.parent.element.id+"_protectworkbook").classList.contains("e-active")?(document.getElementById(this.parent.element.id+"_protectworkbook").classList.remove("e-active"),this.parent.showSheetTabs&&this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled")):this.parent.notify(fa,null)},s.prototype.getLocaleText=function(e){var t=this.parent.serviceLocator.getService(O),i=this.parent.getActiveSheet();return t.getConstant(i["show"+e]?"Hide"+e:"Show"+e)},s.prototype.getLocaleProtectText=function(e,r){var t,i=this.parent.serviceLocator.getService(O);return this.parent.getActiveSheet().isProtected?(r&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),t=i.getConstant("Unprotect"+e)):(r&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),t=i.getConstant("Protect"+e)),t},s.prototype.getLocaleProtectWorkbook=function(e,r){var t,i=this.parent.serviceLocator.getService(O);return this.parent.isProtected?(r&&this.parent.getMainContent().classList.remove("e-hide-"+e.toLowerCase()),t=i.getConstant(e)):(r&&this.parent.getMainContent().classList.add("e-hide-"+e.toLowerCase()),t=i.getConstant(e)),t},s.prototype.insertDesignChart=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.ribbon.items.length-1,i=r.getConstant("ChartDesign");if(this.parent.allowChart&&this.ribbon.items[t]&&this.ribbon.items[t].header.text!==i){this.preTabIdx=this.ribbon.selectedTab;var n=this.parent.element.id,a=[{header:{text:i},content:[{template:this.getAddChartEleDBB(n),tooltipText:r.getConstant("AddChartElement"),id:n+"add_chart_ element_chart"},{type:"Separator"},{prefixIcon:"e-switch-row-column-icon",text:r.getConstant("SwitchRowColumn"),tooltipText:r.getConstant("SwitchRowColumn"),id:n+"switch_row_column_chart",click:function(){e.parent.notify(Or,{switchRowColumn:!0,triggerEvent:!0})}},{type:"Separator"},{template:this.getChartThemeDDB(n),tooltipText:r.getConstant("ChartTheme"),id:n+"_chart_theme"},{type:"Separator"},{template:this.getChartDDB(n,!1),tooltipText:r.getConstant("ChartType"),id:n+"_chart_type"}]}];this.addRibbonTabs({items:a}),this.ribbon.tabObj.select(this.ribbon.items.length)}},s.prototype.removeDesignChart=function(){var e=this.parent.serviceLocator.getService(O),r=this.ribbon.items.length-1;this.parent.allowChart&&this.ribbon.items[r]&&this.ribbon.items[r].header.text===e.getConstant("ChartDesign")&&(this.ribbon.tabObj.select(this.preTabIdx+1),this.parent.hideRibbonTabs([e.getConstant("ChartDesign")],!0),document.getElementsByClassName("e-addchart-ddb").length>0&&document.getElementsByClassName("e-addchart-ddb")[0].remove(),document.getElementsByClassName("e-chart-type-ddb").length>0&&document.getElementsByClassName("e-chart-type-ddb")[0].remove(),document.getElementsByClassName("e-charttheme-ddb").length>0&&document.getElementsByClassName("e-charttheme-ddb")[0].remove(),delete this.ribbon.items[r].content[0],this.ribbon.items.length=this.ribbon.items.length-1)},s.prototype.createRibbon=function(e){var r=this.parent.createElement("div",{id:this.parent.element.id+"_ribbon"});this.ribbon=new kp({selectedTab:0,menuItems:this.getRibbonMenuItems(),items:this.getRibbonItems(),fileMenuItemSelect:this.fileMenuItemSelect.bind(this),beforeOpen:this.fileMenuBeforeOpen.bind(this),beforeClose:this.fileMenuBeforeClose.bind(this),clicked:this.toolbarClicked.bind(this),created:this.ribbonCreated.bind(this),selecting:this.tabSelecting.bind(this),expandCollapse:this.expandCollapseHandler.bind(this),beforeFileMenuItemRender:this.beforeRenderHandler.bind(this)}),this.ribbon.createElement=this.parent.createElement,e?this.parent.element.insertBefore(r,e):this.parent.element.appendChild(r),this.ribbon.appendTo(r)},s.prototype.tabSelecting=function(e){if(e.selectingIndex!==this.ribbon.selectedTab){if(this.parent.allowChart){var r=this.parent.serviceLocator.getService(O);if(this.ribbon.items[e.selectingIndex]&&this.ribbon.items[e.selectingIndex].header.text===r.getConstant("Insert")&&this.createChartDdb(document.getElementById(this.parent.element.id+"_chart-btn"),!0),this.ribbon.items[e.selectedIndex]&&this.ribbon.items[e.selectedIndex].header.text===r.getConstant("Insert"))for(var t=this.ribbon.items[e.selectedIndex].content,i=t.length-1;i>=0;i--)if(t[i].id===this.parent.element.id+"_chart"){var n=t[i].template;n&&n.classList.contains("e-dropdown-btn")&&this.destroyComponent(n,"dropdown-btn");break}}this.refreshRibbonContent(e.selectingIndex),this.parent.notify(xo,{activeTab:e.selectingIndex})}},s.prototype.beforeRenderHandler=function(e){var r=this.parent.serviceLocator.getService(O);e.item.text===r.getConstant("Open")&&(!this.parent.openUrl||!this.parent.allowOpen)&&e.element.classList.add("e-disabled"),e.item.text===r.getConstant("SaveAs")&&(!this.parent.saveUrl||!this.parent.allowSave)&&e.element.classList.add("e-disabled")},s.prototype.getChartThemeDDB=function(e){var r=this,t=this.parent.serviceLocator.getService(O),i=this.parent.createElement("button",{id:e+"_chart_theme",attrs:{type:"button"}});i.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text"}));var n="Material",a=this.parent.element.querySelector(".e-ss-overlay-active");if(a){var o=void 0;(o=a.querySelector(".e-chart"))?n=(0,f.Xr)(o,"chart").theme:(o=a.querySelector(".e-accumulationchart"))&&(n=(0,f.Xr)(o,"accumulationchart").theme)}var l=new Oe.uw({items:this.getChartThemeDdbItems(n),content:t.getConstant("Material"),createPopupOnClick:!0,select:function(h){r.parent.notify(Wt,{type:"mousedown"}),(!h.element||!h.element.querySelector(".e-selected-icon"))&&(l.content=h.item.text,l.dataBind(),r.parent.notify(Or,{chartTheme:h.item.id,triggerEvent:!0}),l.setProperties({items:r.getChartThemeDdbItems(h.item.id)},!0))},close:function(){return r.parent.element.focus()},cssClass:"e-flat e-charttheme-ddb",beforeOpen:function(h){r.tBarDdbBeforeOpen(h.element,h.items,r.parent.serviceLocator.getService(O).getConstant("Chart"))}});return l.createElement=this.parent.createElement,l.appendTo(i),i},s.prototype.getNumFormatDDB=function(e){var r=this,t=this.parent.createElement("button",{id:e+"_number_format",attrs:{type:"button"}});return t.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"General"})),this.numFormatDDB=new Oe.uw({items:this.getNumFormatDdbItems(e),createPopupOnClick:!0,select:function(i){return r.numDDBSelect(i)},open:function(i){return r.numDDBOpen(i)},beforeItemRender:function(i){return r.previewNumFormat(i)},cssClass:"e-flat e-numformat-ddb",beforeOpen:function(i){r.tBarDdbBeforeOpen(i.element,i.items,r.parent.serviceLocator.getService(O).getConstant("NumberFormat"))}}),this.numFormatDDB.createElement=this.parent.createElement,this.numFormatDDB.appendTo(t),t},s.prototype.getFontSizeDDB=function(e){var r=this;return this.fontSizeDdb=new Oe.uw({cssClass:"e-font-size-ddb",content:"11",createPopupOnClick:!0,items:[{text:"8"},{text:"9"},{text:"10"},{text:"11"},{text:"12"},{text:"14"},{text:"16"},{text:"18"},{text:"20"},{text:"22"},{text:"24"},{text:"26"},{text:"28"},{text:"36"},{text:"48"},{text:"72"}],beforeOpen:function(t){r.tBarDdbBeforeOpen(t.element,t.items,r.parent.serviceLocator.getService(O).getConstant("FontSize")),r.refreshSelected(r.fontSizeDdb,t.element,"content","text")},select:function(t){var i={style:{fontSize:t.item.text+"pt"},onActionUpdate:!0};r.parent.notify(ye,i),i.cancel||(r.fontSizeDdb.content=i.style.fontSize.split("pt")[0],r.fontSizeDdb.dataBind()),r.fontSizeDdb.element.setAttribute("aria-label",t.item.text)}}),this.fontSizeDdb.createElement=this.parent.createElement,this.fontSizeDdb.appendTo(this.parent.createElement("button",{id:e+"_font_size",attrs:{type:"button"}})),this.fontSizeDdb.element},s.prototype.getChartDDB=function(e,r){var i,t=this.parent.serviceLocator.getService(O);return r?(i=this.parent.createElement("button",{id:e+"_chart-btn",attrs:{type:"button"}})).appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:t.getConstant("Chart")})):((i=this.parent.createElement("button",{id:e+"_chart-type-btn",attrs:{type:"button"}})).appendChild(this.parent.createElement("span",{id:e+"_chart_type",innerHTML:t.getConstant("ChartType")})),this.createChartDdb(i,!1)),i},s.prototype.createChartDdb=function(e,r){var o,t=this,i=this.parent.serviceLocator.getService(O),n=r?"e-chart-menu":"e-chart-type-menu",a=this.parent.createElement("ul",{id:this.parent.element.id+(r?"_chart_menu":"_chart_type_menu")}),l=new Oe.uw({iconCss:"e-icons "+(r?"e-chart-icon":"e-chart-type-icon"),cssClass:r?"e-chart-ddb":"e-chart-type-ddb",target:a,createPopupOnClick:!0,beforeOpen:function(h){o=t.createChartMenu(a,n,i,l),t.tBarDdbBeforeOpen(h.element,o.items,t.parent.serviceLocator.getService(O).getConstant("Chart"))},open:function(){return K(a)},beforeClose:function(h){h.event&&(0,f.oq)(h.event.target,"."+n)?h.cancel=!0:o.destroy()}});l.createElement=this.parent.createElement,l.appendTo(e)},s.prototype.createChartMenu=function(e,r,t,i){var n=this,a=new ze.v2({cssClass:r,items:[{iconCss:"e-icons e-column",text:t.getConstant("Column"),items:[{id:"column_chart"}]},{iconCss:"e-icons e-bar",text:t.getConstant("Bar"),items:[{id:"bar_chart"}]},{iconCss:"e-icons e-area",text:t.getConstant("Area"),items:[{id:"area_chart"}]},{iconCss:"e-icons e-pie-doughnut",text:t.getConstant("PieAndDoughnut"),items:[{id:"pie_doughnut_chart"}]},{iconCss:"e-icons e-line",text:t.getConstant("Line"),items:[{id:"line_chart"}]},{iconCss:"e-icons e-scatter",text:t.getConstant("Scatter"),items:[{id:"scatter_chart"}]}],orientation:"Vertical",beforeOpen:function(ke){ke.parentItem.text===t.getConstant("Column")?(ke.element.firstChild.appendChild(o),ke.element.parentElement.classList.add("e-column-chart")):ke.parentItem.text===t.getConstant("Bar")?(ke.element.firstChild.appendChild(y),ke.element.parentElement.classList.add("e-bar-chart")):ke.parentItem.text===t.getConstant("Area")?(ke.element.firstChild.appendChild(R),ke.element.parentElement.classList.add("e-area-chart")):ke.parentItem.text===t.getConstant("Line")?(ke.element.firstChild.appendChild(Y),ke.element.parentElement.classList.add("e-line-chart")):ke.parentItem.text===t.getConstant("PieAndDoughnut")?(ke.element.firstChild.appendChild(oe),ke.element.parentElement.classList.add("e-pie-doughnut-chart")):ke.parentItem.text===t.getConstant("Radar")?(ke.element.firstChild.appendChild(ve),ke.element.parentElement.classList.add("e-radar-chart")):ke.parentItem.text===t.getConstant("Scatter")&&(ke.element.firstChild.appendChild(ir),ke.element.parentElement.classList.add("e-scatter-chart"))},select:function(ke){return n.chartSelected(ke,i)}}),o=this.parent.createElement("div",{id:"column_main",className:"e-column-main"}),l=this.parent.createElement("div",{id:"column1_text",className:"e-column1-text",innerHTML:t.getConstant("Column")}),h=this.parent.createElement("div",{id:"column1_cont",className:"e-column1-cont"}),p=this.parent.createElement("div",{id:"column2_cont",className:"e-column2-cont"});o.appendChild(l),o.appendChild(h);var c=this.parent.createElement("span",{id:"clusteredColumn",className:"e-clusteredcolumn e-column-icon e-menu-icon e-icons"}),d=this.parent.createElement("span",{id:"stackedColumn",className:"e-stackedcolumn e-column-icon e-menu-icon e-icons"}),u=this.parent.createElement("span",{id:"stackedColumn100",className:"e-stackedcolumn100 e-column-icon e-menu-icon e-icons"}),v=this.parent.createElement("span",{id:"clusteredColumn3D",className:"e-clusteredColumn3D e-column-icon"}),g=this.parent.createElement("span",{id:"stackedColumn3D",className:"e-stackedColumn3D e-column-icon"}),m=this.parent.createElement("span",{id:"stackedColumn1003D",className:"e-stackedColumn1003D e-column-icon"});c.title=t.getConstant("ClusteredColumn"),d.title=t.getConstant("StackedColumn"),u.title=t.getConstant("StackedColumn100"),m.title=t.getConstant("OrangeDataBar"),g.title=t.getConstant("LightblueDataBar"),v.title=t.getConstant("PurpleDataBar"),h.appendChild(c),h.appendChild(d),h.appendChild(u),p.appendChild(v),p.appendChild(g),p.appendChild(m);var y=this.parent.createElement("div",{id:"bar_main",className:"e-bar-main"}),C=this.parent.createElement("div",{id:"bar1_text",className:"e-bar1-text",innerHTML:t.getConstant("Bar")}),b=this.parent.createElement("div",{id:"bar1_cont",className:"e-bar1-cont"}),S=this.parent.createElement("div",{id:"bar2_cont",className:"e-bar2-cont"});y.appendChild(C),y.appendChild(b);var w=this.parent.createElement("span",{id:"clusteredBar",className:"e-clusteredbar e-bar-icon e-menu-icon e-icons"}),x=this.parent.createElement("span",{id:"stackedBar",className:"e-stackedbar e-bar-icon e-menu-icon e-icons"}),I=this.parent.createElement("span",{id:"stackedBar100",className:"e-stackedbar100 e-bar-icon e-menu-icon e-icons"}),F=this.parent.createElement("span",{id:"clusteredBar3D",className:"e-clusteredBar3D e-bar-icon"}),T=this.parent.createElement("span",{id:"stackedBar3D",className:"e-stackedBar3D e-bar-icon"}),k=this.parent.createElement("span",{id:"stackedBar1003D",className:"e-stackedBar1003D e-bar-icon"});w.title=t.getConstant("ClusteredBar"),x.title=t.getConstant("StackedBar"),I.title=t.getConstant("StackedBar100"),k.title=t.getConstant("OrangeDataBar"),T.title=t.getConstant("LightblueDataBar"),F.title=t.getConstant("PurpleDataBar"),b.appendChild(w),b.appendChild(x),b.appendChild(I),S.appendChild(F),S.appendChild(T),S.appendChild(k);var R=this.parent.createElement("div",{id:"area_main",className:"e-area-main"}),D=this.parent.createElement("div",{id:"area_text",className:"e-area-text",innerHTML:t.getConstant("Area")}),N=this.parent.createElement("div",{id:"area_cont",className:"e-area-cont"});R.appendChild(D),R.appendChild(N);var P=this.parent.createElement("span",{id:"area",className:"e-area e-area-icon e-menu-icon e-icons"}),M=this.parent.createElement("span",{id:"stackedArea",className:"e-stackedarea e-area-icon e-menu-icon e-icons"}),V=this.parent.createElement("span",{id:"stackedArea100",className:"e-stackedarea100 e-area-icon e-menu-icon e-icons"});P.title=t.getConstant("Area"),M.title=t.getConstant("StackedArea"),V.title=t.getConstant("StackedArea100"),N.appendChild(P),N.appendChild(M),N.appendChild(V);var Y=this.parent.createElement("div",{id:"line_main",className:"e-line-main"}),X=this.parent.createElement("div",{id:"line_text",className:"e-line-text",innerHTML:t.getConstant("Line")}),G=this.parent.createElement("div",{id:"line_cont",className:"e-line-cont"});Y.appendChild(X),Y.appendChild(G);var $=this.parent.createElement("span",{id:"line",className:"e-line e-line-icon e-menu-icon e-icons"}),J=this.parent.createElement("span",{id:"stackedLine",className:"e-stackedline e-line-icon e-menu-icon e-icons"}),de=this.parent.createElement("span",{id:"stackedline100",className:"e-stackedline100 e-line-icon e-menu-icon e-icons"});$.title=t.getConstant("Line"),J.title=t.getConstant("StackedLine"),de.title=t.getConstant("StackedLine100"),G.appendChild($),G.appendChild(J),G.appendChild(de);var oe=this.parent.createElement("div",{id:"pie_main",className:"e-pie-main"}),Le=this.parent.createElement("div",{id:"pie_text",className:"e-pie-text",innerHTML:t.getConstant("Pie")}),be=this.parent.createElement("div",{id:"pie_cont",className:"e-pie-cont"});oe.appendChild(Le),oe.appendChild(be);var Ae=this.parent.createElement("span",{id:"pie",className:"e-pie e-pie-icon e-menu-icon e-icons"}),Ie=this.parent.createElement("span",{id:"doughnut",className:"e-doughnut e-pie-icon e-menu-icon e-icons"});Ae.title=t.getConstant("Pie"),Ie.title=t.getConstant("Doughnut"),be.appendChild(Ae),be.appendChild(Ie);var ve=this.parent.createElement("div",{id:"radar_main",className:"e-radar-main"}),et=this.parent.createElement("div",{id:"radar_text",className:"e-radar-text",innerHTML:"Radar"}),kt=this.parent.createElement("div",{id:"radar_cont",className:"e-radar-cont"});ve.appendChild(et),ve.appendChild(kt);var gr=this.parent.createElement("span",{id:"radar",className:"e-radar e-radar-icon e-menu-icon e-icons"}),yr=this.parent.createElement("span",{id:"radar_markers",className:"e-radar-markers e-radar-icon e-menu-icon e-icons"});gr.title=t.getConstant("BlueDataBar"),yr.title=t.getConstant("GreenDataBar"),kt.appendChild(gr),kt.appendChild(yr);var ir=this.parent.createElement("div",{id:"scatter_main",className:"e-scatter-main"}),gt=this.parent.createElement("div",{id:"scatter_text",className:"e-scatter-text",innerHTML:t.getConstant("Scatter")}),yt=this.parent.createElement("div",{id:"scatter_cont",className:"e-scatter-cont"});ir.appendChild(gt),ir.appendChild(yt);var rn=this.parent.createElement("span",{id:"scatter",className:"e-scatter e-scatter-icon e-menu-icon e-icons"});return rn.title=t.getConstant("Scatter"),yt.appendChild(rn),a.createElement=this.parent.createElement,a.appendTo(e),e.classList.add("e-ul"),a},s.prototype.getAddChartEleDBB=function(e){var n,r=this,t=this.parent.serviceLocator.getService(O),i=this.parent.createElement("ul",{id:e+"_add_chart_menu"});this.addChartDdb=new Oe.uw({iconCss:"e-icons e-addchart-icon",cssClass:"e-addchart-ddb",target:i,createPopupOnClick:!0,close:function(){return K(r.parent.element)},beforeOpen:function(o){n=r.createAddChartMenu(i,t),r.tBarDdbBeforeOpen(o.element,n.items)},beforeClose:function(o){o.event&&(0,f.oq)(o.event.target,".e-addchart-menu")?o.cancel=!0:n.destroy()}}),this.addChartDdb.createElement=this.parent.createElement;var a=this.parent.createElement("button",{id:e+"_addchart",attrs:{type:"button"}});return a.appendChild(this.parent.createElement("span",{id:e+"_chart",innerHTML:t.getConstant("AddChartElement")})),this.addChartDdb.appendTo(a),this.addChartDdb.element},s.prototype.createAddChartMenu=function(e,r){var t=new ze.v2({cssClass:"e-addchart-menu",title:r.getConstant("AddChartElement"),items:[{iconCss:"e-icons e-axes",text:r.getConstant("Axes"),items:[{iconCss:"e-icons e-ph-axes",id:"PHAxes",text:r.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axes",id:"PVAxes",text:r.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-axis-title",text:r.getConstant("AxisTitle"),items:[{iconCss:"e-icons e-ph-axistitle",id:"PHAxisTitle",text:r.getConstant("PrimaryHorizontal")},{iconCss:"e-icons e-pv-axistitle",id:"PVAxisTitle",text:r.getConstant("PrimaryVertical")}]},{iconCss:"e-icons e-chart-title",text:r.getConstant("ChartTitle"),items:[{iconCss:"e-icons e-ct-none",id:"ChartTitleNone",text:r.getConstant("None")},{iconCss:"e-icons e-ct-abovechart",id:"ChartTitleAbove",text:r.getConstant("AboveChart")}]},{iconCss:"e-icons e-data-labels",text:r.getConstant("DataLabels"),items:[{iconCss:"e-icons e-dl-none",id:"DLNone",text:r.getConstant("None")},{iconCss:"e-icons e-dl-center",id:"DLCenter",text:r.getConstant("Center")},{iconCss:"e-icons e-dl-insideend",id:"DLInsideend",text:r.getConstant("InsideEnd")},{iconCss:"e-icons e-dl-insidebase",id:"DLInsidebase",text:r.getConstant("InsideBase")},{iconCss:"e-icons e-dl-outsideend",id:"DLOutsideend",text:r.getConstant("OutsideEnd")}]},{iconCss:"e-icons e-gridlines",text:r.getConstant("Gridlines"),items:[{iconCss:"e-icons e-gl-major-horizontal",id:"GLMajorHorizontal",text:r.getConstant("PrimaryMajorHorizontal")},{iconCss:"e-icons e-gl-major-vertical",id:"GLMajorVertical",text:r.getConstant("PrimaryMajorVertical")},{iconCss:"e-icons e-gl-minor-horizontal",id:"GLMinorHorizontal",text:r.getConstant("PrimaryMinorHorizontal")},{iconCss:"e-icons e-gl-minor-vertical",id:"GLMinorVertical",text:r.getConstant("PrimaryMinorVertical")}]},{iconCss:"e-icons e-legends",text:r.getConstant("Legends"),items:[{iconCss:"e-icons e-legends-none",id:"LegendNone",text:r.getConstant("None")},{iconCss:"e-icons e-legends-right",id:"LegendsRight",text:r.getConstant("Right")},{iconCss:"e-icons e-legends-left",id:"LegendsLeft",text:r.getConstant("Left")},{iconCss:"e-icons e-legends-bottom",id:"LegendsBottom",text:r.getConstant("Bottom")},{iconCss:"e-icons e-legends-top",id:"LegendsTop",text:r.getConstant("Top")}]}],orientation:"Vertical",select:this.addChartEleSelected.bind(this)});return t.createElement=this.parent.createElement,t.appendTo(e),e.classList.add("e-ul"),t},s.prototype.getCFDBB=function(e){var i,r=this,t=this.parent.createElement("ul",{id:e+"_cf_menu"});return this.cfDdb=new Oe.uw({iconCss:"e-icons e-conditionalformatting-icon",cssClass:"e-cf-ddb",target:t,createPopupOnClick:!0,close:function(){return K(r.parent.element)},beforeOpen:function(n){i=r.createCFMenu(t),r.tBarDdbBeforeOpen(n.element,i.items,r.parent.serviceLocator.getService(O).getConstant("ConditionalFormatting"))},open:function(){return K(t)},beforeClose:function(n){n.event&&(0,f.oq)(n.event.target,".e-cf-menu")?n.cancel=!0:i.destroy()}}),this.cfDdb.createElement=this.parent.createElement,this.cfDdb.appendTo(this.parent.createElement("button",{id:e+"_conditionalformatting",attrs:{type:"button"}})),this.cfDdb.element},s.prototype.createCFMenu=function(e){var r=this,t=this.parent.serviceLocator.getService(O),i=function(G,$,J){G.forEach(function(de){J.appendChild(r.parent.createElement("span",{id:de+$,className:"e-"+de.toLowerCase()+" e-cf-icon",attrs:{title:t.getConstant(de+$)}}))})},n=new ze.v2({cssClass:"e-cf-menu",items:[{iconCss:"e-icons e-hlcellrules",text:t.getConstant("HighlightCellsRules"),items:[{iconCss:"e-icons e-greaterthan",id:"cf_greaterthan_dlg",text:t.getConstant("GreaterThan")+"..."},{iconCss:"e-icons e-lessthan",id:"cf_lessthan_dlg",text:t.getConstant("LessThan")+"..."},{iconCss:"e-icons e-between",id:"cf_between_dlg",text:t.getConstant("Between")+"..."},{iconCss:"e-icons e-equalto",id:"cf_eqaulto_dlg",text:t.getConstant("CFEqualTo")+"..."},{iconCss:"e-icons e-textcontains",id:"cf_textcontains_dlg",text:t.getConstant("TextThatContains")+"..."},{iconCss:"e-icons e-adateoccuring",id:"cf_adateoccuring_dlg",text:t.getConstant("ADateOccuring")+"..."},{iconCss:"e-icons e-duplicate",id:"cf_duplicatevalues_dlg",text:t.getConstant("DuplicateValues")+"..."}]},{iconCss:"e-icons e-topbottomrules",text:t.getConstant("TopBottomRules"),items:[{iconCss:"e-icons e-top10items",id:"cf_top10items_dlg",text:t.getConstant("Top10Items")+"..."},{iconCss:"e-icons e-top10",id:"cf_top10_dlg",text:t.getConstant("Top10")+" %..."},{iconCss:"e-icons e-bottom10items",id:"cf_bottom10items_dlg",text:t.getConstant("Bottom10Items")+"..."},{iconCss:"e-icons e-bottom10",id:"cf_bottom10_dlg",text:t.getConstant("Bottom10")+" %..."},{iconCss:"e-icons e-aboveaverage",id:"cf_aboveaverage_dlg",text:t.getConstant("AboveAverage")+"..."},{iconCss:"e-icons e-belowaverage",id:"cf_belowaverage_dlg",text:t.getConstant("BelowAverage")+"..."}]},{iconCss:"e-icons e-databars",text:t.getConstant("DataBars"),items:[{id:"db_icons1"},{id:"db_icons2"}]},{iconCss:"e-icons e-colorscales",text:t.getConstant("ColorScales"),items:[{id:"cs_icons1"},{id:"cs_icons2"},{id:"cs_icons3"}]},{iconCss:"e-icons e-iconsets",text:t.getConstant("IconSets"),items:[{id:"is_icons"}]},{iconCss:"e-icons e-clearrules",text:t.getConstant("ClearRules"),items:[{id:"cf_cr_cells",text:t.getConstant("SelectedCells")},{id:"cf_cr_sheet",text:t.getConstant("EntireSheet")}]}],orientation:"Vertical",beforeOpen:function(G){"e-icons e-databars"===G.parentItem.iconCss?(G.element.parentElement.classList.add("e-databars"),i(["Blue","Green","Red"],"DataBar",G.element.firstChild),i(["Orange","LightBlue","Purple"],"DataBar",G.element.lastChild)):"e-icons e-colorscales"===G.parentItem.iconCss?(G.element.parentElement.classList.add("e-colorscales"),i(["GYR","RYG","GWR","RWG"],"ColorScale",G.element.firstChild),i(["BWR","RWB","WR","RW"],"ColorScale",G.element.querySelector("#cs_icons2")),i(["GW","WG","GY","YG"],"ColorScale",G.element.lastChild)):"e-icons e-iconsets"===G.parentItem.iconCss&&(G.element.parentElement.classList.add("e-iconsets"),G.element.firstChild.appendChild(a))},select:this.cfSelected.bind(this)});n.createElement=this.parent.createElement;var a=this.parent.createElement("div",{id:"is",className:"e-is"}),o=this.parent.createElement("div",{id:"is1",className:"e-is1",innerHTML:"Directional"}),l=this.parent.createElement("div",{id:"is2",className:"e-is2"}),h=this.parent.createElement("div",{id:"is3",className:"e-is3",innerHTML:"Shapes"}),p=this.parent.createElement("div",{id:"is4",className:"e-is4"}),c=this.parent.createElement("div",{id:"is5",className:"e-is5",innerHTML:"Indicators"}),d=this.parent.createElement("div",{id:"is6",className:"e-is6"}),u=this.parent.createElement("div",{id:"is7",className:"e-is7",innerHTML:"Ratings"}),v=this.parent.createElement("div",{id:"is8",className:"e-is8"});o.title=t.getConstant("GYColorScale"),l.title=t.getConstant("YGColorScale"),h.title=t.getConstant("GYColorScale"),p.title=t.getConstant("YGColorScale"),c.title=t.getConstant("GYColorScale"),d.title=t.getConstant("YGColorScale"),u.title=t.getConstant("GYColorScale"),v.title=t.getConstant("YGColorScale"),a.appendChild(o),a.appendChild(l),a.appendChild(h),a.appendChild(p),a.appendChild(c),a.appendChild(d),a.appendChild(u),a.appendChild(v);var g=this.parent.createElement("div",{id:"ThreeArrows",className:"e-3arrows e-is-wrapper"}),m=this.parent.createElement("div",{id:"ThreeArrowsGray",className:"e-3arrowsgray e-is-wrapper"}),y=this.parent.createElement("div",{id:"ThreeTriangles",className:"e-3triangles e-is-wrapper"}),C=this.parent.createElement("div",{id:"FourArrowsGray",className:"e-4arrowsgray e-is-wrapper"}),b=this.parent.createElement("div",{id:"FourArrows",className:"e-4arrows e-is-wrapper"}),S=this.parent.createElement("div",{id:"FiveArrowsGray",className:"e-5arrowsgray e-is-wrapper"}),w=this.parent.createElement("div",{id:"FiveArrows",className:"e-5arrows e-is-wrapper"});g.title=t.getConstant("ThreeArrowsColor"),m.title=t.getConstant("ThreeArrowsGray"),y.title=t.getConstant("ThreeTriangles"),C.title=t.getConstant("FourArrowsColor"),b.title=t.getConstant("FourArrowsGray"),S.title=t.getConstant("FiveArrowsColor"),w.title=t.getConstant("FiveArrowsGray"),l.appendChild(g),l.appendChild(m),l.appendChild(y),l.appendChild(C),l.appendChild(b),l.appendChild(S),l.appendChild(w);var x=this.parent.createElement("div",{id:"ThreeTrafficLights1",className:"e-3trafficlights e-is-wrapper"}),I=this.parent.createElement("div",{id:"ThreeTrafficLights2",className:"e-3rafficlights2 e-is-wrapper"}),F=this.parent.createElement("div",{id:"ThreeSigns",className:"e-3signs e-is-wrapper"}),T=this.parent.createElement("div",{id:"FourTrafficLights",className:"e-4trafficlights e-is-wrapper"}),k=this.parent.createElement("div",{id:"FourRedToBlack",className:"e-4redtoblack e-is-wrapper"});x.title=t.getConstant("ThreeTrafficLights1"),I.title=t.getConstant("ThreeTrafficLights2"),F.title=t.getConstant("ThreeSigns"),T.title=t.getConstant("FourTrafficLights"),k.title=t.getConstant("RedToBlack"),p.appendChild(x),p.appendChild(I),p.appendChild(F),p.appendChild(T),p.appendChild(k);var R=this.parent.createElement("div",{id:"ThreeSymbols",className:"e-3symbols e-is-wrapper"}),D=this.parent.createElement("div",{id:"ThreeSymbols2",className:"e-3symbols2 e-is-wrapper"}),N=this.parent.createElement("div",{id:"ThreeFlags",className:"e-3flags e-is-wrapper"});R.title=t.getConstant("ThreeSymbols1"),D.title=t.getConstant("ThreeSymbols2"),N.title=t.getConstant("ThreeFlags"),d.appendChild(R),d.appendChild(D),d.appendChild(N);var P=this.parent.createElement("div",{id:"ThreeStars",className:"e-3stars e-is-wrapper"}),M=this.parent.createElement("div",{id:"FourRating",className:"e-4rating e-is-wrapper"}),V=this.parent.createElement("div",{id:"FiveQuarters",className:"e-5quarters e-is-wrapper"}),Y=this.parent.createElement("div",{id:"FiveRating",className:"e-5rating e-is-wrapper"}),X=this.parent.createElement("div",{id:"FiveBoxes",className:"e-5boxes e-is-wrapper"});return P.title=t.getConstant("ThreeStars"),M.title=t.getConstant("FourRatings"),V.title=t.getConstant("FiveQuarters"),Y.title=t.getConstant("FiveRatings"),X.title=t.getConstant("FiveBoxes"),v.appendChild(P),v.appendChild(M),v.appendChild(V),v.appendChild(Y),v.appendChild(X),g.appendChild(this.createElement("span","e-3arrows-1 e-iconsetspan")),g.appendChild(this.createElement("span","e-3arrows-2 e-iconsetspan")),g.appendChild(this.createElement("span","e-3arrows-3 e-iconsetspan")),m.appendChild(this.createElement("span","e-3arrowsgray-1 e-iconsetspan")),m.appendChild(this.createElement("span","e-3arrowsgray-2 e-iconsetspan")),m.appendChild(this.createElement("span","e-3arrowsgray-3 e-iconsetspan")),y.appendChild(this.createElement("span","e-3triangles-1 e-iconsetspan")),y.appendChild(this.createElement("span","e-3triangles-2 e-iconsetspan")),y.appendChild(this.createElement("span","e-3triangles-3 e-iconsetspan")),C.appendChild(this.createElement("span","e-4arrowsgray-1 e-iconsetspan")),C.appendChild(this.createElement("span","e-4arrowsgray-2 e-iconsetspan")),C.appendChild(this.createElement("span","e-4arrowsgray-3 e-iconsetspan")),C.appendChild(this.createElement("span","e-4arrowsgray-4 e-iconsetspan")),b.appendChild(this.createElement("span","e-4arrows-1 e-iconsetspan")),b.appendChild(this.createElement("span","e-4arrows-2 e-iconsetspan")),b.appendChild(this.createElement("span","e-4arrows-3 e-iconsetspan")),b.appendChild(this.createElement("span","e-4arrows-4 e-iconsetspan")),S.appendChild(this.createElement("span","e-5arrowsgray-1 e-iconsetspan")),S.appendChild(this.createElement("span","e-5arrowsgray-2 e-iconsetspan")),S.appendChild(this.createElement("span","e-5arrowsgray-3 e-iconsetspan")),S.appendChild(this.createElement("span","e-5arrowsgray-4 e-iconsetspan")),S.appendChild(this.createElement("span","e-5arrowsgray-5 e-iconsetspan")),w.appendChild(this.createElement("span","e-5arrows-1 e-iconsetspan")),w.appendChild(this.createElement("span","e-5arrows-2 e-iconsetspan")),w.appendChild(this.createElement("span","e-5arrows-3 e-iconsetspan")),w.appendChild(this.createElement("span","e-5arrows-4 e-iconsetspan")),w.appendChild(this.createElement("span","e-5arrows-5 e-iconsetspan")),x.appendChild(this.createElement("span","e-3trafficlights-1 e-iconsetspan")),x.appendChild(this.createElement("span","e-3trafficlights-2 e-iconsetspan")),x.appendChild(this.createElement("span","e-3trafficlights-3 e-iconsetspan")),I.appendChild(this.createElement("span","e-3rafficlights2-1 e-iconsetspan")),I.appendChild(this.createElement("span","e-3rafficlights2-2 e-iconsetspan")),I.appendChild(this.createElement("span","e-3rafficlights2-3 e-iconsetspan")),F.appendChild(this.createElement("span","e-3signs-1 e-iconsetspan")),F.appendChild(this.createElement("span","e-3signs-2 e-iconsetspan")),F.appendChild(this.createElement("span","e-3signs-3 e-iconsetspan")),T.appendChild(this.createElement("span","e-4trafficlights-1 e-iconsetspan")),T.appendChild(this.createElement("span","e-4trafficlights-2 e-iconsetspan")),T.appendChild(this.createElement("span","e-4trafficlights-3 e-iconsetspan")),T.appendChild(this.createElement("span","e-4trafficlights-4 e-iconsetspan")),k.appendChild(this.createElement("span","e-4redtoblack-1 e-iconsetspan")),k.appendChild(this.createElement("span","e-4redtoblack-2 e-iconsetspan")),k.appendChild(this.createElement("span","e-4redtoblack-3 e-iconsetspan")),k.appendChild(this.createElement("span","e-4redtoblack-4 e-iconsetspan")),R.appendChild(this.createElement("span","e-3symbols-1 e-iconsetspan")),R.appendChild(this.createElement("span","e-3symbols-2 e-iconsetspan")),R.appendChild(this.createElement("span","e-3symbols-3 e-iconsetspan")),D.appendChild(this.createElement("span","e-3symbols2-1 e-iconsetspan")),D.appendChild(this.createElement("span","e-3symbols2-2 e-iconsetspan")),D.appendChild(this.createElement("span","e-3symbols2-3 e-iconsetspan")),N.appendChild(this.createElement("span","e-3flags-1 e-iconsetspan")),N.appendChild(this.createElement("span","e-3flags-2 e-iconsetspan")),N.appendChild(this.createElement("span","e-3flags-3 e-iconsetspan")),P.appendChild(this.createElement("span","e-3stars-1 e-iconsetspan")),P.appendChild(this.createElement("span","e-3stars-2 e-iconsetspan")),P.appendChild(this.createElement("span","e-3stars-3 e-iconsetspan")),M.appendChild(this.createElement("span","e-4rating-1 e-iconsetspan")),M.appendChild(this.createElement("span","e-4rating-2 e-iconsetspan")),M.appendChild(this.createElement("span","e-4rating-3 e-iconsetspan")),M.appendChild(this.createElement("span","e-4rating-4 e-iconsetspan")),V.appendChild(this.createElement("span","e-5quarters-1 e-iconsetspan")),V.appendChild(this.createElement("span","e-5quarters-2 e-iconsetspan")),V.appendChild(this.createElement("span","e-5quarters-3 e-iconsetspan")),V.appendChild(this.createElement("span","e-5quarters-4 e-iconsetspan")),V.appendChild(this.createElement("span","e-5quarters-5 e-iconsetspan")),Y.appendChild(this.createElement("span","e-5rating-1 e-iconsetspan")),Y.appendChild(this.createElement("span","e-5rating-2 e-iconsetspan")),Y.appendChild(this.createElement("span","e-5rating-3 e-iconsetspan")),Y.appendChild(this.createElement("span","e-5rating-4 e-iconsetspan")),Y.appendChild(this.createElement("span","e-5rating-5 e-iconsetspan")),X.appendChild(this.createElement("span","e-5boxes-1 e-iconsetspan")),X.appendChild(this.createElement("span","e-5boxes-2 e-iconsetspan")),X.appendChild(this.createElement("span","e-5boxes-3 e-iconsetspan")),X.appendChild(this.createElement("span","e-5boxes-4 e-iconsetspan")),X.appendChild(this.createElement("span","e-5boxes-5 e-iconsetspan")),n.createElement=this.parent.createElement,n.appendTo(e),e.classList.add("e-ul"),n},s.prototype.createElement=function(e,r){return this.parent.createElement(e,{className:r})},s.prototype.getBordersDBB=function(e){var i,r=this,t=this.parent.createElement("ul",{id:e+"_borders_menu"});return this.cPickerEle=this.parent.createElement("input",{id:e+"_cell_border_color",attrs:{type:"color"}}),this.parent.element.appendChild(this.cPickerEle),this.colorPicker=new bt.zH({cssClass:"e-border-colorpicker",mode:"Palette",inline:!0,change:function(n){var a=r.border.split(" ");a[2]=n.currentValue.hex,r.border=a.join(" ")}}),this.colorPicker.createElement=this.parent.createElement,this.colorPicker.appendTo(this.cPickerEle),this.bordersDdb=new Oe.uw({iconCss:"e-icons e-bottom-borders",cssClass:"e-borders-ddb",target:t,createPopupOnClick:!0,beforeOpen:function(n){i=r.createBorderMenu(t),r.tBarDdbBeforeOpen(n.element,i.items,r.parent.serviceLocator.getService(O).getConstant("Borders"),1)},open:function(){return K(t)},beforeClose:function(n){n.event&&(0,f.oq)(n.event.target,".e-borders-menu")?n.cancel=!0:i.destroy()},close:function(){return K(r.bordersDdb.element)}}),this.bordersDdb.createElement=this.parent.createElement,this.bordersDdb.appendTo(this.parent.createElement("button",{id:e+"_borders",attrs:{type:"button"}})),this.bordersDdb.element},s.prototype.createBorderMenu=function(e){var r=this,t=this.parent.serviceLocator.getService(O),i=this.parent.element.id,n=new ze.v2({cssClass:"e-borders-menu",items:[{iconCss:"e-icons e-top-borders",text:t.getConstant("TopBorders"),id:i+"_border_topborders"},{iconCss:"e-icons e-left-borders",text:t.getConstant("LeftBorders"),id:i+"_border_leftborders"},{iconCss:"e-icons e-right-borders",text:t.getConstant("RightBorders"),id:i+"_border_rightborders"},{iconCss:"e-icons e-bottom-borders",text:t.getConstant("BottomBorders"),id:i+"_border_bottomborders"},{iconCss:"e-icons e-all-borders",text:t.getConstant("AllBorders"),id:i+"_border_allborders"},{iconCss:"e-icons e-horizontal-borders",text:t.getConstant("HorizontalBorders"),id:i+"_border_horizontalborders"},{iconCss:"e-icons e-vertical-borders",text:t.getConstant("VerticalBorders"),id:i+"_border_verticalborders"},{iconCss:"e-icons e-outside-borders",text:t.getConstant("OutsideBorders"),id:i+"_border_outsideborders"},{iconCss:"e-icons e-inside-borders",text:t.getConstant("InsideBorders"),id:i+"_border_insideborders"},{iconCss:"e-icons e-no-borders",text:t.getConstant("NoBorders"),id:i+"_border_noborders"},{separator:!0},{text:t.getConstant("BorderColor"),items:[{id:i+"_border_colors"}],id:i+"_border_bordercolor"},{text:t.getConstant("BorderStyle"),items:[{iconCss:"e-icons e-selected-icon",id:i+"_1px"},{id:i+"_2px"},{id:i+"_3px"},{id:i+"_dashed"},{id:i+"_dotted"},{id:i+"_double"}]}],orientation:"Vertical",beforeOpen:function(a){if(a.parentItem.id===i+"_border_bordercolor"){r.colorPicker.refresh();var o=r.colorPicker.element.parentElement;a.element.firstElementChild.appendChild(o),o.style.display="inline-block",a.element.parentElement.classList.add("e-border-color")}else a.element.classList.add("e-border-style")},beforeClose:function(a){if(a.parentItem.id===i+"_border_bordercolor")if(!(0,f.oq)(a.event.target,".e-border-colorpicker")||(0,f.oq)(a.event.target,".e-apply")||(0,f.oq)(a.event.target,".e-cancel")){r.colorPicker=(0,f.Xr)(r.cPickerEle,"colorpicker"),"Picker"===r.colorPicker.mode&&(r.colorPicker.mode="Palette",r.colorPicker.dataBind());var o=r.colorPicker.element.parentElement;o.style.display="",r.parent.element.appendChild(o)}else a.cancel=!0},onOpen:function(a){a.parentItem.id===i+"_border_bordercolor"&&(a.element.parentElement.style.overflow="visible")},select:function(a){r.borderSelected(a,n)}});return n.createElement=this.parent.createElement,n.appendTo(e),e.classList.add("e-ul"),n},s.prototype.chartSelected=function(e,r){var t=!(0,f.le)((0,f.oq)(e.element,".e-chart-menu")),i=e.element.id;"column_chartbar_chartarea_chartpie_doughnut_chartline_chartradar_chartscatter_chart".includes(i)&&(e.item&&(!e.item.items||!e.item.items.length)&&r.toggle(),this.parent.notify(as,{action:i,id:e.event.target.id,isChart:t}))},s.prototype.addChartEleSelected=function(e){this.parent.notify(Or,{addChartEle:e.element.id,triggerEvent:!0}),e.item&&(!e.item.items||!e.item.items.length)&&this.addChartDdb.toggle()},s.prototype.cfSelected=function(e){var r=this.parent.getActiveSheet();if(e.item.id.includes("_dlg"))this.parent.notify(Qo,{action:e.item.text});else if(e.item.id.includes("icons")){var t=e.event.target;this.parent.notify(Xr,{cfModel:{type:t.id||t.parentElement.id,range:r.selectedRange},isAction:!0})}else"cf_cr_cells"===e.item.id?this.parent.notify(_t,{range:r.selectedRange,isAction:!0}):"cf_cr_sheet"===e.item.id&&(this.parent.conditionalFormat=null,this.parent.notify(_t,{isAction:!0}));e.item&&(!e.item.items||!e.item.items.length)&&this.cfDdb.toggle()},s.prototype.borderSelected=function(e,r){this.bordersDdb.element.setAttribute("aria-label",e.item.text);var t=this.parent.element.id;if(!e.item.items.length&&e.item.id!==t+"_border_colors"){if(!e.item.text){var i=this.border.split(" "),n="solid"===i[1]?t+"_"+i[0]:t+"_"+i[1];if(n===e.item.id)return;return e.item.id===t+"_1px"||e.item.id===t+"_2px"||e.item.id===t+"_3px"?(i[0]=e.item.id.split(t+"_")[1],i[1]="solid"):(i[1]=e.item.id.split(t+"_")[1],i[0]="double"===i[1]?"3px":"1px"),this.border=i.join(" "),r.items[12].items.forEach(function(a){a.id===n&&(a.iconCss=null),a.id===e.item.id&&(a.iconCss="e-icons e-selected-icon")}),void r.setProperties({items:r.items},!0)}switch(this.bordersDdb.toggle(),this.parent.showSpinner(),e.item.id){case t+"_border_topborders":this.parent.notify(ye,{style:{borderTop:this.border},onActionUpdate:!0});break;case t+"_border_leftborders":this.parent.notify(ye,{style:{borderLeft:this.border},onActionUpdate:!0});break;case t+"_border_rightborders":this.parent.notify(ye,{style:{borderRight:this.border},onActionUpdate:!0});break;case t+"_border_bottomborders":this.parent.notify(ye,{style:{borderBottom:this.border},onActionUpdate:!0});break;case t+"_border_allborders":this.parent.notify(ye,{style:{border:this.border},onActionUpdate:!0});break;case t+"_border_horizontalborders":this.parent.notify(ye,{style:{border:this.border},onActionUpdate:!0,borderType:"Horizontal"});break;case t+"_border_verticalborders":this.parent.notify(ye,{style:{border:this.border},onActionUpdate:!0,borderType:"Vertical"});break;case t+"_border_outsideborders":this.parent.notify(ye,{style:{border:this.border},onActionUpdate:!0,borderType:"Outer"});break;case t+"_border_insideborders":this.parent.notify(ye,{style:{border:this.border},onActionUpdate:!0,borderType:"Inner"});break;case t+"_border_noborders":this.parent.notify(ye,{style:{border:""},onActionUpdate:!0})}this.parent.hideSpinner()}},s.prototype.getFontNameDDB=function(e){var r=this,t=this.parent.createElement("button",{id:e+"_font_name",attrs:{type:"button"}});return t.appendChild(this.parent.createElement("span",{className:"e-tbar-btn-text",innerHTML:"Calibri"})),this.fontNameDdb=new Oe.uw({cssClass:"e-font-family",items:this.getFontFamilyItems(),createPopupOnClick:!0,select:function(i){var n={style:{fontFamily:i.item.text},onActionUpdate:!0};r.parent.notify(ye,n),t.setAttribute("aria-label",i.item.text),n.cancel||r.refreshFontNameSelection(n.style.fontFamily)},beforeOpen:function(i){r.tBarDdbBeforeOpen(i.element,i.items,r.parent.serviceLocator.getService(O).getConstant("Font"))}}),this.fontNameDdb.createElement=this.parent.createElement,this.fontNameDdb.appendTo(t),t},s.prototype.getBtn=function(e,r,t,i){void 0===i&&(i=!0);var n=new at.zx({iconCss:"e-icons e-"+r+"-icon",cssClass:"e-flat",isToggle:!0});return n.createElement=this.parent.createElement,n.appendTo(this.parent.createElement("button",{id:e+"_"+r,attrs:{"aria-label":t,type:"button"}})),i&&n.element.addEventListener("click",this.toggleBtnClicked.bind(this)),n.element},s.prototype.datavalidationDDB=function(e){var i,r=this,t=this.parent.serviceLocator.getService(O);return this.datavalidationDdb=new Oe.uw({cssClass:"e-datavalidation-ddb",iconCss:"e-datavalidation-icon e-icons",content:t.getConstant("DataValidation"),items:[{text:t.getConstant("DataValidation")},{text:t.getConstant("HighlightInvalidData")},{text:t.getConstant("ClearHighlight")},{text:t.getConstant("ClearValidation")}],createPopupOnClick:!0,beforeOpen:function(n){r.refreshSelected(r.datavalidationDdb,n.element,"iconCss"),n.element.setAttribute("aria-label",t.getConstant("DataValidation"))},select:function(n){switch(n.item.text){case t.getConstant("DataValidation"):r.parent.notify(Go,null);break;case t.getConstant("HighlightInvalidData"):r.parent.notify(_i,{isRemoveHighlight:!1});break;case t.getConstant("ClearHighlight"):r.parent.notify(_i,{isRemoveHighlight:!0});break;case t.getConstant("ClearValidation"):r.parent.notify(ji,{isAction:!0});break;default:i=n.item.text===t.getConstant("SortAscending")?"Ascending":"Descending",r.parent.notify(Fr,{sortOptions:{sortDescriptors:{order:i}}})}r.datavalidationDdb.element.setAttribute("aria-label",n.item.text)}}),this.datavalidationDdb.createElement=this.parent.createElement,this.datavalidationDdb.appendTo(this.parent.createElement("button",{id:e+"_datavalidation",attrs:{type:"button"}})),this.datavalidationDdb.element},s.prototype.getTextAlignDDB=function(e){var r=this,t=this.parent.serviceLocator.getService(O);return this.textAlignDdb=new Oe.uw({cssClass:"e-align-ddb",iconCss:"e-icons e-left-icon",items:[{iconCss:"e-icons e-left-icon"},{iconCss:"e-icons e-center-icon"},{iconCss:"e-icons e-right-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(i){r.refreshSelected(r.textAlignDdb,i.element,"iconCss"),i.element.setAttribute("aria-label",t.getConstant("HorizontalAlignment"))},select:function(i){var n={style:{textAlign:i.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};r.parent.notify(ye,n),n.cancel||(r.textAlignDdb.iconCss="e-icons e-"+n.style.textAlign+"-icon",r.textAlignDdb.dataBind()),r.textAlignDdb.element.setAttribute("aria-label",t.getConstant("HorizontalAlignment")+" "+t.getConstant("Align"+r.getAlignText(i)))}}),this.textAlignDdb.createElement=this.parent.createElement,this.textAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_text_align",attrs:{type:"button"}})),this.textAlignDdb.element},s.prototype.getVerticalAlignDDB=function(e){var r=this,t=this.parent.serviceLocator.getService(O);return this.verticalAlignDdb=new Oe.uw({cssClass:"e-align-ddb",iconCss:"e-icons e-bottom-icon",items:[{iconCss:"e-icons e-top-icon"},{iconCss:"e-icons e-middle-icon"},{iconCss:"e-icons e-bottom-icon"}],beforeItemRender:this.alignItemRender.bind(this),createPopupOnClick:!0,beforeOpen:function(i){r.refreshSelected(r.verticalAlignDdb,i.element,"iconCss"),i.element.setAttribute("aria-label",t.getConstant("VerticalAlignment"))},select:function(i){var n={style:{verticalAlign:i.item.iconCss.split(" e-")[1].split("-icon")[0]},onActionUpdate:!0};r.parent.notify(ye,n),n.cancel||(r.verticalAlignDdb.iconCss="e-icons e-"+n.style.verticalAlign+"-icon",r.verticalAlignDdb.dataBind()),r.verticalAlignDdb.element.setAttribute("aria-label",t.getConstant("VerticalAlignment")+" "+t.getConstant("Align"+r.getAlignText(i)))}}),this.verticalAlignDdb.createElement=this.parent.createElement,this.verticalAlignDdb.appendTo(this.parent.createElement("button",{id:e+"_vertical_align",attrs:{type:"button"}})),this.verticalAlignDdb.element},s.prototype.getMergeSplitBtn=function(e){var r=this;this.parent.element.appendChild(this.parent.createElement("button",{id:e+"_merge",attrs:{type:"button"}}));var t=this.parent.serviceLocator.getService(O);return this.mergeSplitBtn=new Oe.aW({cssClass:"e-merge-ddb",iconCss:"e-icons e-merge-icon",createPopupOnClick:!0,items:[{text:t.getConstant("MergeAll"),id:e+"_merge_all"},{text:t.getConstant("MergeHorizontally"),id:e+"_merge_horizontally"},{text:t.getConstant("MergeVertically"),id:e+"_merge_vertically"},{separator:!0,id:e+"_merge_separator"},{text:t.getConstant("Unmerge"),id:e+"_unmerge"}],select:this.mergeSelectHandler.bind(this),click:function(i){i.element.setAttribute("aria-label",t.getConstant("MergeCells")),i.element.classList.contains("e-active")?(r.toggleActiveState(!1),r.unMerge()):(r.toggleActiveState(!0),r.merge(r.parent.element.id+"_merge_all"))},created:function(){r.mergeSplitBtn.element.title=t.getConstant("MergeCells"),r.mergeSplitBtn.element.nextElementSibling.title=t.getConstant("SelectMergeType")},beforeOpen:function(i){return i.element.setAttribute("aria-label",t.getConstant("MergeCells"))}}),this.mergeSplitBtn.createElement=this.parent.createElement,this.mergeSplitBtn.appendTo("#"+e+"_merge"),this.mergeSplitBtn.element.parentElement},s.prototype.mergeSelectHandler=function(e){e.item.id===this.parent.element.id+"_unmerge"?this.unMerge():this.merge(e.item.id),this.mergeSplitBtn.element.setAttribute("aria-label",e.item.text)},s.prototype.unMerge=function(e){this.parent.showSpinner();var r=this.parent.getActiveSheet().selectedRange;this.parent.notify(tt,{merge:!1,range:e&&e.range||r,isAction:!0,refreshRibbon:!0,type:"All"}),this.parent.hideSpinner()},s.prototype.merge=function(e){for(var n,a,r=this,t=this.parent.getActiveSheet(),i=A(t.selectedRange),o=i[0];o<=i[2];o++)for(var l=i[1];l<=i[3];l++)o===i[0]&&l===i[1]&&e.includes("merge_all")||o===i[0]&&e.includes("merge_vertically")||l===i[1]&&e.includes("_merge_horizontally")||((n=E(o,l,t)||{}).value||n.formula)&&(a=!0);if(a){var h=this.parent.serviceLocator.getService(ae);h.show({target:this.parent.element,height:200,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-merge-alert-dlg",content:this.parent.serviceLocator.getService(O).getConstant("MergeCellsAlert"),beforeOpen:function(p){var c={dialogName:"MergeAlertDialog",element:p.element,target:p.target,cancel:p.cancel};r.parent.trigger("dialogBeforeOpen",c),c.cancel&&(p.cancel=!0)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(O).getConstant("Ok"),isPrimary:!0},click:function(){h.hide(),r.performMerge(e)}}]})}else this.performMerge(e)},s.prototype.performMerge=function(e){var r=this.parent.element.id;switch(this.parent.showSpinner(),e){case r+"_merge_all":this.parent.notify(tt,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"All",isAction:!0,refreshRibbon:!0});break;case r+"_merge_horizontally":this.parent.notify(tt,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Horizontally",isAction:!0});break;case r+"_merge_vertically":this.parent.notify(tt,{merge:!0,range:this.parent.getActiveSheet().selectedRange,type:"Vertically",isAction:!0})}this.parent.hideSpinner()},s.prototype.getSortFilterDDB=function(e){var i,r=this,t=this.parent.serviceLocator.getService(O);return this.sortingDdb=new Oe.uw({cssClass:"e-sort-filter-ddb",iconCss:"e-icons e-sort-filter-icon",items:[{text:t.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc"},{text:t.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc"},{text:t.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom"},{separator:!0},{text:t.getConstant("Filter"),iconCss:"e-icons e-filter-apply",id:e+"_applyfilter"},{text:t.getConstant("ClearAllFilter"),iconCss:"e-icons e-filter-clear",id:e+"_clearfilter"},{text:t.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:e+"_reapplyfilter"}],createPopupOnClick:!0,beforeItemRender:function(n){var a={isFiltered:!1,isClearAll:!0};r.parent.notify(ra,a),!r.parent.allowSorting&&(n.item.text===t.getConstant("SortAscending")||n.item.text===t.getConstant("SortDescending")||n.item.text===t.getConstant("CustomSort")+"...")&&n.element.classList.add("e-disabled"),!r.parent.allowFiltering&&n.item.text===t.getConstant("Filter")&&n.element.classList.add("e-disabled"),(n.item.id===e+"_clearfilter"||n.item.id===e+"_reapplyfilter")&&(a.isFiltered?n.element.classList.remove("e-disabled"):n.element.classList.add("e-disabled"))},beforeOpen:function(n){r.refreshSelected(r.sortingDdb,n.element,"iconCss"),n.element.setAttribute("aria-label",r.parent.serviceLocator.getService(O).getConstant("SortAndFilter"))},select:function(n){switch(n.item.text){case t.getConstant("Filter"):r.parent.notify(jt,{});break;case t.getConstant("ClearAllFilter"):r.parent.notify(zi,{isAction:!0});break;case t.getConstant("ReapplyFilter"):r.parent.notify(ta,null);break;case t.getConstant("CustomSort")+"...":r.parent.notify(Kn,null);break;default:i=n.item.text===t.getConstant("SortAscending")?"Ascending":"Descending",r.parent.notify(Fr,{sortOptions:{sortDescriptors:{order:i}}})}r.sortingDdb.element.setAttribute("aria-label",n.item.text)}}),this.sortingDdb.createElement=this.parent.createElement,this.sortingDdb.appendTo(this.parent.createElement("button",{id:e+"_sorting",attrs:{type:"button"}})),this.sortingDdb.element},s.prototype.getFindBtn=function(e){var r=this.parent.createElement("button",{id:e+"_findbtn",attrs:{type:"button","aria-label":this.parent.serviceLocator.getService(O).getConstant("FindReplaceTooltip")}});return this.findDdb=new at.zx({cssClass:"e-spreadsheet-find-ddb e-flat",iconCss:"e-icons e-search-icon"}),this.findDdb.createElement=this.parent.createElement,this.findDdb.appendTo(r),r.onclick=this.findToolDlg.bind(this),this.findDdb.element},s.prototype.findToolDlg=function(e){var r=this,t=function(g){var m=e&&e.target?(0,f.oq)(e.target,"#"+r.parent.element.id+"_findbtn"):(0,f.Ys)("#"+r.parent.element.id+"_findbtn",r.ribbon.element);m&&(g?m.classList.add("e-disabled"):m.classList.remove("e-disabled"),m.disabled=g)};t(!0);var i=this.parent.element.getElementsByClassName("e-findtool-dlg")[0];if(i)this.findDialog.hide();else{var n,a=this.parent.createElement("div",{className:"e-input-group"}),o=this.parent.createElement("input",{className:"e-input e-text-findNext-short",attrs:{type:"Text"}});this.findValue&&(o.value=this.findValue);var l=this.parent.serviceLocator.getService(O);o.setAttribute("placeholder",l.getConstant("FindValue"));var p,h=this.parent.createElement("span",{className:"e-input-group-icon"}),c=this.parent.getActiveSheet(),d=c.usedRange.rowIndex*c.usedRange.colIndex>100;o.onkeyup=function(g){var m=function(){if(o){var y=o.value;if(13===g.keyCode)o.value&&"0 of 0"!==h.textContent&&(r.parent.notify(Gi,{findOption:g.shiftKey?"prev":"next"}),r.updateCount(h,g.shiftKey));else{var C=void 0;if(""===y)h.textContent="0 of 0",C=!1;else{var b={value:y,mode:"Sheet",isCSen:!1,sheetIndex:r.parent.activeSheetIndex,isEMatch:!1,searchBy:"By Row"};r.parent.notify(yn,b),h.textContent=b.findCount,C="0 of 0"!==b.findCount}n.enableItems(1,C),n.enableItems(2,C)}}};d?(p&&clearTimeout(p),p=setTimeout(m,500)):m()},a.appendChild(o),a.appendChild(h),n=new ze.o8({clicked:function(g){"e-findRib-next"===g.item.cssClass?(r.parent.notify(Gi,{findOption:"next"}),r.updateCount(h)):"e-findRib-prev"===g.item.cssClass?(r.parent.notify(Gi,{findOption:"prev"}),r.updateCount(h,!0)):"e-findRib-more"===g.item.cssClass&&(r.findDialog.animationSettings.effect="None",r.findDialog.setProperties({animationSettings:r.findDialog.animationSettings},!0),r.parent.notify(na,null),r.findDialog.hide())},width:"auto",height:"auto",items:[{type:"Input",template:a},{prefixIcon:"e-icons e-prev-icon",tooltipText:"Find Previous",type:"Button",cssClass:"e-findRib-prev",disabled:!0},{prefixIcon:"e-icons e-next-icon",tooltipText:"Find Next",type:"Button",cssClass:"e-findRib-next",disabled:!0},{type:"Separator"},{prefixIcon:"e-icons e-option-icon",tooltipText:"More Options",type:"Button",cssClass:"e-findRib-more"},{prefixIcon:"e-icons e-close",tooltipText:"Close",type:"Button",cssClass:"e-findRib-close"}],cssClass:"e-find-toolObj"});var v=this.parent.createElement("div",{className:"e-find-toolbar"});n.createElement=this.parent.createElement,n.appendTo(v),i=this.parent.createElement("div",{className:"e-dlg-div"}),this.findDialog=new Pt.Vq({cssClass:"e-findtool-dlg",content:v,visible:!1,enableRtl:this.parent.enableRtl,target:this.parent.element.getElementsByClassName("e-sheet")[0],open:function(){if(f.bi.add(document,"click",r.closeDialog,r),r.findValue){var g={value:r.findValue,mode:"Sheet",isCSen:!1,sheetIndex:r.parent.activeSheetIndex,isEMatch:!1,searchBy:"By Row"};r.parent.notify(yn,g),h.textContent=g.findCount}else h.textContent="0 of 0";t(!1),n.element.addEventListener("focus",function(){var m=document.querySelector(".e-text-findNext-short");m.focus(),m.classList.add("e-input-focus"),m.setSelectionRange(0,m.value.length)})},beforeClose:function(){r.findValue=o.value||null,n.destroy(),f.bi.remove(document,"click",r.closeDialog)},close:function(){r.findDialog.destroy(),r.findDialog=null,(0,f.og)(i),K(r.parent.element),t(!1)},created:function(){i.style.width=r.parent.getMainContent().offsetWidth+"px",i.style.visibility="hidden",i.style.display="block",r.findDialog.width=2*parseInt(getComputedStyle(i).borderLeftWidth,10)+i.querySelector(".e-toolbar-items").getBoundingClientRect().width+"px",i.style.display="",i.style.width="",i.style.visibility="",i.style.top=r.parent.getColumnHeaderContent().parentElement.offsetHeight+1+"px",i.style.left="",i.style[r.parent.enableRtl?"left":"right"]=r.parent.sheetModule.getScrollSize()+"px",r.findDialog.show()}}),this.findDialog.createElement=this.parent.createElement,this.findDialog.appendTo(i)}},s.prototype.updateCount=function(e,r){var i,t=e.textContent.split(" ");r?(i=Number(t[0])-1)<1&&(i=Number(t[2])):(i=Number(t[0])+1)>Number(t[2])&&(i=1),t[0]=i.toString(),e.textContent=t.join(" ")},s.prototype.closeDialog=function(e){((0,f.oq)(e.target,".e-findRib-close")||!(0,f.oq)(e.target,".e-spreadsheet"))&&this.findDialog&&this.findToolDlg()},s.prototype.getClearDDB=function(e){var r=this,t=this.parent.serviceLocator.getService(O);return this.clearDdb=new Oe.uw({cssClass:"e-clear-ddb",iconCss:"e-icons e-clear-icon",items:[{text:t.getConstant("ClearAll"),id:e+"_Clear All"},{text:t.getConstant("ClearFormats"),id:e+"_Clear Formats"},{text:t.getConstant("ClearContents"),id:e+"_Clear Contents"},{text:t.getConstant("ClearHyperlinks"),id:e+"_Clear Hyperlinks"}],createPopupOnClick:!0,beforeOpen:function(i){i.element.setAttribute("aria-label",r.parent.serviceLocator.getService(O).getConstant("Clear"))},select:function(i){r.parent.notify(Yi,{options:{type:i.item.id.replace(e+"_","")},isAction:!0}),r.clearDdb.element.setAttribute("aria-label",i.item.text)}}),this.clearDdb.createElement=this.parent.createElement,this.clearDdb.appendTo(this.parent.createElement("button",{id:e+"_clear",attrs:{type:"button"}})),this.clearDdb.element},s.prototype.ribbonCreated=function(){var e=this.parent.serviceLocator.getService(O).getConstant("CollapseToolbar");(0,f.Y4)(this.ribbon.element.querySelector(".e-drop-icon"),{role:"button",tabindex:"-1",title:e,"aria-label":e})},s.prototype.alignItemRender=function(e){e.element.title=this.parent.serviceLocator.getService(O).getConstant("Align"+this.getAlignText(e))},s.prototype.getAlignText=function(e){var r=e.item.iconCss.split(" e-")[1].split("-icon")[0];return r[0].toUpperCase()+r.slice(1,r.length)},s.prototype.toggleBtnClicked=function(e){var a,o,l,h,p,r=(0,f.oq)(e.target,".e-btn"),t=this.parent.element.id,n=ye;switch(r.id){case t+"_bold":o={fontWeight:"normal"},l={fontWeight:"bold"},p="fontWeight";break;case t+"_italic":o={fontStyle:"normal"},l={fontStyle:"italic"},p="fontStyle";break;case t+"_line-through":n=Vr,l=o={textDecoration:"line-through"},p="textDecoration";break;case t+"_underline":n=Vr,l=o={textDecoration:"underline"},p="textDecoration"}r.classList.contains("e-active")?(a=l[p],this.parent.notify(n,h={style:l,onActionUpdate:!0}),h.cancel&&r.classList.remove("e-active")):(a=o[p],this.parent.notify(n,h={style:o,onActionUpdate:!0}),h.cancel&&r.classList.add("e-active")),!h.cancel&&a!==h.style[p]&&this.refreshToggleBtn(B(this.parent.getActiveSheet().activeCell))},s.prototype.getCellStyleValue=function(e,r){var t=E(r[0],r[1],this.parent.getActiveSheet()),i=this.parent.cellStyle[e];return t&&t.style&&t.style[e]&&(i=t.style[e]),i},s.prototype.refreshSelected=function(e,r,t,i){void 0===i&&(i=t);for(var n=0;n<e.items.length;n++)if(e.items[n][i]===e[t]){r.children[n].classList.add("e-selected");break}},s.prototype.expandCollapseHandler=function(e){var r=this.ribbon.element.querySelector(".e-drop-icon"),t=this.parent.serviceLocator.getService(O);e.expanded?(r.title=t.getConstant("CollapseToolbar"),r.setAttribute("aria-label",t.getConstant("ExpandToolbar"))):(r.title=t.getConstant("ExpandToolbar"),r.setAttribute("aria-label",t.getConstant("CollapseToolbar"))),this.parent.setPanelSize()},s.prototype.getChartThemeDdbItems=function(e){var r=this.parent.serviceLocator.getService(O),t=[];return["Material","Fabric","Bootstrap","HighContrastLight","MaterialDark","FabricDark","HighContrast","BootstrapDark","Bootstrap4","Bootstrap5Dark","Bootstrap5","TailwindDark","Tailwind","FluentDark","Fluent"].forEach(function(n){t.push({id:n,text:r.getConstant(n),iconCss:n===e?"e-icons e-selected-icon":""})}),t},s.prototype.getNumFormatDdbItems=function(e){var r=this.parent.serviceLocator.getService(O);return[{id:e+"_General",text:r.getConstant("General")},{id:e+"_Number",text:r.getConstant("Number")},{id:e+"_Currency",text:r.getConstant("Currency")},{id:e+"_Accounting",text:r.getConstant("Accounting")},{id:e+"_ShortDate",text:r.getConstant("ShortDate")},{id:e+"_LongDate",text:r.getConstant("LongDate")},{id:e+"_Time",text:r.getConstant("Time")},{id:e+"_Percentage",text:r.getConstant("Percentage")},{id:e+"_Fraction",text:r.getConstant("Fraction")},{id:e+"_Scientific",text:r.getConstant("Scientific")},{id:e+"_Text",text:r.getConstant("Text")},{id:e+"_Custom",text:r.getConstant("Custom")}]},s.prototype.getFontFamilyItems=function(){return[{text:"Arial"},{text:"Arial Black"},{text:"Axettac Demo"},{text:"Batang"},{text:"Book Antiqua"},{text:"Calibri",iconCss:"e-icons e-selected-icon"},{text:"Comic Sans MS"},{text:"Courier"},{text:"Courier New"},{text:"Din Condensed"},{text:"Georgia"},{text:"Helvetica"},{text:"Helvetica New"},{text:"Roboto"},{text:"Tahoma"},{text:"Times New Roman"},{text:"Verdana"}]},s.prototype.numDDBSelect=function(e){var r=this.parent.serviceLocator.getService(O),t=this.parent.getActiveSheet(),i=B(t.activeCell),n=E(i[0],i[1],t),a=e.item.id.split(this.parent.element.id+"_")[1],o={format:Ee(a),range:t.selectedRange,cancel:!1,requestType:"NumberFormat"};e.item.text===r.getConstant("Custom")&&n&&(o.format=n.format);var l={range:t.name+"!"+o.range,format:o.format,requestType:"NumberFormat"};this.parent.trigger("beforeCellFormat",o),this.parent.notify(ue,{eventArgs:o,action:"format"}),!o.cancel&&(this.parent.notify(xi,o),this.parent.notify(Wt,{type:"mousedown"}),e.item.text===r.getConstant("Custom")?this.renderCustomFormatDialog():(this.refreshNumFormatSelection(e.item.text),this.refreshTextAlign(t,E(i[0],i[1],t,!1,!0),a,i),this.parent.notify(Z,{eventArgs:l,action:"format"})),this.numFormatDDB.element.setAttribute("aria-label",a))},s.prototype.renderCustomFormatDialog=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=B(this.parent.getActiveSheet().activeCell),i=E(t[0],t[1],this.parent.getActiveSheet()),n=this.parent.createElement("div"),a=this.parent.createElement("div",{className:"e-custom-dialog"}),o=this.parent.createElement("button",{className:"e-btn",innerHTML:r.getConstant("APPLY"),attrs:{type:"button"}}),l=this.parent.createElement("div",{className:"e-custom-sample",innerHTML:r.getConstant("CustomFormatSample")+":"}),h=this.parent.createElement("input",{className:"e-input e-dialog-input",attrs:{type:"text",name:"input",placeholder:r.getConstant("CustomFormat"),spellcheck:"false"}}),p=this.parent.createElement("div",{className:"e-custom-listview"}),c=this.parent.serviceLocator.getService(ae),u=new an.Bv({dataSource:[{text:"General"},{text:"0"},{text:"0.00"},{text:"#,##0"},{text:"#,##0.00"},{text:"#,##0_);(#,##0)"},{text:"#,##0_);[Red](#,##0)"},{text:"#,##0.00_);(#,##0.00)"},{text:"#,##0.00_);[Red](#,##0.00)"},{text:"$#,##0_);($#,##0)"},{text:"$#,##0_);[Red]($#,##0)"},{text:"$#,##0.00_);($#,##0.00)"},{text:"$#,##0.00_);[Red]($#,##0.00)"},{text:"0%"},{text:"0.00%"},{text:"0.00E+00"},{text:"##0.0E+0"},{text:"# ?/?"},{text:"# ??/??"},{text:"dd-MM-yy"},{text:"dd-MMM-yy"},{text:"dd-MMM"},{text:"MMM-yy"},{text:"h:mm AM/PM"},{text:"h:mm:ss AM/PM"},{text:"h:mm"},{text:"h:mm:ss"},{text:"dd-MM-yy h:mm"},{text:"mm:ss"},{text:"mm:ss.0"},{text:"@"},{text:"[h]:mm:ss"},{text:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)'},{text:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)'},{text:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'},{text:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'}],select:function(g){h.value=g.text}});a.appendChild(h),a.appendChild(o),a.appendChild(l),a.appendChild(p),u.appendTo(p),o.addEventListener("click",function(){var g=h.value,m={range:e.parent.getActiveSheet().name+"!"+e.parent.getActiveSheet().selectedRange,format:g,requestType:"NumberFormat"};e.parent.numberFormat(g,m.range),e.refreshNumFormatSelection(r.getConstant("Custom")),u.destroy(),c.hide(),e.parent.notify(Z,{eventArgs:m,action:"format"})}),c.show({header:r.getConstant("CustomFormat"),cssClass:"e-custom-format-dlg",height:this.parent.cssClass.indexOf("e-bigger")>-1?502:480,width:440,isModal:!0,showCloseIcon:!0,content:a,footerTemplate:n}),u.selectItem({text:i.format})},s.prototype.tBarDdbBeforeOpen=function(e,r,t,i){void 0===i&&(i=0);var n=this.parent.viewport.height,a=parseInt(getComputedStyle(e.firstElementChild).height,10)*(r.length-i)+2*parseInt(getComputedStyle(e).paddingTop,10);if(i){var o=getComputedStyle(e.querySelector(".e-separator"));a+=i*(parseInt(o.borderBottomWidth,10)+2*parseInt(o.marginTop,10))}a>n?(e.style.height=n+"px",e.style.overflowY="auto"):e.style.height&&(e.style.height="",e.style.overflowY=""),e.setAttribute("aria-label",t)},s.prototype.numDDBOpen=function(e){this.numPopupWidth=0;for(var r=e.element.querySelectorAll("span.e-numformat-preview-text"),t=0,i=r.length;t<i;t++)this.numPopupWidth<r[t].offsetWidth&&(this.numPopupWidth=r[t].offsetWidth);var n=this.numPopupWidth+160;document.querySelector(".e-numformat-ddb.e-dropdown-popup").style.width=n+"px"},s.prototype.previewNumFormat=function(e){if("Custom"!==e.item.text){var r=this.parent.createElement("div",{className:"e-numformat-text",styles:"width:100%",innerHTML:e.element.innerHTML});e.element.innerHTML="";var t=this.parent.getActiveSheet(),i=B(t.activeCell),n=E(i[0],i[1],t),a={type:e.item.text,formattedText:"",value:n&&(n.value||0===n.value)?n.value:"",format:Ee(e.item.id.split(this.parent.element.id+"_")[1]),sheetIndex:this.parent.activeSheetIndex,onLoad:!0};this.parent.notify(ot,a);var o=this.parent.createElement("span",{className:"e-numformat-preview-text",styles:"float:right;",innerHTML:a.formattedText.toString()});r.appendChild(o),e.element.appendChild(r)}},s.prototype.refreshRibbonContent=function(e){if(this.ribbon){(0,f.le)(e)&&(e=this.ribbon.selectedTab);var r=this.parent.serviceLocator.getService(O),t=this.parent.getActiveSheet();switch(this.ribbon.items[e].header.text){case r.getConstant("Home"):this.refreshHomeTabContent(B(t.activeCell));break;case r.getConstant("Insert"):case r.getConstant("Formulas"):break;case r.getConstant("Data"):this.refreshDataTabContent(e);break;case r.getConstant("View"):this.refreshViewTabContent(e)}}},s.prototype.refreshHomeTabContent=function(e){(0,f.le)(document.getElementById(this.parent.element.id+"_number_format"))||(this.numFormatDDB=(0,f.Xr)(document.getElementById(this.parent.element.id+"_number_format"),Oe.uw));var r=this.parent.getActiveSheet(),t=B(this.parent.getActiveSheet().activeCell),i=this.parent.serviceLocator.getService(O),n=E(t[0],t[1],this.parent.getActiveSheet())||{},a=Ft(n.format?n.format:"General");if(this.numFormatDDB&&(r.isProtected&&!r.protectSettings.formatCells?this.refreshNumFormatSelection(a="General"):(n.format&&"General"===a&&(a="Custom"),this.refreshNumFormatSelection(i.getConstant(a)))),this.fontNameDdb&&this.refreshFontNameSelection(r.isProtected&&!r.protectSettings.formatCells?"Calibri":this.getCellStyleValue("fontFamily",e)),this.fontSizeDdb){var o=this.getCellStyleValue("fontSize",e);r.isProtected&&!r.protectSettings.formatCells?this.fontSizeDdb.content="11":(o=o.includes("pt")?o.split("pt")[0]:"11")!==this.fontSizeDdb.content&&(this.fontSizeDdb.content=o,this.fontSizeDdb.dataBind())}if(this.refreshTextAlign(r,n,a,e),this.verticalAlignDdb&&(o="e-icons e-"+this.getCellStyleValue("verticalAlign",e).toLowerCase()+"-icon",r.isProtected&&!r.protectSettings.formatCells?this.verticalAlignDdb.iconCss="e-icons e-bottom-icon":o!==this.verticalAlignDdb.iconCss&&(this.verticalAlignDdb.iconCss=o,this.verticalAlignDdb.dataBind())),this.refreshToggleBtn(e),!r.isProtected&&(n.rowSpan>1||n.colSpan>1))this.enableToolbarItems([{tab:i.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!0);else{var l=A(r.selectedRange);this.enableToolbarItems([{tab:i.getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:l[0]!==l[2]||l[1]!==l[3]}]),this.toggleActiveState(!1)}},s.prototype.refreshTextAlign=function(e,r,t,i){if(this.textAlignDdb){var n=this.getCellStyleValue("textAlign",i);if(e.isProtected&&!e.protectSettings.formatCells)this.textAlignDdb.iconCss="e-icons e-left-icon";else{void 0!==r.value&&"left"===n&&("Accounting"===t||te(r.value)&&"Text"!==t)&&(n="right");var a="e-icons e-"+n.toLowerCase()+"-icon";a!==this.textAlignDdb.iconCss&&(this.textAlignDdb.iconCss=a,this.textAlignDdb.dataBind())}}},s.prototype.toggleActiveState=function(e){var r=this.parent.serviceLocator.getService(O);this.parent.getActiveSheet().isProtected||(e?(this.mergeSplitBtn.element.classList.add("e-active"),this.mergeSplitBtn.element.title=r.getConstant("UnmergeCells")):(this.mergeSplitBtn.element.classList.contains("e-active")&&this.mergeSplitBtn.element.classList.remove("e-active"),this.mergeSplitBtn.element.title=r.getConstant("MergeCells")))},s.prototype.refreshToggleBtn=function(e){var i,a,o,r=this,t=this.parent.getActiveSheet(),n=this.parent.element.id,l=E(e[0],e[1],t),h=["fontWeight","fontStyle","textDecoration","textDecoration"];["bold","italic","line-through","underline","wrap"].forEach(function(p,c){(i=document.getElementById(n+"_"+p))&&(t.isProtected&&!t.protectSettings.formatCells?i.classList.remove("e-active"):"wrap"===p?o=l&&l.wrap:(a=r.getCellStyleValue(h[c],e).toLowerCase(),o=a.indexOf(p)>-1),o?i.classList.add("e-active"):i.classList.contains("e-active")&&i.classList.remove("e-active"))})},s.prototype.refreshFontNameSelection=function(e){e=e.split('"').join(""),this.fontNameDdb.element.firstElementChild.textContent=e;for(var r=0;r<this.fontNameDdb.items.length;r++)if(this.fontNameDdb.items[r].text===e){this.fontNameDdb.items[r].iconCss="e-icons e-selected-icon",r!==this.fontNameIndex&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.setProperties({items:this.fontNameDdb.items},!0),this.fontNameIndex=r;break}["Arial","Arial Black","Axettac Demo","Batang","Book Antiqua","Calibri","Courier","Courier New","Din Condensed","Georgia","Helvetica","Helvetica New","Roboto","Tahoma","Times New Roman","Verdana"].indexOf(e)<0&&(this.fontNameDdb.items[this.fontNameIndex].iconCss=""),this.fontNameDdb.element.setAttribute("aria-label",e)},s.prototype.refreshNumFormatSelection=function(e){for(var r=0;r<this.numFormatDDB.items.length;r++)""!==this.numFormatDDB.items[r].iconCss&&(this.numFormatDDB.items[r].iconCss=""),this.numFormatDDB.items[r].text===e&&(this.numFormatDDB.items[r].iconCss="e-icons e-selected-icon");this.numFormatDDB.element.firstElementChild.textContent=e,this.numFormatDDB.setProperties({items:this.numFormatDDB.items},!0),this.numFormatDDB.element.setAttribute("aria-label",e)},s.prototype.fileMenuItemSelect=function(e){var r=this,t=(0,f.l7)({cancel:!1},e);this.parent.trigger("fileMenuItemSelect",t);var n,i=this.parent.element.id;if(!t.cancel)switch(e.item.id){case i+"_Open":(0,f.Ys)("#"+i+"_fileUpload",this.parent.element).click();break;case i+"_Xlsx":case i+"_Xls":case i+"_Csv":case i+"_Pdf":this.parent.notify(fn,e);break;case i+"_New":(n=this.parent.serviceLocator.getService(ae)).show({height:200,width:400,isModal:!0,showCloseIcon:!0,content:this.parent.serviceLocator.getService(O).getConstant("DestroyAlert"),beforeOpen:function(a){var o={dialogName:"DestroySheetDialog",element:a.element,target:a.target,cancel:a.cancel};r.parent.trigger("dialogBeforeOpen",o),o.cancel&&(a.cancel=!0),K(r.parent.element)},buttons:[{buttonModel:{content:this.parent.serviceLocator.getService(O).getConstant("Ok"),isPrimary:!0},click:function(){n.hide(),r.parent.refresh(!0)}}]})}},s.prototype.toolbarClicked=function(e){if("spreadsheet_find"!==e.item.id){var r=this.parent.element.id,t=this.parent.getActiveSheet(),i=void 0,n=void 0,a=void 0,o=void 0;switch(e.item.id){case r+"_headers":if(this.parent.notify(Z,{eventArgs:i={isShow:!t.showHeaders,sheetIdx:this.parent.activeSheetIndex,cancel:!1},action:"headers"}),i.cancel)return;this.parent.setSheetPropertyOnMute(t,"showHeaders",!t.showHeaders),this.parent.serviceLocator.getService("sheet").showHideHeaders(),this.toggleRibbonItems({props:"Headers",activeTab:this.ribbon.selectedTab});break;case r+"_gridlines":if(this.parent.notify(Z,{eventArgs:n={isShow:!t.showGridLines,sheetIdx:this.parent.activeSheetIndex,cancel:!1},action:"gridLines"}),n.cancel)return;this.parent.setSheetPropertyOnMute(t,"showGridLines",!t.showGridLines),this.toggleRibbonItems({props:"GridLines",activeTab:this.ribbon.selectedTab});break;case r+"_protect":this.parent.notify(ya,{});break;case r+"_undo":this.parent.notify(Gt,{isUndo:!0});break;case r+"_redo":this.parent.notify(Gt,{isUndo:!1});break;case r+"_freezepanes":a=B(t.topLeftCell),o=t.frozenRows||t.frozenColumns?a:B(t.activeCell),this.parent.notify(Xi,{row:o[0]-a[0],column:o[1]-a[1],triggerEvent:!0});break;case r+"_freezerows":this.parent.notify(Xi,{row:t.frozenRows?0:B(t.activeCell)[0]-B(t.topLeftCell)[0],column:t.frozenColumns,triggerEvent:!0});break;case r+"_freezecolumns":this.parent.notify(Xi,{row:t.frozenRows,column:t.frozenColumns?0:B(t.activeCell)[1]-B(t.topLeftCell)[1],triggerEvent:!0});break;case r+"_protectworkbook":this.parent.password.length>0?this.parent.notify(ua,null):this.parent.isProtected?(this.parent.isProtected=!1,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").removeAttribute("disabled"),this.parent.element.querySelector(".e-add-sheet-tab").classList.remove("e-disabled")),this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab})):this.parent.element.querySelector(".e-add-sheet-tab").classList.contains("e-disabled")?this.toggleRibbonItems({props:"Protectworkbook",activeTab:this.ribbon.selectedTab}):this.parent.notify(fa,null)}this.parent.notify(Bi,e)}},s.prototype.toggleRibbonItems=function(e){var r="",t=this.parent.serviceLocator.getService(O).getConstant("View"),i=this.parent.serviceLocator.getService(O).getConstant("Data");if(this.ribbon.items[this.ribbon.selectedTab].header.text===t){if((0,f.le)(e.activeTab))for(var n=0,a=this.ribbon.items.length;n<a;n++)if(this.ribbon.items[n].header.text===t){e.activeTab=n;break}var o=this.getLocaleText(e.props);"GridLines"===e.props&&this.parent.serviceLocator.getService("sheet").toggleGridlines();var l=this.parent.element.id+"_"+e.props.toLowerCase(),h=this.ribbon.items[e.activeTab].content.length;for(n=void 0;n<h;n++)"Separator"!==this.ribbon.items[e.activeTab].content[n].type&&this.ribbon.items[e.activeTab].content[n].id===l&&(this.ribbon.items[e.activeTab].content[n].text=o,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===t&&"Protect"!==e.props&&this.updateToggleText(e.props.toLowerCase(),o)}if(this.ribbon.items[this.ribbon.selectedTab].header.text===i){if((0,f.le)(e.activeTab)){n=0;for(var p=this.ribbon.items.length;n<p;n++)if(this.ribbon.items[n].header.text===i){e.activeTab=n;break}}if((l=this.parent.element.id+"_"+e.props.toLowerCase())==this.parent.element.id+"_protect"){var c=this.ribbon.items[this.ribbon.selectedTab].content.length,d=void 0;for(d=0;d<c&&this.ribbon.items[this.ribbon.selectedTab].content[d].id!==this.parent.element.id+"_protect";d++);r=this.getLocaleProtectText("Sheet",!0)}else if(l===this.parent.element.id+"_protectworkbook"){var u=this.ribbon.items[this.ribbon.selectedTab].content.length;for(d=void 0,d=0;d<u&&this.ribbon.items[this.ribbon.selectedTab].content[d].id!==this.parent.element.id+"_protectworkbook";d++);this.parent.isProtected||this.parent.password.length>0?r=this.getLocaleProtectWorkbook("UnProtectWorkbook"):this.parent.isProtected||(r=this.getLocaleProtectWorkbook("ProtectWorkbook"))}for(h=this.ribbon.items[e.activeTab].content.length,n=void 0;n<h;n++)"Separator"!==this.ribbon.items[e.activeTab].content[n].type&&this.ribbon.items[e.activeTab].content[n].id===l&&(this.ribbon.items[e.activeTab].content[n].text=r,this.ribbon.setProperties({items:this.ribbon.items},!0));this.ribbon.items[this.ribbon.selectedTab].header.text===i&&this.updateToggleText(e.props.toLowerCase(),r)}},s.prototype.enableFileMenuItems=function(e){this.ribbon.enableMenuItems(e.items,e.enable,e.isUniqueId)},s.prototype.hideRibbonTabs=function(e){this.ribbon.hideTabs(e.tabs,e.hide)},s.prototype.addRibbonTabs=function(e){this.ribbon.addTabs(e.items,e.insertBefore),(0,f.Ys)(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab).e-hide",this.parent.element)&&this.parent.updateActiveBorder((0,f.td)(".e-ribbon .e-tab-header .e-toolbar-item:not(.e-menu-tab)",this.parent.element)[this.ribbon.selectedTab])},s.prototype.updateToggleText=function(e,r){var t=(0,f.Ys)("#"+this.parent.element.id+"_"+e+" .e-tbar-btn-text",this.ribbon.element);t.parentElement.setAttribute("aria-label","protect"===e||"protectworkbook"===e?r:t.textContent),Pe(function(){t&&(t.textContent=r)}),"headers"===e&&this.findDialog&&(this.findDialog.position.Y=this.parent.getActiveSheet().showHeaders?31:0,this.findDialog.dataBind())},s.prototype.refreshViewTabContent=function(e){for(var r=this.parent.element.id,t=this.parent.getActiveSheet(),i=this.parent.serviceLocator.getService(O),n=0;n<this.ribbon.items[e].content.length;n++)"Separator"!==this.ribbon.items[e].content[n].type&&(this.ribbon.items[e].content[n].id===r+"_headers"&&this.updateViewTabContent(e,"Headers",n),this.ribbon.items[e].content[n].id===r+"_gridlines"&&this.updateViewTabContent(e,"GridLines",n),this.ribbon.items[e].content[n].id===r+"_freezepanes"&&(t.frozenRows||t.frozenColumns?this.ribbon.items[e].content[n].text===i.getConstant("FreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Unfreeze","Panes",n,e)):this.ribbon.items[e].content[n].text===i.getConstant("UnfreezePanes")&&this.updateToggleText("freezepanes",this.updateRibbonItemText("Freeze","Panes",n,e))),this.ribbon.items[e].content[n].id===r+"_freezerows"&&(t.frozenRows?this.ribbon.items[e].content[n].text===i.getConstant("FreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Unfreeze","Rows",n,e)):this.ribbon.items[e].content[n].text===i.getConstant("UnfreezeRows")&&this.updateToggleText("freezerows",this.updateRibbonItemText("Freeze","Rows",n,e))),this.ribbon.items[e].content[n].id===r+"_freezecolumns"&&(t.frozenColumns?this.ribbon.items[e].content[n].text===i.getConstant("FreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Unfreeze","Columns",n,e)):this.ribbon.items[e].content[n].text===i.getConstant("UnfreezeColumns")&&this.updateToggleText("freezecolumns",this.updateRibbonItemText("Freeze","Columns",n,e))))},s.prototype.updateViewTabContent=function(e,r,t){var i=this.parent.getActiveSheet(),n=this.parent.serviceLocator.getService(O);i["show"+r]?this.ribbon.items[e].content[t].text===n.getConstant("Show"+r)&&this.updateToggleText(r.toLowerCase(),this.updateRibbonItemText("Hide",r,t,e)):this.ribbon.items[e].content[t].text===n.getConstant("Hide"+r)&&this.updateToggleText(r.toLowerCase(),this.updateRibbonItemText("Show",r,t,e))},s.prototype.updateRibbonItemText=function(e,r,t,i){var a=this.parent.serviceLocator.getService(O).getConstant(e+r);return this.ribbon.items[i].content[t].text=a,this.ribbon.setProperties({items:this.ribbon.items},!0),a},s.prototype.refreshDataTabContent=function(e){for(var t,r=this.parent.element.id,i=0;i<this.ribbon.items[e].content.length;i++)if("Separator"!==this.ribbon.items[e].content[i].type){if(this.ribbon.items[e].content[i].id===r+"_protect"){if(this.updateDataTabContent(e,"Sheet",i),t)break;t=!0}this.ribbon.items[e].content[i].id===r+"_protectworkbook"&&this.updateDataTabContent(e,"Workbook",i)}},s.prototype.updateDataTabContent=function(e,r,t){var i=this.parent.getActiveSheet(),n=this.parent.serviceLocator.getService(O);if("Sheet"===r)i.isProtected?this.ribbon.items[e].content[t].text===n.getConstant("Protect"+r)&&(this.ribbon.items[e].content[t].cssClass="e-active",this.updateProtectBtn("Unprotect",r,t,e)):this.updateProtectBtn("Protect",r,t,e);else if("Workbook"===r){var a=this.parent.serviceLocator.getService(O);this.parent.isProtected?this.ribbon.items[e].content[t].text===a.getConstant("Protect"+r)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("UnProtect",r,t,e)):this.ribbon.items[e].content[t].text===a.getConstant("UnProtect"+r)&&this.updateToggleText("protectworkbook",this.updateRibbonItemText("Protect",r,t,e))}},s.prototype.updateProtectBtn=function(e,r,t,i){var a=this.parent.serviceLocator.getService(O).getConstant(e+r);this.ribbon.items[i].content[t].text=a,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protect",a)},s.prototype.updateProtectWorkbookBtn=function(e,r,t,i){var a=this.parent.serviceLocator.getService(O).getConstant(e);this.ribbon.items[i].content[t].text=a,this.ribbon.setProperties({items:this.ribbon.items},!0),this.updateToggleText("protectworkbook",a)},s.prototype.addToolbarItems=function(e){var r=this.parent.serviceLocator.getService(O);this.ribbon.addToolbarItems(r.getConstant(e.tab),e.items,e.index)},s.prototype.enableToolbarItems=function(e){var r=this;e.forEach(function(t){r.ribbon.enableItems(t.tab||r.ribbon.items[r.ribbon.selectedTab].header.text,t.items,t.enable)})},s.prototype.createMobileView=function(){var e=this,r=this.parent.element.id,t=this.parent.createElement("div",{className:"e-header-toolbar"}),i=this.parent.createElement("ul");t.appendChild(i);var n=new ze.o8({items:[{prefixIcon:"e-tick-icon",align:"Left",id:r+"focused_tick",cssClass:"e-focused-tick"},{template:i,align:"Right",id:r+"file_menu"}],clicked:function(a){a.item.id===r+"focused_tick"&&(e.parent.element.classList.remove("e-mobile-focused"),e.parent.renderModule.setSheetPanelSize())},created:function(){var a=new ze.v2({cssClass:"e-mobile e-file-menu",enableRtl:!0,showItemOnClick:!0,items:e.getRibbonMenuItems(),select:e.fileMenuItemSelect.bind(e),beforeOpen:function(o){o.element.parentElement.classList.remove("e-rtl"),e.fileMenuBeforeOpen(o)},beforeClose:e.fileMenuBeforeClose.bind(e)});a.createElement=e.parent.createElement,a.appendTo(i)}});n.createElement=this.parent.createElement,n.appendTo(t),this.parent.element.insertBefore(t,this.parent.element.firstElementChild),this.renderMobileToolbar()},s.prototype.renderMobileToolbar=function(){var e=this,r=this.parent.createElement("div",{className:"e-toolbar-panel e-ribbon"}),t=this.parent.createElement("div"),i=this.parent.createElement("button",{attrs:{type:"button"}});r.appendChild(t),r.appendChild(i),r.style.display="block",this.parent.element.appendChild(r);var n=new Oe.uw({cssClass:"e-caret-hide",content:this.ribbon.items[0].header.text,items:[{text:this.ribbon.items[0].header.text},{text:this.ribbon.items[1].header.text},{text:this.ribbon.items[2].header.text},{text:this.ribbon.items[3].header.text}],createPopupOnClick:!0,select:function(o){o.item.text!==n.content&&(a.element.style.display="none",n.content=o.item.text,n.dataBind(),a.items=e.ribbon.items[n.items.indexOf(o.item)+1].content,a.width="calc(100% - "+i.getBoundingClientRect().width+"px)",a.element.style.display="",a.dataBind(),a.items[0].text=o.item.text,a.dataBind())},open:function(o){var l=o.element.parentElement,h=l.getBoundingClientRect(),p=(0,Pt.kl)(n.element,"right","bottom");l.style.left=p.left-h.width+"px",l.style.top=p.top-h.height+"px";for(var c=0;c<n.items.length;c++)if(n.content===n.items[c].text){o.element.children[c].classList.add("e-selected");break}},close:function(){return K(e.parent.element)}});n.createElement=this.parent.createElement,n.appendTo(i);var a=new ze.o8({width:"calc(100% - "+i.getBoundingClientRect().width+"px)",items:this.ribbon.items[0].content,clicked:this.toolbarClicked.bind(this)});a.createElement=this.parent.createElement,a.appendTo(t),r.style.display=""},s.prototype.fileMenuBeforeOpen=function(e){var i,r=this,t=this.parent.serviceLocator.getService(O),n=[".xlsx",".xls",".csv",".pdf"];e.parentItem.text===t.getConstant("SaveAs")&&[].slice.call(e.element.children).forEach(function(a,o){i=r.parent.createElement("div",{innerHTML:a.innerHTML}),a.innerHTML="",i.appendChild(r.parent.createElement("span",{className:"e-extension",innerHTML:n[o]})),a.appendChild(i)}),this.parent.trigger("fileMenuBeforeOpen",e),e.element.setAttribute("aria-label",this.parent.serviceLocator.getService(O).getConstant("File"))},s.prototype.enableRibbonTabs=function(e){this.ribbon.enableTabs(e.tabs,e.enable)},s.prototype.fileMenuBeforeClose=function(e){this.parent.trigger("fileMenuBeforeClose",e)},s.prototype.hideFileMenuItems=function(e){this.ribbon.hideMenuItems(e.items,e.hide,e.isUniqueId)},s.prototype.addFileMenuItems=function(e){this.ribbon.addMenuItems(e.items,e.text,e.insertAfter,e.isUniqueId)},s.prototype.hideToolbarItems=function(e){this.ribbon.hideToolbarItems(e.tab,e.indexes,e.hide)},s.prototype.protectSheetHandler=function(e){var r=this.parent.getActiveSheet(),t=this.parent.serviceLocator.getService(O);r.isProtected&&r.protectSettings.formatCells||!r.isProtected?(this.enableToolbarItems(this.parent.allowCellFormatting?[{tab:t.getConstant("Home"),items:e.enableHomeBtnId,enable:!0}]:[{tab:t.getConstant("Home"),items:e.enableHomeBtnId.slice(2,14),enable:!1}]),this.parent.allowWrap||this.enableToolbarItems([{tab:t.getConstant("Home"),items:e.enableHomeBtnId.slice(14,15),enable:!1}]),this.parent.allowNumberFormatting||this.enableToolbarItems([{tab:t.getConstant("Home"),items:e.enableHomeBtnId.slice(2,3),enable:!1}]),this.parent.notify(Xo,null)):this.enableToolbarItems([{tab:t.getConstant("Home"),items:e.disableHomeBtnId,enable:!1}]),this.enableToolbarItems(r.isProtected&&r.protectSettings.insertLink||!r.isProtected?!this.parent.allowHyperlink||r.isProtected&&r.protectSettings.insertLink?[{tab:t.getConstant("Insert"),items:e.enableInsertBtnId.slice(0,1),enable:!1}]:[{tab:t.getConstant("Insert"),items:e.enableInsertBtnId,enable:!0}]:[{tab:t.getConstant("Insert"),items:e.enableInsertBtnId,enable:!1}]),this.enableToolbarItems(r.isProtected&&r.protectSettings.selectCells||r.protectSettings.selectUnLockedCells||!r.isProtected?[{tab:t.getConstant("Home"),items:e.findBtnId,enable:!0}]:[{tab:t.getConstant("Home"),items:e.findBtnId,enable:!1}]);var n,i=this.ribbon.items[this.ribbon.selectedTab].content.length;for(n=0;n<i&&this.ribbon.items[this.ribbon.selectedTab].content[n].id!==this.parent.element.id+"_protectworkbook";n++);r.isProtected?(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===t.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===t.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=t.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===t.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=t.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:t.getConstant("Insert"),items:e.imageBtnId,enable:!1}]),this.enableToolbarItems([{tab:t.getConstant("Data"),items:e.dataValidationBtnId,enable:!1}]),this.enableToolbarItems([{tab:t.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!1}]),this.enableToolbarItems([{tab:t.getConstant("Insert"),items:e.chartBtnId,enable:!1}])):(this.parent.isProtected&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook")&&this.parent.element.querySelector("#"+this.parent.element.id+"_protectworkbook").querySelector(".e-tbar-btn-text").textContent===t.getConstant("UnProtectWorkbook")?this.ribbon.items[this.ribbon.selectedTab].header.text===t.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=t.getConstant("UnProtectWorkbook")):this.ribbon.items[this.ribbon.selectedTab].header.text===t.getConstant("Data")&&(this.ribbon.items[this.ribbon.selectedTab].content[n].text=t.getConstant("ProtectWorkbook")),this.enableToolbarItems([{tab:t.getConstant("Insert"),items:e.imageBtnId,enable:this.parent.allowImage}]),this.enableToolbarItems([{tab:t.getConstant("Data"),items:e.dataValidationBtnId,enable:this.parent.allowDataValidation}]),this.enableToolbarItems([{tab:t.getConstant("Formulas"),items:e.enableFrmlaBtnId,enable:!0}]),this.enableToolbarItems([{tab:t.getConstant("Insert"),items:e.chartBtnId,enable:this.parent.allowChart}]))},s.prototype.updateMergeItem=function(e){if("mousemove"===e.type||"pointermove"===e.type||"touchmove"===e.type||e.shiftKey&&("mousedown"===e.type||"touchend"===e.type)){var r=A(this.parent.getActiveSheet().selectedRange);(r[1]!==r[3]||r[0]!==r[2])&&!this.parent.getActiveSheet().isProtected&&this.parent.allowMerge&&(this.enableToolbarItems([{tab:this.parent.serviceLocator.getService(O).getConstant("Home"),items:[this.parent.element.id+"_merge_cells"],enable:!0}]),this.toggleActiveState(!1))}},s.prototype.onPropertyChanged=function(e){var r=this.parent.serviceLocator.getService(O),t=this.parent.element.id;switch(e){case"allowFreezePane":this.ribbon.enableItems(r.getConstant("View"),[t+"_freezepanes",t+"_freezerows",t+"_freezecolumns"],this.parent.allowFreezePane);break;case"showRibbon":this.parent.showRibbon?this.initialize(!0):this.ribbon&&this.destroy()}},s.prototype.addEventListener=function(){this.parent.on(Jr,this.ribbonOperation,this),this.parent.on(dr,this.enableToolbarItems,this),this.parent.on(St,this.refreshRibbonContent,this),this.parent.on(Tr,this.toggleRibbonItems,this),this.parent.on(Ro,this.enableFileMenuItems,this),this.parent.on(Ao,this.hideRibbonTabs,this),this.parent.on(Lo,this.addRibbonTabs,this),this.parent.on(Oo,this.addToolbarItems,this),this.parent.on(Fo,this.hideFileMenuItems,this),this.parent.on(To,this.addFileMenuItems,this),this.parent.on(No,this.hideToolbarItems,this),this.parent.on(Do,this.enableRibbonTabs,this),this.parent.on(jo,this.protectSheetHandler,this),this.parent.on(Wt,this.updateMergeItem,this),this.parent.on(Jt,this.refreshRibbonContent,this),this.parent.on(ca,this.insertDesignChart,this),this.parent.on(Lr,this.removeDesignChart,this),this.parent.on(Wa,this.findToolDlg,this),this.parent.on(uo,this.unMerge,this)},s.prototype.destroy=function(){var e=this.parent.element,r=this.ribbon.element,t=this.cPickerEle,i=e.id;["bold","italic","line-through","underline"].forEach(function(n){!function(s,e){if(s){var r=(0,f.Xr)(s,e);r&&r.destroy()}}((0,f.Ys)("#"+i+"_"+n,e),at.zx)}),this.pasteSplitBtn.destroy(),this.pasteSplitBtn=null,this.mergeSplitBtn.destroy(),this.mergeSplitBtn=null,this.numFormatDDB.destroy(),this.numFormatDDB=null,this.fontSizeDdb.destroy(),this.fontSizeDdb=null,this.fontNameDdb.destroy(),this.fontNameDdb=null,this.textAlignDdb.destroy(),this.textAlignDdb=null,this.verticalAlignDdb.destroy(),this.verticalAlignDdb=null,this.sortingDdb.destroy(),this.sortingDdb=null,this.clearDdb.destroy(),this.clearDdb=null,this.colorPicker.destroy(),this.colorPicker=null,this.destroyComponent(i+"_borders_menu","menu"),this.bordersDdb.destroy(),this.bordersDdb=null,this.findDdb.destroy(),this.findDdb=null,this.destroyComponent(i+"_chart_menu","menu"),this.destroyComponent(i+"_chart_type_menu","menu"),this.destroyComponent(i+"_chart-btn","dropdown-btn"),this.destroyComponent(i+"_chart-type-btn","dropdown-btn"),this.destroyComponent(i+"_cf_menu","menu"),this.cfDdb.destroy(),this.cfDdb=null,this.detachPopupElement(i),this.parent.notify("destroyRibbonComponents",null),this.ribbon.destroy(),r&&(0,f.og)(r),this.ribbon=null,t&&(0,f.og)(t),this.cPickerEle=null,this.findDialog&&this.findDialog.hide(),this.datavalidationDdb.destroy(),this.datavalidationDdb=null,this.removeEventListener()},s.prototype.destroyComponent=function(e,r){var t="string"==typeof e?document.getElementById(e):e;if(t){if("menu"!==r||t.childElementCount){var i=(0,f.Xr)(t,r);if(i&&(i.destroy(),"dropdown-btn"===r)){var n=document.getElementById(t.id+"-popup");n&&(0,f.og)(n)}}"menu"===r&&(0,f.og)(t)}},s.prototype.detachPopupElement=function(e){["_conditionalformatting","_chart-type-btn","_chart-btn","_borders"].forEach(function(r){var t=document.getElementById(""+e+r+"-popup");t&&(0,f.og)(t)})},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Jr,this.ribbonOperation),this.parent.off(dr,this.enableToolbarItems),this.parent.off(St,this.refreshRibbonContent),this.parent.off(Tr,this.toggleRibbonItems),this.parent.off(Ro,this.enableFileMenuItems),this.parent.off(Ao,this.hideRibbonTabs),this.parent.off(Lo,this.addRibbonTabs),this.parent.off(Oo,this.addToolbarItems),this.parent.off(Fo,this.hideFileMenuItems),this.parent.off(To,this.addFileMenuItems),this.parent.off(No,this.hideToolbarItems),this.parent.off(Do,this.enableRibbonTabs),this.parent.off(jo,this.protectSheetHandler),this.parent.off(Wt,this.updateMergeItem),this.parent.off(Jt,this.refreshRibbonContent),this.parent.off(ca,this.insertDesignChart),this.parent.off(Lr,this.removeDesignChart),this.parent.on(Wa,this.findToolDlg,this),this.parent.off(uo,this.unMerge))},s}(),Ma=function(){function s(e){this.categoryCollection=[],this.formulaCollection=[],this.isGoto=!1,this.parent=e,this.addEventListener()}return s.prototype.getModuleName=function(){return"formulaBar"},s.prototype.createFormulaBar=function(e){if(this.parent.showFormulaBar||!this.insertFnRipple){var r=this.parent.serviceLocator.getService(O),t=this.parent.element.id,i=this.parent.createElement("div",{className:"e-formula-bar-panel"});if(!this.parent.isMobileView()){var n=this.parent.createElement("input",{id:t+"_name_box",attrs:{type:"text"}});i.appendChild(n),this.comboBoxInstance=new Rt.Ct({value:"A1",cssClass:"e-name-box",width:"",noRecordsTemplate:"",fields:{text:"name",value:"refersTo"},beforeOpen:this.nameBoxBeforeOpen.bind(this),blur:this.nameBoxBlur.bind(this),select:this.nameBoxSelect.bind(this),change:function(){}}),this.comboBoxInstance.createElement=this.parent.createElement,this.comboBoxInstance.appendTo(n),this.comboBoxInstance.element.parentElement.title=r.getConstant("NameBox")}i.appendChild(this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-insert-function",attrs:{title:r.getConstant("InsertFunction"),type:"button"}})).appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons"})),this.insertFnRipple=(0,f.qx)(i,{selector:".e-insert-function"}),i.appendChild(this.parent.createElement("div",{className:"e-separator"}));var o=i.appendChild(this.parent.createElement("textarea",{className:"e-formula-bar e-css",id:t+"_formula_input",attrs:{title:r.getConstant("FormulaBar"),spellcheck:"false"}}));if(o.rows=1,this.parent.isMobileView())o.placeholder=r.getConstant("MobileFormulaBarPlaceHolder"),f.bi.add(o,"focus",this.textAreaFocusIn,this),f.bi.add(o,"blur",this.textAreaFocusOut,this);else{var l=r.getConstant("ExpandFormulaBar");i.appendChild(this.parent.createElement("span",{className:"e-drop-icon e-icons",attrs:{title:l,role:"button",tabindex:"-1","aria-label":l}}))}e&&e.uiUpdate?this.parent.element.insertBefore(i,document.getElementById(t+"_sheet_panel")):this.parent.element.appendChild(i)}else this.destroy()},s.prototype.textAreaFocusIn=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel"),r=this.parent.createElement("button",{className:"e-btn e-css e-flat e-icon-btn e-formula-submit",attrs:{type:"button"}});r.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-tick-icon"})),e.classList.add("e-focused"),e.appendChild(r)},s.prototype.textAreaFocusOut=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel");e.classList.remove("e-focused"),(0,f.og)(e.querySelector(".e-formula-submit"))},s.prototype.keyDownHandler=function(e){var r=e.target;if(this.parent.isEdit&&!this.parent.getActiveSheet().isProtected){if((pe(r.value)||r.validity&&0===r.value.toString().indexOf("="))&&16===e.keyCode)return;r.classList.contains("e-formula-bar")&&this.parent.notify(fe,{action:"refreshEditor",value:r.value,refreshEditorElem:!0})}},s.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var r=e.target;if(r.classList.contains("e-formula-bar")){var t={action:"getCurrentEditValue",editedValue:""};this.parent.notify(fe,t),t.editedValue!==r.value&&16!==e.keyCode&&this.parent.notify(fe,{action:"refreshEditor",value:r.value,refreshEditorElem:!0})}}},s.prototype.nameBoxBeforeOpen=function(e){this.comboBoxInstance.element.classList.contains("e-name-editing")?e.cancel=!0:this.comboBoxInstance.element.select()},s.prototype.nameBoxBlur=function(){this.comboBoxInstance.element.classList.contains("e-name-editing")&&(this.comboBoxInstance.element.classList.remove("e-name-editing"),this.UpdateValueAfterMouseUp())},s.prototype.nameBoxSelect=function(e){if(e.isInteracted){var r=e.itemData.refersTo.substr(1),t=ee(this.parent,Et(r));if(void 0===t)return;var i=Cr(r),n=_(this.parent,t);if(-1!==i.indexOf(":")){var a=i.indexOf(":"),o=i.substr(0,a),l=i.substr(a+1,i.length);o=o.replace("$",""),(l=l.replace("$","")).match(/\D/g)&&!l.match(/[0-9]/g)&&o.match(/\D/g)&&!o.match(/[0-9]/g)?i=(o+="1")+":"+(l+=n.rowCount):!l.match(/\D/g)&&l.match(/[0-9]/g)&&!o.match(/\D/g)&&o.match(/[0-9]/g)&&(i=(o=j(parseInt(o,10)-1,0))+":"+(l=j(parseInt(l,10)-1,n.colCount-1)))}t===this.parent.activeSheetIndex?(this.parent.selectRange(i),K(this.parent.element)):($i(this.parent,i,n),this.parent.activeSheetIndex=t)}},s.prototype.formulaBarUpdateHandler=function(e){var n,r=this,i=this.parent.getActiveSheet().selectedRange.split(":"),a={action:"getElement",element:null};this.parent.notify(fe,a);var o=this.parent.element.querySelector(".e-formula-bar"),l=new f.eC;if("mousemove"===e.type||"pointermove"===e.type){var h=A(i[0]),p=A(i[1]);n=Math.abs(h[0]-p[0])+1+"R x "+(Math.abs(h[1]-p[1])+1)+"C",this.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?this.parent.notify(ha,null):a.element&&(o.value=a.element.textContent))}else n=i[0],this.parent.getData(pt(this.parent)+"!"+n).then(function(d){if(r.parent){var v,u="";d.forEach(function(g){var m=g&&g.format?Ft(g.format):"General";if(g){if(!(0,f.le)(g.value))if("Invalid Date"===(v=nr(Number(g.value))).toString()||"ShortDate"!==m&&"LongDate"!==m)"Invalid Date"!==v.toString()&&"Time"===m?(Number(g.value)>=1&&(u=l.formatDate(v,{type:"dateTime",skeleton:"yMd"})+" "),u+=l.formatDate(v,{type:"dateTime",skeleton:"hms"})):u=g.value;else if((u=l.formatDate(v,{type:"date",skeleton:"yMd"}))&&u.indexOf("/")>-1||u.indexOf("-")>0){var y=u.split(/-|\//),C=g?g.format:"";("dd-MM-yyyy"===C||"dd/MM/yyyy"===C)&&Number(y[0])<=12&&Number(y[1])<=31&&(u=y[1]+"/"+y[0]+"/"+y[2])}g.formula&&(u=g.formula)}var b={action:"getCurrentEditValue",editedValue:""};r.parent.notify(fe,b);var S=b.editedValue&&0===b.editedValue.toString().indexOf("=")||pe(b.editedValue),w=document.getElementById(r.parent.element.id+"_formula_input"),x=A(n),I=r.parent.getCell(x[0],x[1]);if(!g||g.formula||!I||"Time"===m&&u)w.value=u;else if(void 0===g.value||r.isDateTimeType(g.format)&&g.value&&"Invalid Date"!==nr(Number(g.value)).toString()||(0,f.le)(g.format)){var F=r.isDateTimeType(g.format);if(F){var T=new f.eC,k="date"===F?"M/d/yyyy":"h:mm:ss a";("dd-MM-yyyy"===g.format||"dd/MM/yyyy"===g.format)&&(k=g.format),w.value=T.formatDate(nr(parseFloat(g.value)),{type:F,format:k})}else w.value=g.validation&&"List"===g.validation.type?(I.lastElementChild||I).textContent:I.textContent}else w.value=g.value;!(0,f.le)(u)&&!S&&r.parent.notify(fe,{action:"refreshEditor",value:w.value,refreshEditorElem:!0}),r.parent.isEdit&&(e.target&&!e.target.classList.contains("e-spreadsheet-edit")?r.parent.notify(ha,null):a.element&&(o.value=a.element.textContent))})}});this.updateComboBoxValue(n)},s.prototype.isDateTimeType=function(e){var i;return[":","hh","h","mm:ss","h:mm:ss"].forEach(function(n){e&&e.indexOf(n)>-1&&(i="time")}),i||(["/","-d","-m","-y","dd","mm","yy"].forEach(function(n){e&&e.indexOf(n)>-1&&(i="date")}),i)},s.prototype.UpdateValueAfterMouseUp=function(){this.updateComboBoxValue(this.parent.getActiveSheet().selectedRange.split(":")[0])},s.prototype.updateComboBoxValue=function(e){var r=this.parent.getActiveSheet(),i={action:"getNameFromRange",range:pt(this.parent)+"!"+r.selectedRange,definedName:null};if(this.parent.notify(tr,i),i.definedName&&(e=i.definedName.name),!this.parent.isMobileView()){if(this.comboBoxInstance.text===e)return;this.comboBoxInstance.text=e,this.comboBoxInstance.dataBind()}},s.prototype.disabletextarea=function(){this.getFormulaBar().disabled=!!this.parent.getActiveSheet().isProtected},s.prototype.formulaBarScrollEdit=function(){var e=A(this.parent.getActiveSheet().selectedRange),r=B(this.parent.getActiveSheet().topLeftCell);e[0]<r[0]&&(this.parent.goTo(this.parent.getActiveSheet().selectedRange),this.isGoto=!0),this.parent.notify(fe,{action:"startEdit",refreshCurPos:!1})},s.prototype.formulaBarClickHandler=function(e){var r=e.target,t=this.parent.getActiveSheet(),i=t.isProtected,n=B(t.activeCell),o=ur(E(n[0],n[1],t),Fe(t,n[1]));if(r.classList.contains("e-drop-icon")&&(0,f.oq)(r,".e-formula-bar-panel"))this.toggleFormulaBar(r);else if(r.classList.contains("e-formula-bar"))this.parent.isEdit||i&&(!i||o)?i&&o&&this.parent.notify(Nt,null):this.formulaBarScrollEdit();else if(r.parentElement&&r.parentElement.classList.contains("e-name-box"))if(r.classList.contains("e-ddl-icon")){var l={action:"getNames",names:[]};this.parent.notify(tr,l),this.comboBoxInstance.dataSource=l.names}else this.comboBoxInstance.element.classList.add("e-name-editing"),this.comboBoxInstance.element.select();if(!(0,f.le)(r.offsetParent)&&(r.offsetParent.classList.contains("e-insert-function")||r.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.offsetParent.id||this.parent.element.id+"_insert_function"===r.id||r.parentElement.classList.contains("e-insert-function")||this.parent.element.id+"_insert_function"===r.parentElement.id)){if(i)return void this.parent.notify(Nt,null);this.renderInsertDlg()}},s.prototype.renderInsertDlg=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=!this.parent.isEdit,i={action:"getCurrentEditValue",editedValue:""};if(!t){var n={action:"isFormulaEditing",isFormulaEdit:!1};this.parent.notify(tr,n),t=n.isFormulaEdit,this.parent.notify(fe,i)}if(t||""===i.editedValue){""===i.editedValue&&this.parent.notify(fe,{action:"refreshEditor",value:"="});var a=this.parent.createElement("div",{className:"e-formula-description",id:this.parent.element.id+"_description_content"}),o=this.parent.createElement("div",{className:"e-category-content",id:this.parent.element.id+"_category_content",innerHTML:r.getConstant("PickACategory")}),l=this.parent.createElement("input",{className:"e-formula-category",id:this.parent.element.id+"_formula_category"}),h=this.parent.createElement("div",{className:"e-formula-list",id:this.parent.element.id+"_formula_list"}),p=this.parent.createElement("div",{className:"e-description-content",innerHTML:r.getConstant("Description")}),c=this.parent.createElement("div",{className:"e-header-content",innerHTML:r.getConstant("InsertFunction")}),d={action:"getFormulaCategory",categoryCollection:[]};this.parent.notify(ie,d),this.categoryCollection=d.categoryCollection,this.categoryList=new Rt.NB({dataSource:this.categoryCollection,index:0,width:"285px",popupHeight:"210px",select:this.dropDownSelect.bind(this)});var u={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(ie,u),this.formulaCollection=u.formulaCollection,this.formulaList=new an.Bv({dataSource:this.formulaCollection.sort(),actionComplete:this.updateFormulaList.bind(this),select:this.listSelected.bind(this),width:"285px",height:"200px"}),this.dialog=this.parent.serviceLocator.getService(ae),this.parent.element.querySelector(".e-spreadsheet-function-dlg")||(this.dialog.show({header:c.outerHTML,content:o.outerHTML+l.outerHTML+h.outerHTML+p.outerHTML+a.outerHTML,width:"320px",height:"485px",cssClass:"e-spreadsheet-function-dlg",showCloseIcon:!0,isModal:!0,beforeOpen:function(v){var g={dialogName:"InsertFunctionDialog",element:v.element,target:v.target,cancel:v.cancel};e.parent.trigger("dialogBeforeOpen",g),g.cancel&&(v.cancel=!0),K(e.parent.element)},open:this.dialogOpen.bind(this),beforeClose:this.dialogBeforeClose.bind(this),close:this.dialogClose.bind(this),buttons:[{click:this.selectFormula.bind(this,this.dialog,this),buttonModel:{content:r.getConstant("Ok"),isPrimary:!0}}]}),this.categoryList.appendTo("#"+this.parent.element.id+"_formula_category"),this.formulaList.appendTo("#"+this.parent.element.id+"_formula_list"),f.bi.add(this.formulaList.element,"dblclick",this.formulaClickHandler,this))}},s.prototype.toggleFormulaBar=function(e){var r=e.parentElement,t=this.parent.serviceLocator.getService(O);r.classList.contains("e-expanded")?(r.classList.remove("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=1,e.title=t.getConstant("ExpandFormulaBar"),e.setAttribute("aria-label",t.getConstant("CollapseFormulaBar"))):(r.classList.add("e-expanded"),document.getElementById(this.parent.element.id+"_formula_input").rows=3,e.title=t.getConstant("CollapseFormulaBar"),e.setAttribute("aria-label",t.getConstant("ExpandFormulaBar"))),this.parent.setPanelSize()},s.prototype.toggleFormulaBarBtn=function(){var e=this.parent.element.querySelector(".e-formula-bar-panel .e-drop-icon");this.toggleFormulaBar(e)},s.prototype.dialogOpen=function(){var e=this;Pe(function(){var r=e.dialog.dialogInstance.element.querySelector(".e-footer-content .e-primary"),t=e.parent.serviceLocator.getService(O);r.setAttribute("aria-label",t.getConstant("InsertFunction")+" "+t.getConstant("Ok")),K(r)})},s.prototype.dialogClose=function(){var e={action:"getCurrentEditValue",editedValue:""};this.parent.notify(fe,e),"="===e.editedValue.toString().trim()&&this.parent.notify(fe,{action:"refreshEditor",value:""})},s.prototype.dialogBeforeClose=function(){f.bi.remove(this.formulaList.element,"dblclick",this.formulaClickHandler);var e=document.getElementsByClassName("e-spreadsheet-function-dlg")[0].querySelector(".e-dlg-content");e.parentNode.removeChild(e),this.dialog.dialogInstance.storeActiveElement=document.getElementById(this.parent.element.id+"_edit")},s.prototype.selectFormula=function(e,r){var t=r.formulaList.getSelectedItems().text,i=_(this.parent,this.parent.activeSheetIndex);this.parent.isEdit?this.parent.notify(fe,{action:"refreshEditor",value:t+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(fe,{action:"startEdit",value:"="+t+"(",address:i.activeCell}),this.parent.notify(cr,{action:"refreshFormulabar",value:"="+t+"("})),e.hide()},s.prototype.listSelected=function(){this.updateFormulaDescription()},s.prototype.updateFormulaList=function(){this.activeListFormula(),this.updateFormulaDescription()},s.prototype.dropDownSelect=function(e){this.formulaCollection=[];var r={action:"getLibraryFormulas",formulaCollection:[]};if("All"===e.item.textContent)this.parent.notify(ie,r),this.formulaCollection=r.formulaCollection;else{var i={action:"dropDownSelectFormulas",formulaCollection:[],selectCategory:e.item.textContent};this.parent.notify(ie,i),this.formulaCollection=i.formulaCollection}this.formulaList.dataSource=this.formulaCollection.sort()},s.prototype.activeListFormula=function(){var e=document.getElementById(this.parent.element.id+"_formula_list");this.formulaList.selectItem(e.children[0].children[0].firstElementChild)},s.prototype.updateFormulaDescription=function(){var e=this.formulaList.getSelectedItems().text,r={action:"getFormulaDescription",description:"",selectedList:e,isCustom:!1};this.parent.notify(ie,r);var t=this.dialog.dialogInstance.element.querySelector(".e-footer-content .e-primary");t.hasAttribute("aria-label")&&t.removeAttribute("aria-label"),K(t),e="AND"===e?"CalculateAND":"OR"===e?"CalculateOR":e,document.getElementById(this.parent.element.id+"_description_content").textContent=r.isCustom?r.description:this.parent.serviceLocator.getService(O).getConstant(e)},s.prototype.formulaClickHandler=function(e){var r=e.target,t=_(this.parent,this.parent.activeSheetIndex);(r.offsetParent.classList.contains("e-text-content")||r.classList.contains("e-list-item"))&&(this.parent.isEdit?this.parent.notify(fe,{action:"refreshEditor",value:r.innerText+"(",refreshFormulaBar:!0,refreshEditorElem:!0,isAppend:!0}):(this.parent.notify(fe,{action:"startEdit",value:"="+r.innerText+"(",address:t.activeCell}),this.parent.notify(cr,{action:"refreshFormulabar",value:"="+r.innerText+"("})),this.dialog.hide())},s.prototype.addEventListener=function(){this.parent.on(Oi,this.createFormulaBar,this),this.parent.on(xr,this.formulaBarClickHandler,this),this.parent.on(Dt,this.keyDownHandler,this),this.parent.on(gs,this.renderInsertDlg,this),this.parent.on(ys,this.toggleFormulaBarBtn,this),this.parent.on(lt,this.keyUpHandler,this),this.parent.on(Wt,this.formulaBarUpdateHandler,this),this.parent.on(bo,this.UpdateValueAfterMouseUp,this),this.parent.on(cr,this.editOperationHandler,this),this.parent.on(Zo,this.disabletextarea,this),this.parent.on(ei,this.isFormulaBarEdit,this)},s.prototype.destroy=function(){this.removeEventListener(),this.comboBoxInstance.destroy(),this.comboBoxInstance=null,this.insertFnRipple(),this.insertFnRipple=null;var e=this.parent.element.querySelector(".e-formula-bar-panel");e&&(0,f.og)(e)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Oi,this.createFormulaBar),this.parent.off(xr,this.formulaBarClickHandler),this.parent.off(gs,this.renderInsertDlg),this.parent.off(ys,this.toggleFormulaBarBtn),this.parent.off(Dt,this.keyDownHandler),this.parent.off(lt,this.keyUpHandler),this.parent.off(Wt,this.formulaBarUpdateHandler),this.parent.off(bo,this.UpdateValueAfterMouseUp),this.parent.off(cr,this.editOperationHandler),this.parent.off(Zo,this.disabletextarea),this.parent.off(ei,this.isFormulaBarEdit))},s.prototype.editOperationHandler=function(e){switch(e.action){case"refreshFormulabar":this.getFormulaBar().value=(0,f.o8)(e.value)?"":e.value;break;case"getElement":e.element=this.getFormulaBar()}},s.prototype.isFormulaBarEdit=function(e){e.isEdit=!(!this.parent.isEdit||!this.isGoto)},s.prototype.getFormulaBar=function(){return(0,f.Ys)("#"+this.parent.element.id+"_formula_input",this.parent.element)},s}(),Ba=function(){function s(e){this.isFormulaBar=!1,this.isFormula=!1,this.isPopupOpened=!1,this.isPreventClose=!1,this.isSubFormula=!1,this.parent=e,this.addEventListener()}return s.prototype.getModuleName=function(){return"formula"},s.prototype.destroy=function(){this.removeEventListener(),this.autocompleteInstance&&(this.autocompleteInstance.destroy(),this.autocompleteInstance.element&&this.autocompleteInstance.element.remove()),this.autocompleteInstance=null,this.parent=null},s.prototype.addEventListener=function(){this.parent.on(tr,this.performFormulaOperation,this),this.parent.on(lt,this.keyUpHandler,this),this.parent.on(Dt,this.keyDownHandler,this),this.parent.on(xr,this.formulaClick,this),this.parent.on(Wo,this.refreshFormulaDatasource,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(tr,this.performFormulaOperation),this.parent.off(lt,this.keyUpHandler),this.parent.off(Dt,this.keyDownHandler),this.parent.off(xr,this.formulaClick),this.parent.off(Wo,this.refreshFormulaDatasource))},s.prototype.performFormulaOperation=function(e){var n,a,r=this,t=e.action,i=this.parent.serviceLocator.getService(O);switch(t){case"renderAutoComplete":this.renderAutoComplete();break;case"endEdit":this.endEdit();break;case"addDefinedName":e.isAdded=this.addDefinedName(e.definedName);break;case"getNames":e.sheetName||(e.sheetName=pt(this.parent)),e.names=this.getNames(e.sheetName);break;case"getNameFromRange":e.definedName=this.getNameFromRange(e.range);break;case"isFormulaEditing":e.isFormulaEdit=this.isFormula;break;case"isCircularReference":n=this.parent.serviceLocator.getService(ae),a=i.getConstant("CircularReference"),n.dialogInstance&&n.dialogInstance.visible&&n.dialogInstance.content===a||n.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:i.getConstant("CircularReference"),beforeOpen:function(o){var l={dialogName:"CircularReferenceDialog",element:o.element,target:o.target,cancel:o.cancel};r.parent.trigger("dialogBeforeOpen",l),l.cancel&&(o.cancel=!0)}}),e.argValue="0"}},s.prototype.renderAutoComplete=function(){if(!(0,f.Ys)("#"+this.parent.element.id+"_ac",this.parent.element)){var e=this.parent.createElement("input",{id:this.parent.element.id+"_ac",className:"e-ss-ac"});this.parent.element.appendChild(e);var r={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(ie,r);var t={dataSource:r.formulaCollection,cssClass:"e-ss-atc",popupWidth:"130px",allowFiltering:!0,filterType:"StartsWith",sortOrder:"Ascending",open:this.onSuggestionOpen.bind(this),close:this.onSuggestionClose.bind(this),select:this.onSelect.bind(this),actionComplete:this.onSuggestionComplete.bind(this)};this.autocompleteInstance=new Rt.Qc(t,e),this.autocompleteInstance.createElement=this.parent.createElement}},s.prototype.onSuggestionOpen=function(e){var r=this;this.isPopupOpened=!0,e.popup.relateTo=this.getRelateToElem(),e.popup.element.firstChild.style.maxHeight="180px",new Promise(function(t,i){setTimeout(function(){t()},100)}).then(function(){r.triggerKeyDownEvent(mt.DOWN)})},s.prototype.onSuggestionClose=function(e){this.isPreventClose?e.cancel=!0:this.isPopupOpened=!1},s.prototype.onSelect=function(e){var r="="+e.itemData.value+"(";if(this.isSubFormula){var t=this.getEditingValue(),i=t.lastIndexOf(this.getArgumentSeparator());(i>-1||(i=t.lastIndexOf("("))>-1)&&(r=t.slice(0,i+1)),r+=e.itemData.value+"("}if(this.parent.notify(fe,{action:"refreshEditor",value:r,refreshFormulaBar:!0,refreshEditorElem:!0,refreshCurPos:!this.isFormulaBar}),this.isPopupOpened){this.hidePopUp();var n=(0,f.Ys)("#"+this.parent.element.id+"_ac_popup");n&&(0,f.og)(n),this.isPopupOpened=!1}},s.prototype.onSuggestionComplete=function(e){this.isPreventClose=e.result.length>0,this.isPreventClose||(e.cancel=!0,this.hidePopUp())},s.prototype.refreshFormulaDatasource=function(){var e={action:"getLibraryFormulas",formulaCollection:[]};this.parent.notify(ie,e),this.autocompleteInstance.dataSource=e.formulaCollection},s.prototype.keyUpHandler=function(e){if(this.parent.isEdit){var r=this.getEditingValue();this.isFormula=pe(r),(this.isFormula||this.isPopupOpened)&&(e.keyCode!==mt.TAB&&this.isFormula&&(r=this.getSuggestionKeyFromFormula(r)),this.refreshFormulaSuggestion(e,r))}else this.isPopupOpened&&this.hidePopUp()},s.prototype.keyDownHandler=function(e){var r=e.keyCode;if(this.isFormula){if(this.isPopupOpened)switch(r){case mt.UP:case mt.DOWN:e.preventDefault(),this.triggerKeyDownEvent(r);break;case mt.TAB:e.preventDefault(),this.triggerKeyDownEvent(mt.ENTER)}}else{var t=e.target;if(t.id===this.parent.element.id+"_name_box")switch(r){case mt.ENTER:this.addDefinedName({name:t.value}),K(this.parent.element);break;case mt.ESC:K(this.parent.element)}}},s.prototype.formulaClick=function(e){this.parent.isEdit&&(this.isFormulaBar=e.target.classList.contains("e-formula-bar"))},s.prototype.refreshFormulaSuggestion=function(e,r){if(r.length>0){var t=this.autocompleteInstance.element,n=this.isPopupOpened;this.isNavigationKey(e.keyCode)||(t.value=r,t.dispatchEvent(new Event("input")),t.dispatchEvent(new Event("keyup")),n&&this.triggerKeyDownEvent(mt.DOWN))}else this.isPopupOpened&&(this.isPreventClose=!1,this.hidePopUp())},s.prototype.endEdit=function(){if(this.isSubFormula=!1,this.isPreventClose=!1,this.isFormula=!1,this.isFormulaBar=!1,this.isPopupOpened){this.hidePopUp();var e=(0,f.Ys)("#"+this.parent.element.id+"_ac_popup");e&&(0,f.og)(e),this.isPopupOpened=!1}},s.prototype.hidePopUp=function(){this.autocompleteInstance.hidePopup()},s.prototype.getSuggestionKeyFromFormula=function(e){var r="";if(e=e.substr(1)){var t=e.lastIndexOf("("),i=(e=e.substr(t+1)).split(this.getArgumentSeparator());1===i.length?(r=i[0],this.isSubFormula=t>-1):(r=i[i.length-1],this.isSubFormula=!0);var n=r.match(/\w/);(!n||n&&0!==n.index)&&(r="")}return r},s.prototype.getRelateToElem=function(){var e={action:"getElement"};return this.parent.notify(this.isFormulaBar?cr:fe,e),e.element},s.prototype.getEditingValue=function(){var e={action:"getCurrentEditValue",editedValue:""};return this.parent.notify(fe,e),e.editedValue},s.prototype.isNavigationKey=function(e){return e===mt.UP||e===mt.DOWN||e===mt.LEFT||e===mt.RIGHT},s.prototype.triggerKeyDownEvent=function(e){var r=this.autocompleteInstance.element;r.dispatchEvent(new Event("input"));var t=new Event("keydown");t.keyCode=e,t.which=e,t.altKey=!1,t.shiftKey=!1,t.ctrlKey=!1,r.dispatchEvent(t)},s.prototype.getArgumentSeparator=function(){var e={action:"getArgumentSeparator",argumentSeparator:""};return this.parent.notify(ie,e),e.argumentSeparator},s.prototype.getNames=function(e){return this.parent.definedNames.filter(function(t){return"Workbook"===t.scope||""===t.scope||t.scope===e})},s.prototype.getNameFromRange=function(e){var r=e.slice(0,e.indexOf(":")),t=e.slice(e.indexOf("!")+1).split(":"),i=t.length>1&&t[0]===t[1],n=this.parent.definedNames.filter(function(a){return!(!i||a.refersTo!=="="+r)||a.refersTo==="="+e});return n&&n[0]},s.prototype.addDefinedName=function(e){var r=this,t=e.name,i=!1;if(t&&nt(t.toUpperCase()))return this.parent.goTo(t),i;if(!e.refersTo){var n=_(this.parent,this.parent.activeSheetIndex),a=pt(this.parent);a=-1!==a.indexOf(" ")?"'"+a+"'":a;var o=n.selectedRange;if(!(0,f.le)(o)){var l=o.indexOf(":"),h=o.substr(0,l),p=o.substr(l+1,o.length);parseInt(p.replace(/\D/g,""),10)===n.rowCount&&1===parseInt(h.replace(/\D/g,""),10)?(p=p.replace(/[0-9]/g,""),o="$"+(h=h.replace(/[0-9]/g,""))+":$"+p):B(p)[1]===n.colCount-1&&0===B(h)[1]?(p=p.replace(/\D/g,""),o="$"+(h=h.replace(/\D/g,""))+":$"+p):o=h===p?h:o}e.refersTo=a+"!"+o,e.scope="Workbook"}if(t.length>0&&/^([a-zA-Z_0-9.]){0,255}$/.test(t)){var c={action:"addDefinedName",definedName:e,isAdded:!1};this.parent.notify(ie,c),i=c.isAdded,c.isAdded||this.parent.serviceLocator.getService(ae).show({content:this.parent.serviceLocator.getService(O).getConstant("DefineNameExists"),width:"300",beforeOpen:function(d){var u={dialogName:"DefineNameExistsDialog",element:d.element,target:d.target,cancel:d.cancel};r.parent.trigger("dialogBeforeOpen",u),u.cancel&&(d.cancel=!0)}})}else this.parent.serviceLocator.getService(ae).show({content:this.parent.serviceLocator.getService(O).getConstant("DefineNameInValid"),width:"300",beforeOpen:function(d){var u={dialogName:"DefineNameInValidDialog",element:d.element,target:d.target,cancel:d.cancel};r.parent.trigger("dialogBeforeOpen",u),u.cancel&&(d.cancel=!0)}});return i},s}(),Ha=function(){function s(e){this.aggregateContent="",this.selaggregateCnt="Sum",this.parent=e,this.addEventListener()}return s.prototype.getModuleName=function(){return"sheetTabs"},s.prototype.createSheetTabs=function(){var e=this;if(this.parent.showSheetTabs||!this.tabInstance){var r=this.parent.serviceLocator.getService(O),t=this.parent.createElement("div",{className:"e-sheet-tab-panel",id:this.parent.element.id+"_sheet_tab_panel"}),i=this.parent.createElement("button",{className:"e-add-sheet-tab e-btn e-css e-flat e-icon-btn"+(this.parent.allowInsert?"":" e-disabled"),attrs:{title:r.getConstant("AddSheet"),type:"button"}});i.appendChild(this.parent.createElement("span",{className:"e-btn-icon e-icons e-add-icon"})),i.addEventListener("click",this.addSheetTab.bind(this)),i.disabled=!this.parent.allowInsert,t.appendChild(i),this.addBtnRipple=(0,f.qx)(t,{selector:".e-add-sheet-tab"});var n=this.parent.createElement("button",{attrs:{title:r.getConstant("ListAllSheets"),type:"button"}});t.appendChild(n),this.parent.element.appendChild(t);var a=this.getSheetTabItems();this.dropDownInstance=new Oe.uw({iconCss:"e-icons",items:a.ddbItems,createPopupOnClick:!0,beforeItemRender:function(u){var v=e.parent.sheets[e.dropDownInstance.items.indexOf(u.item)];"Hidden"===v.state?u.element.classList.add("e-hide"):"VeryHidden"===v.state&&(u.element.style.display="none")},select:function(u){return e.updateSheetTab({idx:e.dropDownInstance.items.indexOf(u.item)})},beforeOpen:function(u){return e.beforeOpenHandler(e.dropDownInstance,u.element,r.getConstant("ListAllSheets"))},open:function(u){return e.openHandler(e.dropDownInstance,u.element,"left")},cssClass:"e-sheets-list e-flat e-caret-hide",close:function(){return e.focusTab(e.tabInstance.element)}}),this.dropDownInstance.createElement=this.parent.createElement,this.dropDownInstance.appendTo(n);var l,o=this.parent.createElement("div",{className:"e-sheet-tab"});this.tabInstance=new ze.OK({selectedItem:this.parent.activeSheetIndex,overflowMode:"Scrollable",items:a.tabItems,scrollStep:250,selecting:function(u){if(u.selectingIndex!==u.selectedIndex)if(l)l=!1;else{var v={currentSheetIndex:u.selectingIndex,previousSheetIndex:u.selectedIndex,cancel:!1};e.parent.notify(ue,{eventArgs:v,action:"gotoSheet"}),l=v.cancel}},selected:function(u){e.goToSheet(u,l,!0)},created:function(){var u=e.tabInstance.element.querySelector(".e-toolbar-items");u.classList.add("e-sheet-tabs-items"),f.bi.add(u,"dblclick",e.renameSheetTab,e)}}),t.appendChild(o),this.tabInstance.createElement=this.parent.createElement,this.tabInstance.appendTo(o),f.bi.remove(this.tabInstance.element,"keydown",this.tabInstance.spaceKeyDown);for(var p,h=a.tabItems.length,c=0;c<h;c++)p=_(this.parent,c),this.parent.notify(ie,{action:"addSheet",sheetName:"Sheet"+p.id,sheetId:p.id,visibleName:p.name});this.parent.notify(ie,{action:"initiateDefinedNames"}),this.parent.notify(ni,null)}else this.destroy()},s.prototype.goToSheet=function(e,r,t){if(e.selectedIndex!==e.previousIndex){if(r)return this.tabInstance.selectedItem=e.previousIndex,this.tabInstance.dataBind(),void K(this.parent.element);if(this.parent.notify(Lr,{}),this.parent.isEdit){var i=window.getSelection(),n={action:"getCurrentEditValue",editedValue:""};this.parent.notify(fe,n);var a=!!n.editedValue&&pe(n.editedValue,!0);!a&&i&&i.focusNode&&i.focusNode.classList&&i.focusNode.classList.contains("e-formula-bar-panel")&&(a=pe(this.parent.element.querySelector(".e-formula-bar").value,!0)),a||this.parent.endEdit()}this.parent.activeSheetIndex=e.selectedIndex,this.parent.dataBind(),this.updateDropDownItems(e.selectedIndex,e.previousIndex);var o={action:"registerGridInCalc",sheetID:(e.selectedIndex+1).toString()};this.parent.notify(ie,o),t&&this.parent.notify(Z,{eventArgs:{previousSheetIndex:e.previousIndex,currentSheetIndex:e.selectedIndex},action:"gotoSheet"})}},s.prototype.updateDropDownItems=function(e,r){r>-1&&(this.dropDownInstance.items[r].iconCss=""),this.dropDownInstance.items[e].iconCss="e-selected-icon e-icons",this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0)},s.prototype.beforeOpenHandler=function(e,r,t){var i=this.parent.viewport.height;parseInt(getComputedStyle(r.firstElementChild).height,10)*e.items.length+2*parseInt(getComputedStyle(r).paddingTop,10)>i&&(r.style.height=i+"px",r.style.overflowY="auto"),r.parentElement.style.visibility="hidden",t&&r.setAttribute("aria-label",t)},s.prototype.openHandler=function(e,r,t){var n,i=r.parentElement;if(-1===(0,Pt.vF)(i).indexOf("bottom")){n="auto"===r.style.overflowY?this.parent.viewport.height:i.getBoundingClientRect().height;var o=(0,Pt.kl)(e.element,t,"top");"right"===t&&(o.left-=i.getBoundingClientRect().width),i.style.left=o.left+"px",i.style.top=o.top-n+"px"}i.style.visibility="",K(r)},s.prototype.getSheetTabItems=function(){var i,e=this,r=[],t=[];return this.parent.sheets.forEach(function(n,a){i=pt(e.parent,a).replace(/</g,"&lt;").replace(/>/g,"&gt;"),r.push({header:{text:i},visible:"Visible"===n.state}),t.push({text:i,iconCss:a===e.parent.activeSheetIndex?"e-selected-icon e-icons":""})}),{tabItems:r,ddbItems:t}},s.prototype.refreshSheetTab=function(){var e=this.getSheetTabItems();this.dropDownInstance.items=e.ddbItems,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.items=e.tabItems,this.tabInstance.selectedItem=this.parent.activeSheetIndex,this.tabInstance.dataBind()},s.prototype.addSheetTab=function(){this.parent.notify(wt,{model:this.parent,start:this.parent.activeSheetIndex+1,end:this.parent.activeSheetIndex+1,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex+1})},s.prototype.insertSheetTab=function(e){this.parent.notify(Lr,{}),(!e.preventUpdate||e.startIdx===this.tabInstance.selectedItem)&&(this.dropDownInstance.items[this.tabInstance.selectedItem].iconCss="");for(var r=e.startIdx;r<=e.endIdx;r++){var t=this.parent.sheets[r].name.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.dropDownInstance.items.splice(r,0,{text:t}),this.tabInstance.addTab([{header:{text:t},content:""}],r)}(!e.preventUpdate||e.startIdx===this.tabInstance.selectedItem)&&(this.dropDownInstance.items[e.startIdx].iconCss="e-selected-icon e-icons"),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.preventUpdate?e.startIdx!==this.tabInstance.selectedItem&&this.refreshSheetTab():this.updateSheetTab({idx:e.startIdx,preventDataBind:!0})},s.prototype.updateSheetTab=function(e){if("activeSheetChanged"===e.name)e.idx=this.parent.skipHiddenSheets(e.idx);else if("Hidden"===this.parent.sheets[e.idx].state){if(this.parent.isProtected)return;this.showSheet({sheetIndex:e.idx,triggerEvent:!0})}this.tabInstance.selectedItem=e.idx,e.preventDataBind||this.tabInstance.dataBind(),this.parent.notify(ni,null)},s.prototype.showSheet=function(e){this.parent.setSheetPropertyOnMute(this.parent.sheets[e.sheetIndex],"state","Visible"),this.tabInstance.hideTab(e.sheetIndex,!1),e.triggerEvent&&this.parent.notify(Z,{action:"showSheet",eventArgs:{sheetIndex:e.sheetIndex}})},s.prototype.switchSheetTab=function(e){var r=(0,f.oq)(e.event.target,".e-toolbar-item");if(r){for(var t=r.querySelector(".e-tab-text").textContent,i=[],n=this.parent.element.id+"_cmenu",a=0,o=this.parent.sheets.length;a<o;a++)if(this.parent.sheets[a].name===t){this.parent.activeSheetIndex!==a&&this.updateSheetTab({idx:a});break}e.element.classList.contains("e-contextmenu")&&e.items[0]&&e.items[0].id===this.parent.element.id+"_cmenu_insert_sheet"&&(1===this.skipHiddenSheets()&&i.push(n+"_hide_sheet",n+"_delete_sheet"),(!this.parent.allowInsert||this.parent.isProtected)&&i.push(n+"_insert_sheet"),!this.parent.allowDelete&&i.indexOf(n+"_delete_sheet")>-1&&i.push(n+"_delete_sheet")),(this.parent.password.length>0||this.parent.isProtected)&&(i.indexOf(n+"_insert_sheet")>-1&&i.push(n+"_insert_sheet"),i.indexOf(n+"_delete_sheet")>-1&&i.push(n+"_delete_sheet"),i.push(n+"_duplicate",n+"_rename",n+"_hide_sheet",n+"_delete_sheet",n+"_insert_sheet",n+"_move_left",n+"_move_right")),this.parent.enableContextMenuItems(i,!1,!0)}},s.prototype.skipHiddenSheets=function(){var e=this.parent.sheets.length;return this.parent.sheets.forEach(function(r){"Visible"!==r.state&&--e}),e},s.prototype.renameSheetTab=function(){var e=this.tabInstance.element.querySelector(".e-toolbar-item.e-active");if(e){var r=(e=e.querySelector(".e-text-wrap")).querySelector(".e-tab-text").textContent,t={eventArgs:{name:r,index:this.parent.getActiveSheet().id},action:"renameSheet",cancel:!1};if(this.parent.trigger("actionBegin",t),t.cancel||this.parent.isProtected)return;var i=this.parent.createElement("input",{id:this.parent.element.id+"_rename_input",className:"e-input e-sheet-rename",styles:"width: "+e.getBoundingClientRect().width+"px",attrs:{type:"text",name:"Rename",required:"",value:r,spellcheck:"false",maxlength:"31"}});e.firstElementChild.style.display="none",e.appendChild(i),f.bi.add(document,"mousedown touchstart",this.renameInputFocusOut,this),f.bi.add(i,"input",this.updateWidth,this),i.focus(),i.setSelectionRange(0,r.length),f.bi.remove((0,f.oq)(e,".e-toolbar-items"),"dblclick",this.renameSheetTab)}},s.prototype.updateWidth=function(e){var r=e.target,t=r.value.length,i=r.value.split(" ");if(i.length){var n=i.length-1;t-=n,t+=.5*n}r.style.width=t+"ch"},s.prototype.renameInputFocusOut=function(e){var r=e.target;if("mousedown"!==e.type&&"touchstart"!==e.type||!r.classList.contains("e-sheet-rename")&&!(0,f.oq)(r,".e-dlg-container")){if(r=document.getElementById(this.parent.element.id+"_rename_input"),"keydown"===e.type&&27===e.keyCode)return this.removeRenameInput(r),void this.focusTab(this.tabInstance.element);var t=r.value,i=this.parent.serviceLocator.getService(O);if(t){var n=this.tabInstance.selectedItem;if(t.match(new RegExp(".*[\\[\\]\\*\\\\/\\?].*")))this.showRenameDialog(r,i.getConstant("SheetRenameInvalidAlert"));else{if(this.parent.sheets[n].name!==t)for(var a=0,o=this.parent.sheets.length;a<o;a++)if(a!==this.parent.activeSheetIndex&&this.parent.sheets[a].name.toLowerCase()===t.toLowerCase())return void this.showRenameDialog(r,i.getConstant("SheetRenameAlreadyExistsAlert"));var l=this.removeRenameInput(r);this.parent.sheets[n].name!==t&&(this.parent.setSheetPropertyOnMute(this.parent.sheets[n],"name",t),this.updateSheetName({value:t,idx:n,items:l})),"keydown"===e.type?this.focusTab(l):(0,f.oq)(e.target,".e-spreadsheet")&&K(this.parent.element)}}else this.showRenameDialog(r,i.getConstant("SheetRenameEmptyAlert"));this.parent.notify(Z,{eventArgs:{index:this.parent.getActiveSheet().id,value:t},action:"renameSheet"})}},s.prototype.focusTab=function(e){K((0,f.Ys)(".e-toolbar-item.e-active .e-tab-wrap",e))},s.prototype.updateSheetName=function(e){var i,r=this.tabInstance.items[e.idx].header.text.replace(/&lt;/g,"<").replace(/&gt;/g,">"),t=e.value.replace(/</g,"&lt;").replace(/>/g,"&gt;");this.tabInstance.items[e.idx].header.text=t,this.dropDownInstance.items[e.idx].text=t,this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),e.items.children[e.idx+1].querySelector(".e-tab-text").textContent="",e.items.children[e.idx+1].querySelector(".e-tab-text").appendChild(document.createTextNode(e.value)),e.value.indexOf("  ")>-1?this.tabInstance.setProperties({items:this.tabInstance.items},!0):this.tabInstance.dataBind(),this.parent.notify(ie,{action:"renameUpdation",value:e.value,pName:r}),this.parent.allowChart&&this.parent.chartColl.forEach(function(n){n.range.includes("!")&&(i=n.range.split("!"))[0].toLowerCase()===r.toLowerCase()&&(i[0]=e.value,n.range=i.join("!"))})},s.prototype.hideSheet=function(e){var r={action:"hideSheet",eventArgs:{sheetIndex:e.sheetIndex,cancel:!1}};e.triggerEvent&&(this.parent.notify(ue,r),r.eventArgs.cancel)||(this.parent.setSheetPropertyOnMute(_(this.parent,e.sheetIndex),"state","Hidden"),this.tabInstance.hideTab(e.sheetIndex),e.triggerEvent&&(delete r.eventArgs.cancel,this.parent.notify(Z,r)))},s.prototype.removeRenameInput=function(e){var r=e.parentElement.querySelector(".e-tab-text"),t=(0,f.oq)(e,".e-toolbar-items");return f.bi.add(t,"dblclick",this.renameSheetTab,this),f.bi.remove(document,"mousedown touchstart",this.renameInputFocusOut),f.bi.remove(e,"input",this.updateWidth),(0,f.Od)(e),r.style.display="",t},s.prototype.showRenameDialog=function(e,r){var t=this;this.parent.serviceLocator.getService(ae).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:r,beforeOpen:function(n){var a={dialogName:"SheetRenameDialog",element:n.element,target:n.target,cancel:n.cancel};t.parent.trigger("dialogBeforeOpen",a),a.cancel&&(n.cancel=!0),n.element.querySelector(".e-footer-content .e-primary").setAttribute("aria-label",r+" "+t.parent.serviceLocator.getService(O).getConstant("Ok")),e.focus()},close:function(){return e.setSelectionRange(0,e.value.length)}})},s.prototype.focusRenameInput=function(){var e=document.getElementById(this.parent.element.id+"_rename_input");e&&e.focus()},s.prototype.removeSheetTab=function(e){var r=this;if(!e.count||e.count!==this.parent.sheets.length){var t=this.parent.serviceLocator.getService(O);if(this.skipHiddenSheets()>1){var i=e.sheetName?_(this.parent,ee(this.parent,e.sheetName)):this.parent.getActiveSheet(),n=(0,f.le)(e.index)?ee(this.parent,i.name):e.index,a={index:n,sheetCount:this.parent.sheets.length,sheetName:i.name};if(i.rows&&i.rows.length&&(1!==i.rows.length||i.rows[0].cells&&i.rows[0].cells.length)){var l=this.parent.serviceLocator.getService(ae);e.clicked?this.forceDelete(n):l.show({height:200,width:400,isModal:!0,showCloseIcon:!0,cssClass:"e-delete-sheet-dlg",content:t.getConstant("DeleteSheetAlert"),beforeOpen:function(h){var p={dialogName:"DeleteSheetDialog",element:h.element,target:h.target,cancel:h.cancel};r.parent.trigger("dialogBeforeOpen",p),p.cancel&&(h.cancel=!0),h.element.querySelector(".e-footer-content .e-primary").setAttribute("aria-label",t.getConstant("DeleteSheetAlert")+" "+t.getConstant("Ok"));var c=r.tabInstance.element.querySelector(".e-toolbar-item.e-active");K((c.nextElementSibling||c.previousElementSibling).querySelector(".e-tab-wrap"))},buttons:[{buttonModel:{content:t.getConstant("Ok"),isPrimary:!0},click:function(){l.hide(),r.forceDelete(n),r.parent.notify(ri,null),e&&!e.isAction&&(a.sheetCount=r.parent.sheets.length,r.parent.notify(Z,{eventArgs:a,action:"removeSheet"}))}}]})}else this.parent.notify(ie,{action:"deleteSheetTab",sheetId:_(this.parent,n).id}),this.destroySheet(n),this.parent.notify(ri,null),e&&!e.isAction&&(a.sheetCount=this.parent.sheets.length,this.parent.notify(Z,{eventArgs:a,action:"removeSheet"}))}else this.parent.serviceLocator.getService(ae).show({target:document.getElementById(this.parent.element.id+"_sheet_panel"),height:180,width:400,isModal:!0,showCloseIcon:!0,content:t.getConstant("DeleteSingleLastSheetAlert"),beforeOpen:function(h){var p={dialogName:"DeleteSingleSheetDialog",element:h.element,target:h.target,cancel:h.cancel};r.parent.trigger("dialogBeforeOpen",p),p.cancel&&(h.cancel=!0)}})}},s.prototype.forceDelete=function(e){this.parent.notify(Lr,{}),this.parent.notify(ie,{action:"deleteSheetTab",sheetId:_(this.parent,e).id}),this.destroySheet(e)},s.prototype.destroySheet=function(e){var r=(0,f.le)(e)?this.parent.activeSheetIndex:e;this.parent.removeSheet(r),this.parent.notify(ar,{sheetIndex:r}),this.dropDownInstance.items.splice(r,1),this.dropDownInstance.setProperties({items:this.dropDownInstance.items},!0),this.tabInstance.removeTab(r);var t=this.parent.skipHiddenSheets(this.tabInstance.selectedItem);this.parent.activeSheetIndex=t,this.parent.setProperties({activeSheetIndex:t},!0),this.parent.renderModule.refreshSheet(),this.tabInstance.selectedItem=t,this.tabInstance.dataBind(),this.updateDropDownItems(t),this.parent.notify(ni,null)},s.prototype.showAggregate=function(){var e=this;if(!yi(A(this.parent.getActiveSheet().selectedRange))){var r={Count:0,Sum:"0",Avg:"0",Min:"0",Max:"0",countOnly:!0};if(this.parent.notify(Ei,r),r.Count>1){this.aggregateContent=r.countOnly?"Count":this.selaggregateCnt,r.countOnly&&(this.aggregateContent="Count",delete r.Sum,delete r.Avg,delete r.Min,delete r.Max);var t=r.countOnly?"e-aggregate-list e-flat e-aggregate-list-countonly e-caret-hide":"e-aggregate-list e-flat";delete r.countOnly;var i=this.aggregateContent,n=i+": "+r[i];if(this.aggregateDropDown)this.updateAggregateContent(n,r);else{var a=this.parent.createElement("button",{id:this.parent.element.id+"_aggregate",attrs:{type:"button"}});document.getElementById(this.parent.element.id+"_sheet_tab_panel").appendChild(a),this.aggregateDropDown=new Oe.uw({content:n,items:this.getAggregateItems(r),createPopupOnClick:!0,select:function(o){e.parent.notify(Ei,r),e.updateAggregateContent(o.item.text,{Count:r.Count,Sum:r.Sum,Avg:r.Avg,Min:r.Min,Max:r.Max},!0)},beforeOpen:function(o){return e.beforeOpenHandler(e.aggregateDropDown,o.element)},open:function(o){return e.openHandler(e.aggregateDropDown,o.element,"right")},close:function(){return K(e.parent.element)},cssClass:t}),this.aggregateDropDown.createElement=this.parent.createElement,this.aggregateDropDown.appendTo(a)}}else this.removeAggregate()}},s.prototype.getAggregateItems=function(e){var r=this,t=[];return Object.keys(e).forEach(function(a){e[a]!==Ei&&t.push({text:a+": "+e[a],iconCss:a===r.aggregateContent?"e-selected-icon e-icons":""})}),t},s.prototype.updateAggregateContent=function(e,r,t){this.aggregateContent=e.split(": ")[0],t&&(this.selaggregateCnt=e.split(": ")[0]),this.aggregateDropDown.content=e,this.aggregateDropDown.dataBind(),this.aggregateDropDown.setProperties({items:this.getAggregateItems(r)},!0)},s.prototype.removeAggregate=function(){(0,f.le)(this.aggregateDropDown)||(this.aggregateDropDown.destroy(),(0,f.Od)(this.aggregateDropDown.element),this.aggregateDropDown=null)},s.prototype.addEventListener=function(){this.parent.on(jn,this.createSheetTabs,this),this.parent.on(pr,this.refreshSheetTab,this),this.parent.on(So,this.insertSheetTab,this),this.parent.on(Xn,this.removeSheetTab,this),this.parent.on(wo,this.renameSheetTab,this),this.parent.on(Ir,this.switchSheetTab,this),this.parent.on(Hi,this.updateSheetTab,this),this.parent.on(Ho,this.renameInputFocusOut,this),this.parent.on(St,this.removeAggregate,this),this.parent.on(Ni,this.focusRenameInput,this),this.parent.on(Mi,this.focusRenameInput,this),this.parent.on($n,this.updateSheetName,this),this.parent.on(Qn,this.hideSheet,this),this.parent.on(ai,this.showAggregate,this),this.parent.on(Ko,this.goToSheet,this),this.parent.on($o,this.showSheet,this)},s.prototype.destroy=function(){this.removeEventListener(),this.dropDownInstance.destroy(),this.dropDownInstance=null,this.tabInstance.destroy(),this.tabInstance=null,this.removeAggregate(),this.aggregateContent=null,this.addBtnRipple(),this.addBtnRipple=null,f.bi.remove(document,"mousedown touchstart",this.renameInputFocusOut);var e=document.getElementById(this.parent.element.id+"_sheet_tab_panel");e&&(0,f.Od)(e),this.parent=null},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(jn,this.createSheetTabs),this.parent.off(pr,this.refreshSheetTab),this.parent.off(So,this.insertSheetTab),this.parent.off(Xn,this.removeSheetTab),this.parent.off(wo,this.renameSheetTab),this.parent.off(Ir,this.switchSheetTab),this.parent.off(Hi,this.updateSheetTab),this.parent.off(Ho,this.renameInputFocusOut),this.parent.off(St,this.removeAggregate),this.parent.off(Ni,this.focusRenameInput),this.parent.off(Mi,this.focusRenameInput),this.parent.off($n,this.updateSheetName),this.parent.off(Qn,this.hideSheet),this.parent.off(ai,this.showAggregate),this.parent.off(Ko,this.goToSheet),this.parent.off($o,this.showSheet))},s}(),Pa=function(){function s(e){this.isImportedFile=!1,this.unProtectSheetIdx=[],this.parent=e,this.addEventListener(),this.renderFileUpload()}return s.prototype.addEventListener=function(){this.parent.on(un,this.openSuccess,this),this.parent.on(Xa,this.openFailed,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(un,this.openSuccess),this.parent.off(Xa,this.openFailed))},s.prototype.renderFileUpload=function(){var e=this.parent.element.id+"_fileUpload";this.parent.element.appendChild(this.parent.createElement("input",{id:e,attrs:{type:"file",accept:".xls, .xlsx, .csv, .xlsm, .xlsb",name:"fileUpload"}}));var r=document.getElementById(e);r.onchange=this.fileSelect.bind(this),r.onerror=this.openFailed.bind(this),r.style.display="none"},s.prototype.fileSelect=function(e){var r=e.target.files[0];r&&r.length<1||(this.parent.open({file:r}),document.getElementById(this.parent.element.id+"_fileUpload").value="")},s.prototype.openSuccess=function(e){var r=this,t=["UnsupportedFile","InvalidUrl","NeedPassword","InCorrectPassword","InCorrectSheetPassword","CorrectSheetPassword","DataLimitExceeded","FileSizeLimitExceeded"],i=function(h){r.parent.serviceLocator.getService(ae).hide(!0);var p=new File([],e.guid,{type:h.toLowerCase()});r.parent.open({file:p,guid:e.guid,password:e.eventArgs.password,orginalFile:e.eventArgs.file})};if(t.indexOf(e.data)>-1){var n=this.parent.serviceLocator.getService(O);if(t[2]===e.data)this.parent.element.querySelector(".e-importprotectworkbook-dlg")||this.parent.notify(hs,e.eventArgs);else if(t[3]===e.data){var a=this.parent.createElement("span",{className:"e-importprotectpwd-alert-span",innerHTML:n.getConstant("InCorrectPassword")});this.parent.element.querySelector(".e-importprotectworkbook-dlg").querySelector(".e-dlg-content").appendChild(a)}else if(t[4]===e.data)a=this.parent.createElement("span",{className:"e-unprotectsheetpwd-alert-span",innerHTML:n.getConstant("InCorrectPassword")}),this.parent.element.querySelector(".e-unprotectworksheet-dlg").querySelector(".e-dlg-content").appendChild(a);else{if(t[5]!==e.data){this.parent.serviceLocator.getService(ae).hide(!0);var l=e.data.includes("LimitExceeded");return this.parent.serviceLocator.getService(ae).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant(e.data),width:"300",buttons:l?[{click:i.bind(this,e.data+"Open"),buttonModel:{content:n.getConstant("Ok"),isPrimary:!0}},{click:i.bind(this,e.data+"Cancel"),buttonModel:{content:n.getConstant("Cancel")}}]:[],beforeOpen:function(p){var c={dialogName:"OpenDialog",element:p.element,target:p.target,cancel:p.cancel};r.parent.trigger("dialogBeforeOpen",c),c.cancel&&(p.cancel=!0)}},!!l||null),void this.parent.hideSpinner()}this.parent.isOpen=!1,this.parent.notify(vs,null),this.parent.serviceLocator.getService(ae).hide(),this.parent.hideSpinner()}}else this.parent.serviceLocator.getService(ae).hide(),this.parent.showSpinner();!this.parent.element||t[5]!==e.data&&(e.isOpenFromJson||(this.parent.trigger("openComplete",{response:e}),this.parent.notify(Z,{response:e,action:"import"})),this.parent.notify(zr,{cellRef:null,isOpen:!0}),this.parent.renderModule.refreshSheet(e.isOpenFromJson),this.parent.notify(pr,null),this.isImportedFile=!0,this.unProtectSheetIdx=[],this.parent.hideSpinner())},s.prototype.openFailed=function(e){this.parent.trigger("openFailure",e),this.parent.hideSpinner()},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"open"},s}(),Va=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(bi,this.initiateSave,this),this.parent.on(wi,this.saveCompleted,this),this.parent.on(ho,this.showErrorDialog,this),this.parent.on(fn,this.exportDialog,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(bi,this.initiateSave),this.parent.off(wi,this.saveCompleted),this.parent.off(ho,this.showErrorDialog),this.parent.off(fn,this.exportDialog))},s.prototype.getModuleName=function(){return"save"},s.prototype.initiateSave=function(){this.parent.showSpinner()},s.prototype.saveCompleted=function(){this.parent.hideSpinner()},s.prototype.showErrorDialog=function(e){var r=this;this.parent.serviceLocator.getService(ae).show({target:this.parent.element,isModal:!0,showCloseIcon:!0,height:180,width:400,content:e.content,beforeOpen:function(){return K(r.parent.element)}})},s.prototype.exportDialog=function(e){var r=this,t=this.parent.serviceLocator.getService(O),i=this.parent.serviceLocator.getService(ae),n=e?e.item.id.split(this.parent.element.id+"_")[1]:"xlsx";if((0,f.le)(this.parent.element.querySelector(".e-find-dlg"))){var a={isModal:!0,showCloseIcon:!0,cssClass:"e-open-dlg",allowDragging:!1,header:t.getConstant("SaveAs"),beforeOpen:function(o){var l={dialogName:t.getConstant("SaveAs"),element:o.element,target:o.target,cancel:o.cancel};r.parent.trigger("dialogBeforeOpen",l),l.cancel&&(o.cancel=!0),i.dialogInstance.content=r.OpenContent(n),i.dialogInstance.dataBind(),r.parent.element.querySelector(".e-text-open").setSelectionRange(0,r.parent.element.querySelector(".e-text-open").value.length),K(r.parent.element)},buttons:[{buttonModel:{content:t.getConstant("Save"),isPrimary:!0,cssClass:"e-btn-open-ok"},click:function(){var o=r.parent.element.querySelector(".e-text-open").value;if(r.checkValidName(o)){i.hide();var l=e?e.item.id.split(r.parent.element.id+"_")[1]:"Xlsx";r.parent.save({saveType:l,fileName:o})}else{var h=r.parent.element.querySelector(".e-btn-open-ok");(0,f.Xr)(h,"btn").disabled=!0;var d=r.parent.serviceLocator.getService(O).getConstant(0===o.length?"EmptyFileName":o.length>218?"LargeName":"FileNameError"),u=r.parent.createElement("span",{className:"e-file-alert-span",innerHTML:d});r.parent.element.querySelector(".e-file-alert-span")&&r.parent.element.querySelector(".e-file-alert-span").remove(),r.parent.element.querySelector(".e-open-dlg").querySelector(".e-dlg-content").appendChild(u)}}}],close:function(){i.hide()}};i.show(a)}else i.hide()},s.prototype.checkValidName=function(e){var r=!0;return(e.match(new RegExp('.*[\\[\\]\\*\\\\/\\?\\:\\<\\>\\|\\"].*'))||e.length<1||e.length>218)&&(r=!1),r},s.prototype.OpenContent=function(e){var r=this,t=this.parent.serviceLocator.getService(O),i=this.parent.createElement("div",{className:"e-open-dialog"}),n=this.parent.createElement("div",{className:"e-open-head"}),a=this.parent.createElement("div",{className:"e-input-group"});i.appendChild(n),i.appendChild(a);var o=t.getConstant("FileName"),l=this.parent.element.id+"_filename",h=this.parent.createElement("p",{className:"e-header",id:l,innerHTML:o,attrs:{"aria-label":t.getConstant("SaveAs")+" "+o}}),p=this.parent.createElement("input",{className:"e-input e-text-open",attrs:{type:"Text","aria-labelledby":l}}),c=this.parent.createElement("span",{className:"e-input-group-icon"});return p.onkeyup=function(d){if(r.parent.element.querySelector(".e-file-alert-span")&&13!==d.keyCode){var u=r.parent.element.querySelector(".e-btn-open-ok");(0,f.Xr)(u,"btn").disabled=!1,r.parent.element.querySelector(".e-file-alert-span").remove()}},n.appendChild(h),c.textContent="."+e.toLowerCase(),a.appendChild(p),p.setAttribute("value","Sample"),a.appendChild(c),i},s}(),rl=function(){function s(e){this.parent=e,this.init()}return s.prototype.init=function(){this.initContextMenu(),this.addEventListener()},s.prototype.initContextMenu=function(){var e=document.createElement("ul");e.id=this.parent.element.id+"_contextmenu",this.parent.element.appendChild(e),this.contextMenuInstance=new ze.xV({cssClass:"e-spreadsheet-contextmenu",target:"#"+this.parent.element.id,filter:"e-numericcontainer e-active-cell e-selection e-row e-header-row e-select-all-cell e-sheet-tabs-items",select:this.selectHandler.bind(this),beforeOpen:this.beforeOpenHandler.bind(this),beforeClose:this.beforeCloseHandler.bind(this),beforeItemRender:function(r){r.element.setAttribute("aria-label",r.item.text)}},e),e.setAttribute("role","menu")},s.prototype.beforeCloseHandler=function(e){this.parent.trigger("contextMenuBeforeClose",e)},s.prototype.selectHandler=function(e){var r=(0,f.l7)({cancel:!1},e);this.parent.trigger("contextMenuItemSelect",r);var i,t=this.parent.element.id+"_cmenu";if(!r.cancel){var n=void 0;switch(e.item.id){case t+"_cut":this.parent.notify(kr,{invokeCopy:!0,promise:Promise});break;case t+"_copy":this.parent.notify(Rr,{invokeCopy:!0,promise:Promise});break;case t+"_paste":this.parent.notify(Ot,{isAction:!0,isInternal:!0});break;case t+"_pastevalues":this.parent.notify(Ot,{type:"Values",isAction:!0,isInternal:!0});break;case t+"_pasteformats":this.parent.notify(Ot,{type:"Formats",isAction:!0,isInternal:!0});break;case t+"_rename":this.parent.notify(wo,{});break;case t+"_delete_sheet":this.parent.notify(Xn,{});break;case t+"_insert_sheet":this.parent.notify(wt,{model:this.parent,start:this.parent.activeSheetIndex,end:this.parent.activeSheetIndex,modelType:"Sheet",isAction:!0,activeSheetIndex:this.parent.activeSheetIndex});break;case t+"_hide_sheet":this.parent.notify(Qn,{sheetIndex:this.parent.activeSheetIndex,triggerEvent:!0});break;case t+"_duplicate":Es(this.parent,void 0,!0);break;case t+"_move_right":wa(this.parent,this.parent.activeSheetIndex+1,null,!0);break;case t+"_move_left":wa(this.parent,this.parent.activeSheetIndex-1,null,!0);break;case t+"_ascending":this.parent.notify(Fr,{sortOptions:{sortDescriptors:{order:"Ascending"}}});break;case t+"_descending":this.parent.notify(Fr,{sortOptions:{sortDescriptors:{order:"Descending"}}});break;case t+"_customsort":this.parent.notify(Kn,null);break;case t+"_filtercellvalue":this.parent.notify(zo,null);break;case t+"_clearfilter":i=_e(B(this.parent.getActiveSheet().activeCell)[1]+1),this.parent.notify(zi,{field:i});break;case t+"_reapplyfilter":this.parent.notify(ta,null);break;case t+"_hide_row":n=A(this.parent.getActiveSheet().selectedRange),this.parent.notify(je,{startIndex:n[0],endIndex:n[2],hide:!0,isCol:!1,actionUpdate:!0}),K(this.parent.element);break;case t+"_unhide_row":n=A(this.parent.getActiveSheet().selectedRange),this.parent.notify(je,{startIndex:n[0],endIndex:n[2],hide:!1,isCol:!1,actionUpdate:!0}),K(this.parent.element);break;case t+"_hide_column":n=A(this.parent.getActiveSheet().selectedRange),this.parent.notify(je,{startIndex:n[1],endIndex:n[3],hide:!0,isCol:!0,actionUpdate:!0}),K(this.parent.element);break;case t+"_unhide_column":n=A(this.parent.getActiveSheet().selectedRange),this.parent.notify(je,{startIndex:n[1],endIndex:n[3],hide:!1,isCol:!0,actionUpdate:!0}),K(this.parent.element);break;case t+"_insert_row_above":case t+"_delete_row":n=A(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(t.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:n[0],end:n[2],modelType:"Row",isAction:!0,insertType:"above"}),K(this.parent.element);break;case t+"_insert_row_below":n=Q(A(this.parent.getActiveSheet().selectedRange)),this.parent.notify(wt,{model:this.parent.getActiveSheet(),start:n[2]+1,end:n[2]+1+(n[2]-n[0]),modelType:"Row",isAction:!0,insertType:"below"}),K(this.parent.element);break;case t+"_insert_column_before":case t+"_delete_column":n=A(this.parent.getActiveSheet().selectedRange),this.parent.notify(e.item.id.substr(t.length+1,6)+"Model",{model:this.parent.getActiveSheet(),start:n[1],end:n[3],modelType:"Column",isAction:!0,insertType:"before"});break;case t+"_insert_column_after":n=Q(A(this.parent.getActiveSheet().selectedRange)),this.parent.notify(wt,{model:this.parent.getActiveSheet(),start:n[3]+1,end:n[3]+1+(n[3]-n[1]),modelType:"Column",isAction:!0,insertType:"after"});break;case t+"_hyperlink":this.parent.notify(Pi,null);break;case t+"_editHyperlink":this.parent.notify(Vi,null);break;case t+"_openHyperlink":this.parent.notify(Vo,null);break;case t+"_removeHyperlink":this.parent.notify(qi,{range:this.parent.getActiveSheet().selectedRange});break;case t+"_protect":this.parent.notify(ya,{})}}},s.prototype.getInsertModel=function(e,r){for(var t=[],i=e;i<=r;i++)t.push(i===e?{index:i}:{});return t},s.prototype.beforeOpenHandler=function(e){var i,r=e.event.target,t=this.getTarget(r);if(e.element.classList.contains("e-contextmenu")){var n=this.parent.getActiveSheet();if(e.event.target&&(r.classList.contains("e-rowresize")||r.classList.contains("e-colresize"))){var a=A(n.selectedRange);if(!(r.classList.contains("e-rowresize")?0===a[1]&&a[3]===n.colCount-1:0===a[0]&&a[2]===n.rowCount-1))return void(e.cancel=!0);i=(r.classList.contains("e-rowresize")?this.parent.hiddenCount(a[0],a[2])!==Math.abs(a[2]-a[0])+1:this.parent.hiddenCount(a[1],a[3],"columns")!==Math.abs(a[3]-a[1])+1)?this.getDataSource(t):this.getDataSource(t,r)}else{if("Content"===t){var o=0===(a=A(n.selectedRange))[1]&&a[3]===n.colCount-1,l=0===a[0]&&a[2]===n.rowCount-1;t=o&&l?"SelectAll":o?"RowHeader":l?"ColumnHeader":"Content"}i=this.getDataSource(t)}this.contextMenuInstance.items=i,this.contextMenuInstance.dataBind()}else i=e.items;if("None"===this.parent.selectionSettings.mode&&"Content"===t&&this.parent.enableContextMenuItems(["Filter"],!1,!1),"ColumnHeader"===t||"RowHeader"===t){if(e.element&&e.element.childElementCount>0){var h=e.element.querySelector("ColumnHeader"===t?"#"+this.parent.element.id+"_cmenu_insert_column":"#"+this.parent.element.id+"_cmenu_insert_row"),p=e.element.querySelector("ColumnHeader"===t?"#"+this.parent.element.id+"_cmenu_delete_column":"#"+this.parent.element.id+"_cmenu_delete_row");this.parent.allowInsert&&h.classList.contains("e-disabled")?h.classList.remove("e-disabled"):(!this.parent.allowInsert||!!this.parent.element.querySelector(".e-selectall.e-highlight"))&&!h.classList.contains("e-disabled")&&h.classList.add("e-disabled"),this.parent.allowDelete&&p.classList.contains("e-disabled")?p.classList.remove("e-disabled"):!this.parent.allowDelete&&!p.classList.contains("e-disabled")&&p.classList.add("e-disabled"),"None"===this.parent.selectionSettings.mode&&("ColumnHeader"===t&&this.parent.enableContextMenuItems(["Insert Column","Delete Column","Hide Column"],!1,!1),"RowHeader"===t&&this.parent.enableContextMenuItems(["Insert Row","Delete Row","Hide Row"],!1,!1))}}else if("Footer"===t){var c=ee(this.parent,r.textContent);0===c&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_left").classList.add("e-disabled"),c===this.parent.sheets.length-1&&e.element.querySelector("#"+this.parent.element.id+"_cmenu_move_right").classList.add("e-disabled")}this.parent.trigger("contextMenuBeforeOpen",e),this.parent.notify(Ir,(0,f.l7)(e,{target:t,items:i}))},s.prototype.getTarget=function(e){return(0,f.oq)(e,".e-sheet-content")?"Content":(0,f.oq)(e,".e-column-header")?e.classList.contains("e-header-cell")?"ColumnHeader":"Content":(0,f.oq)(e,".e-row-header")?e.classList.contains("e-header-cell")?"RowHeader":"Content":(0,f.oq)(e,".e-sheet-tabs-items")?"Footer":(0,f.oq)(e,".e-selectall-container")?e.classList.contains("e-header-cell")?(0,f.oq)(e,".e-header-row")?"ColumnHeader":"RowHeader":(0,f.oq)(e,".e-select-all-cell")?"SelectAll":"Content":""},s.prototype.getDataSource=function(e,r){var t=this.parent.serviceLocator.getService(O),i=[],n=this.parent.element.id+"_cmenu";if("Content"===e)this.setClipboardData(i,t,n),i.push({separator:!0}),this.setFilterItems(i,n),this.setSortItems(i,n),i.push({separator:!0}),this.setHyperLink(i,n);else if("RowHeader"===e){this.setClipboardData(i,t,n);var o=A(this.parent.getActiveSheet().selectedRange);this.setInsertDeleteItems(i,t,"Row",n,[o[0],o[2]],["Above","Below"]),(!r||r.classList.contains("e-rowresize")||!r.parentElement||!r.parentElement.classList.value.includes("e-hide"))&&this.setHideShowItems(i,t,"Row",n,[o[0],o[2]])}else"ColumnHeader"===e?(this.setClipboardData(i,t,n),o=A(this.parent.getActiveSheet().selectedRange),this.setInsertDeleteItems(i,t,"Column",n,[o[1],o[3]],["Before","After"]),(!r||!r.classList.value.includes("e-hide"))&&this.setHideShowItems(i,t,"Column",n,[o[1],o[3]])):"SelectAll"===e?(this.setClipboardData(i,t,n),this.setFilterItems(i,n),this.setSortItems(i,n)):"Footer"===e&&(i.push({text:t.getConstant("Insert"),id:n+"_insert_sheet"}),i.push({text:t.getConstant("Delete"),iconCss:"e-icons e-delete",id:n+"_delete_sheet"}),i.push({text:t.getConstant("DuplicateSheet"),id:n+"_duplicate"}),i.push({text:t.getConstant("Rename"),id:n+"_rename"}),i.push({text:t.getConstant("Hide"),id:n+"_hide_sheet"}),this.setProtectSheetItems(i,n),i.push({text:t.getConstant("MoveRight"),id:n+"_move_right"}),i.push({text:t.getConstant("MoveLeft"),id:n+"_move_left"}));return i},s.prototype.setProtectSheetItems=function(e,r){var t=this.parent.serviceLocator.getService(O);this.parent.getActiveSheet().isProtected?e.push({text:t.getConstant("UnprotectSheet"),id:r+"_protect",iconCss:"e-icons e-protect-icon"}):e.push({text:t.getConstant("ProtectSheet"),id:r+"_protect",iconCss:"e-icons e-protect-icon"})},s.prototype.setFilterItems=function(e,r){if(this.parent.allowFiltering){var t=this.parent.serviceLocator.getService(O),i={clearFilterText:null,isFiltered:!1};this.parent.notify(ra,i),e.push({text:t.getConstant("Filter"),id:r+"_filter",iconCss:"",items:[{text:i.clearFilterText,iconCss:"e-icons e-filter-clear",id:r+"_clearfilter"},{text:t.getConstant("ReapplyFilter"),iconCss:"e-icons e-filter-reapply",id:r+"_reapplyfilter"},{separator:!0},{text:t.getConstant("FilterCellValue"),iconCss:"",id:r+"_filtercellvalue"}]})}},s.prototype.setSortItems=function(e,r){var t=this.parent.serviceLocator.getService(O);this.parent.allowSorting&&e.push({text:t.getConstant("Sort"),id:r+"_sort",iconCss:"e-icons e-sort-icon",items:[{text:t.getConstant("SortAscending"),iconCss:"e-icons e-sort-asc",id:r+"_ascending"},{text:t.getConstant("SortDescending"),iconCss:"e-icons e-sort-desc",id:r+"_descending"},{text:t.getConstant("CustomSort")+"...",iconCss:"e-icons e-sort-custom",id:r+"_customsort"}]})},s.prototype.setHyperLink=function(e,r){var t=this.parent.getActiveSheet();if(this.parent.allowHyperlink){var i=this.parent.serviceLocator.getService(O);!document.activeElement.getElementsByClassName("e-hyperlink")[0]&&!document.activeElement.classList.contains("e-hyperlink")||t.isProtected&&!t.protectSettings.insertLink?e.push({text:i.getConstant("Hyperlink"),iconCss:"e-icons e-hyperlink-icon",id:r+"_hyperlink"}):e.push({text:i.getConstant("EditHyperlink"),iconCss:"e-icons e-edithyperlink-icon",id:r+"_editHyperlink"},{text:i.getConstant("OpenHyperlink"),iconCss:"e-icons e-openhyperlink-icon",id:r+"_openHyperlink"},{text:i.getConstant("RemoveHyperlink"),iconCss:"e-icons e-removehyperlink-icon",id:r+"_removeHyperlink"})}},s.prototype.setClipboardData=function(e,r,t){this.parent.enableClipboard&&(e.push({text:r.getConstant("Cut"),iconCss:"e-icons e-cut-icon",id:t+"_cut"}),e.push({text:r.getConstant("Copy"),iconCss:"e-icons e-copy-icon",id:t+"_copy"}),e.push({text:r.getConstant("Paste"),iconCss:"e-icons e-paste-icon",id:t+"_paste"}),e.push({text:r.getConstant("PasteSpecial"),id:t+"_pastespecial",items:[{text:r.getConstant("Values"),id:t+"_pastevalues"},{text:r.getConstant("Formats"),id:t+"_pasteformats"}]}))},s.prototype.setInsertDeleteItems=function(e,r,t,i,n,a){e.push({separator:!0}),["Insert","Delete"].forEach(function(o){e.push(n[0]===n[1]?{text:r.getConstant(""+o+t),id:i+"_"+o.toLowerCase()+"_"+t.toLowerCase()}:{text:r.getConstant(""+o+t+"s"),id:i+"_"+o.toLowerCase()+"_"+t.toLowerCase()}),"Insert"===o&&(e[e.length-1].items=[],a.forEach(function(l){e[e.length-1].items.push({text:r.getConstant(l),id:e[e.length-1].id+"_"+l.toLowerCase()})}))})},s.prototype.setHideShowItems=function(e,r,t,i,n){if(n[0]===n[1])e.push({text:r.getConstant("Hide"+t),id:i+"_hide_"+t.toLowerCase()});else{var a=n[0];n[0]=n[0]>n[1]?n[1]:n[0],n[1]=n[1]>a?n[1]:a,e.push({text:r.getConstant("Hide"+t+"s"),id:i+"_hide_"+t.toLowerCase()})}this.parent.hiddenCount(n[0],n[1],t.toLowerCase()+"s")&&e.push({text:r.getConstant("UnHide"+t+"s"),id:i+"_unhide_"+t.toLowerCase()})},s.prototype.addEventListener=function(){this.parent.on(Io,this.addItemsHandler,this),this.parent.on(Eo,this.removeItemsHandler,this),this.parent.on(ko,this.enableItemsHandler,this)},s.prototype.addItemsHandler=function(e){e.insertAfter?this.contextMenuInstance.insertAfter(e.items,e.text,e.isUniqueId):this.contextMenuInstance.insertBefore(e.items,e.text,e.isUniqueId)},s.prototype.removeItemsHandler=function(e){this.contextMenuInstance.removeItems(e.items,e.isUniqueId)},s.prototype.enableItemsHandler=function(e){this.contextMenuInstance.enableItems(e.items,e.enable,e.isUniqueId)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Io,this.addItemsHandler),this.parent.off(Eo,this.removeItemsHandler),this.parent.off(ko,this.enableItemsHandler))},s.prototype.getModuleName=function(){return"contextMenu"},s.prototype.destroy=function(){this.removeEventListener(),this.contextMenuInstance.destroy();var e=document.getElementById(this.parent.element.id+"_contextmenu");e&&(0,f.og)(e),this.parent=null},s}(),qa=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.refreshCellElement=function(e){var r=this.parent.getCell(e.rowIndex,e.colIndex);(0,f.le)(r)||this.parent.refreshNode(r,e)},s.prototype.getTextSpace=function(e){e.width=vt(e.char,e.cell.style,this.parent.cellStyle)},s.prototype.rowFillHandler=function(e){var t,i,r=e.td?e.td:this.parent.getCell(e.rowIdx,e.colIdx);if(r){e.formatText&&(r.innerHTML=e.formatText.toString()),e.secText&&((i=this.parent.createElement("span")).classList.add("e-fill-sec"),i.innerHTML=e.secText.toString()),r.children.length?t=r.querySelector(".e-fill"):((t=this.parent.createElement("span")).style.flexGrow="1",t.classList.add("e-fill"),r.appendChild(t),i&&r.appendChild(i)),t.innerHTML="";var n=vt(e.value.toString(),e.cell.style,this.parent.cellStyle),a=Math.round(t.offsetWidth/n);e.formatText=e.value.repeat(a),t.innerHTML=e.formatText}},s.prototype.addEventListener=function(){this.parent.on(Ga,this.refreshCellElement,this),this.parent.on(Rn,this.rowFillHandler,this),this.parent.on(Fn,this.getTextSpace,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Ga,this.refreshCellElement),this.parent.off(Rn,this.rowFillHandler),this.parent.off(Fn,this.getTextSpace))},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"numberFormat"},s}(),il=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(Fr,this.applySortHandler,this),this.parent.on(Ri,this.sortCompleteHandler,this),this.parent.on(Kn,this.initiateCustomSortHandler,this),this.parent.on(dn,this.sortImport,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Fr,this.applySortHandler),this.parent.off(Ri,this.sortCompleteHandler),this.parent.off(Kn,this.initiateCustomSortHandler),this.parent.off(dn,this.sortImport))},s.prototype.getModuleName=function(){return"sort"},s.prototype.isValidSortRange=function(){var e=this.parent.getActiveSheet(),r=Q(De(e.selectedRange));return!(r[0]>e.usedRange.rowIndex||r[1]>e.usedRange.colIndex)},s.prototype.sortImport=function(e){for(var t,r=this.parent.sortCollection,i=this.parent.getActiveSheet().usedRange.rowIndex-1,n=e?e.sheetIdx:this.parent.activeSheetIndex,a=0;a<r.length;a++)if(r[a].sheetIndex===n)for(var o=0;o<i;o++)if((t=this.parent.getCell(o,r[a].columnIndex))&&t.querySelector(".e-filter-icon"))return void("Ascending"===r[a].order||"OnTop"===r[a].order?t.querySelector(".e-filter-icon").classList.contains("e-sortasc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortasc-filter"):t.querySelector(".e-filter-icon").classList.contains("e-sortdesc-filter")||t.querySelector(".e-filter-icon").classList.add("e-sortdesc-filter"))},s.prototype.sortRangeAlertHandler=function(e){var r=this,t=this.parent.serviceLocator.getService(ae),i=this.parent.serviceLocator.getService(O);t.show({height:180,width:400,isModal:!0,showCloseIcon:!0,content:e.error,beforeOpen:function(n){var a={dialogName:e.error===i.getConstant("MultiRangeSortError")?"MultiRangeSortDialog":"SortRangeDialog",content:e.error,element:n.element,target:n.target,cancel:n.cancel};r.parent.trigger("dialogBeforeOpen",a),a.cancel&&(n.cancel=!0),t.dialogInstance.content=a.content}}),this.parent.hideSpinner()},s.prototype.initiateCustomSortHandler=function(){var e=this,r=this.parent.serviceLocator.getService(O),t=this.parent.getActiveSheet();if(this.isValidSortRange()&&0!=t.rows.length)if(Vs(t.selectedRange))this.sortRangeAlertHandler({error:r.getConstant("MultiRangeSortError")});else{var n,i=this.parent.serviceLocator.getService(ae);i.show({height:400,width:560,isModal:!0,showCloseIcon:!0,cssClass:"e-customsort-dlg",header:r.getConstant("CustomSort"),beforeOpen:function(a){var o={dialogName:"CustomSortDialog",element:a.element,target:a.target,cancel:a.cancel};e.parent.trigger("dialogBeforeOpen",o),o.cancel&&(a.cancel=!0),i.dialogInstance.content=e.customSortContent(),i.dialogInstance.dataBind(),K(e.parent.element)},buttons:[{buttonModel:{content:r.getConstant("Ok"),isPrimary:!0},click:function(){var a=i.dialogInstance.content,l=(0,f.Xr)(a.getElementsByClassName("e-list-sort e-listview e-lib")[0],"listview").dataSource;e.clearError();var h=a.getElementsByClassName("e-sort-error")[0];h.style.display="block",e.validateError(l,a,h)||(n={sortDescriptors:l,containsHeader:a.getElementsByClassName("e-sort-checkheader")[0].checked,caseSensitive:a.getElementsByClassName("e-sort-checkcase")[0].checked},i.hide())}}],close:function(){n&&Pe(function(){return e.applySortHandler({sortOptions:n})})}})}else this.sortRangeAlertHandler({error:r.getConstant("SortOutOfRangeError")})},s.prototype.validateError=function(e,r,t){var i=this.parent.serviceLocator.getService(O);if(e.some(function(c){return""===c.field.toString()}))return Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),function(c){var d=!(0,f.Xr)(c,"dropdownlist").value;return d&&c.parentElement.classList.add("e-error"),d}),t.innerText=i.getConstant("SortEmptyFieldError"),!0;var a=new Set,o="",l=e.some(function(c){return o=c.field.toString(),a.size===a.add(c.field).size}),h="";if(l){var p=0;return Array.prototype.some.call(r.getElementsByClassName("e-sort-field"),function(c){var d=(0,f.Xr)(c,"dropdownlist");return d.value===o&&(c.parentElement.classList.add("e-error"),h=d.text,p++),2===p}),t.innerHTML="<strong>"+h+"</strong>"+i.getConstant("SortDuplicateFieldError"),!0}return!1},s.prototype.customSortContent=function(){var e=this.parent.createElement("div",{className:"e-sort-dialog"}),r=this.getFields(),t=(0,f.QI)("customSort"),i=this.getCustomListview(t);this.setHeaderTab(e,i,r);var n=this.parent.createElement("div",{className:"e-sort-listsection",styles:""});e.appendChild(n);var a=this.parent.createElement("div",{className:"e-list-sort",styles:""});n.appendChild(a),i.createElement=this.parent.createElement,i.appendTo(a),a.removeAttribute("tabindex"),this.renderListItem(t,i,!0,r);var o=this.parent.createElement("div",{className:"e-sort-error"});return e.appendChild(o),e},s.prototype.getFields=function(){var e=this.parent.getActiveSheet(),r=Q(De(e.selectedRange));if(r[0]===r[2]&&r[2]-r[0]==0){r[0]=0,r[1]=0,r[3]=e.usedRange.colIndex;var t={filterRange:[],hasFilter:!1};this.parent.notify(ii,t),t.hasFilter&&t.filterRange&&(r[0]=t.filterRange[0])}for(var n,a,i=[];r[1]<=r[3];r[1]++){var o=E(r[0],r[1],e);if(a="Column "+_e(r[1]+1),o&&o.value){if(n=o.value,o.format){var l={formattedText:n,value:n,format:o.format,onLoad:!0};this.parent.notify(ot,l),n=l.formattedText}}else n=a;i.push({text:n,value:a})}return i},s.prototype.setHeaderTab=function(e,r,t){var i=this,n=this.parent.serviceLocator.getService(O),a=this.parent.createElement("div",{className:"e-sort-header",styles:"",innerHTML:""});e.appendChild(a);var o=this.parent.createElement("button",{className:"e-btn e-sort-addbtn e-flat",innerHTML:n.getConstant("AddColumn"),attrs:{type:"button"}}),l=this.parent.element.querySelector(".e-customsort-dlg .e-footer-content");l.insertBefore(o,l.firstElementChild),o.addEventListener("click",function(){if(r){var u=(0,f.QI)("customSort");r.addItem([{id:u,text:n.getConstant("ThenBy"),field:"",order:"ascending"}]),i.renderListItem(u,r,h.checked,t,!0)}});var h=new at.Jg({label:n.getConstant("ContainsHeader"),checked:!0,change:function(u){var v=u.checked?{text:"text",value:"value"}:{text:"value"};Array.prototype.forEach.call(e.getElementsByClassName("e-sort-field e-dropdownlist e-lib"),function(g){var m=(0,f.Xr)(g,"dropdownlist");m.dataSource=null,m.dataSource=t,m.fields=v,m.dataBind()})},cssClass:"e-sort-headercheckbox"}),p=this.parent.createElement("input",{className:"e-sort-checkheader",attrs:{type:"checkbox"}});a.appendChild(p),h.createElement=this.parent.createElement,h.appendTo(p);var c=new at.Jg({label:n.getConstant("CaseSensitive"),checked:!1,cssClass:"e-sort-casecheckbox"}),d=this.parent.createElement("input",{className:"e-sort-checkcase",attrs:{type:"checkbox"}});a.appendChild(d),c.createElement=this.parent.createElement,c.appendTo(d)},s.prototype.getCustomListview=function(e){var t=[{id:e,text:this.parent.serviceLocator.getService(O).getConstant("SortBy"),field:"",order:"ascending"}];return(0,f.dW)(!1),new an.Bv({dataSource:t,fields:{id:"id"},height:"100%",template:'<div class="e-sort-listwrapper"><span class="text">${text}</span><div class="e-sort-row"><div class="e-sort-field"></div><div class="e-sort-order"><span class="e-sort-ordertxt" style="display:none;">${order}</span></div><span class="e-icons e-sort-delete"></span></div>',cssClass:"e-sort-template"})},s.prototype.deleteHandler=function(e,r){e.getElementsByClassName("e-sort-delete")[0].addEventListener("click",function(){e&&r.removeItem(e)})},s.prototype.renderListItem=function(e,r,t,i,n){var a=this,o=this.parent.serviceLocator.getService(O),l=r.element.querySelector("li[data-uid="+e+"]"),h=t?{text:"text",value:"value"}:{text:"value"},p=l.getElementsByClassName("e-sort-field")[0],c=new Rt.NB({dataSource:i,width:"auto",cssClass:"e-sort-field-ddl",fields:h,placeholder:o.getConstant("SelectAColumn"),change:function(b){!b.value||(Array.prototype.some.call(r.dataSource,function(S){return S.id===e&&(S.field=b.value.toString().replace("Column ","")),S.id===e}),a.clearError())}});c.createElement=this.parent.createElement,c.appendTo(p),n||(c.index=0);var d=l.getElementsByClassName("e-sort-order")[0],v="ascending"===d.getElementsByClassName("e-sort-ordertxt")[0].innerText.toLocaleLowerCase(),g=new at.EU({label:o.getConstant("SortAscending"),name:"sortAZ_"+e,value:"ascending",checked:v,cssClass:"e-sort-radiobutton",change:function(b){a.setRadioBtnValue(r,e,b.value)}}),m=this.parent.createElement("input",{id:"orderAsc_"+e,className:"e-sort-radioasc",styles:"",attrs:{type:"radio"}});d.appendChild(m),g.createElement=this.parent.createElement,g.appendTo(m);var y=new at.EU({label:o.getConstant("SortDescending"),name:"sortAZ_"+e,value:"descending",checked:!v,cssClass:"e-sort-radiobutton",change:function(b){a.setRadioBtnValue(r,e,b.value)}}),C=this.parent.createElement("input",{id:"orderDesc_"+e,className:"e-sort-radiodesc",styles:"",attrs:{type:"radio"}});d.appendChild(C),y.createElement=this.parent.createElement,y.appendTo(C),this.deleteHandler(l,r)},s.prototype.setRadioBtnValue=function(e,r,t){!t||Array.prototype.some.call(e.dataSource,function(i){return i.id===r&&(i.order=t),i.id===r})},s.prototype.clearError=function(){var e=document.getElementsByClassName("e-sort-dialog")[0],r=e.getElementsByClassName("e-sort-error")[0];"none"!==r.style.display&&""!==r.innerHTML&&(r.style.display="none",Array.prototype.forEach.call(e.getElementsByClassName("e-error"),function(t){t.classList.remove("e-error")}))},s.prototype.applySortHandler=function(e){var r=this,t=this.parent.getActiveSheet(),i=e&&e.range||t.selectedRange,n=Q(De(i)),a=e&&e.sortOptions||{sortDescriptors:{}},o=n[0]===n[2],l={filterRange:[],hasFilter:!1,sheetIdx:this.parent.activeSheetIndex};this.parent.notify(ii,l),l.hasFilter&&(o?Ht(l.filterRange,n[0],n[1]):l.filterRange[0]===n[0]&&(this.parent.element.querySelector(".e-selectall.e-highlight")||n[1]>=l.filterRange[1]&&n[1]<=l.filterRange[3]||n[3]>=l.filterRange[1]&&n[3]<=l.filterRange[3]))&&(n[0]=l.filterRange[0],n[1]=l.filterRange[1],n[2]=t.usedRange.rowIndex,n[3]=t.usedRange.colIndex,a.containsHeader=!0,o=!1);var h={range:i=z(n),sortOptions:a,cancel:!1};if(this.parent.trigger("beforeSort",h),!h.cancel){this.parent.notify(ue,{eventArgs:h,action:"beforeSort"}),this.parent.showSpinner();var p=new Promise(function(d,u){d(void 0)}),c={args:{range:h.range,sortOptions:h.sortOptions,checkForHeader:o&&i!==h.range},promise:p,previousSort:e&&e.previousSort};this.parent.notify(ki,c),c.promise.then(function(d){return r.sortCompleteHandler(d),r.parent.trigger(Ri,d),r.parent.notify(Z,{eventArgs:d,action:"sorting"}),Promise.resolve(d)}).catch(function(d){return r.sortRangeAlertHandler({error:d}),Promise.reject(d)})}},s.prototype.sortCompleteHandler=function(e){var r,t,i=this.parent.activeSheetIndex;if(e.range.includes("!")){var n=e.range.split("!");i=ee(this.parent,n[0]),r=_(this.parent,i),t=A(n[1])}else r=this.parent.getActiveSheet(),t=A(e.range);for(var a=t[0];a<=t[2];a++)for(var o=t[1];o<=t[3];o++)this.parent.notify(ie,{action:"refreshCalculate",rowIndex:a,colIndex:o});this.parent.serviceLocator.getService("cell").refreshRange(t,!0,!0),i===this.parent.activeSheetIndex&&r.conditionalFormats&&r.conditionalFormats.length&&this.parent.notify(We,{indexes:t}),this.parent.hideSpinner()},s}(),nl=function(){function s(e){this.parent=e,this.filterCollection=new Map,this.filterRange=new Map,this.filterBtn=e.createElement("div",{className:"e-filter-btn e-control e-btn e-lib e-filter-iconbtn e-icon-btn"}),this.filterBtn.appendChild(e.createElement("span",{className:"e-btn-icon e-icons e-filter-icon"})),this.addEventListener()}return s.prototype.destroy=function(){this.removeEventListener(),this.filterRange=null,this.filterCollection=null,this.filterBtn=null,this.parent=null},s.prototype.addEventListener=function(){this.parent.on(yl,this.filterRangeAlertHandler,this),this.parent.on(jt,this.initiateFilterUIHandler,this),this.parent.on(er,this.filterMouseDownHandler,this),this.parent.on(Ui,this.renderFilterCellHandler,this),this.parent.on(Ge.Hgd,this.beforeFilterMenuOpenHandler,this),this.parent.on(Ge.OX0,this.closeDialog,this),this.parent.on(ta,this.reapplyFilterHandler,this),this.parent.on(zo,this.filterByCellValueHandler,this),this.parent.on(zi,this.clearFilterHandler,this),this.parent.on(ra,this.getFilteredColumnHandler,this),this.parent.on(Ir,this.cMenuBeforeOpenHandler,this),this.parent.on(Ge.k6n,this.filterCboxValueHandler,this),this.parent.on(ii,this.getFilterRangeHandler,this),this.parent.on(ia,this.filterCellKeyDownHandler,this),this.parent.on(Si,this.getFilteredCollection,this),this.parent.on(Ye,this.updateFilter,this),this.parent.on(Sl,this.updateFilter,this),this.parent.on(Di,this.beforeInsertHandler,this),this.parent.on(Li,this.beforeDeleteHandler,this),this.parent.on(ar,this.deleteSheetHandler,this),this.parent.on(wr,this.clearHandler,this),this.parent.on(Ge.yKz,this.filterDialogCreatedHandler,this),this.parent.on(Ge.RAh,this.removeFilterClass,this),this.parent.on(fo,this.duplicateSheetFilterHandler,this)},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(yl,this.filterRangeAlertHandler),this.parent.off(jt,this.initiateFilterUIHandler),this.parent.off(er,this.filterMouseDownHandler),this.parent.off(Ui,this.renderFilterCellHandler),this.parent.off(Ge.Hgd,this.beforeFilterMenuOpenHandler),this.parent.off(Ge.OX0,this.closeDialog),this.parent.off(ta,this.reapplyFilterHandler),this.parent.off(zo,this.filterByCellValueHandler),this.parent.off(zi,this.clearFilterHandler),this.parent.off(ra,this.getFilteredColumnHandler),this.parent.off(Ir,this.cMenuBeforeOpenHandler),this.parent.on(Ge.k6n,this.filterCboxValueHandler),this.parent.off(ii,this.getFilterRangeHandler),this.parent.off(ia,this.filterCellKeyDownHandler),this.parent.off(Si,this.getFilteredCollection),this.parent.off(Ye,this.updateFilter),this.parent.off(Sl,this.updateFilter),this.parent.off(Di,this.beforeInsertHandler),this.parent.off(Li,this.beforeDeleteHandler),this.parent.off(ar,this.deleteSheetHandler),this.parent.off(wr,this.clearHandler),this.parent.off(Ge.yKz,this.filterDialogCreatedHandler),this.parent.off(Ge.RAh,this.removeFilterClass),this.parent.off(fo,this.duplicateSheetFilterHandler))},s.prototype.getModuleName=function(){return"filter"},s.prototype.isInValidFilterRange=function(e,r){var t=Q(De(r||e.selectedRange));return t[0]>e.usedRange.rowIndex||t[1]>e.usedRange.colIndex},s.prototype.filterRangeAlertHandler=function(e){var r=this;this.parent.serviceLocator.getService(ae).show({content:e.error,isModal:!0,height:180,width:400,showCloseIcon:!0,beforeOpen:function(i){var n={dialogName:"FilterRangeDialog",element:i.element,target:i.target,cancel:i.cancel};r.parent.trigger("dialogBeforeOpen",n),n.cancel&&(i.cancel=!0)}}),this.parent.hideSpinner()},s.prototype.beforeFilterMenuOpenHandler=function(e){var r=this.parent.serviceLocator.getService(O);e.element.classList.add("e-spreadsheet-contextmenu");var t=e.element.querySelector("ul");this.addMenuItem(t,r.getConstant("SortDescending"),"e-filter-sortdesc","e-sort-desc"),this.addMenuItem(t,r.getConstant("SortAscending"),"e-filter-sortasc","e-sort-asc"),e.element.appendChild(t)},s.prototype.addMenuItem=function(e,r,t,i){var n=this.parent.createElement("li",{className:t+" e-menu-item"});n.innerHTML=r,n.insertBefore(this.parent.createElement("span",{className:"e-menu-icon e-icons "+i}),n.firstChild),e.insertBefore(n,e.firstChild)},s.prototype.initiateFilterUIHandler=function(e){var n,r=this,t=e?e.predicates:null,i=e.sIdx;!i&&0!==i&&(i=this.parent.activeSheetIndex),e.promise&&(n=new re.BH,e.promise=n.promise);var a=function(){n&&n.resolve()},o=e.isInternal||e.isCut;if(this.filterRange.size>0&&this.filterRange.has(i)&&!this.parent.isOpen&&!t)return this.removeFilter(i,o,!1),void a();var l=_(this.parent,i);if(this.isInValidFilterRange(l,e.range)){var h=this.parent.serviceLocator.getService(O);return this.filterRangeAlertHandler({error:h.getConstant("FilterOutOfRangeError")}),void a()}var c,d,p=e.range||l.selectedRange;if(!o){if(c={range:p,sheetIndex:i,cancel:!1},e.predicates?(c.predicates=e.predicates,c.previousPredicates=this.filterCollection.get(i)&&[].slice.call(this.filterCollection.get(i))):c.filterOptions={predicates:e.predicates},c.useFilterRange=!1,this.parent.notify(ue,d={action:"filter",eventArgs:c}),c.cancel)return void a();delete c.cancel,e.useFilterRange=c.useFilterRange}if(e.range||!o&&p!==c.range)o||(p=c.range);else{var u=A(p);u[0]===u[2]&&u[1]===u[3]&&(p=z(u=Wl(u[0],u[1],l)),o||(c.range=p))}if(t){if(t.length){var v=this.filterRange.get(i);v&&(e.useFilterRange=v.useFilterRange),this.processRange(l,i,p,!0,e.useFilterRange);var g=this.filterRange.get(i).range.slice();g[0]=g[0]+1,e.useFilterRange||(g[2]=l.usedRange.rowIndex),g[1]=g[3]=Vt(t[0].field);var m=l.name+"!"+this.getPredicateRange(g,t.slice(1,t.length)),y=z(g);return void Zt(this.parent,m,!0,!0,null,!0,null,null,!1,y).then(function(C){r.filterSuccessHandler(new re.hm(C),{action:"filtering",filterCollection:t,field:t[0].field,sIdx:e.sIdx,isInternal:o,prevPredicates:c&&c.previousPredicates}),a()})}this.clearFilterHandler({sheetIndex:i}),a()}else this.processRange(l,i,p,!1,e.useFilterRange),a();o||this.parent.notify(Z,d)},s.prototype.processRange=function(e,r,t,i,n){var a=Q(De(t||e.selectedRange));a[0]===a[2]&&a[1]===a[3]?(a[0]=0,a[1]=0,a[2]=e.usedRange.rowIndex,a[3]=e.usedRange.colIndex):a[3]>e.usedRange.colIndex&&(a[3]=e.usedRange.colIndex),this.filterRange.set(r,{useFilterRange:n,range:a}),this.filterCollection.set(r,[]),i||this.refreshFilterRange(a,!1,r)},s.prototype.removeFilter=function(e,r,t){var a,i=this.filterRange.get(e).range.slice(),n=z(i);if(!r){if(this.parent.notify(ue,a={action:"filter",eventArgs:{range:n,sheetIndex:e,cancel:!1}}),a.eventArgs.cancel)return;delete a.eventArgs.cancel}if((this.filterCollection.get(e).length||t)&&this.clearFilterHandler({preventRefresh:t,sheetIndex:e}),this.filterRange.delete(e),this.filterCollection.delete(e),this.refreshFilterRange(i,!0,e),this.parent.filterCollection)for(var o=0,l=void 0,h=0,p=this.parent.filterCollection.length;h<p;h++)(l=this.parent.filterCollection[o]).sheetIndex===e&&l.filterRange===n?this.parent.filterCollection.splice(o,1):o++;r||this.parent.notify(Z,a)},s.prototype.filterByCellValueHandler=function(){var e=this,r=this.parent.activeSheetIndex,t=this.parent.getActiveSheet();if(this.isInValidFilterRange(t)){var i=this.parent.serviceLocator.getService(O);this.filterRangeAlertHandler({error:i.getConstant("FilterOutOfRangeError")})}else{var n=A(t.activeCell);this.isFilterRange(r,n[0],n[1])||this.processRange(t,r);var a=this.filterRange.get(r).range.slice();a[0]=a[0]+1,a[2]=t.usedRange.rowIndex,a[1]=a[3]=n[1];var o=_e(n[1]+1),l=E(n[0],n[1],t),h=xs(this.parent,l,n[0],n[1]);te(h)&&(!l.format||"@"!==l.format)&&(h=parseFloat(h));var p=[{field:o,operator:"equal",type:this.getColumnType(t,n[1],n).type,matchCase:!1,value:h}],c=t.name+"!"+this.getPredicateRange(a,this.filterCollection.get(r)),d=z(a);Zt(this.parent,c,!0,!0,null,!0,null,null,!1,d).then(function(u){e.filterSuccessHandler(new re.hm(u),{action:"filtering",filterCollection:p,field:o,isFilterByValue:!0})})}},s.prototype.renderFilterCellHandler=function(e){var r=(0,f.le)(e.sIdx)?this.parent.activeSheetIndex:e.sIdx;if(r===this.parent.activeSheetIndex&&this.isFilterCell(r,e.rowIndex,e.colIndex)){if(!e.td)return;var t=e.td.querySelector(".e-filter-icon");t?t.className="e-btn-icon e-icons e-filter-icon"+this.getFilterSortClassName(e.colIndex,r):((t=this.filterBtn.cloneNode(!0)).firstElementChild.className+=this.getFilterSortClassName(e.colIndex,r),e.td.insertBefore(t,e.td.firstChild))}},s.prototype.getFilterSortClassName=function(e,r){for(var t=_e(e+1),i="",n=this.filterCollection.get(r),a=this.parent.sortCollection,o=0;o<n.length;o++)if(n[o].field===t){i=" e-filtered";break}if(a)for(o=0;o<a.length;o++)if(a[o].sheetIndex===r&&a[o].columnIndex===e){i+="Ascending"===a[o].order?" e-sortasc-filter":" e-sortdesc-filter";break}return i},s.prototype.refreshFilterRange=function(e,r,t){var i=t;!i&&0!==i&&(i=this.parent.activeSheetIndex),!e&&!this.filterRange.get(i)&&(e=[0,0,0,0]);for(var n=e||this.filterRange.get(i).range.slice(),a=n[1];a<=n[3];a++){var o=this.parent.getCell(n[0],a);if(r){if(o&&o.hasChildNodes()){var l=o.querySelector(".e-filter-btn");l&&l.parentElement.removeChild(l)}}else this.renderFilterCellHandler({td:o,rowIndex:n[0],colIndex:a,sIdx:i})}this.parent.sortCollection&&this.parent.notify(dn,null)},s.prototype.isFilterCell=function(e,r,t){var i=this.filterRange.get(e)&&this.filterRange.get(e).range;return i&&i[0]===r&&i[1]<=t&&i[3]>=t},s.prototype.isFilterRange=function(e,r,t){var i=this.filterRange.get(e)&&this.filterRange.get(e).range;return i&&i[0]<=r&&i[2]>=r&&i[1]<=t&&i[3]>=t},s.prototype.getFilteredColumnHandler=function(e){var r=(0,f.o8)(e.sheetIndex)?this.parent.activeSheetIndex:e.sheetIndex,t=this.parent.serviceLocator.getService(O);if(e.clearFilterText=t.getConstant("ClearFilter"),this.filterRange.has(r)){var i=this.filterCollection.get(r);if(e.isClearAll)return void(e.isFiltered=i&&i.length>0);var n=this.filterRange.get(r).range.slice(),a=_(this.parent,r),o=B(a.activeCell);if(this.isFilterRange(r,o[0],o[1])){e.field=_e(o[1]+1);var l=E(n[0],o[1],a),h=this.parent.getDisplayText(l);e.clearFilterText=t.getConstant("ClearFilterFrom")+'"'+(h?h.toString():"Column "+e.field)+'"',i.some(function(p){return e.isFiltered=p.field===e.field,e.isFiltered})}}},s.prototype.cMenuBeforeOpenHandler=function(e){var r=this.parent.element.id+"_cmenu";if(e.parentItem&&e.parentItem.id===r+"_filter"&&""===e.target){var t={isFiltered:!1};this.getFilteredColumnHandler(t),this.parent.enableContextMenuItems([r+"_clearfilter",r+"_reapplyfilter"],!!t.isFiltered,!0)}},s.prototype.closeDialog=function(){var e=document.querySelector(".e-filter-popup");if(e&&e.id.includes(this.parent.element.id)){var r=(0,f.Xr)(e,"dialog");f.bi.remove(e,Ia(),this.filterMouseDownHandler),r&&r.hide(),this.parent.notify(Ge.RAh,null)}},s.prototype.removeFilterClass=function(){"relative"===this.parent.element.style.position&&(this.parent.element.style.position=""),this.parent.element.classList.contains("e-filter-open")&&this.parent.element.classList.remove("e-filter-open")},s.prototype.isPopupOpened=function(){var e=document.getElementsByClassName("e-filter-popup")[0];return e&&e.id.includes(this.parent.element.id)&&"none"!==e.style.display},s.prototype.filterCellKeyDownHandler=function(e){var t=B(this.parent.getActiveSheet().activeCell);if(this.isFilterCell(this.parent.activeSheetIndex,t[0],t[1]))if(e.closePopup)this.closeDialog();else if(e.isFilterCell=!0,!this.isPopupOpened()){var i=this.parent.getCell(t[0],t[1]);i&&this.openDialog(i)}},s.prototype.filterMouseDownHandler=function(e){if(!(f.AR.isDevice&&"mousedown"===e.type||this.parent.getActiveSheet().isProtected)){var r=e.target;if(r.classList.contains("e-filter-icon")||r.classList.contains("e-filter-btn"))this.isPopupOpened()&&this.closeDialog(),this.openDialog((0,Ge.Cfg)(r,"e-cell"));else if(this.isPopupOpened()){var t=r.offsetParent;r.classList.contains("e-searchinput")||r.classList.contains("e-searchclear")||!t||t.classList.contains("e-filter-popup")||t.classList.contains("e-text-content")||t.classList.contains("e-checkboxtree")||t.classList.contains("e-checkbox-wrapper")?this.selectSortItemHandler(r):this.closeDialog()}}},s.prototype.initTreeView=function(e,r){var c,d,u,v,g,m,y,b,t=this,i=[],n=[],a={},o=[],l=[],h=[],p=[],C=["January","February","March","April","May","June","July","August","September","October","November","December"],S=!1,w=this.parent.getActiveSheet(),x=function(G){a[m]=!0,rr(w,Number(G.__rowIndex)-1)?S=!0:i.push(m),n.push(m)};e.dataSource.forEach(function(G){"object"==typeof(v=G[e.column.field])&&Date.parse(v.toString())?(c=v.getFullYear().toString(),a[c]||((b={__rowIndex:c,hasChild:!0})[e.column.field]=c,o.push(b),a[c]=!0),y=v.getMonth(),a[g=c+" "+(d=C[y])]||((b={__rowIndex:g,pId:c,hasChild:!0,month:y})[e.column.field]=d,l.push(b),a[g]=!0),u=v.getDate(),m=g+" "+u.toString(),a[m]||((b={__rowIndex:m,pId:g})[e.column.field]=u,h.push(b),x(G))):(G[e.column.field]||0===G[e.column.field]?(m="text "+G[e.column.field].toString().toLowerCase(),c=G[e.column.field]):(m="blanks",c=t.parent.serviceLocator.getService(O).getConstant("Blanks")),a[m]||((b={__rowIndex:m})[e.column.field]=c,p.push(b),x(G)))}),o=new re.hm(o).executeLocal((new re.AE).sortBy(e.column.field,"decending")),l=new re.hm(l).executeLocal((new re.AE).sortBy("month","ascending")),h=new re.hm(h).executeLocal((new re.AE).sortBy(e.column.field,"ascending")),h=o.concat(l.concat(h)),p.length&&(p=new re.hm(p).executeLocal((new re.AE).sortBy(e.column.field,"ascending")),h=h.concat(p));var I=function(G){var $=[G.node];(G.event.target.classList.contains("e-fullrow")||"Enter"==G.event.key)&&("true"==M.getNode(G.node).isChecked?M.uncheckAll($):M.checkAll($))},T=function(){(0,f.IV)([D],["e-check","e-stop","e-uncheck"]),e.btnObj.element.disabled&&(e.btnObj.element.disabled=!1),S?M.checkedNodes.length?D.classList.add("e-stop"):(D.classList.add("e-uncheck"),e.btnObj.element.disabled=!0):D.classList.add("e-check"),N.indeterminate=S,N.checked=!S},k={};k[e.column.field]=this.parent.serviceLocator.getService(O).getConstant("SelectAll");var R=(0,Ge.QS6)((0,Ge.sqP)("cbox"),r.createCheckbox(k[e.column.field],!1,k),"e-ftrchk");R.classList.add("e-spreadsheet-ftrchk");var D=R.querySelector(".e-frame");D.classList.add("e-selectall"),R.addEventListener("click",function(){N.indeterminate=!1,D.classList.contains("e-check")?(M.uncheckAll(),D.classList.add("e-uncheck"),N.checked=!1):(M.checkAll(),D.classList.add("e-check"),N.checked=!0)}.bind(this)),e.element.appendChild(R);var N=R.querySelector(".e-chk-hidden"),P=this.parent.createElement("div"),M=new ze.LQ({fields:{dataSource:h,id:"__rowIndex",parentID:"pId",text:e.column.field,hasChildren:"hasChild"},enableRtl:this.parent.enableRtl,showCheckBox:!0,cssClass:"e-checkboxtree",checkedNodes:i,nodeClicked:I.bind(this),keyPress:I.bind(this),nodeChecked:function(G){"indeterminate"!==G.action&&(S=M.checkedNodes.length!==M.fields.dataSource.length,T())}});M.createElement=this.parent.createElement,M.appendTo(P),e.element.appendChild(P),i=M.checkedNodes,T(),e.btnObj.element.addEventListener("click",function(){M.checkedNodes.length===h.length?t.filterSuccessHandler(new re.hm(e.dataSource),{action:"clear-filter",field:e.column.field}):t.generatePredicate(M.checkedNodes,p.length?"string":e.type,e.column.field,r,n,M.checkedNodes.length>h.length/2)}.bind(this));var Y=this.refreshCheckbox.bind(this,h,M,i),X=function(){t.parent.off(Hl,Y),t.parent.off(Ge.RAh,X)};this.parent.on(Ge.RAh,X,this),this.parent.on(Hl,Y,this)},s.prototype.generatePredicate=function(e,r,t,i,n,a){var l,p,c,d,u,o=[],h={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11},v=function(){"blanks"===p[0]?o.push(Object.assign({value:"",type:r},l)):"text"===p[0]&&(p.splice(0,1),d=p.join(" "),isNaN(Number(d))?u="string":(d=Number(d),u="number"),o.push(Object.assign({value:d,type:u},l)))},g=function(){(c=new Date(Number(p[0]),h[p[1]],Number(p[2]))).getDate()?o.push(Object.assign({value:c,type:r},l)):v()};if(a){l={field:t,ignoreAccent:!1,matchCase:!1,predicate:"and",operator:"notequal"};for(var m=0,y=n.length;m<y;m++)-1===e.indexOf(n[m])&&(p=n[m].split(" "),g())}else for(l={field:t,ignoreAccent:!1,matchCase:!1,predicate:"or",operator:"equal"},m=0,y=e.length;m<y;m++)3===(p=e[m].split(" ")).length?g():v();i.initiateFilter(o)},s.prototype.refreshCheckbox=function(e,r,t,i){var n;if("keyup"===i.event.type)n=i.event.target.value;else if(i.event.target.classList.contains("e-search-icon"))return;var a,o=function(){if(a.length&&!r.fields.dataSource.length){var w=r.element.parentElement;w.getElementsByClassName("e-spreadsheet-ftrchk")[0].classList.remove("e-hide"),(0,f.og)(w.getElementsByClassName("e-checkfltrnmdiv")[0])}r.fields.dataSource=a,r.dataBind()};if(n){a=new re.hm(e).executeLocal((new re.AE).where(new re.$G(r.fields.text,"contains",n,!0)));var l={},h=[],p=void 0,c=void 0,u=void 0,v=void 0;if(isNaN(Number(n))){for(var g=0;g<a.length;g++)!a[g].hasChild||(h.push(new re.$G("pId","equal",a[g].__rowIndex,!1)),l[p=a[g].pId]||(h.push(new re.$G("__rowIndex","equal",p,!1)),l[p]=!0));c=a,v=1}else{var m=void 0,y={};for(u=[],g=0;g<a.length;g++)(p=a[g].pId)?(m=p.split(" ")[0],l[p]||(h.push(new re.$G("__rowIndex","equal",p,!1)),l[p]=!0,u.push(m),u.push(p)),y[m]||(l[m]||(h.push(new re.$G("__rowIndex","equal",m,!1)),l[m]=!0),h.push(new re.$G("__rowIndex","equal",a[g].__rowIndex,!1)))):y[p=a[g].__rowIndex]||(h.push(new re.$G("__rowIndex","contains",p,!1)),y[p]=!0);c=[]}if(a.length){h.length&&(a=c.concat(new re.hm(e).executeLocal((new re.AE).where(re.$G.or(h))))),o(),r.checkAll();var C=r.animation.expand.duration;r.animation.expand.duration=0,r.expandAll(u,v),r.animation.expand.duration=C}else if(r.fields.dataSource.length){o();var b=r.element.parentElement;b.getElementsByClassName("e-spreadsheet-ftrchk")[0].classList.add("e-hide");var S=this.parent.createElement("div",{className:"e-checkfltrnmdiv"});S.appendChild(this.parent.createElement("span",{innerHTML:this.parent.serviceLocator.getService(O).getConstant("NoResult")})),b.appendChild(S)}}else a=e,o(),r.checkedNodes=t,r.dataBind()},s.prototype.openDialog=function(e){var r=this,t=parseInt(e.getAttribute("aria-colindex"),10),i=_e(t);this.parent.showSpinner();var n=this.parent.activeSheetIndex,a=this.filterRange.get(n),o=a.range.slice(),l=this.parent.getActiveSheet(),h=E(o[0],t-1,l),p=this.parent.getDisplayText(h);o[0]=o[0]+1,a.useFilterRange||(o[2]=l.usedRange.rowIndex);var C,c=[o[0],t-1,o[2],t-1],d=this.getPredicateRange(c,this.filterCollection.get(n),t-1),u=d.otherColPredicate,v=l.name+"!"+d.address,g=z(c),m=this.getColumnType(l,t-1,o),y=m.type,b=y.includes("date")||m.isDateAvail;b&&!d.filteredCol&&(C=[]),Zt(this.parent,v,!0,!0,null,!0,null,null,!1,g,null,C).then(function(S){var w;if(r.parent.element.style.position="relative",r.parent.element.classList.add("e-filter-open"),b){if(C||!u.length)w=new re.hm(C||S);else{var x=new re.hm(S).executeLocal((new re.AE).where(re.$G.and(r.getPredicates(u))));w=new re.hm(x)}var I=function(Y){r.parent.off(Bl,I),Y.isCheckboxFilterTemplate=!0,r.initTreeView(Y,k)};r.parent.on(Bl,I,r)}else S.some(function(Y,X){return Y&&(w=new re.hm(S.slice(X))),!!Y});var F=e.querySelector(".e-filter-btn"),T={type:y,field:i,format:"date"===y?r.getDateFormatFromColumn(l,t,o):null,displayName:p||"Column "+i,dataSource:w,height:r.parent.element.classList.contains("e-bigger")?800:500,columns:[],hideSearchbox:!1,filteredColumns:r.filterCollection.get(n),column:{field:i,filter:{}},handler:r.filterSuccessHandler.bind(r,new re.hm(S)),target:F,position:{X:0,Y:0},localeObj:r.parent.serviceLocator.getService(O)},k=new Ge.I0D(r.parent,r.getLocalizedCustomOperators());k.openDialog(T);var R=document.querySelector(".e-filter-popup");if(R&&R.id.includes(r.parent.element.id)){f.bi.add(R,Ia(),r.filterMouseDownHandler,r);var D=r.parent.element.getBoundingClientRect(),N=F.getBoundingClientRect(),P=R.getBoundingClientRect(),M=N.right-D.left-P.width;M<0&&(M=N.left-D.left),R.style.left=M+"px",R.style.top="0px",R.style.visibility="hidden",R.classList.contains("e-hide")&&R.classList.remove("e-hide");var V=N.bottom-D.top;P.height-(D.bottom-N.bottom)>0&&(V-=P.height-(D.bottom-N.bottom))<0&&(V=0),R.style.top=V+"px",R.style.visibility=""}r.parent.hideSpinner()})},s.prototype.getPredicateRange=function(e,r,t){var n,o,l,i=z(e),a=[];return r&&r.length?r.forEach(function(h){h.field&&(o=""+h.field+(e[0]+1)+":"+h.field+(e[2]+1),l=Vt(h.field),i.includes(o)||(i+=","+o,l<e[1]&&(e[1]=l),l>e[3]&&(e[3]=l)),void 0!==t&&(l===t?n=!0:a.push(h)))}):n=!0,void 0===t?i:{address:i,filteredCol:n,otherColPredicate:a}},s.prototype.filterDialogCreatedHandler=function(){var e=document.querySelector(".e-filter-popup");e&&e.id.includes(this.parent.element.id)&&e.classList.contains("e-popup-close")&&e.classList.add("e-hide")},s.prototype.filterCboxValueHandler=function(e){if(e.column&&e.data&&e.value){var a=B(e.column.field+e.data.dataObj.__rowIndex),o=E(a[0],a[1],this.parent.getActiveSheet());o&&o.format&&(e.value=this.parent.getDisplayText(o))}},s.prototype.selectSortItemHandler=function(e){var r=this.parent.serviceLocator.getService(O),t=e.classList.contains("e-filter-sortasc")?"Ascending":e.classList.contains("e-filter-sortdesc")?"Descending":null;if(e.setAttribute("aria-label",r.getConstant("Ascending"===t?"SortAscending":"SortDescending")),t){var i=this.parent.getActiveSheet(),n=this.parent.activeSheetIndex,a=this.filterRange.get(n),o=a.range.slice();o[0]=o[0]+1,a.useFilterRange||(o[2]=i.usedRange.rowIndex),this.parent.sortCollection=this.parent.sortCollection?this.parent.sortCollection:[];for(var l,h=0;h<this.parent.sortCollection.length;h++)this.parent.sortCollection[h]&&this.parent.sortCollection[h].sheetIndex===n&&(l=this.parent.sortCollection[h],this.parent.sortCollection.splice(h,1));this.parent.sortCollection.push({sortRange:z(o),columnIndex:De(i.activeCell)[1],order:t,sheetIndex:n}),l||(l={order:""}),this.parent.notify(Fr,{sortOptions:{sortDescriptors:{order:t},containsHeader:!1},previousSort:l,range:z(o)}),this.refreshFilterRange(),this.closeDialog()}},s.prototype.filterSuccessHandler=function(e,r){var t=r.sIdx;!t&&0!==t&&(t=this.parent.activeSheetIndex);var i=r.prevPredicates||[].slice.call(this.filterCollection.get(t));r.isFilterByValue&&!i.length&&(i=void 0);var n=this.filterCollection.get(t);if(this.updatePredicate(n,r.field),"clear-filter"!==r.action||n.length!==i.length){if("filtering"===r.action&&(n=n.concat(r.filterCollection)).length)for(var a=0;a<n.length;a++)r.field=n[a].field;this.filterCollection.set(t,n);var o={datasource:e,predicates:this.getPredicates(this.filterCollection.get(t))},l=this.filterRange.get(t);l.useFilterRange||(l.range[2]=_(this.parent,t).usedRange.rowIndex),this.applyFilter(o,z(l.range),t,i,!1,r.isInternal)}},s.prototype.updatePredicate=function(e,r){for(var t=new re.hm(e),i=new re.AE,n=t.executeLocal(i.where("field","equal",r)),a=0;a<n.length;a++){for(var o=-1,l=0;l<e.length;l++)if(e[l].field===n[a].field){o=l;break}-1!==o&&e.splice(o,1)}},s.prototype.applyFilter=function(e,r,t,i,n,a){var o=this,l={range:r,predicates:[].slice.call(this.filterCollection.get(t)),previousPredicates:i,sheetIndex:t,cancel:!1};if(a||(this.parent.notify(ue,{action:"filter",eventArgs:l}),!l.cancel)){r.indexOf("!")<0&&(r=this.parent.sheets[t].name+"!"+r),this.parent.showSpinner();var p={args:{range:r,filterOptions:e},promise:new Promise(function(c,d){c(void 0)}),refresh:n};this.parent.notify(gn,p),p.promise.then(function(c){return o.refreshFilterRange(),o.parent.notify(Si,null),o.parent.hideSpinner(),a||(delete l.cancel,o.parent.notify(Z,{action:"filter",eventArgs:l})),Promise.resolve(c)}).catch(function(c){return o.filterRangeAlertHandler({error:c}),Promise.reject(c)})}},s.prototype.getPredicates=function(e){for(var r=[],t=Ge.dIK.getPredicate(e),i=0,n=Object.keys(t);i<n.length;i++)r.push(t[n[i]]);return r},s.prototype.getColumnType=function(e,r,t){for(var i=0,n=0,a=0,l=t[0];l<=t[2];l++){var h=E(l,r,e);if(h)if(h.format)switch(Ft(h.format).toLowerCase()){case"number":case"currency":case"accounting":case"percentage":case"time":i++;break;case"shortdate":case"longdate":a++;break;default:Kl(h)?a++:te(h.value)?i++:n++}else"string"==typeof h.value||null==h.value?n++:i++;else n++}return{type:i>n&&i>a&&i>0?"number":n>=i&&n>=a&&n>=0?"string":a>i&&a>n&&a>0?"date":"datetime",isDateAvail:!!a}},s.prototype.getDateFormatFromColumn=function(e,r,t){for(var i,n=t[0];n<=t[2];n++){var a=E(n,r-1,e);if(a&&a.format){var o=Ft(a.format);i="ShortDate"===o?a.format.split("m").join("M"):"LongDate"===o?"EEEE, MMMM d, y":a.format;break}}return i},s.prototype.clearFilterHandler=function(e){var r=e&&void 0!==e.sheetIndex?e.sheetIndex:this.parent.activeSheetIndex;if(e&&e.field){var t=[].slice.call(this.filterCollection.get(r));t&&t.length&&(this.updatePredicate(t,e.field),this.initiateFilterUIHandler({predicates:t,range:z(this.filterRange.get(r).range),sIdx:r}))}else{var i=e&&e.isAction,n={isFiltered:!1,isClearAll:!0,sheetIndex:r};if(this.getFilteredColumnHandler(n),n.isFiltered||e&&e.preventRefresh){var a=void 0,o=_(this.parent,r),l=this.filterRange.get(r),h=l.range;if(i&&(a={range:z(h),predicates:[],previousPredicates:this.filterCollection.get(r),sheetIndex:r,cancel:!1},this.parent.notify(ue,{action:"filter",eventArgs:a}),a.cancel))return;this.filterCollection.set(r,[]);for(var p=this.parent.filterCollection,c=0,d=p&&p.length;c<d;c++)if(p[c].sheetIndex===r){p.splice(c,1);break}var u=l.useFilterRange?h[2]:o.usedRange.rowIndex;if(this.parent.scrollSettings.enableVirtualization&&u-h[0]+1>this.parent.viewport.rowCount+2*this.parent.getThreshold("row")){for(c=0;c<=u;c++)dt(o,c,{hidden:!1,isFiltered:!1});(!e||!e.preventRefresh)&&this.parent.renderModule.refreshSheet(!1,!1,!0)}else{this.refreshFilterRange(null,null,r);var v={startIndex:h[0],hide:!1,isFiltering:!0,refreshUI:!1,endIndex:l.useFilterRange?h[2]:o.usedRange.rowIndex,sheetIndex:r};this.parent.notify(je,v),v.refreshUI&&(!e||!e.preventRefresh)&&this.parent.renderModule.refreshSheet(!1,!1,!0)}i&&(delete a.cancel,this.parent.notify(Z,{action:"filter",eventArgs:a}))}}},s.prototype.reapplyFilterHandler=function(e,r){var t=this,i=this.parent.activeSheetIndex;if(this.filterRange.has(i)){var n=this.filterCollection.get(i);if(n&&n.length){var a=_(this.parent,i),o=this.filterRange.get(this.parent.activeSheetIndex),l=o.range.slice();l[0]=l[0]+1,o.useFilterRange||(l[2]=a.usedRange.rowIndex),l[1]=l[3]=Vt(n[0].field);var h=a.name+"!"+this.getPredicateRange(l,n.slice(1,n.length));Zt(this.parent,h,!0,!0,null,!0,null,null,!1,z(l)).then(function(p){var c=t.getPredicates(t.filterCollection.get(i));t.applyFilter({predicates:c,datasource:new re.hm(p)},z(o.range),i,[].slice.call(n),r,e)})}}},s.prototype.getFilterRangeHandler=function(e){var r=e.sheetIdx;this.filterRange&&this.filterRange.has(r)?(e.hasFilter=!0,e.filterRange=this.filterRange.get(r).range):(e.hasFilter=!1,e.filterRange=null)},s.prototype.getLocalizedCustomOperators=function(){var e=this.parent.serviceLocator.getService(O),r=[{value:"equal",text:e.getConstant("Equal")},{value:"greaterthan",text:e.getConstant("GreaterThan")},{value:"greaterthanorequal",text:e.getConstant("GreaterThanOrEqual")},{value:"lessthan",text:e.getConstant("LessThan")},{value:"lessthanorequal",text:e.getConstant("LessThanOrEqual")},{value:"notequal",text:e.getConstant("NotEqual")}];return{stringOperator:[{value:"startswith",text:e.getConstant("StartsWith")},{value:"endswith",text:e.getConstant("EndsWith")},{value:"contains",text:e.getConstant("Contains")},{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}],numberOperator:r,dateOperator:r,datetimeOperator:r,booleanOperator:[{value:"equal",text:e.getConstant("Equal")},{value:"notequal",text:e.getConstant("NotEqual")}]}},s.prototype.getFilteredCollection=function(){for(var t,e=this.parent.sheets.length,r=[],i=0;i<e;i++){var o={sheetIdx:i,filterRange:void 0,hasFilter:void 0};if(this.getFilterRangeHandler(o),o.hasFilter){for(var l=[],h=[],p=[],c=[],d=[],u=this.filterCollection.get(o.sheetIdx),v=0;v<u.length;v++)if(u[v].field&&u[v].operator){var g=B(u[v].field+"1")[1];l.push(g),h.push(u[v].operator),p.push((0,f.le)(u[v].value)?"":u[v].value),c.push(u[v].type),d.push(u[v].predicate)}var m=z(o.filterRange);r.push(t={sheetIndex:o.sheetIdx,filterRange:m,hasFilter:o.hasFilter,column:l,criteria:h,value:p,dataType:c,predicates:d})}}t&&(this.parent.filterCollection=r)},s.prototype.updateFilter=function(e){if(this.parent.filterCollection&&(e.initLoad||e.isOpen)){for(var r=0;r<this.parent.filterCollection.length;r++){var t=this.parent.filterCollection[r],i=t.sheetIndex;0===r&&!this.parent.isOpen&&!e.isOpen&&(i=0);var n=[];if(t.column)for(var a=0;a<t.column.length;a++){var o={field:j(0,t.column[a]).charAt(0),operator:this.getFilterOperator(t.criteria[a]),value:"string"==typeof t.value[a]?t.value[a].split("*").join(""):t.value[a],predicate:t.predicates&&t.predicates[a],type:t.dataType&&t.dataType[a]};n.push(o)}for(var l=0;l<n.length-1;l++)n[l].field===n[l+1].field&&(n[l].predicate||(n[l].predicate="or"),n[l+1].predicate||(n[l+1].predicate="or"));this.parent.notify(jt,{predicates:n.length?n:void 0,range:t.filterRange,sIdx:i,isInternal:!0})}this.parent.sortCollection&&this.parent.notify(dn,null)}},s.prototype.getFilterOperator=function(e){switch(e){case"BeginsWith":e="startswith";break;case"Less":e="lessthan";break;case"EndsWith":e="endswith";break;case"Equal":e="equal";break;case"Notequal":e="notEqual";break;case"Greater":e="greaterthan";break;case"Contains":e="contains";break;case"LessOrEqual":e="lessthanorequal";break;case"GreaterOrEqual":e="greaterthanorequal"}return e},s.prototype.beforeInsertHandler=function(e){if("Column"===e.modelType){var r=(0,f.o8)(e.activeSheetIndex)?this.parent.activeSheetIndex:e.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(r)){var t=this.filterRange.get(r).range;(this.isFilterCell(r,t[0],e.index)||e.index<t[1])&&(t[3]+=e.model.length,e.index<=t[1]&&(t[1]+=e.model.length),this.filterCollection.get(r).forEach(function(l){var h=Vt(l.field);e.index<=h&&(l.field=_e(h+e.model.length+1))}),this.parent.sortCollection&&this.parent.sortCollection.forEach(function(l){l.sheetIndex===r&&e.index<=l.columnIndex&&(l.columnIndex+=e.model.length)}),this.getFilteredCollection())}}else if("Sheet"===e.modelType){for(var i=!1,n=0,a=Array.from(this.filterRange.keys()).sort().reverse();n<a.length;n++){var o=a[n];e.index<=o&&(i=!0,this.filterRange.set(o+e.model.length,this.filterRange.get(o)),this.filterRange.delete(o),this.filterCollection.set(o+e.model.length,this.filterCollection.get(o)),this.filterCollection.delete(o))}this.parent.sortCollection&&this.parent.sortCollection.forEach(function(l){e.index<=l.sheetIndex&&(l.sheetIndex+=e.model.length)}),i&&this.getFilteredCollection()}},s.prototype.beforeDeleteHandler=function(e){if("Column"===e.modelType){var r=this.parent.activeSheetIndex;if(this.filterRange.size&&this.filterRange.has(r)){var t=!0,i=this.filterRange.get(r).range;if(e.start>=i[1]&&e.end<=i[3]?i[3]-=e.end-e.start+1:e.start<i[1]&&e.end<i[1]?(i[1]-=e.end-e.start+1,i[3]-=e.end-e.start+1):e.start<i[1]&&e.end>i[1]&&e.end<i[3]?(i[1]=e.start,i[3]-=e.end-e.start+1):t=!1,t){for(var n=this.filterCollection.get(r),a=void 0,o=n.length-1;o>=0;o--){var l=Vt(n[o].field);e.end<l?n[o].field=_e(l-(e.end-e.start+1)+1):e.start<=l&&e.end>=l&&(a=!0,n.splice(o,1))}var h=this.parent.sortCollection;if(h)for(o=0;o<h.length;o++)if(h[o].sheetIndex===r){if(e.end<h[o].columnIndex){h[o].columnIndex=h[o].columnIndex-(e.end-e.start+1);break}if(e.start<=h[o].columnIndex&&e.end>=h[o].columnIndex){h.splice(o,1);break}}i.some(function(p){return p<0})?(this.removeFilter(r,!0,!0),e.refreshSheet=!0):a&&(n&&n.length?(this.reapplyFilterHandler(!0,!0),e.refreshSheet=!1):(this.clearFilterHandler({preventRefresh:!0}),e.refreshSheet=!0)),this.getFilteredCollection()}}}},s.prototype.deleteSheetHandler=function(e){if((0,f.o8)(e.sheetIndex))this.filterRange.get(this.parent.activeSheetIndex)&&(this.filterRange.delete(this.parent.activeSheetIndex),this.filterCollection.delete(this.parent.activeSheetIndex));else{for(var r=void 0,t=0,i=Array.from(this.filterRange.keys()).sort().reverse();t<i.length;t++){var n=i[t];r=!0,e.sheetIndex===n?(this.filterRange.delete(n),this.filterCollection.delete(n)):e.sheetIndex<n?(this.filterRange.set(n-1,this.filterRange.get(n)),this.filterRange.delete(n),this.filterCollection.set(n-1,this.filterCollection.get(n)),this.filterCollection.delete(n)):r=!1}var a=this.parent.sortCollection;if(a)for(var o=a.length-1;o>=0;o--)e.sheetIndex===a[o].sheetIndex?a.splice(o,1):e.sheetIndex<a[o].sheetIndex&&(a[o].sheetIndex-=1);r&&this.getFilteredCollection()}},s.prototype.clearHandler=function(e){var r=this.parent.getAddressInfo(e.range);if(this.filterRange.has(r.sheetIndex)){var t=this.filterRange.get(r.sheetIndex).range.slice();Ht(r.indices,t[0],t[1])&&Ht(r.indices,t[0],t[3])&&this.removeFilter(r.sheetIndex)}},s.prototype.duplicateSheetFilterHandler=function(e){this.filterCollection.has(e.sheetIndex)&&this.filterCollection.set(e.newSheetIndex,this.filterCollection.get(e.sheetIndex)),this.filterRange.has(e.sheetIndex)&&this.filterRange.set(e.newSheetIndex,this.filterRange.get(e.sheetIndex))},s}(),al=function(){function s(e){this.pictureCount=1,this.parent=e,this.addEventListener(),this.renderImageUpload()}return s.prototype.addEventListener=function(){this.parent.on(rs,this.insertImage,this),this.parent.on(Dl,this.refreshImgElem,this),this.parent.on(li,this.refreshImgCellObj,this),this.parent.on(Mt,this.createImageElement,this),this.parent.on(It,this.deleteImage,this),this.parent.on(pa,this.refreshInsDelImagePosition,this)},s.prototype.renderImageUpload=function(){this.parent.element.appendChild(this.parent.createElement("input",{id:this.parent.element.id+"_imageUpload",styles:"display: none;",attrs:{type:"file",accept:".image, .jpg, .png, .gif ,jpeg",name:"fileUpload"}})).onchange=this.imageSelect.bind(this)},s.prototype.imageSelect=function(e){var r=e.target.files[0];!r||(r.type.includes("image")?this.insertImage({file:r}):this.parent.serviceLocator.getService(ae).show({content:this.parent.serviceLocator.getService("spreadsheetLocale").getConstant("UnsupportedFile"),width:"300"}),e.target.value="")},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(rs,this.insertImage),this.parent.off(li,this.refreshImgCellObj),this.parent.off(Mt,this.createImageElement),this.parent.off(It,this.deleteImage),this.parent.off(pa,this.refreshInsDelImagePosition))},s.prototype.insertImage=function(e,r){var t=this;this.binaryStringVal(e).then(function(i){return t.createImageElement({options:{src:i},range:r,isPublic:!0})})},s.prototype.binaryStringVal=function(e){return new Promise(function(r,t){var i=new FileReader;i.readAsDataURL(e.file),i.onload=function(){return r(i.result)},i.onerror=function(n){return t(n)}})},s.prototype.createImageElement=function(e){var r=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,t=e.range&&e.range.indexOf("!")>0?ee(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,i=this.parent.serviceLocator.getService(ll),n=e.options.imageId?e.options.imageId:this.parent.element.id+"_overlay_picture_"+this.pictureCount,a=A(r),o=(0,f.o8)(t)?this.parent.getActiveSheet():this.parent.sheets[t];if(!document.getElementById(n)){var l={requestType:"beforeInsertImage",range:o.name+"!"+r,imageData:e.options.src,sheetIndex:t};if(e.isPublic&&this.parent.notify("actionBegin",{eventArgs:l,action:"beforeInsertImage"}),!l.cancel){var h=i.insertOverlayElement(n,r,t);h.style.backgroundImage="url('"+e.options.src+"')",(e.options.height||e.options.left)&&(h.style.height=e.options.height+"px",h.style.width=e.options.width+"px",h.style.top=e.options.top+"px",h.style.left=e.options.left+"px"),(o.frozenRows||o.frozenColumns)&&i.adjustFreezePaneSize(e.options,h,r),e.options.imageId||this.pictureCount++;var p={src:e.options.src,id:n,height:parseFloat(h.style.height.replace("px","")),width:parseFloat(h.style.width.replace("px","")),top:o.frozenRows||o.frozenColumns?a[0]?Ce(o,0,a[0]-1):0:parseFloat(h.style.top.replace("px","")),left:o.frozenRows||o.frozenColumns?a[1]?ge(o,0,a[1]-1):0:parseFloat(h.style.left.replace("px",""))};this.parent.setUsedRange(a[0],a[1]),(e.isPublic||e.isUndoRedo)&&this.parent.notify(wn,{options:[p],range:o.name+"!"+r});var c=E(a[0],a[1],o);c.image[c.image.length-1].id||(c.image[c.image.length-1].id=p.id),!e.isUndoRedo&&e.isPublic&&this.parent.notify("actionComplete",{eventArgs:l={requestType:"insertImage",range:o.name+"!"+r,imageHeight:e.options.height?e.options.height:300,imageWidth:e.options.width?e.options.width:400,imageData:e.options.src,id:n,sheetIndex:t},action:"insertImage"})}}},s.prototype.refreshImgElem=function(){var e=document.getElementsByClassName("e-ss-overlay-active")[0];e&&(0,f.IV)([e],"e-ss-overlay-active")},s.prototype.refreshInsDelImagePosition=function(e){for(var n,l,h,r=e.count,a=E(e.rowIdx,e.colIdx,this.parent.sheets[e.sheetIdx]),o=a.image.length,p=0;p<o;p++)n=document.getElementById(a.image[p].id),h="Column"===e.type?"insert"===e.status?a.image[p].left+64*r:a.image[p].left-64*r:a.image[p].left,a.image[p].top=l="Row"===e.type?"insert"===e.status?a.image[p].top+20*r:a.image[p].top-20*r:a.image[p].top,a.image[p].left=h,n.style.top=l+"px",n.style.left=h+"px"},s.prototype.refreshImgCellObj=function(e){var o,l,r=(0,f.o8)(e.sheetIdx)?this.parent.activeSheetIndex:e.sheetIdx,t=_(this.parent,r),i=E(e.prevRowIdx,e.prevColIdx,t),n=E(e.currentRowIdx,e.currentColIdx,t),a=i?i.image:[],h=a&&a.length?a.length:0;if(i&&i.image&&a.length>0){for(var p=0;p<h;p++)a[p]&&a[p].id===e.id&&((o=a[p]).height=e.currentHeight,o.width=e.currentWidth,o.top=e.currentTop,o.left=e.currentLeft,a.splice(p,1));n&&n.image&&(l=n.image,o&&l.push(o)),ce(e.currentRowIdx,e.currentColIdx,t,l?{image:l}:{image:[o]},!0),"imageRefresh"!==e.requestType||e.isUndoRedo||this.parent.notify("actionComplete",{eventArgs:{requestType:"imageRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,id:e.id,sheetIdx:this.parent.activeSheetIndex},action:"imageRefresh"})}},s.prototype.deleteImage=function(e){var i,n,a,r=this.parent.getActiveSheet(),t=document.getElementById(e.id);if(t){var o=void 0,l=void 0;if(r.frozenRows||r.frozenColumns){var h=t.getBoundingClientRect();o={clientY:h.top},l={clientX:h.left},h.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(o.target=this.parent.getColumnHeaderContent()),h.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(l.target=this.parent.getRowHeaderTable())}else o={clientY:t.offsetTop,isImage:!0},l={clientX:t.offsetLeft,isImage:!0};if(this.parent.notify(Yt,o),this.parent.notify(Xt,l),a=r.name+"!"+j(i=o.clientY,n=l.clientX),!e.preventEventTrigger){var p={address:a,cancel:!1};if(this.parent.notify(ue,{action:"deleteImage",eventArgs:p}),p.cancel)return}document.getElementById(e.id).remove()}else{var c=e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange,d=e.range&&e.range.indexOf("!")>0?ee(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,u=A(c);i=u[0],n=u[1],r=this.parent.sheets[d]}for(var g=E(i,n,r).image,m=g.length,y={},C=0;C<m;C++)g[C].id===e.id&&(y=g.splice(C,1)[0]);ce(i,n,r,{image:g},!0),e.preventEventTrigger||this.parent.notify(Z,{action:"deleteImage",eventArgs:{address:a,id:y.id,imageData:y.src,cancel:!1}})},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s.prototype.getModuleName=function(){return"spreadsheetImage"},s}();Be.kL2.Inject(Be.dXD,Be.ehF,Be.QG9,Be.f62,Be.f5i,Be.b40,Be.gtc,Be.nCZ),Be.kL2.Inject(Be.yXf,Be.WDG,Be.DeQ,Pt.u,Be.wEc),Be.WCS.Inject(Be.fWg,Be.V_J,Be.w3Q,Be.prM);var ol=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.addEventListener=function(){this.parent.on(Zr,this.initiateChartHandler,this),this.parent.on(hi,this.refreshChartCellObj,this),this.parent.on(so,this.updateChartHandler,this),this.parent.on(Dr,this.deleteChart,this),this.parent.on(ns,this.clearBorder,this),this.parent.on(as,this.insertChartHandler,this),this.parent.on(ci,this.chartRangeHandler,this),this.parent.on(Or,this.chartDesignTabHandler,this),this.parent.on(Ll,this.updateChartElement,this),this.parent.on(os,this.undoRedoForChartDesign,this)},s.prototype.insertChartHandler=function(e){var r="Column";switch(e.id){case"clusteredColumn":r="Column";break;case"stackedColumn":r="StackingColumn";break;case"stackedColumn100":r="StackingColumn100";break;case"clusteredBar":r="Bar";break;case"stackedBar":r="StackingBar";break;case"stackedBar100":r="StackingBar100";break;case"area":r="Area";break;case"stackedArea":r="StackingArea";break;case"stackedArea100":r="StackingArea100";break;case"line":r="Line";break;case"stackedLine":r="StackingLine";break;case"stackedLine100":r="StackingLine100";break;case"pie":r="Pie";break;case"doughnut":r="Doughnut";break;case"scatter":r="Scatter"}e.isChart?this.parent.notify(lr,{chart:[{type:r}]}):this.parent.notify(Or,{chartType:r,triggerEvent:!0})},s.prototype.chartRangeHandler=function(){var e=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(e)for(var r=e.getElementsByClassName("e-control")[0].id,t=this.parent.chartColl,i=t.length,n=0;n<i;n++){var a=document.getElementById(t[n].id);e&&a&&t[n].id===r&&this.parent.notify(Zr,{option:t[n],isRefresh:!0})}},s.prototype.getPropertyValue=function(e,r,t){var i=E(e,r,_(this.parent,t));if(i){var n=void 0;if(i.format){var a={value:i.value,format:i.format,onLoad:!0,formattedText:i.value,isRightAlign:!1,cell:i,rowIndex:e.toString(),colIndex:r.toString()};if(this.parent.notify(ot,a),"number"==typeof a.value){var o=new RegExp("[!@#$%^&()+=';,{}|\":<>~_-]","g");a.formattedText=a.formattedText.toString().replace(o,""),n=parseInt(a.formattedText.toString(),10)}else n=a.formattedText&&a.formattedText.toString()}else n=i.value;return(0,f.le)(n)?"":n}return""},s.prototype.updateChartHandler=function(e){var r=this.initiateChartHandler({option:e.chart,isRefresh:!0}),t=this.parent.element.querySelector("."+e.chart.id);if(t){var i=(0,f.Xr)(t,"chart");(0,f.le)(i)&&(i=(0,f.Xr)(t,"accumulationchart")),i.series=r,i.refresh()}},s.prototype.refreshChartCellObj=function(e){var o,l,r=(0,f.o8)(e.sheetIdx)?this.parent.activeSheetIndex:e.sheetIdx,t=_(this.parent,r),i=E(e.prevRowIdx,e.prevColIdx,t),n=E(e.currentRowIdx,e.currentColIdx,t),a=i?i.chart:[],h=a&&a.length?a.length:0;if(h){for(var p=0;p<h;p++)if(a[p].id===e.id.split("_overlay")[0]){(o=a[p]).height=e.currentHeight,o.width=e.currentWidth,o.top=e.currentTop,o.left=e.currentLeft,a.splice(p,1);for(var c=0,d=this.parent.chartColl.length;c<d;c++)o.id===this.parent.chartColl[c].id&&(o.height=e.currentHeight,this.parent.chartColl[c].width=e.currentWidth,this.parent.chartColl[c].top=e.currentTop,this.parent.chartColl[c].left=e.currentLeft)}n&&n.chart&&(l=n.chart,o&&l.push(o)),ce(e.currentRowIdx,e.currentColIdx,t,l?{chart:l}:{chart:[o]},!0),"chartRefresh"!==e.requestType||e.isUndoRedo||this.parent.notify("actionComplete",{eventArgs:{requestType:"chartRefresh",currentRowIdx:e.currentRowIdx,currentColIdx:e.currentColIdx,currentWidth:e.currentWidth,prevHeight:e.prevHeight,prevWidth:e.prevWidth,prevRowIdx:e.prevRowIdx,prevColIdx:e.prevColIdx,prevTop:e.prevTop,prevLeft:e.prevLeft,currentTop:e.currentTop,currentLeft:e.currentLeft,currentHeight:e.currentHeight,id:e.id,sheetIdx:r},action:"chartRefresh"})}},s.prototype.processChartRange=function(e,r,t){var i,n,a,o=e[0],l=e[1],h=!1,p=e[2],c=e[3],d=o===p,u=l===c,v=this.getPropertyValue(o,c,r),g=this.getPropertyValue(p,l,r),m=this.getPropertyValue(o,l,r);return(!te(g)||!m)&&(h=!0),(0,f.le)(m)&&!d&&!u||"Scatter"===t.type&&e[3]-e[1]==1?(i=[o+1,l,p,l],n=[o+1,l+1,p,c],a=[o,l+1,o,c]):(0,f.le)(g)||!h||d||u?(n=[o,l,p,c],(0,f.le)(v)||te(v)||Hr(v)?(0,f.le)(m)&&(d||u)&&(a=[o,l,o,c],d?(n[1]=n[1]+1,a[3]=a[1]):n[0]=n[0]+1):(a=[o,l,o,c],n[0]=n[0]+1)):(0,f.le)(v)||te(v)&&m?(i=[o,l,p,l],n=[o,l+1,p,c]):(i=[o+1,l,p,l],n=[o+1,l+1,p,c],a=[o,l+1,o,c]),{xRange:i,yRange:n,lRange:a}},s.prototype.toIntrnlRange=function(e,r){return e?"string"==typeof e&&(e=A[e]):e=A[this.parent.sheets[r].selectedRange],e},s.prototype.getRangeData=function(e){e.range=this.toIntrnlRange(e.range,e.sheetIdx);var t=[];return this.pushRowData(e,e.range[0],e.range[1],e.range[2],e.range[3],t,[],!0,e.isYvalue),t},s.prototype.pushRowData=function(e,r,t,i,n,a,o,l,h){for(var d,p=t,c=this.parent.sheets[e.sheetIdx];r<=i;)if(ne(c,r))r++;else{for(t=p;t<=n;)if(we(c,t))t++;else{var u=E(r,t,c,!1,!0);if(u.format&&!h){var v={value:u.value,format:u.format,onLoad:!0,formattedText:u.value,rowIndex:r.toString(),colIndex:t.toString(),isRightAlign:!1,cell:u};this.parent.notify(ot,v),d=v.formattedText?v.formattedText.toString():""}else d=u.value||(0===u.value?0:"");a.push({value:d}),t++}r++}o.push(r)},s.prototype.toArrayData=function(e){for(var t,r="value",i=0,n=[],a=e.length;i<a;)t=e[i],Object.keys(t).length?r in t&&n.push(t[r]):n.push(""),i++;return n},s.prototype.getVirtualXValues=function(e){for(var r=1,t=[];r<e;)t.push(r.toString()),r++;return t},s.prototype.processChartSeries=function(e,r,t,i,n){e=e||{};var l,h,p,c,d,v,C,a="",o={},u={},g=0,m=0,y=[];r=(0,f.le)(r)?this.parent.getActiveSheet().index:r;var b=this.parent.sheets[r],S=this.getRangeData({range:i,sheetIdx:r,skipFormula:!0,isYvalue:!0}),w=i[2]-i[0]+1-this.parent.hiddenCount(i[0],i[2],"rows",b),x=i[3]-i[1]+1-this.parent.hiddenCount(i[0],i[2],"columns",b);e.isSeriesInRows?(h=n?this.toArrayData(this.getRangeData({range:n,sheetIdx:r,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(x+1),t&&(p=this.toArrayData(this.getRangeData({range:t,sheetIdx:r,skipFormula:!1,isYvalue:!1}))),c=w):(h=t?this.toArrayData(this.getRangeData({range:t,sheetIdx:r,skipFormula:!1,isYvalue:!1})):this.getVirtualXValues(w+1),n&&(p=this.toArrayData(this.getRangeData({range:n,sheetIdx:r,skipFormula:!1,isYvalue:!1}))),c=x);var N,I=h.length,F=e.isSeriesInRows?1:c;for((0,f.le)(e.dataLabelSettings)||(o.visible=e.dataLabelSettings.visible,o.position=e.dataLabelSettings.position);g<c;){for(v=0,d=[],m=e.isSeriesInRows?m:g;v<I;)S[m]&&(te(l=S[m].value)?l=Number(l):(C=Ut(l),l=isNaN(C)?0:C),d.push({x:h[v],y:l})),m+=F,v++;if(a=p&&p.length>0?p[g]:"series"+g,e.type){var T=e.type;if("Line"===T||"StackingLine"===T||"StackingLine100"===T)u={dataSource:d,type:e.type,xName:"x",yName:"y",name:a.toString(),marker:{visible:!0,width:10,height:10,dataLabel:o}};else if("Scatter"===T)u={dataSource:d,type:e.type,xName:"x",yName:"y",name:a.toString(),marker:{visible:!1,width:12,height:12,shape:"Circle",dataLabel:o}};else if("Pie"===T||"Doughnut"===T){var k="Pie"===e.type?"0%":"40%",R=o.visible,D=(0,f.le)(o.position)?"Inside":"Outer"===o.position?"Outside":"Inside";u={dataSource:d,dataLabel:{visible:!(0,f.le)(R)&&R,position:D,name:"text",font:{fontWeight:"600"}},radius:"100%",xName:"x",yName:"y",innerRadius:k}}else u={dataSource:d,type:e.type,xName:"x",yName:"y",name:a.toString(),marker:{dataLabel:o}}}y.push(u),g++}return e.type&&(N={series:y,xRange:e.isSeriesInRows?n:t,yRange:i,lRange:e.isSeriesInRows?t:n}),N},s.prototype.primaryYAxisFormat=function(e){if((0,f.le)(e))return"{value}";var r,t=E(e[0],e[1],this.parent.getActiveSheet());if(t&&t.format){if("Accounting"===(r=Ft(t.format)))return"${value}";if("Currency"===r)return"${value}";if("Percentage"===r)return"{value}%"}return"{value}"},s.prototype.focusChartRange=function(e,r,t){var i=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"];this.clearBorder();var n,a=this.parent.getActiveSheet(),o=!(!a.frozenRows&&!a.frozenColumns);t&&(o?n=t:this.parent.notify(pi,{startcell:{rowIndex:t[0],colIndex:t[1]},endcell:{rowIndex:t[2],colIndex:t[3]},classes:[i[0],i[1]]})),e&&(o?n?(n[0]=Math.min(t[0],e[0]),n[1]=Math.min(t[1],e[1]),n[2]=Math.max(t[2],e[2]),n[3]=Math.max(t[3],e[3])):n=e:this.parent.notify(pi,{startcell:{rowIndex:e[0],colIndex:e[1]},endcell:{rowIndex:e[2],colIndex:e[3]},classes:[i[2],i[3]]})),this.parent.notify(pi,o&&n?{startcell:{rowIndex:Math.min(n[0],r[0]),colIndex:Math.min(n[1],r[1])},endcell:{rowIndex:Math.max(n[2],r[2]),colIndex:Math.max(n[3],r[3])},classes:[i[4],i[5]]}:{startcell:{rowIndex:r[0],colIndex:r[1]},endcell:{rowIndex:r[2],colIndex:r[3]},classes:[i[4],i[5]]})},s.prototype.clearBorder=function(){var e=this.parent.getActiveSheet();if(e.frozenColumns||e.frozenRows)[].slice.call(this.parent.element.getElementsByClassName("e-chart-range")).forEach(function(c){(0,f.og)(c)});else for(var t=this.parent.getMainContent(),i=["e-rcborderright","e-rcborderbottom","e-vcborderright","e-vcborderbottom","e-bcborderright","e-bcborderbottom"],n=0,a=i.length;n<a;n++)for(var o=t.querySelectorAll("."+i[n]),l=0,h=o.length;l<h;l++)o[l].classList.remove(i[n])},s.prototype.initiateChartHandler=function(e){var t,i,r=e.option;t=!!(0,f.le)(e.isInitCell)||!e.isInitCell,e.triggerEvent=!!(0,f.le)(e.triggerEvent)||e.triggerEvent,e.isRefresh=!(0,f.le)(e.isRefresh)&&e.isRefresh;var p,c,n=r.range&&r.range.indexOf("!")>0?ee(this.parent,r.range.split("!")[0]):this.parent.activeSheetIndex,a=_(this.parent,n),o=r.range?r.range:this.parent.getActiveSheet().selectedRange,l=A(o),h={};if(!this.parent.allowChart&&a.isProtected)return i;var d={sheetIndex:n,reqType:"shape",type:"actionBegin",shapeType:"chart",action:"create",options:r,range:o,operation:"create"};o=d.range,l.length>0&&l[2]-l[0]<l[3]-l[1]&&(p=!0),(h=(h=d.options)||{}).isSeriesInRows=!!p||!!h.isSeriesInRows&&h.isSeriesInRows,e.dataSheetIdx=(0,f.le)(e.dataSheetIdx)?n:e.dataSheetIdx;var g=this.processChartRange(l,e.dataSheetIdx,h),m=g.xRange,y=g.yRange,C=g.lRange;n===this.parent.activeSheetIndex&&t&&this.focusChartRange(m,y,C);var b=this.processChartSeries(h,e.dataSheetIdx,m,y,C),S={majorGridLines:r.primaryXAxis&&r.primaryXAxis.majorGridLines&&!(0,f.le)(r.primaryXAxis.majorGridLines.width)?{width:r.primaryXAxis.majorGridLines.width}:{width:0},minorGridLines:r.primaryXAxis&&r.primaryXAxis.minorGridLines&&!(0,f.le)(r.primaryXAxis.minorGridLines.width)?{width:r.primaryXAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:r.primaryXAxis&&r.primaryXAxis.minorGridLines&&r.primaryXAxis.minorGridLines.width>0?5:0,lineStyle:{width:0},valueType:"Category",visible:!r.primaryXAxis||r.primaryXAxis.visible,title:r.primaryXAxis?r.primaryXAxis.title:""},w={lineStyle:{width:0},majorGridLines:r.primaryYAxis&&r.primaryYAxis.majorGridLines&&!(0,f.le)(r.primaryYAxis.majorGridLines.width)?{width:r.primaryYAxis.majorGridLines.width}:{width:1},minorGridLines:r.primaryYAxis&&r.primaryYAxis.minorGridLines&&!(0,f.le)(r.primaryYAxis.minorGridLines.width)?{width:r.primaryYAxis.minorGridLines.width}:{width:0},minorTicksPerInterval:r.primaryYAxis&&r.primaryYAxis.minorGridLines&&r.primaryYAxis.minorGridLines.width>0?5:0,labelFormat:this.primaryYAxisFormat(y),visible:!r.primaryYAxis||r.primaryYAxis.visible,title:r.primaryYAxis?r.primaryYAxis.title:""};if(e.isRefresh)return b.series;if(e.triggerEvent){if(this.parent.notify(ue,{eventArgs:c={type:r.type,theme:r.theme,isSeriesInRows:r.isSeriesInRows,range:r.range,id:r.id,height:r.height,width:r.width,posRange:e.range,isInitCell:e.isInitCell,cancel:!1},action:"beforeInsertChart"}),c.cancel)return[];r.type=c.type,r.theme=c.theme,r.isSeriesInRows=c.isSeriesInRows,r.range=c.range,r.id=c.id,r.height=c.height,r.width=c.width}var x=r.id+"_overlay",I=this.parent.serviceLocator.getService(ll),F=!(0,f.le)(e.isInitCell)&&e.isInitCell?e.range:o,T=I.insertOverlayElement(x,F,qt(this.parent,F));T.classList.add("e-datavisualization-chart"),T.style.width=r.width+"px",T.style.height=r.height+"px",a.frozenRows||a.frozenColumns?I.adjustFreezePaneSize(r,T,F):(T.style.top=(0,f.le)(r.top)?T.style.top:r.top+"px",T.style.left=(0,f.le)(r.left)?T.style.left:r.left+"px",r.top=parseInt(T.style.top.replace("px",""),10),r.left=parseInt(T.style.left.replace("px",""),10)),this.parent.notify(cs,{height:r.height,width:r.width});var k="Pie"===r.type||"Doughnut"===r.type?{position:"Bottom",visible:!0}:{};(0,f.le)(r.legendSettings)||(k.visible=r.legendSettings.visible,k.position=r.legendSettings.position);var R=this.parent.createElement("div",{id:r.id,className:r.id}),D=r.theme||"Material";return"Pie"!==r.type&&"Doughnut"!==r.type?(this.chart=new Be.kL2({primaryXAxis:S,primaryYAxis:w,background:this.getThemeBgColor(D),chartArea:{border:{width:0}},title:r.title,legendSettings:k,theme:D,series:b.series,tooltip:{enable:!0},width:T.style.width,height:T.style.height,load:function(N){N.chart.theme=r.theme||"Material"},beforeResize:function(N){N.cancelResizedEvent=!0}}),this.chart.appendTo(R)):(this.chart=new Be.WCS({title:r.title,legendSettings:k,theme:D,background:this.getThemeBgColor(D),series:b.series,width:T.style.width,height:T.style.height,center:{x:"50%",y:"50%"},enableSmartLabels:!0,enableAnimation:!0,load:function(N){N.chart.theme=r.theme||"Material"},beforeResize:function(N){N.cancelResizedEvent=!0}}),this.chart.appendTo(R)),T.appendChild(R),T.classList.contains("e-ss-overlay-active")&&this.parent.notify(ca,{id:T.id}),e.triggerEvent&&this.parent.notify(Z,{eventArgs:c,action:"insertChart"}),i},s.prototype.deleteChart=function(e){this.clearBorder();var r=null,t=this.parent.getActiveSheet();if((0,f.le)(e.id)?(r=document.querySelector(".e-datavisualization-chart.e-ss-overlay-active"),e.id=r?r.getElementsByClassName("e-control")[0].id:null):(e.id=e.id.includes("overlay")?e.id:e.id+"_overlay",r=document.getElementById(e.id)),!(0,f.le)(e.id)){e.id=e.id.includes("overlay")?e.id:e.id+"_overlay";for(var i,n,a,l,o=!1,h=0,p=this.parent.chartColl.length;h<p;h++)if(this.parent.chartColl[h].id===e.id.split("_overlay")[0]){l=this.parent.chartColl[h];break}var c={id:l.id,range:l.range,type:l.type,theme:l.theme,height:l.height,width:l.width,isSeriesInRows:l.isSeriesInRows,isInitCell:!0,posRange:null,top:l.top,left:l.left,cancel:!1};if(r){var d=void 0,u=void 0;if(t.frozenRows||t.frozenColumns){var v=r.getBoundingClientRect();d={clientY:v.top},u={clientX:v.left},v.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(d.target=this.parent.getColumnHeaderContent()),v.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(u.target=this.parent.getRowHeaderTable())}else d={clientY:r.offsetTop,isImage:!0},u={clientX:r.offsetLeft,isImage:!0};this.parent.notify(xn,{id:e.id}),this.parent.notify(Yt,d),this.parent.notify(Xt,u),o=!0,i=d.clientY,n=u.clientX,t=this.parent.sheets[this.parent.activeSheetIndex]}else{this.parent.notify(xn,{id:e.id});var g=e.range&&e.range.indexOf("!")>0?ee(this.parent,e.range.split("!")[0]):this.parent.activeSheetIndex,y=A(e.range?e.range.indexOf("!")>0?e.range.split("!")[1]:e.range.split("!")[0]:this.parent.getActiveSheet().selectedRange);i=y[0],n=y[1],t=this.parent.sheets[g]}var C=E(i,n,t);C&&(a=C.chart);var b=a?a.length:null;for(h=0;h<b;h++)e.id===a[h].id+"_overlay"&&a.splice(h,1);o&&(document.getElementById(e.id).remove(),this.parent.notify(Lr,{})),ce(i,n,t,{chart:a},!0),c.posRange=j(i,n),e.isUndoRedo||this.parent.notify(Z,{eventArgs:c,action:"deleteChart"})}},s.prototype.updateChartModel=function(e,r,t,i,n){var a=r,o=this.parent.chartColl[i].id;if(!(n&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1))for(var l=0,h=t.chart.length;l<h;l++)if(t.chart[l].id===o)switch(e){case"PHAxes":case"PHAxisTitle":(0,f.le)(t.chart[l].primaryXAxis)&&(t.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),"PHAxes"===e?(t.chart[l].primaryXAxis.visible=r.primaryXAxis.visible,this.parent.chartColl[i].primaryXAxis.visible=r.primaryXAxis.visible):"PHAxisTitle"===e&&(t.chart[l].primaryXAxis.title=r.primaryXAxis.title,this.parent.chartColl[i].primaryXAxis.title=r.primaryXAxis.title);break;case"PVAxes":case"PVAxisTitle":(0,f.le)(t.chart[l].primaryYAxis)&&(t.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),"PVAxes"===e?(t.chart[l].primaryYAxis.visible=r.primaryYAxis.visible,this.parent.chartColl[i].primaryYAxis.visible=r.primaryYAxis.visible):"PVAxisTitle"===e&&(t.chart[l].primaryYAxis.title=r.primaryYAxis.title,this.parent.chartColl[i].primaryYAxis.title=r.primaryYAxis.title);break;case"ChartTitleNone":case"ChartTitleAbove":t.chart[l].title=r.title,this.parent.chartColl[i].title=r.title;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if((0,f.le)(t.chart[l].dataLabelSettings)&&(t.chart[l].dataLabelSettings={},this.parent.chartColl[i].dataLabelSettings={}),"DLNone"===e)t.chart[l].dataLabelSettings.visible=!1,this.parent.chartColl[i].dataLabelSettings.visible=!1;else{t.chart[l].dataLabelSettings.visible=!0,this.parent.chartColl[i].dataLabelSettings.visible=!0;var p;t.chart[l].dataLabelSettings.position=p=n?"Outside"===a.series[0].dataLabel.position?"Outer":"Middle":r.series[0].marker.dataLabel.position,this.parent.chartColl[i].dataLabelSettings.position=p}break;case"GLMajorHorizontal":(0,f.le)(t.chart[l].primaryYAxis)&&(t.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),(0,f.le)(t.chart[l].primaryYAxis.majorGridLines)&&(t.chart[l].primaryYAxis.majorGridLines={},this.parent.chartColl[i].primaryYAxis.majorGridLines={}),t.chart[l].primaryYAxis.majorGridLines.width=r.primaryYAxis.majorGridLines.width,this.parent.chartColl[i].primaryYAxis.majorGridLines.width=r.primaryYAxis.majorGridLines.width;break;case"GLMajorVertical":(0,f.le)(t.chart[l].primaryXAxis)&&(t.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),(0,f.le)(t.chart[l].primaryXAxis.majorGridLines)&&(t.chart[l].primaryXAxis.majorGridLines={},this.parent.chartColl[i].primaryXAxis.majorGridLines={}),t.chart[l].primaryXAxis.majorGridLines.width=r.primaryXAxis.majorGridLines.width,this.parent.chartColl[i].primaryXAxis.majorGridLines.width=r.primaryXAxis.majorGridLines.width;break;case"GLMinorHorizontal":(0,f.le)(t.chart[l].primaryYAxis)&&(t.chart[l].primaryYAxis={},this.parent.chartColl[i].primaryYAxis={}),(0,f.le)(t.chart[l].primaryYAxis.minorGridLines)&&(t.chart[l].primaryYAxis.minorGridLines={},this.parent.chartColl[i].primaryYAxis.minorGridLines={}),t.chart[l].primaryYAxis.minorGridLines.width=r.primaryYAxis.minorGridLines.width,this.parent.chartColl[i].primaryYAxis.minorGridLines.width=r.primaryYAxis.minorGridLines.width;break;case"GLMinorVertical":(0,f.le)(t.chart[l].primaryXAxis)&&(t.chart[l].primaryXAxis={},this.parent.chartColl[i].primaryXAxis={}),(0,f.le)(t.chart[l].primaryXAxis.minorGridLines)&&(t.chart[l].primaryXAxis.minorGridLines={},this.parent.chartColl[i].primaryXAxis.minorGridLines={}),t.chart[l].primaryXAxis.minorGridLines.width=r.primaryXAxis.minorGridLines.width,this.parent.chartColl[i].primaryXAxis.minorGridLines.width=r.primaryXAxis.minorGridLines.width;break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":if((0,f.le)(t.chart[l].legendSettings)&&(t.chart[l].legendSettings={},this.parent.chartColl[i].legendSettings={}),t.chart[l].legendSettings.visible=r.legendSettings.visible,this.parent.chartColl[i].legendSettings.visible=r.legendSettings.visible,"LegendNone"!==e){t.chart[l].legendSettings.position=r.legendSettings.position,this.parent.chartColl[i].legendSettings.position=r.legendSettings.position;break}}},s.prototype.updateChartElement=function(e,r,t,i,n,a,o,l){if(!(a&&["PHAxes","PVAxes","PHAxisTitle","PVAxisTitle","GLMajorHorizontal","GLMajorVertical","GLMinorHorizontal","GLMinorVertical"].indexOf(e)>-1)){var h;switch(e){case"PHAxes":r.primaryXAxis.visible=!r.primaryXAxis.visible;break;case"PVAxes":r.primaryYAxis.visible=!r.primaryYAxis.visible;break;case"PHAxisTitle":r.primaryXAxis.title=n;break;case"PVAxisTitle":r.primaryYAxis.title=n;break;case"ChartTitleNone":r.title="";break;case"ChartTitleAbove":r.title=n;break;case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":if(h=r.series,"DLNone"===e)for(var p=0,c=h.length;p<c;p++)a?h[p].dataLabel.visible=!1:h[p].marker.dataLabel.visible=!1;else for(p=0,c=h.length;p<c;p++)if(a){var d="DLOutsideend"===e?"Outside":"Inside";h[p].dataLabel.visible=!0,h[p].dataLabel.position=d}else d="DLCenter"===e?"Middle":"DLInsideend"===e?"Top":"DLInsidebase"===e?"Bottom":"DLOutsideend"===e?"Outer":h[0].marker.dataLabel.position,h[p].marker.dataLabel.visible=!0,h[p].marker.dataLabel.position=d;r.series=h,a&&r.refresh();break;case"GLMajorHorizontal":r.primaryYAxis.majorGridLines.width=0===r.primaryYAxis.majorGridLines.width?1:0;break;case"GLMajorVertical":r.primaryXAxis.majorGridLines.width=0===r.primaryXAxis.majorGridLines.width?1:0;break;case"GLMinorHorizontal":r.primaryYAxis.minorTicksPerInterval=0===r.primaryYAxis.minorGridLines.width?5:0,r.primaryYAxis.minorGridLines.width=0===r.primaryYAxis.minorGridLines.width?1:0;break;case"GLMinorVertical":r.primaryXAxis.minorTicksPerInterval=0===r.primaryXAxis.minorGridLines.width?5:0,r.primaryXAxis.minorGridLines.width=0===r.primaryXAxis.minorGridLines.width?1:0;break;case"LegendNone":r.legendSettings.visible=!1;break;case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":r.legendSettings.visible=!0,r.legendSettings.position="LegendsRight"===e?"Right":"LegendsLeft"===e?"Left":"LegendsBottom"===e?"Bottom":"LegendsTop"===e?"Top":r.legendSettings.position}this.updateChartModel(e,r,t,i,a),l&&this.parent.notify(Z,{action:"chartDesign",eventArgs:{addChartEle:e,id:r.element.id+"_overlay",title:n,address:o}})}},s.prototype.undoRedoForChartDesign=function(e){var r=document.getElementById(e.id);if(r){var t=this.getChartElement(r),i=(0,f.Xr)(t,"chart");(0,f.le)(i)&&(i=(0,f.Xr)(t,"accumulationchart"));for(var l,n=this.parent.getAddressInfo(e.address),a=E(n.indices[0],n.indices[1],_(this.parent,n.sheetIndex)),o=this.getChartCollectionId(t.id),h=e.addChartEle,p=e.title,c=0;c<e.beforeActionData.cellDetails[0].chart.length;c++)if(t.id===e.beforeActionData.cellDetails[0].chart[c].id){l=e.beforeActionData.cellDetails[0].chart[c];break}if(e.switchRowColumn)this.switchRowColumn(o,t.id,i,a);else if(e.chartTheme)this.switchChartTheme(o,t.id,e.isUndo?l.theme:e.chartTheme,i,a);else if(e.chartType)this.switchChartType(o,t.id,e.isUndo?l.type:e.chartType,i,a);else if(e.addChartEle){if(e.isUndo){var d=void 0;switch(h){case"DLNone":case"DLCenter":case"DLInsideend":case"DLInsidebase":case"DLOutsideend":h="Middle"===(d=l.dataLabelSettings&&l.dataLabelSettings.position)?"DLCenter":"Top"===d?"DLInsideend":"Bottom"===d?"DLInsidebase":"Outer"===d?"DLOutsideend":"DLNone";break;case"LegendNone":case"LegendsRight":case"LegendsLeft":case"LegendsBottom":case"LegendsTop":l.legendSettings&&!l.legendSettings.visible?d="LegendNone":h="Right"===(d=l.legendSettings&&l.legendSettings.position)?"LegendsRight":"Left"===d?"LegendsLeft":"Bottom"===d?"LegendsBottom":"Top"===d?"LegendsTop":"LegendsBottom";break;case"PVAxisTitle":p=l.primaryYAxis&&l.primaryYAxis.title;break;case"PHAxisTitle":p=l.primaryXAxis&&l.primaryXAxis.title;break;case"ChartTitleNone":case"ChartTitleAbove":p=l.title}}this.updateChartElement(h,i,a,o,p,null,e.address)}}},s.prototype.chartDesignTabHandler=function(e){var h,r=!1,t=this.parent.sheets[this.parent.activeSheetIndex],i=e.switchRowColumn,n=e.chartType,a=e.chartTheme,o=e.addChartEle,l=null,p=e.id?document.getElementById(e.id):document.querySelector(".e-datavisualization-chart.e-ss-overlay-active");if(p){var d,u,c="ChartTitleAbove"===o||"PHAxisTitle"===o||"PVAxisTitle"===o;if(t.frozenRows||t.frozenColumns){var v=p.getBoundingClientRect();d={clientY:v.top},u={clientX:v.left},v.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(d.target=this.parent.getColumnHeaderContent()),v.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(u.target=this.parent.getRowHeaderTable())}else d={clientY:p.offsetTop,isImage:!0},u={clientX:p.offsetLeft,isImage:!0};this.parent.notify(Yt,d),this.parent.notify(Xt,u);var g=E(d.clientY,u.clientX,t),m=t.name+"!"+j(d.clientY,u.clientX);if(e.triggerEvent&&(this.parent.notify(ue,{action:"chartDesign",eventArgs:y={switchRowColumn:e.switchRowColumn,chartType:e.chartType,chartTheme:e.chartTheme,addChartEle:e.addChartEle,id:p.id,address:m,cancel:!1}}),y.cancel))return;var y,C=this.getChartElement(p),b=C.getAttribute("id");if(h=this.getChartCollectionId(b),C&&(l=(0,f.Xr)(C,"chart"),(0,f.le)(l)&&(l=(0,f.Xr)(C,"accumulationchart"),r=!0)),i&&!r&&this.switchRowColumn(h,b,l,g),n&&this.switchChartType(h,b,n,l,g),a&&this.switchChartTheme(h,b,a,l,g),o)if(c&&!e.title){if(this.parent.element.getElementsByClassName("e-title-dlg").length>0)return;this.titleDlgHandler(o,l,g,h,r,m,e.triggerEvent)}else this.updateChartElement(o,l,g,h,e.title,r);e.triggerEvent&&!c&&this.parent.notify(Z,{action:"chartDesign",eventArgs:y={switchRowColumn:e.switchRowColumn,chartType:e.chartType,chartTheme:e.chartTheme,addChartEle:e.addChartEle,id:p.id,address:m}})}},s.prototype.switchRowColumn=function(e,r,t,i){this.parent.chartColl[e].isSeriesInRows=!!(0,f.le)(this.parent.chartColl[e].isSeriesInRows)||!this.parent.chartColl[e].isSeriesInRows;for(var n=0,a=i.chart.length;n<a;n++)i.chart[n].id===r&&(i.chart[n].isSeriesInRows=!!(0,f.le)(i.chart[n].isSeriesInRows)||!i.chart[n].isSeriesInRows);var o=this.initiateChartHandler({option:this.parent.chartColl[e],isRefresh:!0});t.series=o},s.prototype.switchChartTheme=function(e,r,t,i,n){this.parent.chartColl[e].theme=t;for(var a=0,o=n.chart.length;a<o;a++)n.chart[a].id===r&&(n.chart[a].theme=t);i.setProperties({theme:t,background:this.getThemeBgColor(t)},!0),i.refresh()},s.prototype.getThemeBgColor=function(e){var r;if(e.includes("Dark"))switch(e){case"MaterialDark":r="#383838";break;case"FabricDark":r="#242424";break;case"BootstrapDark":r="#1b1b1b";break;case"Bootstrap5Dark":r="#212529";break;case"TailwindDark":r="#1f2937";break;case"FluentDark":r="#1b1a19"}else r=e.includes("HighContrast")?"#000000":"#FFFFFF";return r},s.prototype.switchChartType=function(e,r,t,i,n){var a=this.parent.chartColl[e].type;this.parent.chartColl[e].type=t;for(var o=0,l=n.chart.length;o<l;o++)n.chart[o].id===r&&(n.chart[o].type=t);if("Pie"!==t&&"Doughnut"!==t)if("Pie"===a||"Doughnut"===a)this.changeCharType(e);else{o=0;for(var p=(h=i.series).length;o<p;o++)h[o].type=t;i.series=h,i.refresh()}else if("Pie"===a||"Doughnut"===a){var h;for(o=0,p=(h=i.series).length;o<p;o++)h[o].innerRadius="Pie"===t?"0%":"40%";i.series=h,i.refresh()}else this.changeCharType(e)},s.prototype.getChartElement=function(e){var r=e.querySelector(".e-chart");return(0,f.le)(r)&&(r=e.querySelector(".e-accumulationchart")),r},s.prototype.getChartCollectionId=function(e){for(var r,t=0,i=this.parent.chartColl.length;t<i;t++)e===this.parent.chartColl[t].id&&(r=t);return r},s.prototype.changeCharType=function(e){var r=document.getElementById(this.parent.chartColl[e].id),t=(0,f.oq)(r,".e-datavisualization-chart");t.remove(),this.parent.notify(Zr,{option:this.parent.chartColl[e],isInitCell:!1,triggerEvent:!1,isPaste:!1}),r=document.getElementById(this.parent.chartColl[e].id),(t=(0,f.oq)(r,".e-datavisualization-chart")).classList.contains("e-ss-overlay-active")||t.classList.add("e-ss-overlay-active")},s.prototype.titleDlgHandler=function(e,r,t,i,n,a,o){var l=this,h="";if(!n||"PHAxisTitle"!==e&&"PVAxisTitle"!==e){var p=this.parent.serviceLocator.getService(O),c=this.parent.serviceLocator.getService(ae);c.show({width:375,showCloseIcon:!0,isModal:!0,cssClass:"e-title-dlg",header:p.getConstant("chart_abovechart"===e?"ChartTitle":"PHAxisTitle"===e?"HorizontalAxisTitle":"VerticalAxisTitle"),target:document.querySelector(".e-control.e-spreadsheet"),beforeOpen:function(){c.dialogInstance.content=l.titleDlgContent(e,r),c.dialogInstance.dataBind(),l.parent.element.focus()},buttons:[{buttonModel:{content:p.getConstant("Ok"),isPrimary:!0,cssClass:"e-btn e-clearall-btn e-flat"},click:function(){var d=l.parent.element.querySelector(".e-title-dlg").getElementsByClassName("e-title-dlg-content")[0];h=d.getElementsByTagName("input")[0].value,c.hide(),l.updateChartElement(e,r,t,i,h,null,a,o)}}]}),c.dialogInstance.refresh()}},s.prototype.titleDlgContent=function(e,r){var i=this.parent.serviceLocator.getService(O).getConstant("EnterTitle"),n=this.parent.createElement("div",{className:"e-title-dlg-content"}),a=this.parent.createElement("span",{className:"e-header e-top-header",innerHTML:i}),o=this.parent.createElement("input",{className:"e-input",id:"titleInput",attrs:{type:"text"}});return n.appendChild(a),n.appendChild(o),r&&(o.value="PHAxisTitle"===e?r.primaryXAxis.title?r.primaryXAxis.title:o.value:"PVAxisTitle"===e?r.primaryYAxis.title?r.primaryYAxis.title:o.value:r.title?r.title:o.value),n},s.prototype.removeEventListener=function(){this.parent.isDestroyed||(this.parent.off(Zr,this.initiateChartHandler),this.parent.off(hi,this.refreshChartCellObj),this.parent.off(so,this.updateChartHandler),this.parent.off(Dr,this.deleteChart),this.parent.off(ns,this.clearBorder),this.parent.off(as,this.insertChartHandler),this.parent.off(ci,this.chartRangeHandler),this.parent.off(Or,this.chartDesignTabHandler),this.parent.off(Ll,this.updateChartElement),this.parent.off(os,this.undoRedoForChartDesign))},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null;var e=null;this.chart&&(e=this.chart.element,this.chart.destroy()),e&&(0,f.og)(e),this.chart=null},s.prototype.getModuleName=function(){return"spreadsheetChart"},s}(),dh=function(){var s=function(e,r){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(e,r)};return function(e,r){function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),sl=function(s,e,r,t){var a,i=arguments.length,n=i<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(s,e,r,t);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);return i>3&&n&&Object.defineProperty(e,r,n),n},Ap=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return dh(e,s),sl([(0,f.Z9)(!1)],e.prototype,"isFinite",void 0),sl([(0,f.Z9)(!0)],e.prototype,"enableVirtualization",void 0),e}(f.rt),Dp=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return dh(e,s),sl([(0,f.Z9)("Multiple")],e.prototype,"mode",void 0),e}(f.rt),fh="e-wraptext",O="spreadsheetLocale",ae="dialog",ll="shape",Op={Custom:["#ffffff","#000000","#e7e6e6","#44546a","#4472c4","#ed7d31","#a5a5a5","#ffc000","#70ad47","#ff0000","#f2f2f2","#808080","#cfcdcd","#d5dce4","#d9e2f3","#fbe4d5","#ededed","#fff2cc","#e2efd9","#ffcccc","#d9d9d9","#595959","#aeaaaa","#acb9ca","#b4c6e7","#f7caac","#dbdbdb","#ffe599","#c5e0b3","#ff8080","#bfbfbf","#404040","#747070","#8496b0","#8eaadb","#f4b083","#c9c9c9","#ffd966","#a8d08d","#ff3333","#a6a6a6","#262626","#3b3838","#323e4f","#2f5496","#c45911","#7b7b7b","#bf8f00","#538135","#b30000","#7f7f7f","#0d0d0d","#161616","#212934","#1f3763","#823b0b","#525252","#7f5f00","#375623","#660000"]},Np={Custom:["#ffffff","#000000","#ffff00","#00ff00","#00ffff","#0000ff","#ff0000","#000080","#800080","#996633","#f2f2f2","#808080","#ffffcc","#b3ffb3","#ccffff","#ccccff","#ffcccc","#ccccff","#ff80ff","#f2e6d9","#d9d9d9","#595959","#ffff80","#80ff80","#b3ffff","#8080ff","#ff8080","#8080ff","#ff00ff","#dfbf9f","#bfbfbf","#404040","#ffff33","#33ff33","#33ffff","#3333ff","#ff3333","#0000b3","#b300b3","#c68c53","#a6a6a6","#262626","#e6e600","#00b300","#009999","#000099","#b30000","#000066","#660066","#86592d","#7f7f7f","#0d0d0d","#999900","#006600","#006666","#000066","#660000","#00004d","#4d004d","#734d26"]},mt={UP:38,DOWN:40,LEFT:37,RIGHT:39,FIRSTALPHABET:65,LASTALPHABET:90,SPACE:32,BACKSPACE:8,TAB:9,DELETE:46,ENTER:13,ESC:27},Mp={FindValue:"Find value",ReplaceValue:"Replace value",FindReplaceTooltip:"Find & Replace",InsertingEmptyValue:"Reference value is not valid.",ReplaceAllEnd:" matches replaced with ",ByRow:"By Rows",ByColumn:"By Columns",MatchCase:"Match case   ",MatchExactCellElements:"Match exact cell contents",Replace:"Replace...",Find:"Find and Replace...",Goto:"Goto...",EntercellAddress:"Enter cell address",GotoSpecial:"GotoSpecial...",FindAndReplace:"Find and Replace",FindNextBtn:"Find Next",FindPreviousBtn:"Find Previous",ReplaceBtn:"Replace",ReplaceAllBtn:"Replace All",GotoHeader:"Go To",GotoSpecialHeader:"Go To Special",Sheet:"Sheet",Workbook:"Workbook",NoElements:"We couldn't find what you were looking for.",FindWhat:"Find what",ReplaceWith:"Replace with",Cut:"Cut",Copy:"Copy",Paste:"Paste",PasteSpecial:"Paste Special",Link:"Link",Spreadsheet:"Spreadsheet",SpreadsheetHyperlink:"SpreadsheetHyperlink",Hyperlink:"Hyperlink",EditHyperlink:"Edit Hyperlink",OpenHyperlink:"Open Hyperlink",RemoveHyperlink:"Remove Hyperlink",InvalidHyperlinkAlert:"The address of this site is not valid. Check the address and try again.",InsertLink:"Insert Link",EditLink:"Edit Link",All:"All",Values:"Values",Formats:"Formats",Bold:"Bold",Font:"Font",FontSize:"Font Size",Italic:"Italic",Underline:"Underline",Strikethrough:"Strikethrough",TextColor:"Text Color",FillColor:"Fill Color",HorizontalAlignment:"Horizontal Alignment",AlignLeft:"Align Left",AlignCenter:"Center",AlignRight:"Align Right",VerticalAlignment:"Vertical Alignment",AlignTop:"Align Top",AlignMiddle:"Align Middle",AlignBottom:"Align Bottom",WrapText:"Wrap Text",MergeCells:"Merge Cells",MergeAll:"Merge All",MergeHorizontally:"Merge Horizontally",MergeVertically:"Merge Vertically",Unmerge:"Unmerge",UnmergeCells:"Unmerge Cells",SelectMergeType:"Select Merge Type",MergeCellsAlert:"Merging cells will only preserve the top-leftmost(Uppermost) value. Merge anyway?",PasteMergeAlert:'We can"t do that to a merge cell.',Borders:"Borders",TopBorders:"Top Borders",LeftBorders:"Left Borders",RightBorders:"Right Borders",BottomBorders:"Bottom Borders",AllBorders:"All Borders",HorizontalBorders:"Horizontal Borders",VerticalBorders:"Vertical Borders",OutsideBorders:"Outside Borders",InsideBorders:"Inside Borders",NoBorders:"No Borders",BorderColor:"Border Color",BorderStyle:"Border Style",InsertFunction:"Insert Function",Insert:"Insert",Delete:"Delete",DuplicateSheet:"Duplicate",MoveRight:"Move Right",MoveLeft:"Move Left",Rename:"Rename",Hide:"Hide",FileName:"File Name",EnterName:"Enter Name",InvalidFileName:"File name contains invalid character.",PROPER:"Converts a text to proper case; first letter to uppercase and other letters to lowercase.",Unhide:"Unhide",NameBox:"Name Box",ShowHeaders:"Show Headers",HideHeaders:"Hide Headers",ShowGridLines:"Show Gridlines",ExtendValidation:"The selection contains some cells without data validation. Do you want to extend validation to these cells?",Yes:"Yes",No:"No",HideGridLines:"Hide Gridlines",FreezePanes:"Freeze Panes",FreezeRows:"Freeze Rows",FreezeColumns:"Freeze Columns",UnfreezePanes:"Unfreeze Panes",UnfreezeRows:"Unfreeze Rows",UnfreezeColumns:"Unfreeze Columns",AddSheet:"Add Sheet",ListAllSheets:"List All Sheets",FullScreen:"Full Screen",CollapseToolbar:"Collapse Toolbar",ExpandToolbar:"Expand Toolbar",CollapseFormulaBar:"Collapse Formula Bar",ExpandFormulaBar:"Expand Formula Bar",File:"File",Home:"Home",Formulas:"Formulas",View:"View",New:"New",Open:"Open",SaveAs:"Save As",Update:"Update",ExcelXlsx:"Microsoft Excel",ExcelXls:"Microsoft Excel 97-2003",CSV:"Comma-separated values",FormulaBar:"Formula Bar",Sort:"Sort",SortAscending:"Ascending",SortDescending:"Descending",CustomSort:"Custom Sort",AddColumn:"Add Column",ContainsHeader:"Data contains header",CaseSensitive:"Case sensitive",SortBy:"Sort by",ThenBy:"Then by",SelectAColumn:"Select a column",SortEmptyFieldError:"Sort criteria column should not be empty.",SortDuplicateFieldError:" is mentioned more than once. Duplicate columns must be removed.",SortOutOfRangeError:"Select a cell or range inside the used range and try again.",MultiRangeSortError:"This can't be done on a multiple range selection. Select a single range and try again.",SortAndFilter:"Sort & Filter",Filter:"Filter",ClearAllFilter:"Clear",ClearFilterFrom:"Clear Filter From ",ReapplyFilter:"Reapply",FilterCellValue:"Filter by Value of Selected Cell",FilterOutOfRangeError:"Select a cell or range inside the used range and try again.",HideRow:"Hide Row",HideRows:"Hide Rows",UnHideRows:"UnHide Rows",HideColumn:"Hide Column",HideColumns:"Hide Columns",UnHideColumns:"UnHide Columns",InsertRow:"Insert Row",InsertRows:"Insert Rows",Above:"Above",Below:"Below",InsertColumn:"Insert Column",InsertColumns:"Insert Columns",Before:"Before",After:"After",DeleteRow:"Delete Row",DeleteRows:"Delete Rows",DeleteColumn:"Delete Column",DeleteColumns:"Delete Columns",Ok:"OK",Close:"Close",Cancel:"Cancel",Apply:"Apply",MoreColors:"More Colors",StandardColors:"Standard Colors",General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",Time:"Time",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",Custom:"Custom",MobileFormulaBarPlaceHolder:"Enter value or Formula",NumberFormat:"Number Format",PasteAlert:"You can't paste this here, because the copy area and paste area aren't in the same size. Please try pasting in a different range.",DestroyAlert:"Are you sure you want to destroy the current workbook without saving and create a new workbook?",SheetRenameInvalidAlert:"Sheet name contains invalid character.",SheetRenameEmptyAlert:"Sheet name cannot be empty.",SheetRenameAlreadyExistsAlert:"Sheet name already exists. Please enter another name.",DeleteSheetAlert:"You can't undo deleting sheets, and you might be removing some data. If you don't need it, click OK to delete.",DeleteSingleLastSheetAlert:"A Workbook must contain at least one visible worksheet.",PickACategory:"Pick a category",Description:"Description",UnsupportedFile:"Unsupported File",DataLimitExceeded:"File data is too large and it takes more time to process, do you want to continue?",FileSizeLimitExceeded:"File size is too large and it takes more time to process, do you want to continue?",InvalidUrl:"Invalid URL",SUM:"Adds a series of numbers and/or cells.",SUMIF:"Adds the cells based on specified condition.",SUMIFS:"Adds the cells based on specified conditions.",ABS:"Returns the value of a number without its sign.",RAND:"Returns a random number between 0 and 1.",RANDBETWEEN:"Returns a random integer based on specified values.",FLOOR:"Rounds a number down to the nearest multiple of a given factor.",CEILING:"Rounds a number up to the nearest multiple of a given factor.",PRODUCT:"Multiplies a series of numbers and/or cells.",INT:"Returns a number to the nearest integer.",ROUNDUP:"Rounds a number away from zero.",SUMPRODUCT:"Returns sum of the product of given ranges of arrays.",SORT:"Sorts a range of an array",T:"Checks whether a value is text or not and returns the text.",EXACT:"Checks whether a two text strings are exactly same and returns TRUE or FALSE.",LEN:"Returns a number of characters in a given string.",MOD:"Returns a remainder after a number is divided by divisor.",ODD:"Rounds a positive number up and negative number down to the nearest odd integer.",PI:"Returns the value of pi.",COUNTBLANK:"Returns the number of empty cells in a specified range of cells.",EVEN:"Rounds a positive number up and negative number down to the nearest even integer.",DECIMAL:"Converts a text representation of a number in a given base into a decimal number.",DEGREES:"Converts radians to degrees.",ADDRESS:"Returns a cell reference as text, given specified row and column numbers.",TIME:"Converts hours, minutes, seconds to the time formatted text.",CHAR:"Returns the character from the specified number.",CODE:"Returns the numeric code for the first character in a given string.",DOLLAR:"Converts the number to currency formatted text.",SMALL:"Returns the k-th smallest value in a given array.",LARGE:"Returns the k-th largest value in a given array.",FACT:"Returns the factorial of a number.",MEDIAN:"Returns the median of the given set of numbers.",EDATE:"Returns a date with given number of months before or after the specified date.",DATEVALUE:"Converts a date string into date value.",HOUR:"Returns the number of hours in a specified time string.",SECOND:"Returns the number of seconds in a specified time string.",MINUTE:"Returns the number of minutes in a specified time string.",NOW:"Returns the current date and time.",MONTH:"Returns the number of months in a specified date string.",TODAY:"Returns the current date as date value.",WEEKDAY:"Returns the day of the week corresponding to a date.",AVERAGE:"Calculates average for the series of numbers and/or cells excluding text.",AVERAGEIF:"Calculates average for the cells based on specified criterion.",AVERAGEIFS:"Calculates average for the cells based on specified conditions.",AVERAGEA:"Calculates the average for the cells evaluating TRUE as 1, text and FALSE as 0.",COUNT:"Counts the cells that contain numeric values in a range.",COUNTIF:"Counts the cells based on specified condition.",COUNTIFS:"Counts the cells based on specified conditions.",COUNTA:"Counts the cells that contains values in a range.",MIN:"Returns the smallest number of the given arguments.",MAX:"Returns the largest number of the given arguments.",DATE:"Returns the date based on given year, month, and day.",DAY:"Returns the day from the given date.",DAYS:"Returns the number of days between two dates.",IF:"Returns value based on the given expression.",IFS:"Returns value based on the given multiple expressions.",CalculateAND:"Returns TRUE if all the arguments are TRUE, otherwise returns FALSE.",CalculateOR:"Returns TRUE if any of the arguments are TRUE, otherwise returns FALSE.",IFERROR:"Returns value if no error found else it will return specified value.",CHOOSE:"Returns a value from list of values, based on index number.",INDEX:"Returns a value of the cell in a given range based on row and column number.",FIND:"Returns the position of a string within another string, which is case sensitive",TEXT:"Converts a value to text in specified number format.",CONCATENATE:"Combines two or more strings together.",CONCAT:"Concatenates a list or a range of text strings.",SUBTOTAL:"Returns subtotal for a range using the given function number.",RADIANS:"Converts degrees into radians.",MATCH:"Returns the relative position of a specified value in given range.",LN:"Returns the natural logarithm of a number.",INTERCEPT:"Calculates the point of the Y-intercept line via linear regression.",UNIQUE:"Returns a unique values from a range or array",SLOPE:"Returns the slope of the line from linear regression of the data points.",DefineNameExists:"This name already exists, try different name.",DefineNameInValid:"The name that you entered is not valid.",CircularReference:"When a formula refers to one or more circular references, this may result in an incorrect calculation.",ShowRowsWhere:"Show rows where:",OR:"OR",AND:"AND",CustomFilterDatePlaceHolder:"Choose a date",CustomFilterPlaceHolder:"Enter the value",CustomFilter:"Custom Filter",Between:"Between",DateTimeFilter:"DateTime Filters",Undo:"Undo",Redo:"Redo",DateFilter:"Date Filters",TextFilter:"Text Filters",NumberFilter:"Number Filters",ClearFilter:"Clear Filter",NoResult:"No Matches Found",FilterFalse:"False",FilterTrue:"True",Blanks:"Blanks",SelectAll:"Select All",GreaterThanOrEqual:"Greater Than Or Equal",GreaterThan:"Greater Than",LessThanOrEqual:"Less Than Or Equal",LessThan:"Less Than",NotEqual:"Not Equal",Equal:"Equal",Contains:"Contains",EndsWith:"Ends With",StartsWith:"Starts With",ClearButton:"Clear",FilterButton:"Filter",CancelButton:"Cancel",OKButton:"OK",Search:"Search",ProtectSheet:"Protect Sheet",UnprotectSheet:"Unprotect Sheet",LockCells:"Lock Cells",SelectCells:"Select Locked cells",SelectUnLockedCells:"Select Unlocked Cells",FormatCells:"Format cells",FormatRows:"Format rows",FormatColumns:"Format columns",InsertLinks:"Insert links",ProtectContent:"Protect the contents of locked cells",ProtectAllowUser:" Allow all users of this worksheet to:",EditAlert:"The cell you're trying to change is protected. To make change, unprotect the sheet.",SearchWithin:"Search within",SearchBy:"Search by",Reference:"Reference",DataValidation:"Data Validation",CLEARALL:"Clear All",APPLY:"Apply",CellRange:"Cell Range",Allow:"Allow",Data:"Data",Minimum:"Minimum",Maximum:"Maximum",IgnoreBlank:"Ignore blank",WholeNumber:"Whole Number",Decimal:"Decimal",Date:"Date",TextLength:"Text Length",List:"List",NotBetween:"Not between",EqualTo:"Equal to",NotEqualTo:"Not equal to",Greaterthan:"Greater than",Lessthan:"Less than",GreaterThanOrEqualTo:"Greater than or equal to",LessThanOrEqualTo:"Less than or equal to",InCellDropDown:"In-cell-dropdown",Sources:"Sources",Value:"Value",Retry:"Retry",EnterValue:"Enter value",DialogError:"The list source must be a reference to single row or column.",MinMaxError:"The Maximum must be greater than or equal to the Minimum.",MoreValidation:"This selection contains more than one validation. \n Erase current settings and continue?",FileNameError:"A file name can't contain characters like \\ / : * ? \" < > [ ] |",ListLengthError:"The list values allows only upto 256 charcters",ValidationError:"This value doesn't match the data validation restrictions defined for the cell.",EmptyError:"You must enter a value",ClearHighlight:"Clear Highlight",HighlightInvalidData:"Highlight Invalid Data",ClearValidation:"Clear Validation",HighlightCellsRules:"Highlight Cells Rules",CFEqualTo:"Equal To",TextThatContains:"Text that Contains",Save:"Save",EmptyFileName:"File name cannot be empty.",LargeName:"The name is too long.",ADateOccuring:"A Date Occuring",DuplicateValues:"Duplicate Values",TopBottomRules:"Top/Bottom Rules",Top10Items:"Top 10 Items",Top10:"Top 10",Bottom10Items:"Bottom 10 Items",Bottom10:"Bottom 10",AboveAverage:"Above Average",BelowAverage:"Below Average",FormatCellsGreaterThan:"Format cells that are GREATER THAN:",FormatCellsLessThan:"Format cells that are LESS THAN:",FormatCellsBetween:"Format cells that are BETWEEN:",FormatCellsEqualTo:"Format cells that are EQUAL TO:",FormatCellsThatContainTheText:"Format cells that contain the text:",FormatCellsThatContainADateOccurring:"Format cells that contain a date occurring:",FormatCellsDuplicate:"Format cells that contain:",FormatCellsTop:"Format cells that rank in the TOP:",FormatCellsBottom:"Format cells that rank in the BOTTOM:",FormatCellsAbove:"Format cells that are ABOVE AVERAGE:",FormatCellsBelow:"Format cells that are BELOW AVERAGE:",With:"with",DataBars:"Data Bars",ColorScales:"Color Scales",IconSets:"Icon Sets",ClearRules:"Clear Rules",SelectedCells:"Clear Rules from Selected Cells",EntireSheet:"Clear Rules from Entire Sheet",ISNUMBER:"Returns true when the value parses as a numeric value.",ROUND:"Rounds a number to a specified number of digits.",GEOMEAN:"Returns the geometric mean of an array or range of positive data.",POWER:"Returns the result of a number raised to power",LOG:"Returns the logarithm of a number to the base that you specify.",TRUNC:"Returns the truncated value of a number to a specified number of decimal places.",EXP:"Returns e raised to the power of the given number.",Clear:"Clear",ClearContents:"Clear Contents",ClearAll:"Clear All",ClearFormats:"Clear Formats",ClearHyperlinks:"Clear Hyperlinks",LightRedFillWithDarkRedText:"Light Red Fill with Dark Red Text",YellowFillWithDarkYellowText:"Yellow Fill with Dark Yellow Text",GreenFillWithDarkGreenText:"Green Fill with Dark Green Text",RedFill:"Red Fill",RedText:"Red Text",Duplicate:"Duplicate",Unique:"Unique",And:"and",WebPage:"WEB PAGE",ThisDocument:"THIS DOCUMENT",DisplayText:"Display Text",Url:"URL",CellReference:"Cell Reference",DefinedNames:"Defined Names",EnterTheTextToDisplay:"Enter the text to display",EnterTheUrl:"Enter the URL",Image:"Image",ConditionalFormatting:"Conditional Formatting",BlueDataBar:"Blue Data Bar",GreenDataBar:"Green Data Bar",RedDataBar:"Red Data Bar",OrangeDataBar:"Orange Data Bar",LightblueDataBar:"Light blue Data Bar",PurpleDataBar:"Purple Data Bar",GYRColorScale:"Green - Yellow - Red Color Scale",RYGColorScale:"Red - Yellow - Green Color Scale",GWRColorScale:"Green - White - Red Color Scale",RWGColorScale:"Red - White - Green Color Scale",BWRColorScale:"Blue - White - Red Color Scale",RWBColorScale:"Red - White - Blue Color Scale",WRColorScale:"White - Red Color Scale",RWColorScale:"Red - White Color Scale",GWColorScale:"Green - White Color Scale",WGColorScale:"White - Green Color Scale",GYColorScale:"Green - Yellow Color Scale",YGColorScale:"Yellow - Green Color Scale",ThreeArrowsColor:"3 Arrows (Colored)",ThreeArrowsGray:"3 Arrows (Gray)",ThreeTriangles:"3 Triangles",FourArrowsColor:"4 Arrows (Gray)",FourArrowsGray:"4 Arrows (Colored)",FiveArrowsColor:"5 Arrows (Gray)",FiveArrowsGray:"5 Arrows (Colored)",ThreeTrafficLights1:"3 Traffic Lights (Unrimmed)",ThreeTrafficLights2:"3 Traffic Lights (Rimmed)",ThreeSigns:"3 Signs",FourTrafficLights:"4 Traffic Lights",RedToBlack:"Red To Black",ThreeSymbols1:"3 Symbols (Circled)",ThreeSymbols2:"3 Symbols (Uncircled)",ThreeFlags:"3 Flags",ThreeStars:"3 Stars",FourRatings:"4 Ratings",FiveQuarters:"5 Quarters",FiveRatings:"5 Ratings",FiveBoxes:"5 Boxes",Chart:"Chart",Column:"Column",Bar:"Bar",Area:"Area",Pie:"Pie",Doughnut:"Doughnut",PieAndDoughnut:"Pie/Doughnut",Line:"Line",Radar:"Radar",Scatter:"Scatter",ChartDesign:"Chart Design",ClusteredColumn:"Clustered Column",StackedColumn:"Stacked Column",StackedColumn100:"100% Stacked Column",ClusteredBar:"Clustered Bar",StackedBar:"Stacked Bar",StackedBar100:"100% Stacked Bar",StackedArea:"Stacked Area",StackedArea100:"100% Stacked Area",StackedLine:"Stacked Line",StackedLine100:"100% Stacked Line",AddChartElement:"Add Chart Element",Axes:"Axes",AxisTitle:"Axis Title",ChartTitle:"Chart Title",DataLabels:"Data Labels",Gridlines:"Gridlines",Legends:"Legends",PrimaryHorizontal:"Primary Horizontal",PrimaryVertical:"Primary Vertical",None:"None",AboveChart:"Above Chart",Center:"Center",InsideEnd:"Inside End",InsideBase:"Inside Base",OutsideEnd:"OutSide End",PrimaryMajorHorizontal:"Primary Major Horizontal",PrimaryMajorVertical:"Primary Major Vertical",PrimaryMinorHorizontal:"Primary Minor Horizontal",PrimaryMinorVertical:"Primary Minor Vertical",Right:"Right",Left:"Left",Bottom:"Bottom",Top:"Top",SwitchRowColumn:"Switch Row/Column",ChartTheme:"Chart Theme",ChartType:"Chart Type",Material:"Material",Fabric:"Fabric",Bootstrap:"Bootstrap",HighContrastLight:"HighContrast Light",MaterialDark:"Material Dark",FabricDark:"Fabric Dark",HighContrast:"HighContrast",BootstrapDark:"Bootstrap Dark",Bootstrap4:"Bootstrap4",Bootstrap5Dark:"Bootstrap5 Dark",Bootstrap5:"Bootstrap5",Tailwind:"Tailwind",TailwindDark:"Tailwind Dark",VerticalAxisTitle:"Vertical Axis Title",HorizontalAxisTitle:"Horizontal Axis Title",EnterTitle:"Enter Title",ProtectWorkbook:"Protect Workbook",Password:"Password (optional):",unProtectPassword:"Password",EnterThePassword:"Enter the password",ConfirmPassword:"Confirm Password",EnterTheConfirmPassword:"Re-enter your password",PasswordAlert:"Confirmation password is not identical",UnProtectWorkbook:"Unprotect Workbook",UnProtectPasswordAlert:"The password you supplied is not correct.",InCorrectPassword:"Unable to open the file or worksheet with the given password",PasswordAlertMsg:"Please enter the password",ConfirmPasswordAlertMsg:"Please enter the confirm password",IsProtected:"is protected",PDF:"PDF document",AutoFillMergeAlertMsg:"To do this, all the merged cells need to be the same size",FillSeries:"Fill Series",CopyCells:"Copy Cells",FillFormattingOnly:"Fill Formatting Only",FillWithoutFormatting:"Fill Without Formatting",CustomFormat:"Custom Number Formats",CustomFormatSample:"Type",UnProtectWorksheet:"Unprotect Sheet",ReEnterPassword:"Re-enter password to proceed",SheetPassword:"Password to unprotect sheet:",Fluent:"Fluent",FluentDark:"Fluent Dark"},Bp=function(){function s(e){this.colGroupWidth=30,this.parent=e,this.col=e.createElement("col"),this.rowRenderer=e.serviceLocator.getService("row"),this.cellRenderer=e.serviceLocator.getService("cell"),this.addEventListener()}return s.prototype.refreshSelectALLContent=function(){var e,r=this.parent.getActiveSheet();if(r.frozenColumns||r.frozenRows){var t=this.getSelectAllTable().querySelector("thead"),i=this.rowRenderer.render();t.appendChild(i),e=this.parent.createElement("th",{className:"e-select-all-cell"}),i.appendChild(e)}else(e=this.headerPanel.firstElementChild).classList.add("e-select-all-cell");e.appendChild(this.parent.createElement("button",{className:"e-selectall",id:this.parent.element.id+"_select_all",attrs:{"aria-label":this.parent.serviceLocator.getService(O).getConstant("SelectAll"),type:"button"}}))},s.prototype.updateLeftColGroup=function(e,r){e&&(this.colGroupWidth=e),r||(r=this.getRowHeaderPanel());var n,t=r.querySelector("table"),i=this.parent.getActiveSheet();if(e)t.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px";else{n=this.parent.createElement("colgroup");var a=this.col.cloneNode();a.style.width=this.colGroupWidth+"px",n.appendChild(a),t.insertBefore(n,t.querySelector("tbody"))}(i.frozenRows||i.frozenColumns)&&(t=this.getSelectAllTable(),e?t.querySelector("colgroup").firstElementChild.style.width=this.colGroupWidth+"px":t.insertBefore(n.cloneNode(!0),t.querySelector("thead"))),this.setPanelWidth(i,r),this.setPanelHeight(i)},s.prototype.setPanelWidth=function(e,r){var t=this.getScrollSize(!0),i=this.getRowHeaderWidth(e),n=this.parent.enableRtl?"right":"left";if(e.frozenColumns){var a=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-column")[0];a.style.height="calc(100% - "+t+"px)",a.style[n]=i-Ve(1)+"Px",a.style.display=""}this.setHeaderPanelWidth(this.getSelectAllContent(),i),this.getColHeaderPanel().style.width="calc(100% - "+i+"px)",this.getColHeaderPanel().style[n]=i+"px",this.setHeaderPanelWidth(r,i),this.getContentPanel().style.width="calc(100% - "+i+"px)",this.getContentPanel().style[n]=i+"px";var o=this.contentPanel.nextElementSibling?this.contentPanel.nextElementSibling:null;o&&(t?o.style.height=t+1+"px":(o.style.height="1px",o.style.borderTopWidth="0px"),(o=o.firstElementChild).style[n]=i+"px",o.style.width="calc(100% - "+i+"px)",f.AR.userAgent.indexOf("Mac OS")>-1&&"safari"===f.AR.info.name&&(o.style.height="7px",o.style.top="-7px"))},s.prototype.getScrollSize=function(e){var r=parseInt(this.headerPanel.style[this.parent.enableRtl?"margin-left":"margin-right"],10);return r?r+(e?1:0):0},s.prototype.setHeaderPanelWidth=function(e,r){[].slice.call(e.querySelectorAll("col.e-empty")).forEach(function(i){r+=parseInt(i.style.width,10)}),e.style.width=r+"px"},s.prototype.setPanelHeight=function(e){var r=this.getScrollSize(!0);if(e.frozenRows){var t=this.getColHeaderHeight(e);this.headerPanel.style.height=e.showHeaders||e.frozenColumns?"":t+"px",this.contentPanel.style.height="calc(100% - "+(t+r)+"px)";var i=document.getElementById(this.parent.element.id+"_sheet").getElementsByClassName("e-frozen-row")[0];i.style.width=f.AR.isDevice?"100%":"calc(100% - "+r+"px)",i.style.top=t-1-(e.showHeaders?1:0)+"px",i.style.display=""}else this.contentPanel.style.height="calc(100% - "+((e.showHeaders?Ve(31):0)+r)+"px)"},s.prototype.renderPanel=function(){this.contentPanel=this.parent.createElement("div",{className:"e-main-panel"});var e=this.parent.getActiveSheet(),r=this.parent.element.id;this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-row-header",id:r+"_row_header"})),this.initHeaderPanel(),this.parent.allowScrolling&&this.parent.scrollModule.setPadding();var t=document.getElementById(this.parent.element.id+"_sheet");e.frozenColumns&&t.classList.add("e-frozen-columns"),e.frozenRows&&t.classList.add("e-frozen-rows"),this.updateHideHeaders(e,t),e.showGridLines||t.classList.add("e-hide-gridlines");var i=this.contentPanel.appendChild(this.parent.createElement("div",{className:"e-sheet-content",id:r+"_main_content"}));this.parent.allowScrolling||(i.style.overflow="hidden"),e.frozenRows&&t.appendChild(this.parent.createElement("div",{className:"e-frozen-row",styles:"display: none"})),e.frozenColumns&&t.appendChild(this.parent.createElement("div",{className:"e-frozen-column",styles:"display: none"})),f.AR.userAgent.indexOf("Mac OS")>-1&&"safari"===f.AR.info.name&&t.classList.add("e-mac-safari")},s.prototype.initHeaderPanel=function(){var e=this.parent.element.id;this.headerPanel=this.parent.createElement("div",{className:"e-header-panel"}),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-selectall-container",id:e+"_selectall"})),this.headerPanel.appendChild(this.parent.createElement("div",{className:"e-column-header",id:e+"_col_header"}))},s.prototype.createHeaderTable=function(){var e=this.contentPanel.querySelector(".e-row-header"),r=this.parent.getActiveSheet();(r.frozenRows||r.frozenColumns)&&this.updateTable(r.frozenRows?["thead","tbody"]:["thead"],"selectall",this.headerPanel.querySelector(".e-selectall-container")),this.updateTable(r.frozenRows?["thead","tbody"]:["thead"],"colhdr",this.headerPanel.querySelector(".e-column-header")),this.updateTable(["tbody"],"rowhdr",e),this.updateLeftColGroup(null,e)},s.prototype.updateTable=function(e,r,t){var i=this,n=this.parent.createElement("table",{className:"e-table",attrs:{role:"grid"}});n.classList.add("e-"+r+"-table"),t.appendChild(n),e.forEach(function(a){n.appendChild(i.parent.createElement(a))})},s.prototype.renderTable=function(e){var t,i,n,r=this,a=this.parent.getActiveSheet(),o=document.createDocumentFragment();if(o.appendChild(this.headerPanel),o.appendChild(this.contentPanel),this.parent.allowScrolling){var l=this.parent.createElement("div",{className:"e-scrollbar"});l.appendChild(this.parent.createElement("div",{className:"e-scroller"})),o.appendChild(l)}this.createHeaderTable(),this.updateTable(["tbody"],"content",this.contentPanel.lastElementChild);var p,h=this.parent.createElement("colgroup"),c=this.contentPanel.querySelector(".e-sheet-content tbody");this.refreshSelectALLContent();var d=this.getSelectAllContent().querySelector("colgroup"),u=this.getRowHeaderPanel().querySelector("colgroup"),v=this.getSelectAllContent().querySelector("thead .e-header-row"),g=this.contentPanel.querySelector(".e-row-header tbody"),m=this.getSelectAllContent().querySelector("tbody"),y=this.headerPanel.querySelector(".e-column-header thead"),C=this.headerPanel.querySelector(".e-column-header tbody"),b=this.rowRenderer.render();y.appendChild(b),this.getColHeaderTable().insertBefore(h,y);var S=this.parent.frozenRowCount(a),w=this.parent.frozenColCount(a),x=U(a,w-1,!1,"columns");this.parent.notify(yo,{top:e.top,left:e.left});var k,I=a.colCount.toString(),F=a.colCount.toString(),T=e.top&&e.left?"RowColumn":e.top?"Row":e.left?"Column":"";this.parent.getColHeaderTable().setAttribute("aria-colcount",I),this.parent.getRowHeaderTable().setAttribute("aria-rowcount",F),(0,f.Y4)(this.parent.getContentTable(),{"aria-rowcount":F,"aria-colcount":I}),e.cells.forEach(function(R,D){if(((t=A(D))[1]===e.indexes[1]||!i)&&(n=r.rowRenderer.render(t[0],!0),w&&S&&t[1]<w&&t[0]<S?((k=m.querySelector(".e-empty"))?m.insertBefore(n,k):m.appendChild(n),i=n):w&&t[1]<w?(g.appendChild(n),i=n):(i=r.rowRenderer.render(t[0]),S&&t[0]<S?(k=C.querySelector(".e-empty"))?C.insertBefore(i,k):C.appendChild(i):c.appendChild(i),t[1]===e.indexes[1]&&(S&&t[0]<S?m.appendChild(n):g.appendChild(n))),t[1]===e.indexes[1]&&r.cellRenderer.renderRowHeader(t[0],n)),r.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:R,address:D,lastCell:t[1]===e.indexes[3],isHeightCheckNeeded:!0,row:i,hRow:n,pRow:i.previousSibling,pHRow:n.previousSibling,isRefreshing:e.isRefreshing,first:T?T.includes("Row")?t[0]===e.indexes[0]?"Row":T.includes("Column")&&t[1]===e.indexes[1]?"Column":"":t[1]===e.indexes[1]?"Column":"":""}),w&&t[1]===x&&(i=null),R&&R.format&&(Ji(R.format)||R.format.indexOf("*")>-1)&&r.parent.notify(ot,{cell:R,value:R.value,format:R.format,rowIndex:t[0],colIndex:t[1],td:r.parent.getCell(t[0],t[1])}),t[0]===e.indexes[0])if(w&&t[1]<w){p=r.updateCol(a,t[1],d);var N=u.querySelector(".e-empty");N?u.insertBefore(p.cloneNode(!0),N):u.appendChild(p.cloneNode(!0)),r.cellRenderer.renderColHeader(t[1],v)}else r.updateCol(a,t[1],h),r.cellRenderer.renderColHeader(t[1],b)}),this.parent[da]&&this.parent[Ol](),c.parentElement.insertBefore(h.cloneNode(!0),c),Pe(function(){if(r.parent){var R=r.parent.getMainContent(),D=document.getElementById(r.parent.element.id+"_sheet");if(D.childElementCount&&D.querySelector(".e-header-panel")!==r.headerPanel)for(var N=D.children,P=0;P<N.length;P++)!N[P].classList.contains("e-frozen-row")&&!N[P].classList.contains("e-frozen-column")&&!N[P].classList.contains("e-ss-overlay")&&D.removeChild(N[P]);if(D.appendChild(o),D.style.backgroundColor="",a.conditionalFormats&&a.conditionalFormats.length&&r.parent.notify(We,{indexes:e.indexes}),r.checkRowHeightChanged(e,a),e.top&&(R.parentElement.scrollTop=e.top),e.left&&(R.scrollLeft=e.left,r.parent.getColumnHeaderContent().scrollLeft=e.left),r.parent.notify(Ye,e),r.checkTableWidth(a),r.parent.notify(fe,{action:"renderEditor"}),!e.initLoad&&!r.parent.isOpen&&r.parent.hideSpinner(),Br(R,{busy:!1}),r.parent.trigger("dataBound",{}),r.parent.isEdit&&r.parent.notify(ts,null),e.initLoad){var M=!0;if(r.parent.scrollSettings.enableVirtualization)for(P=0;P<a.ranges.length;P++)if(a.ranges[P].info.count-1>r.parent.viewport.bottomIndex){M=!1;break}M?r.parent.isReact?setTimeout(function(){!r.parent||r.triggerCreatedEvent()}):r.triggerCreatedEvent():r.parent.isOpen||r.parent.hideSpinner()}}})},s.prototype.triggerCreatedEvent=function(){this.parent.isOpen||this.parent.hideSpinner(),this.parent.createdHandler&&(this.parent.createdHandler.observers?(this.parent[xt].observers=this.parent.createdHandler.observers,this.parent.isAngular&&this.parent.createdHandler.currentObservers&&(this.parent[xt].currentObservers=this.parent.createdHandler.currentObservers)):this.parent.setProperties({created:this.parent.createdHandler},!0),this.parent.createdHandler=void 0,this.parent.trigger(xt,null),this.parent.notify(ri,null))},s.prototype.checkRowHeightChanged=function(e,r){var t={top:e.top,left:e.left,sheet:r};this.parent.notify(ms,t),e.top!=t.top&&(this.parent.scrollModule&&this.parent.scrollModule.offset.top.idx&&t.top-e.top<le(r,this.parent.scrollModule.offset.top.idx)&&(this.parent.scrollModule.offset.top.size=t.top),e.top=t.top),e.left!=t.left&&(this.parent.scrollModule&&this.parent.scrollModule.offset.left.idx&&t.left-e.left<Te(r,this.parent.scrollModule.offset.left.idx)&&(this.parent.scrollModule.offset.left.size=t.left),e.left=t.left)},s.prototype.checkTableWidth=function(e){if(this.parent.scrollSettings.isFinite&&!this.parent.scrollSettings.enableVirtualization&&e.colCount-1===this.parent.viewport.rightIndex){var r=ge(e,this.parent.viewport.leftIndex+this.parent.frozenColCount(e),this.parent.viewport.rightIndex),t=this.getRowHeaderWidth(e),i=this.getScrollSize();r<this.contentPanel.getBoundingClientRect().width-t-i?(this.getContentPanel().style.width=r+"px",this.getColHeaderPanel().style.width=r+"px"):this.getContentPanel().style.width.includes("calc")||(this.getContentPanel().style.width="calc(100% - "+t+"px)",this.getColHeaderPanel().style.width="calc(100% - "+t+"px)")}},s.prototype.clearCFResult=function(e){if(e.conditionalFormats&&e.conditionalFormats.length)for(var r=e.conditionalFormats,t=0;t<r.length;t++)delete r[t].result},s.prototype.refreshColumnContent=function(e){var t,i,n,o,l,r=this,a=0,h=this.parent.getActiveSheet(),p=document.createDocumentFragment(),c=document.createDocumentFragment(),d=this.parent.element.querySelector(".e-sheet-content tbody"),u=this.parent.element.querySelector(".e-column-header tbody"),v=this.parent.element.querySelector(".e-sheet-content colgroup");v=v.cloneNode(),p.appendChild(v),d=p.appendChild(d.cloneNode(!0));var m,g=v.cloneNode();c.appendChild(g),m=this.parent.element.querySelector(".e-column-header thead");var y=(m=c.appendChild(m.cloneNode(!0))).querySelector("tr");y.innerHTML="";var C=this.parent.frozenRowCount(h),b=this.parent.frozenColCount(h);C&&(u=c.appendChild(u.cloneNode(!0)));var S=U(h,C-1,!1),w=this.parent.scrollSettings.enableVirtualization&&this.parent.viewport.topIndex!==U(h,0,!0);this.clearCFResult(h),e.cells.forEach(function(I,F){if((t=A(F))[0]===e.indexes[0]&&(l=r.updateCol(h,t[1],g),v.appendChild(l.cloneNode()),r.cellRenderer.renderColHeader(t[1],y)),t[1]-b===e.indexes[1]){if(!(i=t[0]<C?u.children[a]:d.children[a]))return;i.innerHTML="",a++}!i||(o=r.cellRenderer.render({colIdx:t[1],rowIdx:t[0],cell:I,address:F,row:i,pRow:i.previousSibling,first:e.skipUpdateOnFirst||t[1]!==e.indexes[1]?w&&t[0]===e.indexes[0]?"Row":"":"Column",isRefreshing:!0,checkCF:!0}),r.checkColMerge(t,e.indexes,o,I),C&&t[0]===S&&(a=0))});var x=function(){Ts(n=r.getColHeaderTable()),n.appendChild(c),Ts(n=r.getContentTable()),n.appendChild(p),r.parent.notify(Lt,{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),r.parent.isEdit&&r.parent.notify(si,{}),r.parent.allowChart&&r.parent.notify(ci,null),r.parent.isOpen||r.parent.hideSpinner(),Br(r.parent.getMainContent(),{busy:!1})};e.insertDelete?x():Pe(function(){return x()})},s.prototype.refreshRowContent=function(e){var t,i,n,l,r=this,a=this.colGroupWidth,o=this.parent.getActiveSheet(),h=document.createDocumentFragment(),p=this.parent.createElement("tbody"),c=document.createDocumentFragment(),d=p.cloneNode();c.appendChild(d),h.appendChild(p);var u=this.parent.frozenColCount(o),v=U(o,u-1,!1,"columns"),g=this.parent.scrollSettings.enableVirtualization&&this.parent.viewport.leftIndex!==U(o,0,!0,"columns");this.clearCFResult(o),e.cells.forEach(function(m,y){((t=A(y))[1]===e.indexes[1]||!i)&&(n=r.rowRenderer.render(t[0],!0),u&&t[1]<u?(d.appendChild(n),i=n):(t[1]===e.indexes[1]&&d.appendChild(n),i=r.rowRenderer.render(t[0]),p.appendChild(i)),t[1]===e.indexes[1]&&(r.cellRenderer.renderRowHeader(t[0],n),a=Jl(t[0]+1))),u&&(n=d.lastElementChild||n),l=r.cellRenderer.render({rowIdx:t[0],colIdx:t[1],cell:m,address:y,lastCell:t[1]===e.indexes[3],row:i,hRow:n,pRow:i.previousSibling,pHRow:n.previousSibling,isHeightCheckNeeded:!0,first:e.skipUpdateOnFirst||t[0]!==e.indexes[0]?g&&t[1]===e.indexes[1]?"Column":"":"Row",isRefreshing:!0,checkCF:!0}),r.checkRowMerge(t,e.indexes,l,m),u&&t[1]===v&&(i=null)}),this.colGroupWidth!==a&&this.updateLeftColGroup(a),this.contentPanel.querySelector(".e-row-header tbody")&&((0,f.og)(this.contentPanel.querySelector(".e-row-header tbody")),this.getRowHeaderTable().appendChild(c)),this.contentPanel.querySelector(".e-sheet-content tbody")&&((0,f.og)(this.contentPanel.querySelector(".e-sheet-content tbody")),this.getContentTable().appendChild(h)),this.parent.notify(Lt,{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.allowChart&&this.parent.notify(ci,{}),this.parent.isEdit&&this.parent.notify(si,null),this.parent.isOpen||this.parent.hideSpinner(),Br(this.parent.getMainContent(),{busy:!1})},s.prototype.updateCol=function(e,r,t){var i=this.col.cloneNode();if(i.style.width=(0,f.Ac)(Te(e,r,null,!0)),t){var n=t.querySelector(".e-empty");return n?t.insertBefore(i,n):t.appendChild(i)}return i},s.prototype.updateColContent=function(e){var r=this;Pe(function(){var t,i,n,a,l,g,I,o=0,h=r.parent.getActiveSheet(),p=r.parent.element.querySelector(".e-column-header .e-header-row"),c=p.firstElementChild,d=r.parent.element.querySelector(".e-sheet-content colgroup"),u=r.parent.element.querySelector(".e-column-header colgroup"),v=d.firstElementChild,m=u.firstElementChild,y=r.parent.element.querySelector(".e-sheet-content tbody"),C=r.parent.element.querySelector(".e-column-header tbody"),b=r.parent.frozenRowCount(h),S=r.parent.frozenColCount(h),w=U(h,b-1,!1),x=U(h,e.indexes[0],!0);r.clearCFResult(h),e.cells.forEach(function(F,T){if(!g){if(t=A(T),"first"===e.direction&&t[1]===e.indexes[1]&&r.checkColMerge([t[0],r.parent.viewport.leftIndex+S],e.indexes,((t[0]<b?C:y).rows[o]||{cells:[]}).cells[e.indexes[3]-e.indexes[1]+1],E(t[0],r.parent.viewport.leftIndex+S,h)||{}),t[0]===x&&("last"===e.direction?((l=r.col.cloneNode()).style.width=(0,f.Ac)(Te(h,t[1],null,!0)),d.insertBefore(l,v),u.insertBefore(l.cloneNode(),m),r.cellRenderer.renderColHeader(t[1],p,c)):(l=r.updateCol(h,t[1],d),u.appendChild(l.cloneNode()),r.cellRenderer.renderColHeader(t[1],p)),r.parent.scrollSettings.enableVirtualization&&e.direction&&((0,f.og)(d[e.direction+"ElementChild"]),(0,f.og)(u[e.direction+"ElementChild"]),(0,f.og)(p[e.direction+"ElementChild"]))),t[1]===e.indexes[1]){if(t[0]<b)i=C.children[o];else if(!(i=y.children[o]))return void(g=!0);o++,n=i.firstElementChild}I={colIdx:t[1],rowIdx:t[0],cell:F,address:T,row:i,lastCell:t[1]===e.indexes[3],isHeightCheckNeeded:"first"===e.direction,first:"last"!==e.direction||e.skipUpdateOnFirst||t[1]!==e.indexes[1]?"":"Column",checkNextBorder:"last"===e.direction&&t[3]===e.indexes[3]?"Column":"",isRefreshing:"first"===e.direction,checkCF:!0},"last"===e.direction?(I.refChild=n,a=r.cellRenderer.render(I),r.checkColMerge(t,e.indexes,a,F,((t[0]<b?C:y).rows[o-1]||{cells:[]}).cells[1])):a=r.cellRenderer.render(I),r.parent.scrollSettings.enableVirtualization&&e.direction&&(0,f.og)(i[e.direction+"ElementChild"]),b&&t[0]===w&&(o=0)}}),r.parent.notify(Lt,{refresh:"Column",prevRowColCnt:e.prevRowColCnt}),r.parent.allowChart&&r.parent.notify(ci,null),r.parent.isEdit&&r.parent.notify(si,{}),r.parent.isOpen||r.parent.hideSpinner(),Br(r.parent.getMainContent(),{busy:!1})})},s.prototype.updateRowContent=function(e){var i,n,a,d,r=this,t=this.colGroupWidth,o=this.parent.getActiveSheet(),l=0,h=this.parent.getMainContent().querySelector("tbody"),p=this.parent.getRowHeaderContent().querySelector("tbody"),c=document.createDocumentFragment(),u=document.createDocumentFragment();this.parent.showSpinner();var m,v=this.parent.frozenColCount(o),g=this.parent.frozenRowCount(o),y=U(o,e.indexes[1],!0,"columns");this.clearCFResult(o),e.cells.forEach(function(C,b){d=A(b),"first"===e.direction&&d[0]===e.indexes[0]&&(void 0===m&&(m=(d[1]<v?p:h).rows[e.indexes[2]-e.indexes[0]+1]||null),r.checkRowMerge([r.parent.viewport.topIndex+g,d[1]],e.indexes,(m||{cells:[]}).cells[d[1]<v?l+1:l],E(r.parent.viewport.topIndex+g,d[1],o)||{})),(d[1]===y||!i)&&(n=r.rowRenderer.render(d[0],!0),v&&d[1]<v?(c.appendChild(n),i=n):(i=r.rowRenderer.render(d[0]),u.appendChild(i),d[1]===y&&c.appendChild(n),r.parent.scrollSettings.enableVirtualization&&e.direction&&(0,f.og)(h[e.direction+"ElementChild"])),d[1]===y&&(r.cellRenderer.renderRowHeader(d[0],n),t=Jl(d[0]+1),r.parent.scrollSettings.enableVirtualization&&e.direction&&(0,f.og)(p[e.direction+"ElementChild"]))),v&&(n=c.lastElementChild||n),a=r.cellRenderer.render({colIdx:d[1],rowIdx:d[2],cell:C,address:b,lastCell:d[1]===e.indexes[3],row:i,pHRow:n.previousSibling,checkNextBorder:"last"===e.direction&&d[2]===e.indexes[2]?"Row":"",pRow:i.previousSibling,isHeightCheckNeeded:"first"===e.direction||""===e.direction,hRow:n,first:"last"!==e.direction||e.skipUpdateOnFirst||d[0]!==e.indexes[0]?"":"Row",isRefreshing:"first"===e.direction,checkCF:!0}),"last"===e.direction&&h.rows.length&&r.checkRowMerge(d,e.indexes,a,C,(d[1]<v?p:h).rows[0].cells[d[1]<v?l+1:l]),l++,v&&d[1]===v-1&&(i=null,m=void 0,l=0)}),this.colGroupWidth!==t&&this.updateLeftColGroup(t),"last"===e.direction?(p.insertBefore(c,p.firstElementChild),h.insertBefore(u,h.firstElementChild)):(p.appendChild(c),h.appendChild(u)),this.parent.scrollSettings.enableVirtualization&&this.parent.notify(Lt,{refresh:"Row",prevRowColCnt:e.prevRowColCnt}),this.parent.isEdit&&this.parent.notify(si,null),this.parent.allowChart&&this.parent.notify(ci,{}),this.parent.isOpen||this.parent.hideSpinner(),Br(this.parent.getMainContent(),{busy:!1})},s.prototype.checkRowMerge=function(e,r,t,i,n){if(this.parent.scrollSettings.enableVirtualization&&t&&(!(0,f.le)(i.rowSpan)||!(0,f.le)(i.colSpan))){var a=this.parent.frozenRowCount(this.parent.getActiveSheet());if(e[0]===this.parent.viewport.topIndex+a){if(i.rowSpan<0){var o={td:t,rowIdx:e[0],colIdx:e[1],isRow:!0,isFreezePane:!0};if(this.parent.notify(la,o),o.insideFreezePane)return;this.parent.viewport.topIndex+a>=r[0]&&this.refreshPrevMerge(r[0]+1,e[1])}n&&(n.colSpan>1||n.rowSpan>1)&&this.cellRenderer.refresh(e[0]+(r[2]-r[0])+1,e[1],null,n)}else if(i.rowSpan>1){var l=r[2]+1;e[0]+i.rowSpan-1>l&&e[0]<l&&this.refreshPrevMerge(l,e[1],this.parent.viewport.topIndex+a)}}},s.prototype.refreshPrevMerge=function(e,r,t){var i=this.parent.getCell(e,r,this.parent.getRow(t||0,null,r));i&&i.rowSpan>1&&this.cellRenderer.refresh(e,r,null,i)},s.prototype.checkColMerge=function(e,r,t,i,n){if(this.parent.scrollSettings.enableVirtualization&&t&&e[1]===this.parent.viewport.leftIndex+this.parent.frozenColCount(this.parent.getActiveSheet())&&(!(0,f.le)(i.rowSpan)||!(0,f.le)(i.colSpan))){if(i.colSpan<0){var a={td:t,colIdx:e[1],rowIdx:e[0],isFreezePane:!0};if(this.parent.notify(la,a),a.insideFreezePane)return}n&&(n.colSpan>1||n.rowSpan>1)&&this.cellRenderer.refresh(e[0],e[1]+(r[3]-r[1])+1,null,n)}},s.prototype.toggleGridlines=function(){var e=document.getElementById(this.parent.element.id+"_sheet");this.parent.getActiveSheet().showGridLines?e.classList.remove("e-hide-gridlines"):e.classList.add("e-hide-gridlines")},s.prototype.showHideHeaders=function(){var e=this,r=this.parent.getActiveSheet();Pe(function(){if(r.showHeaders){var t=e.getContentPanel();e.setPanelWidth(r,e.getRowHeaderPanel()),e.setPanelHeight(r),document.getElementById(e.parent.element.id+"_sheet").classList.remove("e-hide-headers"),e.getColHeaderPanel().scrollLeft=t.scrollLeft,e.parent.selectRange(r.selectedRange)}else{if(e.updateHideHeaders(r,document.getElementById(e.parent.element.id+"_sheet")),e.setPanelHeight(r),e.parent.frozenColCount(r)||e.parent.frozenRowCount(r))e.setPanelWidth(r,e.getRowHeaderPanel()),e.parent.selectRange(r.selectedRange);else{e.getContentPanel().style.width="";var i=e.parent.enableRtl?"right":"left";e.getContentPanel().style[i]=""}e.getScrollElement().style.left=e.getRowHeaderWidth(r)+"px"}})},s.prototype.updateHideHeaders=function(e,r){e.showHeaders||r.classList.add("e-hide-headers")},s.prototype.rowHeightChanged=function(e){if(e.threshold||e.isHideShow){var r=this.parent.getActiveSheet();e.rowIdx<this.parent.frozenRowCount(r)&&this.setPanelHeight(r)}},s.prototype.colWidthChanged=function(e){if(e.threshold||e.isHideShow){var r=this.parent.getActiveSheet();e.colIdx<this.parent.frozenColCount(r)&&this.setPanelWidth(r,this.getRowHeaderPanel()),this.checkTableWidth(r)}},s.prototype.getRowHeaderWidth=function(e,r){var t=0;if(!r&&e.frozenColumns){var i=B(e.topLeftCell)[1];t=ge(e,i,i+e.frozenColumns-1,!0)}return t+(e.showHeaders?Ve(this.colGroupWidth):0)},s.prototype.getColHeaderHeight=function(e,r){var t=B(e.topLeftCell)[0];return(e.showHeaders&&!r?Ve(31):0)+Ce(e,t,t+e.frozenRows-1,!0)},s.prototype.getSelectAllContent=function(){return this.headerPanel.getElementsByClassName("e-selectall-container")[0]},s.prototype.getScrollElement=function(){var e=this.contentPanel.parentElement||this.contentPanel.nextElementSibling;return e&&e.querySelector(".e-scroller")},s.prototype.getSelectAllTable=function(){return this.headerPanel.getElementsByClassName("e-selectall-table")[0]},s.prototype.getColHeaderTable=function(){return this.headerPanel.getElementsByClassName("e-colhdr-table")[0]},s.prototype.getRowHeaderTable=function(){return this.contentPanel.getElementsByClassName("e-rowhdr-table")[0]},s.prototype.getContentTable=function(){return this.contentPanel.getElementsByClassName("e-content-table")[0]},s.prototype.getRowHeaderPanel=function(){return this.contentPanel.getElementsByClassName("e-row-header")[0]},s.prototype.getColHeaderPanel=function(){return this.headerPanel.getElementsByClassName("e-column-header")[0]},s.prototype.getContentPanel=function(){return this.contentPanel.getElementsByClassName("e-sheet-content")[0]},s.prototype.addEventListener=function(){this.parent.on(xt,this.triggerCreatedEvent,this),this.parent.on(Xe,this.rowHeightChanged,this),this.parent.on($e,this.colWidthChanged,this),this.parent.on(rt,this.removeEventListener,this)},s.prototype.destroy=function(){this.headerPanel=null,this.contentPanel=null,this.col=null,this.rowRenderer=null,this.cellRenderer=null,this.colGroupWidth=null,this.parent=null},s.prototype.removeEventListener=function(){this.parent.off(xt,this.triggerCreatedEvent),this.parent.off(Xe,this.rowHeightChanged),this.parent.off($e,this.colWidthChanged),this.parent.off(rt,this.removeEventListener)},s}(),Hp=function(){function s(e){this.parent=e,this.element=this.parent.createElement("tr",{attrs:{role:"row"}}),this.cellRenderer=e.serviceLocator.getService("cell")}return s.prototype.render=function(e,r,t){var i=this.element.cloneNode();if(void 0===e)return i.classList.add("e-header-row"),i;i.classList.add("e-row");var n=this.parent.getActiveSheet();(0,f.Y4)(i,{"aria-rowindex":(e+1).toString()});var a=le(n,e,!0);return i.style.height=a+"px",a<20&&(i.style.lineHeight=a>0?a-1+"px":"0px"),r&&!t&&(a<20&&(i.style.lineHeight=a>=4?a-4+"px":a>0?a-1+"px":"0px",i.classList.contains("e-reach-fntsize")||i.classList.add("e-reach-fntsize")),ne(n,e+1)&&!ne(n,e-1)&&i.classList.add("e-hide-start"),0!==e&&ne(n,e-1)&&!ne(n,e+1)&&i.classList.add("e-hide-end")),i},s.prototype.refresh=function(e,r,t,i,n){var l,a=this,o=this.parent.getActiveSheet();if(i)l=this.render(e,i,n),this.cellRenderer.renderRowHeader(e,l);else{var h,p,c=function(){for(;h<=p;)we(o,h)||a.cellRenderer.render({colIdx:h,rowIdx:e,cell:E(e,h,o),address:j(e,h),lastCell:h===p,row:l,hRow:t,isHeightCheckNeeded:!0,pRow:r,first:e===a.parent.viewport.topIndex&&U(o,e,!0)!==U(o,0,!0)?"Row":""}),h++},d=this.parent.frozenColCount(o);d&&(l=t,h=B(o.topLeftCell)[0],p=d-1,c()),l=this.render(e,i,n),h=this.parent.viewport.leftIndex+d,p=this.parent.viewport.rightIndex,c()}return l},s.prototype.destroy=function(){this.parent=null,this.element=null},s}(),Pp=function(){function s(e){this.parent=e,this.element=this.parent.createElement("td"),this.th=this.parent.createElement("th",{className:"e-header-cell"}),this.tableRow=e.createElement("tr",{className:"e-row"}),this.parent.on(xl,this.updateView,this),this.parent.on("calculateFormula",this.calculateFormula,this)}return s.prototype.renderColHeader=function(e,r,t){var i=this.th.cloneNode(),n=_e(e+1);i.innerHTML=n;var a=this.parent.getActiveSheet();we(a,e+1)&&i.classList.add("e-hide-start"),0!==e&&we(a,e-1)&&i.classList.add("e-hide-end"),t?r.insertBefore(i,t):r.appendChild(i),this.parent.trigger("beforeCellRender",{cell:null,element:i,address:n,colIndex:e}),(0,f.Y4)(i,{role:"columnheader","aria-colindex":(e+1).toString(),tabindex:"-1"})},s.prototype.renderRowHeader=function(e,r,t){var i=this.element.cloneNode();(0,f.cn)([i],"e-header-cell"),(0,f.Y4)(i,{role:"rowheader",tabindex:"-1"}),i.innerHTML=(e+1).toString(),t?r.insertBefore(i,t):r.appendChild(i),this.parent.trigger("beforeCellRender",{cell:null,element:i,address:""+(e+1),rowIndex:e})},s.prototype.render=function(e){var r=this.parent.getActiveSheet();if(e.td=this.element.cloneNode(),e.td.className="e-cell",(0,f.Y4)(e.td,{role:"gridcell","aria-colindex":(e.colIdx+1).toString(),tabindex:"-1"}),this.checkMerged(e))return e.refChild?e.row.insertBefore(e.td,e.refChild):e.row.appendChild(e.td),e.td;e.isRefresh=!1,this.update(e),e.checkCF&&e.cell&&r.conditionalFormats&&r.conditionalFormats.length&&this.parent.notify(We,{indexes:[e.rowIdx,e.colIdx],cell:e.cell,ele:e.td,isRender:!0}),e.td.classList.contains("e-cell-template")||this.parent.notify(Ui,{td:e.td,rowIndex:e.rowIdx,colIndex:e.colIdx}),e.refChild?e.row.insertBefore(e.td,e.refChild):e.row.appendChild(e.td);var t={cell:e.cell,element:e.td,address:e.address,rowIndex:e.rowIdx,colIndex:e.colIdx,needHeightCheck:!1,row:e.row};if(this.parent.trigger("beforeCellRender",t),!r.rows[e.rowIdx]||!r.rows[e.rowIdx].customHeight){if(t.element&&t.element.children.length||t.needHeightCheck){var i=t.element.cloneNode(!0);i.style.width=Te(r,e.colIdx,!0)+"px",this.tableRow.appendChild(i)}if(e.lastCell&&this.tableRow.childElementCount||t.needHeightCheck){var n=e.row||this.parent.getRow(e.rowIdx),a=le(r,e.rowIdx),o=this.getRowHeightOnInit();if(o>a){var l=Ve(o);n.style.height=l+"px",(e.hRow||this.parent.getRow(e.rowIdx,this.parent.getRowHeaderTable())).style.height=l+"px",ui(r,e.rowIdx,o)}this.tableRow.innerHTML=""}}return this.setWrapByValue(r,e),t.element},s.prototype.setWrapByValue=function(e,r){r.cell&&!r.cell.wrap&&r.cell.value&&r.cell.value.toString().includes("\n")&&(ce(r.rowIdx,r.colIdx,e,{wrap:!0},!0),this.parent.notify(or,{range:[r.rowIdx,r.colIdx,r.rowIdx,r.colIdx],wrap:!0,initial:!0,sheet:e,td:r.td,row:r.row,hRow:r.hRow}))},s.prototype.update=function(e){var r=this.parent.getActiveSheet(),t=this.processTemplates(e.cell,e.rowIdx,e.colIdx);if(t&&("string"==typeof t?e.td.innerHTML=t:(Ts(e.td),e.td.appendChild(t)),e.td.classList.add("e-cell-template")),e.isRefresh){if(e.td.rowSpan&&(this.mergeFreezeRow(r,e.rowIdx,e.colIdx,e.td.rowSpan,e.row,!0),e.td.removeAttribute("rowSpan")),e.td.colSpan&&(this.mergeFreezeCol(r,e.rowIdx,e.colIdx,e.td.colSpan,!0),e.td.removeAttribute("colSpan")),this.checkMerged(e))return;if(e.cell&&!e.cell.hyperlink){var i=e.td.querySelector(".e-hyperlink");i&&(0,f.og)(i)}!e.cell&&e.td.classList.contains("e-wraptext")&&e.td.classList.remove("e-wraptext")}e.cell&&e.cell.formula&&this.calculateFormula(e);var n={value:e.cell&&e.cell.value,type:e.cell&&Ft(e.cell.format),format:e.cell&&e.cell.format,formattedText:e.cell&&e.cell.value,onLoad:!0,isRightAlign:!1,cell:e.cell,rowIndex:e.rowIdx,colIndex:e.colIdx,isRowFill:!1,td:e.td};e.cell&&this.parent.notify(ot,n),(0,f.Y4)(e.td,{"aria-label":(n.formattedText?n.formattedText+" ":"")+e.address}),this.parent.refreshNode(e.td,{type:n.type,result:n.formattedText,curSymbol:(0,f.o5)(this.parent.locale,"USD"),isRightAlign:n.isRightAlign,value:n.value||"",isRowFill:n.isRowFill});var a={};if(e.cell){if(e.cell.style&&(a=e.cell.style.properties?ks(e.cell.style,!0):e.cell.style),e.cell.chart&&e.cell.chart.length>0&&this.parent.notify(lr,{chart:e.cell.chart,isInitCell:!0,range:j(e.rowIdx,e.colIdx),isUndoRedo:!1}),e.cell.hyperlink&&this.parent.notify(qo,{cell:e.cell,style:a,td:e.td,rowIdx:e.rowIdx,colIdx:e.colIdx}),e.cell.rowSpan>1){var o=e.cell.rowSpan-this.parent.hiddenCount(e.rowIdx,e.rowIdx+(e.cell.rowSpan-1));o>1&&(e.td.rowSpan=o,this.mergeFreezeRow(r,e.rowIdx,e.colIdx,o,e.row))}if(e.cell.colSpan>1){var l=e.cell.colSpan-this.parent.hiddenCount(e.colIdx,e.colIdx+(e.cell.colSpan-1),"columns");l>1&&(e.td.colSpan=l,this.mergeFreezeCol(r,e.rowIdx,e.colIdx,l))}if(e.cell.image)for(var h=0;h<e.cell.image.length;h++)e.cell.image[h]&&this.parent.notify(Mt,{options:{src:e.cell.image[h].src,imageId:e.cell.image[h].id,height:e.cell.image[h].height,width:e.cell.image[h].width,top:e.cell.image[h].top,left:e.cell.image[h].left},range:z([e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]),isPublic:!1})}if(e.isRefresh&&this.removeStyle(e.td,e.rowIdx,e.colIdx),e.lastCell&&this.parent.chartColl&&this.parent.chartColl.length&&this.parent.notify(Kr,{cell:e.cell,rIdx:e.rowIdx,cIdx:e.colIdx,sheetIdx:this.parent.activeSheetIndex}),this.applyStyle(e,a),"Row"===e.checkNextBorder){var p=this.parent.getCellStyleValue(["borderTop"],[Number(this.parent.getContentTable().rows[0].getAttribute("aria-rowindex"))-1,e.colIdx]).borderTop;""!==p&&(!e.cell||!e.cell.style||!e.cell.style.bottomPriority)&&this.parent.notify(He,{style:{borderBottom:p},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}if("Column"===e.checkNextBorder){var c=this.parent.getCellStyleValue(["borderLeft"],[e.rowIdx,e.colIdx+1]).borderLeft;""!==c&&(!e.cell||!e.cell.style||!e.cell.style.borderRight&&!e.cell.style.border)&&this.parent.notify(He,{style:{borderRight:c},rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td})}e.cell&&e.cell.wrap&&this.parent.notify(or,{range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx],wrap:!0,sheet:r,initial:!0,td:e.td,row:e.row,hRow:e.hRow,isCustomHgt:!e.isRefresh&&le(r,e.rowIdx)>20});var d=e.cell&&e.cell.validation||r.columns&&r.columns[e.colIdx]&&r.columns[e.colIdx].validation;d&&d.isHighlighted&&this.parent.notify(Wr,{range:z([e.rowIdx,e.colIdx]),td:e.td}),e.cell&&e.cell.validation&&e.cell.validation.isHighlighted&&this.parent.notify(Wr,{range:z([e.rowIdx,e.colIdx]),td:e.td})},s.prototype.applyStyle=function(e,r){(Object.keys(r).length||Object.keys(this.parent.commonCellStyle).length||e.lastCell)&&this.parent.notify(He,{style:(0,f.l7)({},this.parent.commonCellStyle,r),rowIdx:e.rowIdx,colIdx:e.colIdx,cell:e.td,first:e.first,row:e.row,lastCell:e.lastCell,hRow:e.hRow,pRow:e.pRow,isHeightCheckNeeded:e.isHeightCheckNeeded,manualUpdate:e.manualUpdate,onActionUpdate:e.onActionUpdate})},s.prototype.calculateFormula=function(e){if(null!=e.cell.value){var r={action:"checkFormulaAdded",added:!0,address:e.address,sheetId:(void 0===e.sheetIndex?this.parent.getActiveSheet():_(this.parent,e.sheetIndex)).id.toString()};if(this.parent.notify(ie,r),r.added)return}else e.formulaRefresh&&(e.cell.value="");var t=pe(e.cell.formula);this.parent.notify(ie,{action:"refreshCalculate",value:e.cell.formula,rowIndex:e.rowIdx,colIndex:e.colIdx,isFormula:t,sheetIndex:e.sheetIndex,isRefreshing:e.isRefreshing}),e.cell.value=E(e.rowIdx,e.colIdx,(0,f.le)(e.sheetIndex)?this.parent.getActiveSheet():_(this.parent,e.sheetIndex)).value},s.prototype.checkMerged=function(e){if(e.cell&&(e.cell.colSpan<0||e.cell.rowSpan<0)){var r=this.parent.getActiveSheet();if(r.frozenRows||r.frozenColumns){var t={range:[e.rowIdx,e.colIdx,e.rowIdx,e.colIdx]};this.parent.notify(Ne,t);var i=this.parent.frozenRowCount(r),n=this.parent.frozenColCount(r);(r.frozenRows&&r.frozenColumns?t.range[0]<i&&t.range[1]<n?e.rowIdx<i&&e.colIdx<n:t.range[0]<i?e.rowIdx<i:!(t.range[1]<n)||e.colIdx<n:i?t.range[0]>=i||e.rowIdx<i:t.range[1]>=n||e.colIdx<n)&&(e.td.style.display="none")}else e.td.style.display="none";return e.cell.colSpan<0&&(this.parent.notify(sa,e),e.cell.style&&e.cell.style.borderTop&&this.applyStyle(e,{borderTop:e.cell.style.borderTop})),e.cell.rowSpan<0&&(e.isRow=!0,this.parent.notify(sa,e),e.cell.style&&e.cell.style.borderLeft&&this.applyStyle(e,{borderLeft:e.cell.style.borderLeft})),!0}return!1},s.prototype.mergeFreezeRow=function(e,r,t,i,n,a){var o=this.parent.frozenRowCount(e);if(o&&r<o&&r+(i-1)>=o){var l=void 0,h=0,p=void 0,c=this.parent.frozenColCount(e),d=n||this.parent.getRow(r,null,t),u=[].slice.call(d.parentElement.querySelectorAll(".e-empty"));if(a){var v=r+i-o;if(v<u.length)return;var g=0;if(v===u.length){var m=void 0,y=void 0,C=void 0;for(c&&t<c?(y=B(e.topLeftCell)[1],C=c):(y=this.parent.viewport.leftIndex+c,C=this.parent.viewport.rightIndex);y<C;y++)y!==t&&(m=E(r,y,e,!1,!0)).rowSpan&&r+m.rowSpan-o>g&&(g=r+m.rowSpan-o);if(g===v)return}else g=v;var b=r+(i-1);for(y=g,C=u.length;y<C;y++)h+=le(e,b),b--,(0,f.og)(u.pop());return this.updateSpanTop(t,c,h,!0),void(u.length||this.updateColZIndex(t,c,!0))}for(this.updateColZIndex(t,c),y=o,C=r+(i-1);y<=C;y++)h+=-(p=le(e,U(e,y,!0),!0)),!(o+u.length>y)&&((l=d.cloneNode()).classList.add("e-empty"),l.style.visibility="hidden",l.style.height=p+"px",d.parentElement.appendChild(l));this.updateSpanTop(t,c,h)}},s.prototype.updateSpanTop=function(e,r,t,i){var n=this.parent.serviceLocator.getService("sheet").contentPanel;if(i){if(!parseInt(n.style.top,10))return;t=parseInt(n.style.top,10)+t}if(r&&e<r&&(i||!parseInt(n.style.top,10)||t<parseInt(n.style.top,10))){n.style.top=t+"px";var a=n.nextElementSibling;a&&(a.style.top=t+"px")}},s.prototype.mergeFreezeCol=function(e,r,t,i,n){var a=this.parent.frozenColCount(e);if(a&&t<a&&t+(i-1)>=a){var o=void 0,l=void 0,h=this.parent.frozenRowCount(e),p=(r<h?this.parent.getSelectAllContent():this.parent.getRowHeaderContent()).querySelector("colgroup"),c=[].slice.call(p.querySelectorAll(".e-empty"));if(n){var d=t+i-a;if(d<c.length)return;var u=0;if(d===c.length){var v=void 0,g=void 0,m=void 0;for(h&&r<a?(g=h,m=B(e.topLeftCell)[0]):(g=this.parent.viewport.bottomIndex,m=this.parent.viewport.topIndex+h);m<g;m++)m!==r&&(v=E(m,t,e,!1,!0)).colSpan&&t+v.colSpan-a>u&&(u=t+v.colSpan-a);if(u===d)return}else u=d;for(m=u,g=c.length;m<g;m++)(0,f.og)(c.pop());return this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()),void(c.length||this.updateRowZIndex(r,h,!0))}for(this.updateRowZIndex(r,h),m=a,g=t+(i-1);m<=g;m++)a+c.length>m||((o=p.childNodes[0].cloneNode()).classList.add("e-empty"),o.style.visibility="hidden",l=Te(e,U(e,m,!0,"columns"),null,!0),o.style.width=l+"px",p.appendChild(o),m===g&&this.parent.serviceLocator.getService("sheet").setPanelWidth(e,this.parent.getRowHeaderContent()))}},s.prototype.updateColZIndex=function(e,r,t){e<r?this.updateSelectAllZIndex(t):(this.parent.getColumnHeaderContent().style.zIndex=t?"":"2",this.updatedHeaderZIndex(t))},s.prototype.updateSelectAllZIndex=function(e){var r=this.parent.element.querySelector(".e-frozen-row"),t=this.parent.element.querySelector(".e-frozen-column");e?(this.parent.getSelectAllContent().style.zIndex="",r&&(r.style.zIndex=""),t&&(t.style.zIndex="")):this.parent.getRowHeaderContent().style.zIndex||this.parent.getColumnHeaderContent().style.zIndex?(this.parent.getSelectAllContent().style.zIndex="3",r&&(r.style.zIndex="4"),t&&(t.style.zIndex="4")):this.parent.getSelectAllContent().style.zIndex="2"},s.prototype.updatedHeaderZIndex=function(e){if(!e&&"2"===this.parent.getSelectAllContent().style.zIndex){this.parent.getSelectAllContent().style.zIndex="3";var r=this.parent.element.querySelector(".e-frozen-row"),t=this.parent.element.querySelector(".e-frozen-column");t&&(t.style.zIndex="4"),r&&(r.style.zIndex="4")}},s.prototype.updateRowZIndex=function(e,r,t){e<r?this.updateSelectAllZIndex(t):(this.parent.getRowHeaderContent().style.zIndex=t?"":"2",this.updatedHeaderZIndex(t))},s.prototype.processTemplates=function(e,r,t){for(var a,i=this.parent.getActiveSheet(),n=i.ranges,o=0,l=n.length;o<l;o++)if(n[o].template&&(a=A(n[o].address.length?n[o].address:n[o].startCell))[0]<=r&&a[1]<=t&&a[2]>=r&&a[3]>=t){if(e)return this.compileCellTemplate(n[o].template,e);if(!E(r,t,i,!0))return this.compileCellTemplate(n[o].template,E(r,t,i,null,!0))}return""},s.prototype.compileCellTemplate=function(e,r){var t;if("string"==typeof e){var i;return i=0===e.trim().indexOf("#")?document.querySelector(e).innerHTML.trim():e,t=(0,f.MY)(i),!this.parent.isVue||document.querySelector(e)?t(r,this.parent,"ranges","",!0)[0].outerHTML:t(r,this.parent,"ranges","")[0]}return(t=(0,f.MY)(e))(r,this.parent,"ranges","")[0]},s.prototype.getRowHeightOnInit=function(){var e=this.parent.createElement("table",{className:"e-table e-test-table"});e.appendChild(this.parent.createElement("tbody")).appendChild(this.tableRow),this.parent.element.appendChild(e);var t=Math.round(this.tableRow.getBoundingClientRect().height);return this.parent.element.removeChild(e),t<20?20:t},s.prototype.removeStyle=function(e,r,t){var i;if(e.style.length){var n=(i=this.parent.getCellStyleValue(["borderLeft","border"],[r,t+1])).borderLeft||i.border,a=(i=this.parent.getCellStyleValue(["borderTop","border"],[r+1,t])).borderTop||i.border;n||a?[].slice.call(e.style).forEach(function(p){n&&a?!p.includes("border-right")&&!p.includes("border-bottom")&&e.style.removeProperty(p):(n&&!(p.indexOf("border-right")>-1)&&(!a||"none"===a)||a&&!(p.indexOf("border-bottom")>-1)&&(!n||"none"===n))&&e.style.removeProperty(p)}):e.removeAttribute("style")}var o=this.parent.getCell(r-1,t);if(o&&o.style.borderBottom){var l=Number(o.parentElement.getAttribute("aria-rowindex"))-1;(i=this.parent.getCellStyleValue(["borderBottom","border"],[l,t])).borderBottom||i.border||(o.style.borderBottom="")}var h=e.previousElementSibling;h&&h.style.borderRight&&(t=Number(h.getAttribute("aria-colindex"))-1,(i=this.parent.getCellStyleValue(["borderRight","border"],[r,t])).borderRight||i.border||(h.style.borderRight=""))},s.prototype.refreshRange=function(e,r,t,i,n){var l,h,a=this.parent.getActiveSheet(),o=e.slice();if(ih(this.parent,o,!0))for(var p=o[0];p<=o[2];p++)if(!ne(a,p))for(var c=o[1];c<=o[3];c++)we(a,c)||(h=this.parent.getCell(p,c))&&(l={rowIdx:p,colIdx:c,td:h,cell:E(p,c,a),isRefreshing:r,lastCell:c===o[3],isRefresh:!0,isHeightCheckNeeded:!0,manualUpdate:!0,first:"",onActionUpdate:i},this.update(l),n&&a.conditionalFormats&&a.conditionalFormats.length&&this.parent.notify(We,{indexes:[p,c],isAction:!0}),this.parent.notify(Ui,{td:h,rowIndex:p,colIndex:c}),t&&this.setWrapByValue(a,l))},s.prototype.refresh=function(e,r,t,i,n,a){var o=this.parent.getActiveSheet();if((i||!ne(o,e)&&!we(o,r))&&(i||!this.parent.scrollSettings.enableVirtualization||this.parent.insideViewport(e,r))){var l=i||this.parent.getCell(e,r);if(!l)return;var h={rowIdx:e,colIdx:r,td:l,cell:E(e,r,o),isRefresh:!0,lastCell:t,isHeightCheckNeeded:!0,manualUpdate:!0,first:""};this.update(h),n&&o.conditionalFormats&&o.conditionalFormats.length&&this.parent.notify(We,{indexes:[e,r],isAction:!0}),this.parent.notify(Ui,{td:l,rowIndex:e,colIndex:r}),a&&this.setWrapByValue(o,h)}},s.prototype.updateView=function(e){if((0,f.le)(e.sheetIndex)||e.sheetIndex===this.parent.activeSheetIndex){if(!e.indexes){var r=this.parent.getActiveSheet(),t=this.parent.frozenRowCount(r),i=this.parent.frozenColCount(r),n=A(r.topLeftCell);t&&i&&this.refreshRange([n[0],n[1],t-1,i-1],e.refreshing,e.checkWrap,!1,e.checkCF),t&&this.refreshRange([n[0],this.parent.viewport.leftIndex+i,t-1,this.parent.viewport.rightIndex],e.refreshing,e.checkWrap,!1,e.checkCF),i&&this.refreshRange([this.parent.viewport.topIndex+t,n[1],this.parent.viewport.bottomIndex,i-1],e.refreshing,e.checkWrap,!1,e.checkCF),e.indexes=[this.parent.viewport.topIndex+t,this.parent.viewport.leftIndex+i,this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex]}this.refreshRange(e.indexes,e.refreshing,e.checkWrap,!1,e.checkCF)}else e.refreshing&&this.calculateFormula({cell:E(e.indexes[0],e.indexes[1],_(this.parent,e.sheetIndex),!0,!0),rowIdx:e.indexes[0],colIdx:e.indexes[1],sheetIndex:e.sheetIndex})},s.prototype.destroy=function(){this.parent.off(xl,this.updateView),this.parent.off("calculateFormula",this.calculateFormula),this.element=null,this.th=null,this.tableRow=null,this.parent=null},s}(),Vp=function(){function s(e){this.parent=e,this.addEventListener(),this.instantiateRenderer()}return s.prototype.render=function(){this.parent.setProperties({activeSheetIndex:this.parent.skipHiddenSheets(this.parent.activeSheetIndex)},!0),this.parent.isMobileView()||(this.parent.notify(Jr,null),this.parent.notify(Oi,null));var e=this.parent.createElement("div",{id:this.parent.element.id+"_sheet_panel",className:"e-sheet-panel"});this.parent.enableRtl&&e.classList.add("e-rtl"),this.parent.element.appendChild(e),this.parent.showSheetTabs?this.parent.notify(jn,null):(this.parent.notify(ie,{action:"initSheetInfo"}),this.parent.notify(ie,{action:"initiateDefinedNames"})),this.parent.isMobileView()&&(this.parent.notify(Oi,null),this.parent.notify(Jr,null)),(this.parent.password.length>0||this.parent.isProtected)&&(this.parent.isProtected=!0,this.parent.showSheetTabs&&(this.parent.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),this.parent.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"))),"None"===this.parent.selectionSettings.mode&&(this.parent.allowAutoFill=!1),this.setSheetPanelSize(),this.renderSheet(e),this.checkTopLeftCell(!this.parent.refreshing)},s.prototype.checkTopLeftCell=function(e,r,t,i,n){var a=this.parent.getActiveSheet();this.parent.showSpinner();var h,o="A1"===a.topLeftCell,l=B(a.topLeftCell);if(a.topLeftCell!==a.paneTopLeftCell&&(a.frozenRows||a.frozenColumns)){var p=B(a.paneTopLeftCell);h=this.parent.scrollSettings.enableVirtualization,o=a.frozenRows&&a.frozenColumns?l[0]+a.frozenRows===p[0]&&l[1]+a.frozenColumns===p[1]:a.frozenRows?l[0]+a.frozenRows===p[0]&&0===l[1]:l[1]+a.frozenColumns===p[1]&&0===l[0],this.parent.viewport.beforeFreezeHeight=l[0]&&p[0]>l[0]?Ce(a,0,l[0]-1,!0):0,this.parent.viewport.beforeFreezeWidth=l[1]&&p[1]>l[1]?ge(a,0,l[1]-1,!0):0}else this.parent.viewport.beforeFreezeHeight=this.parent.viewport.beforeFreezeWidth=0;var c=this.parent.frozenRowCount(a),d=this.parent.frozenColCount(a);if(!this.parent.scrollSettings.enableVirtualization||o)this.refreshUI({rowIndex:l[0],colIndex:l[1],refresh:"All"},null,e,r,n),h&&(this.parent.viewport.topIndex=U(a,c,!0)-c,this.parent.viewport.leftIndex=U(a,d,!0,"columns")-d);else{var u=a.paneTopLeftCell===a.topLeftCell?l:B(a.paneTopLeftCell),v={preventScroll:!0};v.scrollTop=t||(u[0]>c?Ce(a,c,u[0]-1,!0):0),v.scrollLeft=i||(u[1]>d?ge(a,d,u[1]-1,!0):0),this.parent.notify(Bo,v);var g=this.parent.getThreshold("row"),m=a.frozenRows?l[0]:l[0]>g?U(a,l[0]-g,!0):0,y=[];a.frozenRows&&y.push(u[0]-g>c?u[0]-g:c),g=this.parent.getThreshold("col");var C=a.frozenColumns?l[1]:l[1]>g?U(a,l[1]-g,!0,"columns"):0;a.frozenColumns?(y.length||y.push(c),y.push(u[1]-g>d?u[1]-g:d)):y.length&&y.push(d),this.refreshUI({rowIndex:m,colIndex:C,refresh:"All",top:v.scrollTop,left:v.scrollLeft,frozenIndexes:y},null,e,r,n),h&&(c&&y[0]>=c&&(this.parent.viewport.topIndex=U(a,y[0],!0)-c),d&&y[1]>=d&&(this.parent.viewport.leftIndex=U(a,y[1],!0,"columns")-d))}},s.prototype.renderSheet=function(e){void 0===e&&(e=document.getElementById(this.parent.element.id+"_sheet_panel")),e.appendChild(this.parent.createElement("div",{className:"e-sheet",id:this.parent.element.id+"_sheet",styles:"background-color: #fff"})),this.parent.serviceLocator.getService("sheet").renderPanel()},s.prototype.refreshUI=function(e,r,t,i,n){var a=this;"All"!==e.refresh&&this.parent.showSpinner();var o=this.parent.serviceLocator.getService("sheet"),l=this.parent.getActiveSheet(),h=pt(this.parent),p={rowCount:l.rowCount,colCount:l.colCount};if(e.frozenIndexes=e.frozenIndexes?e.frozenIndexes:[],!r)if(this.parent.scrollSettings.enableVirtualization){var c=e.rowIndex+this.parent.viewport.rowCount+2*this.parent.getThreshold("row"),d=e.colIndex+this.parent.viewport.colCount+2*this.parent.getThreshold("col"),u=this.parent.frozenRowCount(l),v=this.parent.frozenColCount(l);e.frozenIndexes.length&&(c+=e.frozenIndexes[0]-u,d+=e.frozenIndexes[1]-v),d+="Column"===e.refresh?v:l.frozenColumns;var g=e.frozenIndexes[0]>u?e.frozenIndexes[0]:e.rowIndex+("Row"===e.refresh?u:l.frozenRows),m=this.parent.skipHidden(g,c+="Row"===e.refresh?u:l.frozenRows,"rows",!1);c=m[1],g!==m[0]&&(y=B(l.paneTopLeftCell))[0]===g&&this.parent.updateTopLeftCell(m[0]-u,y[1],"col"),m[0]-=u;var C=l.rowCount-1,b=0,S=e.rowIndex;this.parent.scrollSettings.isFinite&&c>C&&(b=c-C,c=U(l,C,!1),m[0]+u>U(l,u,!0))&&(w=this.decreaseHidden(w=(w=e.rowIndex-b)<0?0:w,e.rowIndex-1,u),e.top&&w<e.rowIndex&&this.parent.notify(Nr,{height:Ce(l,w+u,e.rowIndex-1+u,!0),isRender:!0}),this.parent.viewport.topIndex=m[0]=w,S="Row"===e.refresh?w:S),"Row"===e.refresh?e.rowIndex=U(l,S+u,!0)-u:S=e.rowIndex=u?U(l,S,!0):m[0];var y,x=e.frozenIndexes[1]>v?e.frozenIndexes[1]:e.colIndex+("Column"===e.refresh?v:l.frozenColumns);d=(m=this.parent.skipHidden(x,d,"columns",!1))[1],x!==m[0]&&(y=B(l.paneTopLeftCell))[1]===x&&this.parent.updateTopLeftCell(y[0],m[0]-v,"row"),m[0]-=v,C=l.colCount-1,b=0;var w,I=e.colIndex;this.parent.scrollSettings.isFinite&&d>C&&(b=d-C,d=U(l,C,!1,"columns"),m[0]+v>U(l,v,!0,"columns"))&&(w=this.decreaseHidden(w=(w=e.colIndex-b)>-1?w:0,e.colIndex-1,v,"columns"),e.left&&w<e.colIndex&&this.parent.notify(Nr,{width:ge(l,w+v,e.colIndex-1+v,!0),isRender:!0}),this.parent.viewport.leftIndex=m[0]=w,I="Column"===e.refresh?w:I),"Column"===e.refresh?e.colIndex=U(l,I+v,!0,"columns")-v:I=e.colIndex=v?U(l,I,!0,"columns"):m[0],"Row"===e.refresh&&(S+=u,u&&(c+=B(l.topLeftCell)[0]),d=this.parent.viewport.rightIndex),"Column"===e.refresh&&(I+=v,v&&(d+=B(l.topLeftCell)[1]),c=this.parent.viewport.bottomIndex),this.parent.viewport.topIndex=e.rowIndex,this.parent.viewport.bottomIndex=c,this.parent.viewport.leftIndex=e.colIndex,this.parent.viewport.rightIndex=d,r=j(S,I)+":"+j(c,d)}else"All"===e.refresh&&this.updateTopLeftScrollPosition((0,f.l7)(e,{sheet:l})),this.parent.viewport.bottomIndex=l.rowCount-1,this.parent.viewport.rightIndex=l.colCount-1,r=j(e.rowIndex,e.colIndex)+":"+j(this.parent.viewport.bottomIndex,this.parent.viewport.rightIndex);"All"===e.refresh&&this.parent.trigger("beforeDataBound",{});var F=this.parent.isOpen||this.parent.refreshing;Br(this.parent.getMainContent(),{busy:!0});var T=this.parent.sheets.length;Zt(this.parent,h+"!"+r,null,null,e.frozenIndexes).then(function(k){if(a.parent&&!(T<a.parent.sheets.length)){var R=a.parent.sheets.indexOf(l);if(!n&&(-1===R||R!==a.parent.activeSheetIndex))return void(R>-1&&a.checkTopLeftCell());var P,D=[e.rowIndex,e.colIndex].concat(B(r.split(":")[1]));switch(e.refresh){case"All":o.renderTable({cells:k,indexes:D,top:e.top,left:e.left,initLoad:t,isRefreshing:i,isOpen:F});break;case"Row":o.refreshRowContent({cells:k,indexes:D,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:p}),a.parent.notify(ei,P={isEdit:!1}),P.isEdit&&a.parent.notify(fe,{action:"startEdit",refreshCurPos:!1});break;case"Column":o.refreshColumnContent({cells:k,indexes:D,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:p,insertDelete:e.insertDelete});break;case"RowPart":o.updateRowContent({cells:k,indexes:D,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:p});break;case"ColumnPart":o.updateColContent({cells:k,indexes:D,direction:e.direction,skipUpdateOnFirst:e.skipUpdateOnFirst,prevRowColCnt:p})}a.parent&&a.parent[da]&&a.parent[Ol]()}}),this.parent.notify(Co,{refresh:e.refresh,skipTranslate:e.skipTranslate})},s.prototype.updateTopLeftScrollPosition=function(e){var r=B(e.sheet.topLeftCell),t=B(e.sheet.paneTopLeftCell);if(e.sheet.frozenRows){var i=this.parent.frozenRowCount(e.sheet);t[0]>i&&(e.top=Ce(e.sheet,i,t[0]-1,!0))}else e.rowIndex&&(e.rowIndex=0),0!==r[0]&&(e.top=Ce(e.sheet,0,r[0]-1,!0));if(e.sheet.frozenColumns){var n=this.parent.frozenColCount(e.sheet);t[1]>n&&(e.left=ge(e.sheet,n,t[1]-1,!0))}else e.colIndex&&(e.colIndex=0),0!==r[1]&&(e.left=ge(e.sheet,0,r[1]-1,!0))},s.prototype.removeSheet=function(){(0,f.Od)(document.getElementById(this.parent.element.id+"_sheet"))},s.prototype.refreshSheet=function(e,r,t,i){var n=0,a=0;if(r){var o=this.parent.element.getElementsByClassName("e-main-panel")[0];o&&(n=o.scrollTop);var l=this.parent.getMainContent();l&&(a=l.scrollLeft)}this.removeSheet(),this.renderSheet(),this.parent.notify(Zn,{}),this.checkTopLeftCell(!1,e,n,a,i),t&&K(this.parent.element)},s.prototype.setSheetPanelSize=function(){var t,e=document.getElementById(this.parent.element.id+"_sheet_panel"),r=this.parent.element.getBoundingClientRect();"auto"===this.parent.height?(e.style.height="260px",t=230):(t=r.height-th(e),e.style.height=t+"px",t-=32),this.parent.viewport.height=t,this.parent.viewport.width=r.width-32,this.parent.viewport.rowCount=this.roundValue(t,20),this.parent.viewport.colCount=this.roundValue(r.width,64)},s.prototype.roundValue=function(e,r){var t=e/r,i=Math.round(t);return Math.abs(t-i)<.5?i:i-1},s.prototype.moveOrDuplicateSheetHandler=function(e){this.parent.notify(pr,null),e.refresh&&this.refreshSheet(e.isDuplicate)},s.prototype.decreaseHidden=function(e,r,t,i){void 0===i&&(i="rows"),e+=t,r+=t;for(var n=this.parent.getActiveSheet(),a=r;a>=e;a--)if(n[i][a]&&n[i][a].hidden&&--e<t){e=U(n,t,!0,i);break}return e-t},s.prototype.instantiateRenderer=function(){this.parent.serviceLocator.register("cell",new Pp(this.parent)),this.parent.serviceLocator.register("row",new Hp(this.parent)),this.parent.serviceLocator.register("sheet",new Bp(this.parent))},s.prototype.destroy=function(){this.removeEventListener(),this.parent.serviceLocator.getService("row").destroy(),this.parent.serviceLocator.getService("cell").destroy(),this.parent=null},s.prototype.addEventListener=function(){this.parent.on(rt,this.destroy,this),this.parent.on(En,this.moveOrDuplicateSheetHandler,this),this.parent.on(ms,this.updateTopLeftScrollPosition,this)},s.prototype.removeEventListener=function(){this.parent.off(rt,this.destroy),this.parent.off(En,this.moveOrDuplicateSheetHandler),this.parent.off(ms,this.updateTopLeftScrollPosition)},s}(),qp=function(){function s(e){this.parent=e}return s.prototype.show=function(e,r){var i,t=this;r=!!(0,f.le)(r);var n=e.close||null,a={header:"Spreadsheet",cssClass:this.parent.cssClass,target:this.parent.element,buttons:[]};e.close=function(){t.destroyDialog(),n&&n()},(0,f.l7)(a,e),r&&(i=this.parent.serviceLocator.getService(O).getConstant(a.buttons.length?"Cancel":"Ok"),a.buttons.push({buttonModel:{content:i,isPrimary:0===a.buttons.length},click:this.hide.bind(this)}));var o=this.parent.createElement("div");document.body.appendChild(o),this.dialogInstance=new Pt.Vq(a),this.dialogInstance.createElement=this.parent.createElement,this.dialogInstance.appendTo(o),this.dialogInstance.refreshPosition()},s.prototype.destroyDialog=function(){this.dialogInstance.destroy(),(0,f.Od)(this.dialogInstance.element),this.dialogInstance=null},s.prototype.hide=function(e){this.dialogInstance&&(e&&(this.dialogInstance.animationSettings.effect="None",this.dialogInstance.dataBind()),this.dialogInstance.hide())},s.prototype.destroy=function(){this.parent=null},s}(),Up=function(){function s(e){this.parent=e,this.addEventListener()}return s.prototype.initializeActionBegin=function(){var e=this,r=this.parent.beforeCellFormat;this.parent.beforeCellFormat=function(a){e.actionEventHandler({evtArgs:a,evtFunc:r,actionType:"begin",eventType:"format"})};var t=this.parent.beforeOpen;this.parent.beforeOpen=function(a){e.actionEventHandler({evtArgs:a,evtFunc:t,actionType:"begin",eventType:"beforeOpen"})};var i=this.parent.beforeSave;this.parent.beforeSave=function(a){e.actionEventHandler({evtArgs:a,evtFunc:i,actionType:"begin",eventType:"beforeSave"})};var n=this.parent.beforeSort;this.parent.beforeSort=function(a){e.actionEventHandler({evtArgs:a,evtFunc:n,actionType:"begin",eventType:"beforeSort"})}},s.prototype.initializeActionComplete=function(){var e=this,r=this.parent.sortComplete;this.parent.sortComplete=function(i){e.actionEventHandler({evtArgs:i,evtFunc:r,actionType:"complete",eventType:"sorting"})};var t=this.parent.cellSave;this.parent.cellSave=function(i){e.actionEventHandler({evtArgs:i,evtFunc:t,actionType:"complete",eventType:"cellSave"})}},s.prototype.actionEventHandler=function(e){e.evtFunc&&e.evtFunc.apply(this,[e]),"begin"===e.actionType?this.actionBeginHandler({eventArgs:e.evtArgs,action:e.eventType}):this.actionCompleteHandler({eventArgs:e.evtArgs,action:e.eventType})},s.prototype.actionBeginHandler=function(e){var r=e.preventAction;delete e.preventAction;var t={action:e.action};e.isUndo&&(t.isUndo=!0,delete e.isUndo),e.isRedo&&(t.isUndo=!1,delete e.isRedo),t.args=e,this.parent.trigger("actionBegin",t),!r&&("clipboard"===e.action||"format"===e.action||"cellSave"===e.action||"beforeWrap"===e.action||"beforeReplace"===e.action||"filter"===e.action||"beforeClear"===e.action||"beforeInsertImage"===e.action||"beforeInsertChart"===e.action||"chartDesign"===e.action||"cellDelete"===e.action||"autofill"===e.action||"removeValidation"===e.action||"hyperlink"===e.action||"removeHyperlink"===e.action||"deleteImage"===e.action)&&this.parent.notify(ea,{args:e}),r&&(e.preventAction=!0),t.isUndo&&(e.isUndo=!0),!1===t.isUndo&&(e.isRedo=!0)},s.prototype.actionCompleteHandler=function(e){var r=e.preventAction;delete e.preventAction,this.parent.notify(Ci,e),e.preventEventTrigger||this.parent.trigger("actionComplete",e),!r&&"undoRedo"!==e.action&&"gotoSheet"!==e.action&&this.parent.notify(Jn,{args:e}),this.parent.notify(Bt,null)},s.prototype.addEventListener=function(){this.parent.on(Z,this.actionCompleteHandler,this),this.parent.on(ue,this.actionBeginHandler,this),this.parent.on(rt,this.removeEventListener,this)},s.prototype.removeEventListener=function(){this.parent.off(Z,this.actionCompleteHandler),this.parent.off(ue,this.actionBeginHandler),this.parent.off(rt,this.removeEventListener)},s}(),zp=function(){function s(e){this.minHeight="300px",this.minWidth="400px",this.isOverlayClicked=!1,this.isResizerClicked=!1,this.currentWidth=400,this.currenHeight=300,this.parent=e}return s.prototype.insertOverlayElement=function(e,r,t){var d,i=this.parent.createElement("div",{id:e,attrs:{class:"e-ss-overlay e-ss-overlay-active"},styles:"width: "+this.minWidth+";  height: "+this.minHeight}),n=A(r),a=this.parent.sheets[t],o=this.parent.frozenRowCount(a),l=this.parent.frozenColCount(a),h=xa(a,n,o,l,this.parent.viewport.beforeFreezeHeight,this.parent.viewport.beforeFreezeWidth,this.parent.sheetModule.colGroupWidth);if(n[0]>=o&&n[1]<l){var p=this.parent.sheetModule.contentPanel;p.scrollTop&&(h.top-=p.scrollTop,h.top+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height)}if(n[1]>=l&&n[0]<o){var c=this.parent.getScrollElement();c.scrollLeft&&(h.left-=c.scrollLeft,h.left+=this.parent.sheetModule.getRowHeaderWidth(a))}return n[0]<o||n[1]<l?(d=document.getElementById(this.parent.element.id+"_sheet"),o&&(n[0]>=o?h.top+=(a.showHeaders?31:0)+Ce(a,B(a.topLeftCell)[0],o-1):l||(h.left+=this.parent.sheetModule.getRowHeaderWidth(a,!0))),l&&(n[1]>=l?h.left+=this.parent.sheetModule.getRowHeaderWidth(a):o||(h.left+=a.showHeaders?31:0))):d=this.parent.getMainContent(),i.style.top=h.top+"px",i.style.left=h.left+"px",t===this.parent.activeSheetIndex&&(d.appendChild(i),this.renderResizeHandles(i),this.addEventListener(i)),this.originalWidth=parseFloat(getComputedStyle(i,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(i,null).getPropertyValue("height").replace("px","")),i},s.prototype.adjustFreezePaneSize=function(e,r,t){var i=A(t),n=this.parent.getActiveSheet(),a=this.parent.frozenRowCount(n),o=this.parent.frozenColCount(n);if(i[0]<a||i[1]<o?((0,f.le)(e.top)||(r.style.top=e.top+(n.showHeaders?31:0)-this.parent.viewport.beforeFreezeHeight+"px"),(0,f.le)(e.left)||(r.style.left=e.left+this.parent.sheetModule.getRowHeaderWidth(n,!0)-this.parent.viewport.beforeFreezeWidth+"px")):((0,f.le)(e.top)||(r.style.top=e.top-this.parent.viewport.beforeFreezeHeight-(a?Ce(n,B(n.topLeftCell)[0],a-1):0)+"px"),(0,f.le)(e.left)||(r.style.left=e.left-this.parent.viewport.beforeFreezeWidth-(o?ge(n,B(n.topLeftCell)[1],o-1):0)+"px")),(0,f.le)(e.top)){var l=B(n.topLeftCell)[0];e.top=this.parent.viewport.beforeFreezeHeight+(a&&l===i[0]?0:Ce(n,a?l:0,i[0]-1))}if((0,f.le)(e.left)){var h=B(n.topLeftCell)[1];e.left=this.parent.viewport.beforeFreezeWidth+(o&&h===i[1]?0:ge(n,o?h:0,i[1]-1))}},s.prototype.addEventListener=function(e){var r=e;f.bi.add(r,"mousedown",this.overlayClickHandler,this),f.bi.add(r,"mousemove",this.overlayMouseMoveHandler,this),f.bi.add(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler,this),f.bi.add(document,"mouseup",this.overlayMouseUpHandler,this),this.parent.on(cs,this.setOriginalSize,this)},s.prototype.setOriginalSize=function(e){this.originalHeight=e.height,this.originalWidth=e.width},s.prototype.overlayMouseMoveHandler=function(e){var a,o,l,h,p,c,r=e.target,t=document.getElementsByClassName("e-ss-overlay-active")[0],i=this.parent.getActiveSheet(),n=i.frozenRows||i.frozenColumns?[29,this.parent.sheetModule.getRowHeaderWidth(i,!0)]:[-1,-1];if(this.isOverlayClicked&&this.isResizerClicked)switch(this.resizer){case"e-ss-overlay-t":a=Math.max(this.originalMouseY-e.clientY+this.originalHeight,20),o=e.clientY-(this.originalMouseY-this.originalResizeTop),a>20&&o>n[0]&&(t.style.height=a+"px",t.style.top=o+"px",this.resizedReorderTop=o,this.currenHeight=a,this.parent.notify($r,{height:t.style.height,width:t.style.width,overlayEle:t}));break;case"e-ss-overlay-r":(l=this.originalWidth+(e.pageX-this.originalMouseX))>20&&(t.style.width=l+"px",this.currentWidth=l,this.parent.notify($r,{height:t.style.height,width:t.style.width,overlayEle:t}));break;case"e-ss-overlay-b":(h=this.originalHeight+(e.pageY-this.originalMouseY))>20&&(t.style.height=h+"px",this.currenHeight=h,this.parent.notify($r,{height:t.style.height,width:t.style.width,overlayEle:t}));break;case"e-ss-overlay-l":p=Math.max(this.originalMouseX-e.clientX+this.originalWidth,20),c=e.clientX-(this.originalMouseX-this.originalResizeLeft),p>20&&c>n[1]&&(t.style.width=p+"px",t.style.left=c+"px",this.resizedReorderLeft=c,this.currentWidth=p,this.parent.notify($r,{height:t.style.height,width:t.style.width,overlayEle:t}))}else if(this.isOverlayClicked)if((0,f.oq)(r,".e-sheet")&&!r.classList.contains("e-sheet-content")||r.classList.contains("e-cell")){if(!t)return;var d=e.clientX-this.diffX,u=e.clientY-this.diffY;d>n[1]&&(t.style.left=d+"px"),u>n[0]&&(t.style.top=u+"px"),this.resizedReorderLeft=d<0?0:d,this.resizedReorderTop=u<0?0:u}else this.overlayMouseUpHandler(e,!0)},s.prototype.overlayMouseUpHandler=function(e,r){if(this.parent&&!this.parent.getActiveSheet().isProtected){this.isResizerClicked=!1;var t=e.target,i=document.getElementsByClassName("e-datavisualization-chart e-ss-overlay-active");t.classList.contains("e-ss-overlay")||(t=(0,f.oq)(e.target,".e-datavisualization-chart")?(0,f.oq)(e.target,".e-datavisualization-chart"):t);var n=this.parent.getActiveSheet(),a={prevTop:n.frozenRows||n.frozenColumns?this.prevY:this.originalReorderTop,prevLeft:n.frozenRows||n.frozenColumns?this.prevX:this.originalReorderLeft,currentTop:this.resizedReorderTop>=0?this.resizedReorderTop:this.originalReorderTop,currentLeft:this.resizedReorderLeft>=0?this.resizedReorderLeft:this.originalReorderLeft,id:t.id,currentHeight:this.currenHeight,currentWidth:this.currentWidth,requestType:"imageRefresh",prevHeight:this.originalHeight,prevWidth:this.originalWidth};if(this.isOverlayClicked||r){var o=void 0,l=void 0,h={clientY:a.prevTop,isImage:!0},p={clientX:a.prevLeft,isImage:!0},c=this.parent.element.getElementsByClassName("e-ss-overlay-active")[0];if(n.frozenRows||n.frozenColumns){if(!c)return;h.isImage=!1,p.isImage=!1,h.target=c,p.target=c,a.prevTop<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(h.target=this.parent.getColumnHeaderContent()),a.prevLeft<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(p.target=this.parent.getRowHeaderTable());var d=c.getBoundingClientRect();o={clientY:d.top},l={clientX:d.left},d.top<this.parent.getColumnHeaderContent().getBoundingClientRect().bottom&&(o.target=this.parent.getColumnHeaderContent()),d.left<this.parent.getRowHeaderContent().getBoundingClientRect().right&&(l.target=this.parent.getRowHeaderTable())}else o={clientY:a.currentTop,isImage:!0},l={clientX:a.currentLeft,isImage:!0};if(this.parent.notify(Yt,h),this.parent.notify(Yt,o),this.parent.notify(Xt,p),this.parent.notify(Xt,l),o.size&&(a.currentTop=o.size),l.size&&(a.currentLeft=l.size),a.prevRowIdx=h.clientY,a.prevColIdx=p.clientX,a.currentRowIdx=o.clientY,a.currentColIdx=l.clientX,(n.frozenColumns||n.frozenRows)&&!(0,f.oq)(c,".e-sheet-content")){var u=this.parent.frozenColCount(n),v=this.parent.frozenRowCount(n);if(a.currentRowIdx>=v&&a.currentColIdx>=u){var g=parseInt(c.style.top,10),m=parseInt(c.style.left,10);g+=this.parent.sheetModule.contentPanel.scrollTop,g-=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,m+=this.parent.getScrollElement().scrollLeft,m-=this.parent.sheetModule.getRowHeaderWidth(n),c.style.top=g+"px",c.style.left=m+"px",this.parent.getMainContent().appendChild(c)}}i&&i[0]&&i[0].querySelector(".e-control")&&(a.id=i[0].id),this.originalReorderTop!==this.resizedReorderTop||this.originalReorderLeft!==this.resizedReorderLeft?(a.id=c.id,i&&i[0]?(a.requestType="chartRefresh",this.parent.notify(hi,a)):this.parent.notify(li,a),this.resizedReorderTop=this.originalReorderTop,this.resizedReorderLeft=this.originalReorderLeft):(this.currenHeight!==this.originalHeight||this.originalWidth!==this.currentWidth)&&(a.id=t.id.indexOf("overlay")>0?t.id:t.parentElement?t.parentElement.id:"",i&&i[0]?(a.requestType="chartRefresh",this.parent.notify(hi,a)):this.parent.notify(li,a),this.originalHeight=this.currenHeight,this.originalWidth=this.currentWidth)}this.isOverlayClicked=!1}},s.prototype.overlayClickHandler=function(e){if(!this.parent.getActiveSheet().isProtected){this.isOverlayClicked=!0;var r=e.target,t=e.target;r.classList.contains("e-ss-overlay")||(t=r.parentElement,(0,f.oq)(e.target,".e-datavisualization-chart")&&(t=(0,f.oq)(e.target,".e-datavisualization-chart"),this.currentWidth=parseFloat(getComputedStyle(t,null).getPropertyValue("width").replace("px","")),this.currenHeight=parseFloat(getComputedStyle(t,null).getPropertyValue("height").replace("px",""))));var i=this.parent.getActiveSheet();if((i.frozenColumns||i.frozenRows)&&(0,f.oq)(t,".e-sheet-content")){var n=parseInt(t.style.top,10),a=parseInt(t.style.left,10);n-=this.parent.sheetModule.contentPanel.scrollTop,n+=this.parent.getColumnHeaderContent().parentElement.getBoundingClientRect().height,a-=this.parent.getScrollElement().scrollLeft,a+=this.parent.sheetModule.getRowHeaderWidth(i),t.style.top=n+"px",t.style.left=a+"px",document.getElementById(this.parent.element.id+"_sheet").appendChild(t)}this.originalReorderLeft=parseInt(t.style.left,10),this.originalReorderTop=parseInt(t.style.top,10),this.resizedReorderLeft=parseInt(t.style.left,10),this.resizedReorderTop=parseInt(t.style.top,10),this.originalResizeTop=this.originalReorderTop,this.originalResizeLeft=this.originalReorderLeft,this.originalMouseX=e.clientX,this.originalMouseY=e.clientY,this.diffX=this.originalMouseX-this.originalReorderLeft,this.diffY=this.originalMouseY-this.originalReorderTop;var h=document.getElementsByClassName("e-ss-overlay-active")[0];h&&(0,f.IV)([h],"e-ss-overlay-active"),document.getElementById(t.id).classList.add("e-ss-overlay-active"),r.classList.contains("e-ss-resizer")&&(this.resizer=r.classList[0],this.originalWidth=parseFloat(getComputedStyle(t,null).getPropertyValue("width").replace("px","")),this.originalHeight=parseFloat(getComputedStyle(t,null).getPropertyValue("height").replace("px","")),this.isResizerClicked=!0),t.classList.contains("e-datavisualization-chart")&&(this.parent.notify(lo,{id:t.id}),h||this.parent.notify(ca,{id:t.id}));var p=t.getBoundingClientRect();this.prevX=p.left,this.prevY=p.top}},s.prototype.renderResizeHandles=function(e){for(var i,r=["e-ss-overlay-t","e-ss-overlay-r","e-ss-overlay-b","e-ss-overlay-l"],t=0,n=e;r.length>t;)i=this.parent.createElement("div",{attrs:{class:r[t]+" e-ss-resizer"},styles:"width: 8px; height: 8px; border-radius: 4px;"}),n.appendChild(i),t++},s.prototype.removeEventListener=function(){var e=document.getElementById(this.parent.element.id+"_overlay");e&&(f.bi.remove(e,"mousedown",this.overlayClickHandler),f.bi.remove(e,"mousemove",this.overlayMouseMoveHandler)),f.bi.remove(document.getElementById(this.parent.element.id+"_sheet"),"mousemove",this.overlayMouseMoveHandler),f.bi.remove(document,"mouseup",this.overlayMouseUpHandler),this.parent.off(cs,this.setOriginalSize)},s.prototype.destroy=function(){this.removeEventListener(),this.parent=null},s}(),_p=function(){var s=function(e,r){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])})(e,r)};return function(e,r){function t(){this.constructor=e}s(e,r),e.prototype=null===r?Object.create(r):(t.prototype=r.prototype,new t)}}(),he=function(s,e,r,t){var a,i=arguments.length,n=i<3?e:null===t?t=Object.getOwnPropertyDescriptor(e,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(s,e,r,t);else for(var o=s.length-1;o>=0;o--)(a=s[o])&&(n=(i<3?a(n):i>3?a(e,r,n):a(e,r))||n);return i>3&&n&&Object.defineProperty(e,r,n),n},hl=function(s){function e(t,i){var n=s.call(this,t)||this;return n.viewport={rowCount:0,colCount:0,height:0,topIndex:0,leftIndex:0,width:0,bottomIndex:0,rightIndex:0,beforeFreezeHeight:0,beforeFreezeWidth:0},n.needsID=!0,r.Inject(Na,Ma,Ha,Aa,Ta,Da,La,Fa,br,Pa,rl,Va,qa,Oa,Ba,Gs,Vn,ln,Dn,Pn,sn,On,il,Nn,qs,Ws,Mn,nl,zs,qn,js,Ys,Un,mo,Xs,zn,Zs,Wn,Ks,_n,$s,Gn,al,Qs,Bn,Ca,ol,Hn,Js,ba),i&&n.appendTo(i),n}var r;return _p(e,s),r=e,e.prototype.getCell=function(t,i,n){var a;return this.insideViewport(t,i)&&(n||(n=this.getRow(t,null,i)),i=this.getViewportIndex(i,!0),a=n&&n.cells[i]),a},e.prototype.getRow=function(t,i,n){if(!i){var a=this.getActiveSheet(),o=this.frozenRowCount(a),l=this.frozenColCount(a);i=(0,f.le)(n)||t>o-1&&n>l-1?this.getContentTable():t<o&&n<l?this.sheetModule.getSelectAllTable():t<o?this.getColHeaderTable():this.getRowHeaderTable()}return t=this.getViewportIndex(t),i?i.rows[t]:null},e.prototype.hiddenCount=function(t,i,n,a){void 0===n&&(n="rows"),void 0===a&&(a=this.getActiveSheet());for(var o=0,l=t;l<=i;l++)a[n][l]&&a[n][l].hidden&&o++;return o},e.prototype.getViewportIndex=function(t,i){var n=this.getActiveSheet(),a=this.frozenColCount(n),o=this.frozenRowCount(n);if(i){if(a){var l=B(n.topLeftCell)[1];return t<a?(t-=this.hiddenCount(l,t,"columns"),1+(t-=l)):(t-=this.hiddenCount(this.viewport.leftIndex+a,t,"columns"),t-=this.viewport.leftIndex+a)}}else if(o){var h=B(n.topLeftCell)[0];return t<o?(t-=this.hiddenCount(h,t),1+(t-=h)):(t-=this.hiddenCount(this.viewport.topIndex+o,t),t-=this.viewport.topIndex+o)}return this.scrollSettings.enableVirtualization&&(i?(t-=this.hiddenCount(this.viewport.leftIndex,t,"columns"),t-=this.viewport.leftIndex):(t-=this.hiddenCount(this.viewport.topIndex,t),t-=this.viewport.topIndex)),t},e.prototype.preRender=function(){s.prototype.preRender.call(this),this.serviceLocator=new $l,this.initServices()},e.prototype.initServices=function(){this.serviceLocator.register(O,new f.E7(this.getModuleName(),Mp,this.locale)),this.serviceLocator.register(ae,new qp(this)),this.serviceLocator.register("actionEvents",new Up(this)),this.serviceLocator.register(ll,new zp(this))},e.prototype.render=function(){if(s.prototype.render.call(this),this.element.setAttribute("tabindex","0"),Br(this.element,{role:"grid"}),this.renderModule=new Vp(this),this.renderSpreadsheet(),this.wireEvents(),this.created)if(this[xt].observers){if(this[xt].observers.length>0){var t={observers:this[xt].observers};this.isAngular&&(t={observers:this[xt].observers,currentObservers:this[xt].observers},this[xt].currentObservers=[]),this.createdHandler=t,this[xt].observers=[]}}else this.createdHandler=this.created,this.setProperties({created:void 0},!0)},e.prototype.renderSpreadsheet=function(){this.cssClass&&(0,f.cn)([this.element],this.cssClass.split(" ")),this.setHeight(),this.setWidth(),(0,Pt.rj)({target:this.element},this.createElement),this.isMobileView()&&-1===this.cssClass.indexOf("e-mobile-view")&&this.element.classList.add("e-mobile-view"),this.sheetModule=this.serviceLocator.getService("sheet"),this.allowScrolling&&(this.scrollModule=new wp(this)),this.scrollSettings.enableVirtualization&&new xp(this),this.renderModule.render(),new Ip(this)},e.prototype.showSpinner=function(){(0,Pt.yh)(this.element)},e.prototype.hideSpinner=function(){(0,Pt.v3)(this.element)},e.prototype.protectSheet=function(t,i,n){"string"==typeof t&&(t=ee(this,t)),t&&(this.setSheetPropertyOnMute(this.sheets[t],"isProtected",!0),this.setSheetPropertyOnMute(this.sheets[t],"password",n||""),this.setSheetPropertyOnMute(this.sheets[t],"protectSettings",i)),t=this.getActiveSheet().index,this.setSheetPropertyOnMute(this.getActiveSheet(),"isProtected",!0),this.setSheetPropertyOnMute(this.getActiveSheet(),"password",n||""),s.prototype.protectSheet.call(this,t,i,n)},e.prototype.unprotectSheet=function(t){"string"==typeof t&&(t=ee(this,t)),t?this.sheets[t].isProtected=!1:this.getActiveSheet().isProtected=!1,s.prototype.unprotectSheet.call(this,t)},e.prototype.find=function(t){var i=this.getActiveSheet().activeCell;if(s.prototype.findHandler.call(this,t),!t.isAction)return i!==this.getActiveSheet().activeCell?this.getActiveSheet().name+"!"+this.getActiveSheet().activeCell:null},e.prototype.replace=function(t){t={value:t.value,mode:t.mode?t.mode:"Sheet",isCSen:!!t.isCSen&&t.isCSen,isEMatch:!!t.isEMatch&&t.isEMatch,searchBy:t.searchBy?t.searchBy:"By Row",replaceValue:t.replaceValue,replaceBy:t.replaceBy,sheetIndex:(0,f.o8)(t.sheetIndex)?this.activeSheetIndex:t.sheetIndex,findOpt:t.findOpt?t.findOpt:""},s.prototype.replaceHandler.call(this,t)},e.prototype.findAll=function(t,i,n,a,o){var l=[];return this.notify(ja,{value:t,mode:i=i||"Sheet",sheetIndex:o=o||this.activeSheetIndex,isCSen:n=n||!1,isEMatch:a=a||!1,findCollection:l}),l},e.prototype.goTo=function(t){if(t.includes("!")){var i=t.split("!"),n=ee(this,i[0]);if(void 0===n)return;if(n!==this.activeSheetIndex){var a=i[1].split(":")[0],o=this.sheets[n];this.setSheetPropertyOnMute(o,"activeCell",a),this.setSheetPropertyOnMute(o,"selectedRange",i[1]);var l=B(a);if(o.frozenColumns||o.frozenRows){var h=B(o.topLeftCell);if(!(o.frozenRows&&l[0]<h[0]||o.frozenColumns&&l[1]<h[1])){var p=this.frozenRowCount(o),c=this.frozenColCount(o),d=[],u=[],v=B(o.paneTopLeftCell);p?(d.push(h[0]),u.push(l[0]>=p?l[0]:v[0])):(d.push(l[0]),u.push(l[0])),c?(d.push(h[1]),u.push(l[1]>=c?l[1]:v[1])):(d.push(l[1]),u.push(l[1])),this.setSheetPropertyOnMute(o,"topLeftCell",j(d[0],d[1])),this.setSheetPropertyOnMute(o,"paneTopLeftCell",j(u[0],u[1]))}}else l[0]<this.viewport.rowCount&&(l[0]=0),l[1]<this.viewport.colCount&&(l[1]=0),this.updateTopLeftCell(l[0],l[1],null,o);return this.activeSheetIndex=n,void this.dataBind()}}var g=A(t),m=this.getActiveSheet(),y=this.frozenRowCount(m),C=this.frozenColCount(m),b=this.insideViewport(g[0],g[1]);if(b){this.selectRange(t);var S=B(m.paneTopLeftCell),w=this.viewport.height-this.getScrollElement().parentElement.getBoundingClientRect().height,x=0,I=0;if(y)for(var T=B(m.topLeftCell)[0];T<y;T++)if((x+=le(m,T))>w){I=T;break}if(0===I)for(T=S[0];T<=this.viewport.bottomIndex;T++){if((x+=le(m,T))>w){I=T;break}T===this.viewport.bottomIndex&&(I=this.viewport.bottomIndex)}S[2]=I;var k=0;if(x=0,w=this.viewport.width-this.sheetModule.getScrollSize(),C)for(T=B(m.topLeftCell)[1];T<C;T++)if((x+=Te(m,T))>w){k=T;break}if(0===k)for(T=S[1];T<=this.viewport.rightIndex;T++){if((x+=Te(m,T))>w){k=T;break}T===this.viewport.rightIndex&&(k=this.viewport.rightIndex)}if(S[3]=k,g[0]>=S[0]&&g[0]<S[2]&&g[1]>=S[1]&&g[1]<S[3]||(y||C)&&(S=[].concat(B(m.topLeftCell),[y,S[3]]),g[0]>=S[0]&&g[0]<S[2]&&g[1]>=S[1]&&g[1]<S[3]||(S[2]=I,S[3]=C,g[0]>=S[0]&&g[0]<S[2]&&g[1]>=S[1]&&g[1]<S[3])))return}var D,N,P,M,V,Y,R=this.getMainContent().parentElement;g[0]===y?P=0:(P=Ce(m,y,g[0]-1,!0),this.scrollSettings.enableVirtualization&&(Y=P+this.getContentTable().getBoundingClientRect().height)>(V=parseFloat(R.querySelector(".e-virtualtrack").style.height))&&(Y+=10,(D=R.querySelector(".e-virtualtrack")).style.height=Y+"px",Pe(function(){D.style.height=V+"px"}))),R.scrollTop=P,R=this.element.getElementsByClassName("e-scroller")[0],g[1]===C?P=0:(P=ge(m,C,g[1]-1,!0),this.scrollSettings.enableVirtualization&&(Y=P+this.getContentTable().getBoundingClientRect().width)>(M=parseFloat(R.querySelector(".e-virtualtrack").style.width))&&(Y+=10,(D=R.querySelector(".e-virtualtrack")).style.width=Y+"px",(N=this.getColumnHeaderContent().querySelector(".e-virtualtrack")).style.width=Y+"px",(D=this.getMainContent().querySelector(".e-virtualtrack")).style.width=Y+"px",Pe(function(){D.style.width=M+"px",N.style.width=M+"px"}))),R.scrollLeft=P,b||this.selectRange(t)},e.prototype.insideViewport=function(t,i){var n=this.getActiveSheet();if(n.frozenRows||n.frozenColumns){var a=this.frozenRowCount(n),o=this.frozenColCount(n),l=B(n.topLeftCell);return(t>=l[0]&&t<a||t>=this.viewport.topIndex+a&&t<=this.viewport.bottomIndex)&&(i>=l[1]&&i<o||i>=this.viewport.leftIndex+o&&i<=this.viewport.rightIndex)}return t>=this.viewport.topIndex&&t<=this.viewport.bottomIndex&&i>=this.viewport.leftIndex&&i<=this.viewport.rightIndex},e.prototype.resize=function(){this.renderModule.setSheetPanelSize(),this.scrollSettings.enableVirtualization&&this.renderModule.refreshSheet(!1,!0)},e.prototype.cut=function(t){var i=new Promise(function(n,a){n(void 0)});return this.notify(kr,t?{range:De(t),sId:this.sheets[ee(this,Et(t))]?this.sheets[ee(this,Et(t))].id:this.getActiveSheet().id,promise:i,invokeCopy:!0,isPublic:!0}:{promise:i,invokeCopy:!0,isPublic:!0}),i},e.prototype.copy=function(t){var i=new Promise(function(n,a){n(void 0)});return this.notify(Rr,t?{range:De(t),sId:this.sheets[ee(this,Et(t))]?this.sheets[ee(this,Et(t))].id:this.getActiveSheet().id,promise:i,invokeCopy:!0,isPublic:!0}:{promise:i,invokeCopy:!0,isPublic:!0}),i},e.prototype.paste=function(t,i){this.notify(Ot,{range:t&&De(t),sIdx:t&&ee(this,Et(t)),type:i,isAction:!0,isInternal:!0})},e.prototype.updateAction=function(t){qe(t,this)},e.prototype.setHeight=function(){this.height.toString().indexOf("%")>-1&&(this.element.style.minHeight="400px"),this.element.style.height=(0,f.Ac)(this.height)},e.prototype.setWidth=function(){(this.width.toString().indexOf("%")>-1||"auto"===this.width)&&(this.element.style.minWidth="300px"),this.element.style.width=(0,f.Ac)(this.width)},e.prototype.setColWidth=function(t,i,n){void 0===t&&(t=64),void 0===i&&(i=0);var a=(0,f.le)(n)?this.getActiveSheet():this.sheets[n];if(a){var o=i,l="number"==typeof t?t+"px":t;i=(0,f.le)(i)?B(a.activeCell)[1]:i;var h=function(){Fe(a,o).width=parseInt(l,10)>0?parseInt(l,10):0,a.columns[o].customWidth=!0},p=this.frozenColCount(a);if(a.id===this.getActiveSheet().id){if(i>=this.viewport.leftIndex+p&&i<=this.viewport.rightIndex||p&&i<p){i=this.getViewportIndex(i,!0);var c=Te(a,o,null,!0);(d=Ve(parseInt(l,10))-c)<0&&c<-d&&(d=-c),h(),this.notify($e,{threshold:d,colIdx:o,checkWrapCell:!0}),Ms(o,i,l,!0,this)}else{var u=Te(a,i),d=void 0;d=parseInt(l,10)>0?-(u-parseInt(l,10)):-u,h(),this.notify($e,{threshold:d,colIdx:i})}this.notify(Bt,null)}else h()}},e.prototype.setRowHeight=function(t,i,n,a){void 0===t&&(t=20),void 0===i&&(i=0);var o=(0,f.le)(n)?this.getActiveSheet():this.sheets[n];if(o){var l=i,h="number"==typeof t?t+"px":t;i=(0,f.le)(i)?B(o.activeCell)[0]:i;var p=function(){ui(o,l,parseInt(h,10)>0?parseInt(h,10):0),o.rows[l].customHeight=!0};if(o.id===this.getActiveSheet().id){var c=this.frozenRowCount(o);if(i>=this.viewport.topIndex+c&&i<=this.viewport.bottomIndex||c&&i<c){i=this.getViewportIndex(l);var d=le(o,l,!0);(u=Ve(parseInt(h,10))-d)<0&&d<-u&&(u=-d),p(),this.notify(Xe,{threshold:u,rowIdx:l,isCustomHgt:!0}),(0,f.le)(a)&&(a=!1),a||(Ms(l,i,h,!1,this),a=!1)}else{var v=le(o,i),u=void 0;u=parseInt(h,10)>0?-(v-parseInt(h,10)):-v,p(),this.notify(Xe,{threshold:u,rowIdx:l})}this.notify(Bt,null)}else p()}},e.prototype.autoFit=function(t){var i=this.getIndexes(t),n=i.startIdx,a=i.endIdx,o=i.isCol,l=o?Vt("XFD"):1048576;if(n<=l)for(a>l&&(a=l);n<=a;n++)this.notify(_o,{idx:n,isCol:o})},e.prototype.getIndexes=function(t){var i,n,a,o;if(-1!==t.indexOf(":")){var l=t.split(":");a=l[0],o=l[1]}else a=t,o=t;if(!(0,f.le)(a)){var h=this.getAddress(a);a=h.address,i=h.isCol}if(!(0,f.le)(o)){var p=this.getAddress(o);o=p.address,n=p.isCol}var c=!0===i&&!0===n;return{startIdx:c?Vt(a.toUpperCase()):parseInt(a,10),endIdx:c?Vt(o.toUpperCase()):parseInt(o,10),isCol:c}},e.prototype.getAddress=function(t){var i;return t.substring(0,1).match(/\D/g)?(i=!0,{address:t=t.replace(/[0-9]/g,""),isCol:i}):t.substring(0,1).match(/[0-9]/g)&&t.match(/\D/g)?{address:"",isCol:!1}:{address:t=(parseInt(t,10)-1).toString(),isCol:i}},e.prototype.addHyperlink=function(t,i,n){this.insertHyperlink(t,i,n,!0)},e.prototype.removeHyperlink=function(t){this.notify(qi,{range:t,preventEventTrigger:!0})},e.prototype.insertHyperlink=function(t,i,n,a){if(this.allowHyperlink){var o=void 0,l=void 0,h=void 0,p=this.getActiveSheet();h=A(i=i||p.name+"!"+p.activeCell);for(var c=this.getCell(h[0],h[1]),d=[],u=0;c&&u<c.classList.length;u++)d.push(c.classList[u]);var v={hyperlink:t,address:i,displayText:n,cancel:!1},g={hyperlink:t,address:i,displayText:n};if(a||(this.trigger("beforeHyperlinkCreate",v),this.notify(ue,{action:"hyperlink",eventArgs:v})),!v.cancel){if(this.notify(_r,{hyperlink:t=v.hyperlink,cell:i=v.address,displayText:n,triggerEvt:!a}),i&&-1!==i.indexOf("!")){o=i.split("!");for(var y=this.sheets,C=0;C<y.length;C++)y[C].name===o[0]&&(l=C);p=this.sheets[l],i=o[1]}if(!p)return;if(h=A(i=i||this.getActiveSheet().activeCell),a||(this.trigger("afterHyperlinkCreate",g),this.notify(Z,{action:"hyperlink",eventArgs:v})),p===this.getActiveSheet()){for(this.serviceLocator.getService("cell").refreshRange(h),u=0;u<d.length;u++)this.getCell(h[0],h[1]).classList.contains(d[u])||this.getCell(h[0],h[1]).classList.add(d[u]);this.notify(Jt,null)}}}},e.prototype.addDataValidation=function(t,i){s.prototype.addDataValidation.call(this,t,i)},e.prototype.removeDataValidation=function(t){s.prototype.removeDataValidation.call(this,t)},e.prototype.addInvalidHighlight=function(t){var i=t||this.dataValidationRange;if(i.indexOf(",")>-1){var n="";i.includes("!")&&(n=i.split("!")[0]+"!",i=i.split("!")[1]);for(var a=i.split(","),o=0;o<a.length-1;o++)s.prototype.addInvalidHighlight.call(this,n+a[o])}else s.prototype.addInvalidHighlight.call(this,i)},e.prototype.removeInvalidHighlight=function(t){var i=t||this.dataValidationRange;if(i.indexOf(",")>-1){var n="";i.includes("!")&&(n=i.split("!")[0]+"!",i=i.split("!")[1]);for(var a=i.split(","),o=0;o<a.length-1;o++)s.prototype.removeInvalidHighlight.call(this,n+a[o])}else s.prototype.removeInvalidHighlight.call(this,i)},e.prototype.conditionalFormat=function(t){s.prototype.conditionalFormat.call(this,t)},e.prototype.clearConditionalFormat=function(t){t=t||this.getActiveSheet().selectedRange,s.prototype.clearConditionalFormat.call(this,t)},e.prototype.setPanelSize=function(){if("auto"!==this.height){var t=document.getElementById(this.element.id+"_sheet_panel");t.style.height=this.element.getBoundingClientRect().height-th(t)+"px"}},e.prototype.open=function(t){this.isOpen=!0,s.prototype.open.call(this,t),this.isOpen&&this.showSpinner()},e.prototype.hideRow=function(t,i,n){void 0===i&&(i=t),void 0===n&&(n=!0),this.renderModule?this.notify(je,{startIndex:t,endIndex:i,hide:n}):s.prototype.hideRow.call(this,t,i,n)},e.prototype.hideColumn=function(t,i,n){void 0===i&&(i=t),void 0===n&&(n=!0),this.renderModule?this.notify(je,{startIndex:t,endIndex:i,hide:n,isCol:!0}):s.prototype.hideColumn.call(this,t,i,n)},e.prototype.clear=function(t){this.notify(Yi,{options:t})},e.prototype.refresh=function(t){this[da]&&this[Nl](),t?(this.notify(ti,null),this.sheets.length=0,this.sheetNameCount=1,this.notify(ar,{}),this.createSheet(),this.activeSheetIndex=this.sheets.length-1,this.notify(pr,null),this.notify(ie,{action:"initSheetInfo"}),this.renderModule.refreshSheet(),this.openModule.isImportedFile=!1,this.openModule.unProtectSheetIdx=[]):s.prototype.refresh.call(this)},e.prototype.insertImage=function(t,i){var n;for(n=0;n<t.length;n++)this.notify(Mt,{options:t[n],range:i||this.getActiveSheet().selectedRange,isPublic:!0})},e.prototype.deleteImage=function(t,i){this.notify(It,{id:t,range:i||this.getActiveSheet().selectedRange})},e.prototype.getRowHeaderContent=function(){return this.sheetModule.getRowHeaderPanel()},e.prototype.getColumnHeaderContent=function(){return this.sheetModule.getColHeaderPanel()},e.prototype.getMainContent=function(){return this.sheetModule.getContentPanel()},e.prototype.getSelectAllContent=function(){return this.sheetModule.getSelectAllContent()},e.prototype.getScrollElement=function(){return this.sheetModule.getScrollElement()},e.prototype.getContentTable=function(){return this.sheetModule.getContentTable()},e.prototype.getRowHeaderTable=function(){return this.sheetModule.getRowHeaderTable()},e.prototype.getColHeaderTable=function(){return this.sheetModule.getColHeaderTable()},e.prototype.getThreshold=function(t){var i=Math.round((this.viewport[t+"Count"]+1)/2);return i<15?15:i},e.prototype.isMobileView=function(){return(this.cssClass.indexOf("e-mobile-view")>-1||f.AR.isDevice)&&-1===this.cssClass.indexOf("e-desktop-view")&&!1},e.prototype.getValueRowCol=function(t,i,n,a,o,l){return s.prototype.getValueRowCol.call(this,t,i,n,a,o,l)},e.prototype.updateCell=function(t,i){i=i||this.getActiveSheet().activeCell,s.prototype.updateCell.call(this,t,i)},e.prototype.getRowData=function(t,i){return s.prototype.getRowData.call(this,t,i)},e.prototype.sort=function(t,i){var n=this;return this.allowSorting?s.prototype.sort.call(this,t,i).then(function(a){return n.notify(Ri,a),Promise.resolve(a)}):Promise.reject()},e.prototype.setValueRowCol=function(t,i,n,a,o){if("circular reference: "===i){var l={action:"isCircularReference",argValue:i};this.notify(tr,l),i=l.argValue}s.prototype.setValueRowCol.call(this,t,i,n,a,o),this.notify(fe,{action:"refreshDependentCellValue",rowIdx:n,colIdx:a,sheetIdx:ht(this,t)})},e.prototype.getModuleName=function(){return"spreadsheet"},e.prototype.refreshNode=function(t,i){var n;if(t){if(i){if(i.result=(0,f.le)(i.result)?"":i.result.toString(),!i.isRowFill){var a=(0,f.Ys)(".e-fill",t);a&&((0,f.og)(a),t.style.display="table-cell");var o=(0,f.Ys)(".e-fill-sec",t);o&&(0,f.og)(o)}var l=(0,f.Ys)("#"+this.element.id+"_currency",t);if(l&&(0,f.og)(l),"Accounting"===i.type&&te(i.value))return t.querySelector("a")?t.querySelector("a").textContent=i.result.split(i.curSymbol).join(""):t.innerHTML="",t.appendChild(this.createElement("span",{id:this.element.id+"_currency",innerHTML:""+i.curSymbol,styles:"float: left"})),t.querySelector("a")||(t.innerHTML+=i.result.split(i.curSymbol).join("")),void t.classList.add("e-right-align");var h=void 0;!i.result||"true"!==i.result.toLowerCase()&&"false"!==i.result.toLowerCase()?h="e-right-align":(i.result=i.result.toUpperCase(),h="e-center-align",i.isRightAlign=!0),n=i.result,i.isRightAlign?t.classList.add(h):t.classList.remove(h)}n=(0,f.le)(n)?"":n;var p=t.lastChild;t.querySelector(".e-databar-value")&&(p=t.querySelector(".e-databar-value").lastChild),t.querySelector(".e-hyperlink")&&(p=t.querySelector(".e-hyperlink").lastChild);var c=t.querySelector(".e-wrap-content");c&&(c.lastChild||c.appendChild(document.createTextNode("")),p=c.lastChild),!p||3!==p.nodeType&&1!==p.nodeType?t.appendChild(document.createTextNode(n)):i.isRowFill||(p.nodeValue=n)}},e.prototype.calculateHeight=function(t,i,n){void 0===i&&(i=1),void 0===n&&(n=1);var a=t&&t.fontSize||this.cellStyle.fontSize,o="Arial Black"===t.fontFamily?1.44:1.24;return(a.indexOf("pt")>-1?1.33*parseInt(a,10):parseInt(a,10))*o*i+n*o},e.prototype.skipHidden=function(t,i,n,a){void 0===n&&(n="rows"),void 0===a&&(a=this.scrollSettings.isFinite);var l,o=this.getActiveSheet();this.scrollSettings.isFinite&&(l=("rows"===n?o.rowCount:o.colCount)-1);for(var h=t;h<=i;h++)if(o[n][h]&&o[n][h].hidden){if(t===h&&t++,i++,a&&i>l){i=l;break}}else if(!a&&this.scrollSettings.isFinite&&i>l&&o[n][h-1]&&o[n][h-1].hidden){i--;break}return[t,i]},e.prototype.updateActiveBorder=function(t,i){void 0===i&&(i=".e-ribbon");var n=(0,f.Ys)(i+" .e-tab-header .e-indicator",this.element);n.style.display="none",(0,f.V7)(n,{left:"",right:""}),(0,f.V7)(n,{left:t.offsetLeft+"px",right:t.parentElement.offsetWidth-(t.offsetLeft+t.offsetWidth)+"px"}),n.style.display=""},e.prototype.undo=function(){this.notify(Gt,{isUndo:!0,isPublic:!0})},e.prototype.redo=function(){this.notify(Gt,{isUndo:!1,isPublic:!0})},e.prototype.updateUndoRedoCollection=function(t){this.notify(Jn,{args:t,isPublic:!0})},e.prototype.addDefinedName=function(t){var i={action:"addDefinedName",isAdded:!1,definedName:t};return this.notify(tr,i),i.isAdded},e.prototype.removeDefinedName=function(t,i){return s.prototype.removeDefinedName.call(this,t,i)},e.prototype.mouseClickHandler=function(t){this.notify(xr,t)},e.prototype.mouseDownHandler=function(t){this.notify(er,t)},e.prototype.keyUpHandler=function(t){(0,f.oq)(t.target,".e-find-dlg")?this.notify(ro,t):this.notify(lt,t)},e.prototype.keyDownHandler=function(t){(0,f.oq)(t.target,".e-findtool-dlg")||this.notify(Dt,t)},e.prototype.freeze=function(t){if(!(!this.allowFreezePane||t.row<0||t.column<0)){if(t.triggerEvent){var i={row:t.row,column:t.column,cancel:!1,sheetIndex:this.activeSheetIndex};if(this.notify(ue,{eventArgs:i,action:"freezePanes"}),i.cancel)return}this.on(Ye,this.freezePaneUpdated,this),this.freezePanes(t.row,t.column),this.notify(Jt,null)}},e.prototype.freezePaneUpdated=function(){this.off(Ye,this.freezePaneUpdated);var t=this.getActiveSheet();this.notify(Z,{eventArgs:{row:t.frozenRows,column:t.frozenColumns,sheetIndex:this.activeSheetIndex},action:"freezePanes"})},e.prototype.wireEvents=function(){f.bi.add(this.element,"click",this.mouseClickHandler,this),f.bi.add(this.element,Ia(),this.mouseDownHandler,this),f.bi.add(this.element,"keyup",this.keyUpHandler,this),f.bi.add(this.element,"keydown",this.keyDownHandler,this),f.bi.add(this.element,"noderefresh",this.refreshNode,this),this.on(Xi,this.freeze,this),this.on(hr,this.refreshInsertDelete,this)},e.prototype.destroy=function(){this[da]&&this[Nl](),this.unwireEvents(),this.notify(rt,null),s.prototype.destroy.call(this),this.element.innerHTML="",this.element.removeAttribute("tabindex"),this.element.removeAttribute("role"),this.element.style.removeProperty("height"),this.element.style.removeProperty("width"),this.element.style.removeProperty("min-height"),this.element.style.removeProperty("min-width"),this.sheetModule.destroy()},e.prototype.unwireEvents=function(){f.bi.remove(this.element,"click",this.mouseClickHandler),f.bi.remove(this.element,Ia(),this.mouseDownHandler),f.bi.remove(this.element,"keyup",this.keyUpHandler),f.bi.remove(this.element,"keydown",this.keyDownHandler),f.bi.remove(this.element,"noderefresh",this.refreshNode),this.off(Xi,this.freeze),this.off(hr,this.refreshInsertDelete)},e.prototype.refreshInsertDelete=function(t){var a,i=this;t.sheet.ranges.forEach(function(o){o.template&&o.address&&(a=A(o.address),i.updateRangeOnInsertDelete(t,a)&&(o.address=z(a)))}),this.setSheetPropertyOnMute(t.sheet,"ranges",t.sheet.ranges)},e.prototype.addContextMenuItems=function(t,i,n,a){void 0===n&&(n=!0),this.notify(Io,{items:t,text:i,insertAfter:n,isUniqueId:a})},e.prototype.removeContextMenuItems=function(t,i){this.notify(Eo,{items:t,isUniqueId:i})},e.prototype.enableContextMenuItems=function(t,i,n){void 0===i&&(i=!0),this.notify(ko,{items:t,enable:i,isUniqueId:n})},e.prototype.enableFileMenuItems=function(t,i,n){void 0===i&&(i=!0),this.notify(Ro,{items:t,enable:i,isUniqueId:n})},e.prototype.hideFileMenuItems=function(t,i,n){void 0===i&&(i=!0),this.notify(Fo,{items:t,hide:i,isUniqueId:n})},e.prototype.addFileMenuItems=function(t,i,n,a){void 0===n&&(n=!0),this.notify(To,{items:t,text:i,insertAfter:n,isUniqueId:a})},e.prototype.hideRibbonTabs=function(t,i){void 0===i&&(i=!0),this.notify(Ao,{tabs:t,hide:i})},e.prototype.enableRibbonTabs=function(t,i){void 0===i&&(i=!0),this.notify(Do,{tabs:t,enable:i})},e.prototype.addRibbonTabs=function(t,i){this.notify(Lo,{items:t,insertBefore:i})},e.prototype.enableToolbarItems=function(t,i,n){this.notify(dr,[{tab:t,items:i,enable:void 0===n||n}])},e.prototype.hideToolbarItems=function(t,i,n){void 0===n&&(n=!0),this.notify(No,{tab:t,indexes:i,hide:n})},e.prototype.addToolbarItems=function(t,i,n){this.notify(Oo,{tab:t,items:i,index:n})},e.prototype.selectRange=function(t){this.isEdit&&this.notify(fe,{action:"endEdit"}),this.notify(Er,{address:t})},e.prototype.startEdit=function(){this.notify(fe,{action:"startEdit",isNewValueEdit:!1})},e.prototype.closeEdit=function(){this.notify(fe,{action:"cancelEdit"})},e.prototype.endEdit=function(){this.notify(fe,{action:"endEdit"})},e.prototype.onPropertyChanged=function(t,i){var n=this;s.prototype.onPropertyChanged.call(this,t,i);for(var a=function(c){var d=void 0,u=void 0;switch(c){case"enableRtl":if((d=o.getColumnHeaderContent())&&(d=d.parentElement),!d)break;t.enableRtl?(d.style.marginLeft=Ds()+"px",d.style.marginRight="",document.getElementById(o.element.id+"_sheet_panel").classList.add("e-rtl")):(d.style.marginRight=Ds()+"px",d.style.marginLeft="",document.getElementById(o.element.id+"_sheet_panel").classList.remove("e-rtl")),-1===Object.keys(t).indexOf("locale")&&o.renderModule.refreshSheet();break;case"cssClass":i.cssClass&&(0,f.IV)([o.element],i.cssClass.split(" ")),t.cssClass&&(0,f.cn)([o.element],t.cssClass.split(" "));break;case"activeSheetIndex":o.renderModule.refreshSheet(),o.notify(Hi,{idx:t.activeSheetIndex});break;case"width":o.setWidth(),o.resize();break;case"height":o.setHeight(),o.resize();break;case"showRibbon":o.notify(Jr,{prop:"showRibbon",onPropertyChange:!0});break;case"showFormulaBar":o.notify(Oi,{uiUpdate:!0});break;case"showSheetTabs":o.notify(jn,null);break;case"cellStyle":o.renderModule.refreshSheet();break;case"allowEditing":if(o.allowEditing&&(o.notify(fe,{action:"renderEditor"}),o.enableKeyboardNavigation)){o.enableKeyboardNavigation=!1,o.dataBind(),o.enableKeyboardNavigation=!0,o.dataBind();var v=o.selectionSettings.mode;"None"!==v&&(o.selectionSettings.mode="None",o.dataBind(),o.selectionSettings.mode=v,o.dataBind())}break;case"allowInsert":(u=o.element.getElementsByClassName("e-add-sheet-tab")[0])&&(u.disabled=!o.allowInsert,o.allowInsert?u.classList.contains("e-disabled")&&u.classList.remove("e-disabled"):u.classList.contains("e-disabled")||u.classList.add("e-disabled"));break;case"sheets":if(t.sheets===o.sheets){o.renderModule.refreshSheet(),o.notify(pr,null),o.notify(ie,{action:"initSheetInfo"});break}var g;Object.keys(t.sheets).forEach(function(y,C){var b=t.sheets[y];if(b.ranges&&Object.keys(b.ranges).length){var w,S=Object.keys(b.ranges);S.forEach(function(P,M){b.ranges[P].info||(w=M)}),S.forEach(function(P,M){b.ranges[P].dataSource&&((0,f.o8)(w)||!(0,f.o8)(w)&&w===M)&&n.notify(_a,{sheetIdx:y,rangeIdx:P,isLastRange:S.length-1===M,changedData:b.ranges[P].dataSource})})}else if(b.paneTopLeftCell&&i.sheets&&i.sheets[y]&&i.sheets[y].paneTopLeftCell){if(n.activeSheetIndex!==Number(y))return;var x=B(b.paneTopLeftCell),I=B(i.sheets[y].paneTopLeftCell);if(x[0]!==I[0]){var F=n.frozenRowCount(n.getActiveSheet()),T=x[0]>F?Ce(n.getActiveSheet(),F,x[0]-1):0;n.notify(va,{top:T})}if(x[1]!==I[1]){var k=n.frozenColCount(n.getActiveSheet()),R=x[1]>k?ge(n.getActiveSheet(),k,x[1]-1):0;n.notify(va,{left:R})}}else if(0===C&&n.renderModule.refreshSheet(),n.showSheetTabs&&b.name&&!g){var D=(0,f.Ys)(".e-sheet-tabs-items",n.element),N=Number(y);D.children[N+1]?n.notify($n,{items:D,value:b.name,idx:N}):(n.notify(pr,null),g=!0)}});break;case"locale":o.refresh();break;case"currencyCode":o.notify("updateView",{});break;case"password":o.password.length>0&&o.showSheetTabs&&(o.element.querySelector(".e-add-sheet-tab").setAttribute("disabled","true"),o.element.querySelector(".e-add-sheet-tab").classList.add("e-disabled"));break;case"isProtected":if(o.isProtected){var m=o.element.getElementsByClassName("e-add-sheet-tab")[0];m&&(m.disabled=o.isProtected,o.isProtected?m.classList.contains("e-disabled")&&m.classList.add("e-disabled"):m.classList.contains("e-disabled")||m.classList.remove("e-disabled"))}break;case"allowFreezePane":o.notify(Jr,{prop:"allowFreezePane",onPropertyChange:!0})}},o=this,l=0,h=Object.keys(t);l<h.length;l++)a(h[l])},e.prototype.requiredModules=function(){return function(s){var e=[];return function(s,e){e.push({member:"basic",args:[]}),e.push({member:"all",args:[]}),s.showRibbon&&e.push({member:"ribbon",args:[s]}),s.showFormulaBar&&e.push({member:"formulaBar",args:[s]}),s.showSheetTabs&&e.push({member:"sheetTabs",args:[s]}),s.allowEditing&&(e.push({member:"edit",args:[s]}),e.push({member:"formula",args:[s]}),e.push({member:"workbookFormula",args:[s]}),e.push({member:"workbookEdit",args:[s]})),s.allowOpen&&e.push({member:"open",args:[s]}),s.allowSave&&e.push({member:"save",args:[s]}),s.enableContextMenu&&e.push({member:"contextMenu",args:[s]}),s.allowAutoFill&&e.push({member:"autofill",args:[s]}),"None"!==s.selectionSettings.mode&&e.push({member:"selection",args:[s]}),s.enableKeyboardNavigation&&e.push({member:"keyboardNavigation",args:[s]}),s.allowNumberFormatting&&e.push({member:"numberFormat",args:[s]}),s.enableKeyboardShortcut&&e.push({member:"keyboardShortcut",args:[s]}),s.enableClipboard&&e.push({member:"clipboard",args:[s]}),s.allowCellFormatting&&e.push({member:"cellformat",args:[s]}),s.allowSorting&&e.push({member:"sort",args:[s]}),s.allowResizing&&e.push({member:"resize",args:[s]}),e.push({member:"collaborativeEditing",args:[s]}),e.push({member:"protectSheet",args:[s]}),s.allowHyperlink&&e.push({member:"spreadsheetHyperlink",args:[s]}),s.allowUndoRedo&&e.push({member:"undoredo",args:[s]}),s.allowFiltering&&e.push({member:"filter",args:[s]}),s.allowWrap&&e.push({member:"wrapText",args:[s]}),s.allowInsert&&e.push({member:"insert",args:[s]}),s.allowDelete&&e.push({member:"delete",args:[s]}),s.allowDataValidation&&e.push({member:"dataValidation",args:[s]}),s.allowFindAndReplace&&e.push({member:"findAndReplace",args:[s]}),s.allowMerge&&e.push({member:"merge",args:[s]}),s.allowConditionalFormat&&e.push({member:"conditionalFormatting",args:[s]}),s.allowImage&&e.push({member:"spreadsheetImage",args:[s]}),s.allowChart&&e.push({member:"spreadsheetChart",args:[s]})}(s,e),Pl(s,e),e}(this)},e.prototype.appendTo=function(t){s.prototype.appendTo.call(this,t)},e.prototype.filter=function(t,i){return this.allowFiltering?(i=i||this.getActiveSheet().selectedRange,s.prototype.filter.call(this,t,i)):Promise.reject()},e.prototype.clearFilter=function(t){this.notify(zi,{field:t})},e.prototype.applyFilter=function(t,i){if(!this.allowFiltering)return Promise.reject();var a={predicates:t,range:i,isInternal:!0,promise:new Promise(function(o,l){o(void 0)})};return this.notify(jt,a),a.promise},e.prototype.addCustomFunction=function(t,i,n){s.prototype.addCustomFunction.call(this,t,i,n),this.notify(Wo,null)},he([(0,f.Z9)("")],e.prototype,"cssClass",void 0),he([(0,f.Z9)(!0)],e.prototype,"allowScrolling",void 0),he([(0,f.Z9)(!0)],e.prototype,"allowResizing",void 0),he([(0,f.Z9)(!0)],e.prototype,"showAggregate",void 0),he([(0,f.Z9)(!0)],e.prototype,"enableClipboard",void 0),he([(0,f.Z9)(!0)],e.prototype,"enableContextMenu",void 0),he([(0,f.Z9)(!0)],e.prototype,"enableKeyboardNavigation",void 0),he([(0,f.Z9)(!0)],e.prototype,"enableKeyboardShortcut",void 0),he([(0,f.Z9)(!0)],e.prototype,"allowUndoRedo",void 0),he([(0,f.Z9)(!0)],e.prototype,"allowWrap",void 0),he([(0,f.Zz)({},Dp)],e.prototype,"selectionSettings",void 0),he([(0,f.Zz)({},Ap)],e.prototype,"scrollSettings",void 0),he([(0,f.ju)()],e.prototype,"beforeCellRender",void 0),he([(0,f.ju)()],e.prototype,"beforeSelect",void 0),he([(0,f.ju)()],e.prototype,"select",void 0),he([(0,f.ju)()],e.prototype,"contextMenuBeforeOpen",void 0),he([(0,f.ju)()],e.prototype,"fileMenuBeforeOpen",void 0),he([(0,f.ju)()],e.prototype,"contextMenuBeforeClose",void 0),he([(0,f.ju)()],e.prototype,"dialogBeforeOpen",void 0),he([(0,f.ju)()],e.prototype,"fileMenuBeforeClose",void 0),he([(0,f.ju)()],e.prototype,"contextMenuItemSelect",void 0),he([(0,f.ju)()],e.prototype,"fileMenuItemSelect",void 0),he([(0,f.ju)()],e.prototype,"beforeDataBound",void 0),he([(0,f.ju)()],e.prototype,"dataBound",void 0),he([(0,f.ju)()],e.prototype,"dataSourceChanged",void 0),he([(0,f.ju)()],e.prototype,"cellEdit",void 0),he([(0,f.ju)()],e.prototype,"cellEditing",void 0),he([(0,f.ju)()],e.prototype,"cellSave",void 0),he([(0,f.ju)()],e.prototype,"beforeCellSave",void 0),he([(0,f.ju)()],e.prototype,"created",void 0),he([(0,f.ju)()],e.prototype,"beforeSort",void 0),he([(0,f.ju)()],e.prototype,"beforeHyperlinkCreate",void 0),he([(0,f.ju)()],e.prototype,"afterHyperlinkCreate",void 0),he([(0,f.ju)()],e.prototype,"beforeHyperlinkClick",void 0),he([(0,f.ju)()],e.prototype,"afterHyperlinkClick",void 0),he([(0,f.ju)()],e.prototype,"beforeConditionalFormat",void 0),he([(0,f.ju)()],e.prototype,"actionBegin",void 0),he([(0,f.ju)()],e.prototype,"actionComplete",void 0),he([(0,f.ju)()],e.prototype,"openComplete",void 0),he([(0,f.ju)()],e.prototype,"sortComplete",void 0),he([(0,f.Z9)("USD")],e.prototype,"currencyCode",void 0),r=he([f.Zl],e)}(Fs);const uh=["template"];let Wp=["height","id","left","src","top","width"],Gp=[],jp=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(Gp),this.directivePropList=Wp}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-image"]],inputs:{height:"height",id:"id",left:"left",src:"src",top:"top",width:"width"},features:[H.qOj]}),s})(),Yp=(()=>{class s extends me.wR{constructor(){super("image")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-images"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,jp,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})(),Xp=["dataLabelSettings","height","id","isSeriesInRows","legendSettings","primaryXAxis","primaryYAxis","range","theme","title","type","width"],Zp=[],Kp=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(Zp),this.directivePropList=Xp}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-chart"]],inputs:{dataLabelSettings:"dataLabelSettings",height:"height",id:"id",isSeriesInRows:"isSeriesInRows",legendSettings:"legendSettings",primaryXAxis:"primaryXAxis",primaryYAxis:"primaryYAxis",range:"range",theme:"theme",title:"title",type:"type",width:"width"},features:[H.qOj]}),s})(),$p=(()=>{class s extends me.wR{constructor(){super("chart")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-charts"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,Kp,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})(),Qp=["chart","colSpan","format","formula","hyperlink","image","index","isLocked","rowSpan","style","validation","value","wrap"],Jp=[],ec=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,this.tags=["image","chart"],(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(Jp),this.directivePropList=Qp}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-cell"]],contentQueries:function(r,t,i){if(1&r&&(H.Suo(i,Yp,5),H.Suo(i,$p,5)),2&r){let n;H.iGM(n=H.CRH())&&(t.childImage=n.first),H.iGM(n=H.CRH())&&(t.childChart=n.first)}},inputs:{chart:"chart",colSpan:"colSpan",format:"format",formula:"formula",hyperlink:"hyperlink",image:"image",index:"index",isLocked:"isLocked",rowSpan:"rowSpan",style:"style",validation:"validation",value:"value",wrap:"wrap"},features:[H.qOj]}),s})(),tc=(()=>{class s extends me.wR{constructor(){super("cells")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-cells"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,ec,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})(),rc=["cells","customHeight","format","height","hidden","index"],ic=[],nc=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,this.tags=["cells"],(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(ic),this.directivePropList=rc}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-row"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,tc,5),2&r){let n;H.iGM(n=H.CRH())&&(t.childCells=n.first)}},inputs:{cells:"cells",customHeight:"customHeight",format:"format",height:"height",hidden:"hidden",index:"index"},features:[H.qOj]}),s})(),ac=(()=>{class s extends me.wR{constructor(){super("rows")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-rows"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,nc,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})(),oc=["customWidth","format","hidden","index","isLocked","validation","width"],sc=[],lc=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(sc),this.directivePropList=oc}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-column"]],inputs:{customWidth:"customWidth",format:"format",hidden:"hidden",index:"index",isLocked:"isLocked",validation:"validation",width:"width"},features:[H.qOj]}),s})(),hc=(()=>{class s extends me.wR{constructor(){super("columns")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-columns"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,lc,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})(),pc=["address","dataSource","query","showFieldAsHeader","startCell","template"],cc=[],dc=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(cc),this.directivePropList=pc}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-range"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,uh,5),2&r){let n;H.iGM(n=H.CRH())&&(t.template=n.first)}},inputs:{address:"address",dataSource:"dataSource",query:"query",showFieldAsHeader:"showFieldAsHeader",startCell:"startCell",template:"template"},features:[H.qOj]}),(0,Ua.gn)([(0,me.YS)()],s.prototype,"template",void 0),s})(),fc=(()=>{class s extends me.wR{constructor(){super("ranges")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-ranges"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,dc,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})(),uc=["cFColor","format","range","type","value"],vc=[],mc=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(vc),this.directivePropList=uc}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-conditionalformat"]],inputs:{cFColor:"cFColor",format:"format",range:"range",type:"type",value:"value"},features:[H.qOj]}),s})(),gc=(()=>{class s extends me.wR{constructor(){super("conditionalformats")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-conditionalformats"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,mc,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})(),yc=["activeCell","colCount","columns","conditionalFormats","frozenColumns","frozenRows","index","isProtected","name","paneTopLeftCell","password","protectSettings","ranges","rowCount","rows","selectedRange","showGridLines","showHeaders","state","topLeftCell","usedRange"],Cc=[],bc=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,this.tags=["rows","columns","ranges","conditionalFormats"],(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(Cc),this.directivePropList=yc}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-sheet"]],contentQueries:function(r,t,i){if(1&r&&(H.Suo(i,ac,5),H.Suo(i,hc,5),H.Suo(i,fc,5),H.Suo(i,gc,5)),2&r){let n;H.iGM(n=H.CRH())&&(t.childRows=n.first),H.iGM(n=H.CRH())&&(t.childColumns=n.first),H.iGM(n=H.CRH())&&(t.childRanges=n.first),H.iGM(n=H.CRH())&&(t.childConditionalFormats=n.first)}},inputs:{activeCell:"activeCell",colCount:"colCount",columns:"columns",conditionalFormats:"conditionalFormats",frozenColumns:"frozenColumns",frozenRows:"frozenRows",index:"index",isProtected:"isProtected",name:"name",paneTopLeftCell:"paneTopLeftCell",password:"password",protectSettings:"protectSettings",ranges:"ranges",rowCount:"rowCount",rows:"rows",selectedRange:"selectedRange",showGridLines:"showGridLines",showHeaders:"showHeaders",state:"state",topLeftCell:"topLeftCell",usedRange:"usedRange"},features:[H.qOj]}),s})(),Sc=(()=>{class s extends me.wR{constructor(){super("sheets")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-sheets"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,bc,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})(),wc=["comment","name","refersTo","scope"],xc=[],Ic=(()=>{class s extends me.bn{constructor(r){super(),this.viewContainerRef=r,(0,me.sO)("currentInstance",this,this.viewContainerRef),this.registerEvents(xc),this.directivePropList=wc}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.s_b))},s.\u0275dir=H.lG2({type:s,selectors:[["e-definedname"]],inputs:{comment:"comment",name:"name",refersTo:"refersTo",scope:"scope"},features:[H.qOj]}),s})(),Ec=(()=>{class s extends me.wR{constructor(){super("definednames")}}return s.\u0275fac=function(r){return new(r||s)},s.\u0275dir=H.lG2({type:s,selectors:[["e-definednames"]],contentQueries:function(r,t,i){if(1&r&&H.Suo(i,Ic,4),2&r){let n;H.iGM(n=H.CRH())&&(t.children=n)}},features:[H.qOj]}),s})();const kc=["actionBegin","actionComplete","afterHyperlinkClick","afterHyperlinkCreate","beforeCellFormat","beforeCellRender","beforeCellSave","beforeCellUpdate","beforeConditionalFormat","beforeDataBound","beforeHyperlinkClick","beforeHyperlinkCreate","beforeOpen","beforeSave","beforeSelect","beforeSort","cellEdit","cellEditing","cellSave","contextMenuBeforeClose","contextMenuBeforeOpen","contextMenuItemSelect","created","dataBound","dataSourceChanged","dialogBeforeOpen","fileMenuBeforeClose","fileMenuBeforeOpen","fileMenuItemSelect","openComplete","openFailure","queryCellInfo","saveComplete","select","sortComplete"],Rc=[""];let Fc=(()=>{let s=class extends hl{constructor(r,t,i,n){super(),this.ngEle=r,this.srenderer=t,this.viewContainerRef=i,this.injector=n,this.tags=["sheets","definedNames"],this.element=this.ngEle.nativeElement,this.injectedModules=this.injectedModules||[];try{let a=this.injector.get("SpreadsheetClipboard");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetEdit");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetKeyboardNavigation");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetKeyboardShortcut");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetCollaborativeEditing");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetSelection");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetContextMenu");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetFormulaBar");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetRibbon");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetSave");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetOpen");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetSheetTabs");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetDataBind");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetAllModule");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetBasicModule");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetCellFormat");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetNumberFormat");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}try{let a=this.injector.get("SpreadsheetFormula");-1===this.injectedModules.indexOf(a)&&this.injectedModules.push(a)}catch(a){}this.registerEvents(kc),this.addTwoWay.call(this,Rc),(0,me.sO)("currentInstance",this,this.viewContainerRef),this.context=new me.VZ}ngOnInit(){this.context.ngOnInit(this)}ngAfterViewInit(){this.context.ngAfterViewInit(this)}ngOnDestroy(){this.context.ngOnDestroy(this)}ngAfterContentChecked(){this.tagObjects[0].instance=this.childSheets,this.childDefinedNames&&(this.tagObjects[1].instance=this.childDefinedNames),this.context.ngAfterContentChecked(this)}};return s.\u0275fac=function(r){return new(r||s)(H.Y36(H.SBq),H.Y36(H.Qsj),H.Y36(H.s_b),H.Y36(H.zs3))},s.\u0275cmp=H.Xpm({type:s,selectors:[["ejs-spreadsheet"]],contentQueries:function(r,t,i){if(1&r&&(H.Suo(i,uh,5),H.Suo(i,Sc,5),H.Suo(i,Ec,5)),2&r){let n;H.iGM(n=H.CRH())&&(t.template=n.first),H.iGM(n=H.CRH())&&(t.childSheets=n.first),H.iGM(n=H.CRH())&&(t.childDefinedNames=n.first)}},inputs:{activeSheetIndex:"activeSheetIndex",allowAutoFill:"allowAutoFill",allowCellFormatting:"allowCellFormatting",allowChart:"allowChart",allowConditionalFormat:"allowConditionalFormat",allowDataValidation:"allowDataValidation",allowDelete:"allowDelete",allowEditing:"allowEditing",allowFiltering:"allowFiltering",allowFindAndReplace:"allowFindAndReplace",allowFreezePane:"allowFreezePane",allowHyperlink:"allowHyperlink",allowImage:"allowImage",allowInsert:"allowInsert",allowMerge:"allowMerge",allowNumberFormatting:"allowNumberFormatting",allowOpen:"allowOpen",allowResizing:"allowResizing",allowSave:"allowSave",allowScrolling:"allowScrolling",allowSorting:"allowSorting",allowUndoRedo:"allowUndoRedo",allowWrap:"allowWrap",autoFillSettings:"autoFillSettings",cellStyle:"cellStyle",cssClass:"cssClass",currencyCode:"currencyCode",definedNames:"definedNames",enableClipboard:"enableClipboard",enableContextMenu:"enableContextMenu",enableKeyboardNavigation:"enableKeyboardNavigation",enableKeyboardShortcut:"enableKeyboardShortcut",enablePersistence:"enablePersistence",enableRtl:"enableRtl",height:"height",isProtected:"isProtected",locale:"locale",openUrl:"openUrl",password:"password",saveUrl:"saveUrl",scrollSettings:"scrollSettings",selectionSettings:"selectionSettings",sheets:"sheets",showAggregate:"showAggregate",showFormulaBar:"showFormulaBar",showRibbon:"showRibbon",showSheetTabs:"showSheetTabs",width:"width"},outputs:{actionBegin:"actionBegin",actionComplete:"actionComplete",afterHyperlinkClick:"afterHyperlinkClick",afterHyperlinkCreate:"afterHyperlinkCreate",beforeCellFormat:"beforeCellFormat",beforeCellRender:"beforeCellRender",beforeCellSave:"beforeCellSave",beforeCellUpdate:"beforeCellUpdate",beforeConditionalFormat:"beforeConditionalFormat",beforeDataBound:"beforeDataBound",beforeHyperlinkClick:"beforeHyperlinkClick",beforeHyperlinkCreate:"beforeHyperlinkCreate",beforeOpen:"beforeOpen",beforeSave:"beforeSave",beforeSelect:"beforeSelect",beforeSort:"beforeSort",cellEdit:"cellEdit",cellEditing:"cellEditing",cellSave:"cellSave",contextMenuBeforeClose:"contextMenuBeforeClose",contextMenuBeforeOpen:"contextMenuBeforeOpen",contextMenuItemSelect:"contextMenuItemSelect",created:"created",dataBound:"dataBound",dataSourceChanged:"dataSourceChanged",dialogBeforeOpen:"dialogBeforeOpen",fileMenuBeforeClose:"fileMenuBeforeClose",fileMenuBeforeOpen:"fileMenuBeforeOpen",fileMenuItemSelect:"fileMenuItemSelect",openComplete:"openComplete",openFailure:"openFailure",queryCellInfo:"queryCellInfo",saveComplete:"saveComplete",select:"select",sortComplete:"sortComplete"},features:[H.qOj],decls:0,vars:0,template:function(r,t){},encapsulation:2,changeDetection:0}),(0,Ua.gn)([(0,me.YS)()],s.prototype,"template",void 0),s=(0,Ua.gn)([(0,me.jm)([me.VZ])],s),s})(),Tc=(()=>{class s{}return s.\u0275fac=function(r){return new(r||s)},s.\u0275mod=H.oAB({type:s}),s.\u0275inj=H.cJS({imports:[[fl.ez]]}),s})();var Ac=Ue(6007),Dc=Ue(4697);const Lc=["spreadsheet"];let Oc=(()=>{class s{constructor(r,t){this.shared=r,this.driveService=t,this.file=[]}ngOnInit(){}loadDoc(){if(null==localStorage.getItem("localFile"))return;let r=JSON.parse(localStorage.getItem("localFile"));localStorage.removeItem("localFile"),this.file=r,this.shared.http.get(r.fileUrl,{responseType:"blob"}).subscribe(t=>{let i=new File([t],r.fileName);this.spreadsheetObj.open({file:i})})}saveResult(){}}return s.\u0275fac=function(r){return new(r||s)(H.Y36(Ac.F),H.Y36(Dc.w))},s.\u0275cmp=H.Xpm({type:s,selectors:[["app-excel"]],viewQuery:function(r,t){if(1&r&&H.Gf(Lc,5),2&r){let i;H.iGM(i=H.CRH())&&(t.spreadsheetObj=i.first)}},decls:4,vars:0,consts:[[1,"navbar","navbar-expand-md","navbar-dark","fixed-top"],[1,"excel"],["height","657px","openUrl","https://ej2services.syncfusion.com/production/web-services/api/spreadsheet/open","allowOpen","true",2,"display","block",3,"created"],["spreadsheet",""]],template:function(r,t){1&r&&(H._UZ(0,"nav",0),H.TgZ(1,"div",1),H.TgZ(2,"ejs-spreadsheet",2,3),H.NdJ("created",function(){return t.loadDoc()}),H.qZA(),H.qZA())},directives:[Fc],styles:[".excel[_ngcontent-%COMP%]{margin-top:56px}nav[_ngcontent-%COMP%]{background-color:var(--dark-color);height:56px}"]}),s})();var Nc=Ue(6901);const Mc=[{path:"",component:Oc}];let Bc=(()=>{class s{}return s.\u0275fac=function(r){return new(r||s)},s.\u0275mod=H.oAB({type:s}),s.\u0275inj=H.cJS({imports:[[fl.ez,Tc,Nc.Bz.forChild(Mc)]]}),s})()}}]);